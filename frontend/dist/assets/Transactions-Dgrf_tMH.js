import{u as e,j as a}from"./data-vendor-C6mPcuPT.js";import{r as s}from"./react-vendor-C4Xey-hE.js";import{f as l,B as r,C as t,D as i,a as n,E as c}from"./index-DRIXW4Ut.js";import{u as d,f as o,a as x}from"./table-vendor-BZVOk-Gl.js";import{c as m}from"./ui-vendor-CMKyyIMz.js";import{a as h,F as u,b as g,c as v}from"./FunnelIcon-BZn0xH1b.js";import{F as j}from"./MagnifyingGlassIcon-D7UyJAmN.js";import"./chart-vendor-Be69IwoK.js";const p=[{value:"",label:"All Types"},{value:"new",label:"New Subscription"},{value:"renewal",label:"Renewal"},{value:"change_service",label:"Change Service"},{value:"refund",label:"Refund"},{value:"transfer",label:"Transfer"},{value:"withdraw",label:"Withdrawal"},{value:"reset_fup",label:"Reset FUP"},{value:"refill",label:"Refill"}];function N(){var N,b,f,y,w,_;const[C,F]=s.useState(1),[S]=s.useState(25),[R,M]=s.useState(""),[K,T]=s.useState(""),[D,P]=s.useState(""),[$,k]=s.useState(""),[A,I]=s.useState(!1),{data:U,isLoading:q,refetch:B}=e({queryKey:["transactions",C,S,R,K,D,$],queryFn:()=>c.transactions({page:C,limit:S,search:R,type:K,date_from:D,date_to:$}).then(e=>e.data)}),E=s.useMemo(()=>[{accessorKey:"created_at",header:"Date",cell:({row:e})=>a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{children:l(e.original.created_at)}),a.jsx("div",{className:"text-gray-500",children:r(e.original.created_at)})]})},{accessorKey:"type",header:"Type",cell:({row:e})=>a.jsx("span",{className:m("badge",{new:"badge-success",renewal:"badge-info",change_service:"badge-purple",refund:"badge-warning",transfer:"badge-primary",withdraw:"badge-danger",reset_fup:"badge-orange",refill:"badge-success",adjustment:"badge-gray"}[e.original.type]||"badge-gray"),children:{new:"New",renewal:"Renewal",change_service:"Change Service",refund:"Refund",transfer:"Transfer",withdraw:"Withdrawal",reset_fup:"Reset FUP",refill:"Refill"}[e.original.type]||e.original.type})},{accessorKey:"subscriber",header:"User",cell:({row:e})=>{var s,l,r;return a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:(null==(s=e.original.subscriber)?void 0:s.username)||"-"}),a.jsx("div",{className:"text-sm text-gray-500",children:(null==(l=e.original.subscriber)?void 0:l.fullname)||(null==(r=e.original.reseller)?void 0:r.username)||""})]})}},{accessorKey:"service",header:"Service",cell:({row:e})=>{const s=e.original;return"change_service"===s.type&&(s.old_service_name||s.new_service_name)?a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"text-gray-500",children:s.old_service_name||"-"}),a.jsx("span",{className:"mx-1 text-gray-400",children:"â†’"}),a.jsx("span",{className:"font-medium text-primary-600",children:s.new_service_name||"-"})]}):s.service_name?a.jsx("span",{className:"text-sm",children:s.service_name}):a.jsx("span",{className:"text-sm text-gray-400",children:"-"})}},{accessorKey:"amount",header:"Amount",cell:({row:e})=>a.jsxs("div",{className:m("flex items-center gap-1 font-semibold",e.original.amount>=0?"text-green-600":"text-red-600"),children:[e.original.amount>=0?a.jsx(t,{className:"w-4 h-4"}):a.jsx(i,{className:"w-4 h-4"}),"$",Math.abs(e.original.amount).toFixed(2)]})},{accessorKey:"balance_after",header:"Balance After",cell:({row:e})=>{var a;return void 0!==e.original.balance_after?`$${null==(a=e.original.balance_after)?void 0:a.toFixed(2)}`:"-"}},{accessorKey:"description",header:"Description",cell:({row:e})=>a.jsx("div",{className:"max-w-xs truncate text-sm text-gray-600",children:e.original.description||"-"})},{accessorKey:"reference",header:"Reference",cell:({row:e})=>a.jsx("code",{className:"text-xs px-2 py-1 bg-gray-100 rounded",children:e.original.reference||"-"})}],[]),G=d({data:(null==U?void 0:U.data)||[],columns:E,getCoreRowModel:x()}),W=Math.ceil(((null==(N=null==U?void 0:U.meta)?void 0:N.total)||0)/S),H=(null==(b=null==U?void 0:U.data)?void 0:b.reduce((e,a)=>a.amount>0?e+a.amount:e,0))||0,L=(null==(f=null==U?void 0:U.data)?void 0:f.reduce((e,a)=>a.amount<0?e+Math.abs(a.amount):e,0))||0;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Transactions"}),a.jsx("p",{className:"text-gray-500",children:"Financial transaction history"})]}),a.jsxs("button",{onClick:()=>B(),className:"btn-secondary flex items-center gap-2",children:[a.jsx(n,{className:"w-4 h-4"}),"Refresh"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(h,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Total Transactions"}),a.jsx("div",{className:"text-2xl font-bold",children:(null==(y=null==U?void 0:U.meta)?void 0:y.total)||0})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(t,{className:"w-5 h-5 text-green-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Page Income"}),a.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",H.toFixed(2)]})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx(i,{className:"w-5 h-5 text-red-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Page Expense"}),a.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",L.toFixed(2)]})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(h,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Page Net"}),a.jsxs("div",{className:m("text-2xl font-bold",H-L>=0?"text-green-600":"text-red-600"),children:["$",(H-L).toFixed(2)]})]})]})})]}),a.jsxs("div",{className:"card p-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search by username, description, reference...",value:R,onChange:e=>{M(e.target.value),F(1)},className:"input pl-10"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("select",{value:K,onChange:e=>{T(e.target.value),F(1)},className:"input",children:p.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsxs("button",{onClick:()=>I(!A),className:m("btn-secondary flex items-center gap-2",A&&"bg-primary-50 text-primary-600"),children:[a.jsx(u,{className:"w-4 h-4"}),"Filters"]})]})]}),A&&a.jsxs("div",{className:"mt-4 pt-4 border-t grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"label",children:"Date From"}),a.jsx("input",{type:"date",value:D,onChange:e=>{P(e.target.value),F(1)},className:"input"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"label",children:"Date To"}),a.jsx("input",{type:"date",value:$,onChange:e=>{k(e.target.value),F(1)},className:"input"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{M(""),T(""),P(""),k(""),F(1)},className:"btn-secondary",children:"Clear Filters"})})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:G.getHeaderGroups().map(e=>a.jsx("tr",{children:e.headers.map(e=>a.jsx("th",{children:o(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:q?a.jsx("tr",{children:a.jsx("td",{colSpan:E.length,className:"text-center py-8",children:a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===G.getRowModel().rows.length?a.jsx("tr",{children:a.jsx("td",{colSpan:E.length,className:"text-center py-8 text-gray-500",children:"No transactions found"})}):G.getRowModel().rows.map(e=>a.jsx("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>a.jsx("td",{children:o(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t",children:[a.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(C-1)*S+1," to ",Math.min(C*S,(null==(w=null==U?void 0:U.meta)?void 0:w.total)||0)," of"," ",(null==(_=null==U?void 0:U.meta)?void 0:_.total)||0," results"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>F(e=>Math.max(1,e-1)),disabled:1===C,className:"btn-secondary p-2 disabled:opacity-50",children:a.jsx(g,{className:"w-5 h-5"})}),a.jsxs("span",{className:"px-4 py-2 text-sm",children:["Page ",C," of ",W||1]}),a.jsx("button",{onClick:()=>F(e=>Math.min(W,e+1)),disabled:C>=W,className:"btn-secondary p-2 disabled:opacity-50",children:a.jsx(v,{className:"w-5 h-5"})})]})]})]})]})}export{N as default};
