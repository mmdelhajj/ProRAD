import{b as e,u as t,d as s,j as a}from"./data-vendor-C6mPcuPT.js";import{r as l}from"./react-vendor-C4Xey-hE.js";import{y as d}from"./index-DmOIf-MM.js";import{z as r}from"./ui-vendor-CMKyyIMz.js";import{F as n}from"./PlayIcon-0-RjI_79.js";import"./chart-vendor-Be69IwoK.js";function i(){const i=e(),[c,o]=l.useState(!1),[u,m]=l.useState(null),[x,p]=l.useState({name:"",start_time:"16:00",end_time:"23:00",days_of_week:[0,1,2,3,4,5,6],speed_multiplier:50,cdn_ids:[],priority:10,enabled:!0,auto_apply:!0}),{data:h,isLoading:g}=t({queryKey:["cdn-bandwidth-rules"],queryFn:()=>d.get("/cdn-bandwidth-rules").then(e=>e.data.data||[])}),{data:b}=t({queryKey:["cdns"],queryFn:()=>d.get("/cdns").then(e=>e.data.data||[])}),y=s({mutationFn:e=>d.post("/cdn-bandwidth-rules",e),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),r.success("CDN bandwidth rule created"),_()},onError:e=>{var t,s;r.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)||"Failed to create rule")}}),N=s({mutationFn:({id:e,...t})=>d.put(`/cdn-bandwidth-rules/${e}`,t),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),r.success("CDN bandwidth rule updated"),_()},onError:e=>{var t,s;r.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)||"Failed to update rule")}}),j=s({mutationFn:e=>d.delete(`/cdn-bandwidth-rules/${e}`),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),r.success("Rule deleted")}}),f=s({mutationFn:({id:e,enabled:t})=>d.put(`/cdn-bandwidth-rules/${e}`,{enabled:t}),onSuccess:()=>i.invalidateQueries(["cdn-bandwidth-rules"])}),v=s({mutationFn:e=>d.post(`/cdn-bandwidth-rules/${e}/apply`),onSuccess:e=>{r.success(`CDN rule applied to ${e.data.applied_count} queues`)},onError:e=>{var t,s;r.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)||"Failed to apply rule")}}),w=[{value:0,label:"Sun"},{value:1,label:"Mon"},{value:2,label:"Tue"},{value:3,label:"Wed"},{value:4,label:"Thu"},{value:5,label:"Fri"},{value:6,label:"Sat"}],_=()=>{o(!1),m(null),p({name:"",start_time:"16:00",end_time:"23:00",days_of_week:[0,1,2,3,4,5,6],speed_multiplier:50,cdn_ids:[],priority:10,enabled:!0,auto_apply:!0})},k=e=>{if(!e||0===e.length)return"No CDNs selected";const t=e.map(e=>{var t;return null==(t=null==b?void 0:b.find(t=>t.id===e))?void 0:t.name}).filter(Boolean);return t.length>0?t.join(", "):"No CDNs selected"};return g?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"CDN Bandwidth Rules"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure time-based CDN speed adjustments (e.g., reduce CDN speed during peak hours)"})]}),a.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Rule"})]}),a.jsxs("div",{className:"bg-orange-50 border border-orange-200 p-4 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-orange-900",children:"Time-Based CDN Bandwidth Rules"}),a.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Create rules to adjust CDN speeds during peak hours. For example, reduce CDN traffic to 50% during evening hours (16:00-23:00) to prioritize regular user traffic. Enable Auto Apply to have rules activate automatically on schedule."})]}),a.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CDNs"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Schedule"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Speed"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(h||[]).map(e=>{return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:k(e.cdn_ids)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.jsxs("div",{children:[a.jsxs("div",{children:[e.start_time," - ",e.end_time]}),a.jsx("div",{className:"text-xs",children:(t=e.days_of_week,t&&0!==t.length?7===t.length?"Every day":JSON.stringify([...t].sort())===JSON.stringify([1,2,3,4,5])?"Weekdays":JSON.stringify([...t].sort())===JSON.stringify([0,6])?"Weekends":t.map(e=>{var t;return null==(t=w.find(t=>t.value===e))?void 0:t.label}).join(", "):"Never")})]})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[a.jsxs("span",{className:"font-medium "+(e.speed_multiplier>100?"text-green-600":e.speed_multiplier<100?"text-orange-600":"text-gray-600"),children:[e.speed_multiplier,"%"]}),e.speed_multiplier<100&&a.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",100-e.speed_multiplier,"% reduction)"]})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>f.mutate({id:e.id,enabled:!e.enabled}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 "+(e.enabled?"bg-blue-600":"bg-gray-200"),children:a.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow transition duration-200 "+(e.enabled?"translate-x-5":"translate-x-0")})}),e.auto_apply&&a.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-green-100 text-green-700 rounded font-medium",children:"AUTO"})]})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[a.jsxs("button",{onClick:()=>v.mutate(e.id),disabled:v.isPending,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded hover:bg-green-200 mr-2",title:"Apply Now",children:[a.jsx(n,{className:"w-3 h-3 mr-1"}),"Apply"]}),a.jsx("button",{onClick:()=>(e=>{m(e),p({name:e.name,start_time:e.start_time||"16:00",end_time:e.end_time||"23:00",days_of_week:e.days_of_week||[0,1,2,3,4,5,6],speed_multiplier:e.speed_multiplier||100,cdn_ids:e.cdn_ids||[],priority:e.priority||10,enabled:e.enabled,auto_apply:e.auto_apply||!1}),o(!0)})(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Edit"}),a.jsx("button",{onClick:()=>{confirm("Delete this rule?")&&j.mutate(e.id)},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var t})})]}),0===(h||[]).length&&a.jsx("div",{className:"text-center py-8 text-gray-500",children:'No CDN bandwidth rules configured. Click "Add Rule" to create one.'})]}),c&&a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[a.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:_}),a.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:u?"Edit CDN Bandwidth Rule":"Add CDN Bandwidth Rule"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),0!==x.cdn_ids.length?u?N.mutate({id:u.id,...x}):y.mutate(x):r.error("Please select at least one CDN")},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rule Name"}),a.jsx("input",{type:"text",value:x.name,onChange:e=>p({...x,name:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"e.g., Peak Hours CDN Limit, Evening CDN Reduction",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Time"}),a.jsx("input",{type:"time",value:x.start_time,onChange:e=>p({...x,start_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Time"}),a.jsx("input",{type:"time",value:x.end_time,onChange:e=>p({...x,end_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Days of Week"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(e=>a.jsx("button",{type:"button",onClick:()=>(e=>{const t=x.days_of_week.includes(e)?x.days_of_week.filter(t=>t!==e):[...x.days_of_week,e].sort();p({...x,days_of_week:t})})(e.value),className:"px-3 py-1 text-sm rounded-md "+(x.days_of_week.includes(e.value)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.label},e.value))})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["CDN Speed: ",a.jsxs("span",{className:"font-bold "+(x.speed_multiplier>100?"text-green-600":x.speed_multiplier<100?"text-orange-600":"text-gray-600"),children:[x.speed_multiplier,"%"]}),x.speed_multiplier<100&&a.jsxs("span",{className:"font-normal text-gray-500 ml-1",children:["(",100-x.speed_multiplier,"% reduction)"]})]}),a.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:x.speed_multiplier,onChange:e=>p({...x,speed_multiplier:parseInt(e.target.value)}),className:"mt-2 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),a.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[a.jsx("span",{children:"10%"}),a.jsx("span",{children:"50%"}),a.jsx("span",{children:"100%"}),a.jsx("span",{children:"200%"}),a.jsx("span",{children:"300%"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"100% = no change, 50% = half speed, 300% = triple speed"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Apply to CDNs ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 "+(0===x.cdn_ids.length?"border-red-300 bg-red-50":""),children:(b||[]).map(e=>a.jsxs("label",{className:"flex items-center py-1",children:[a.jsx("input",{type:"checkbox",checked:x.cdn_ids.includes(e.id),onChange:t=>{const s=t.target.checked?[...x.cdn_ids,e.id]:x.cdn_ids.filter(t=>t!==e.id);p({...x,cdn_ids:s})},className:"rounded border-gray-300 text-blue-600"}),a.jsxs("span",{className:"ml-2 text-sm text-gray-700 flex items-center",children:[a.jsx("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:e.color||"#EF4444"}}),e.name]})]},e.id))}),a.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Select at least one CDN (required)"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:x.enabled,onChange:e=>p({...x,enabled:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enabled"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:x.auto_apply,onChange:e=>p({...x,auto_apply:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Auto Apply (apply automatically on schedule)"})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:y.isPending||N.isPending,className:"px-4 py-2 text-sm text-white bg-blue-600 rounded-md hover:bg-blue-700",children:[u?"Update":"Create"," Rule"]})]})]})]})]})})]})}export{i as default};
