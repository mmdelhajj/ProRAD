import{b as e,u as a,d as s,j as t}from"./data-vendor-C6mPcuPT.js";import{r as l}from"./react-vendor-C4Xey-hE.js";import{u as d,c as i,h as n,v as r,d as o,n as p,i as m,p as _}from"./index-CTh83_CG.js";import{u as c,f as u,a as h}from"./table-vendor-BZVOk-Gl.js";import{c as x,z as g}from"./ui-vendor-CMKyyIMz.js";import{F as b}from"./PencilIcon-IYn463Gm.js";import{F as y}from"./TrashIcon-BFZdbUYd.js";import"./chart-vendor-Be69IwoK.js";function f(){const f=e(),{hasPermission:j}=d(),[v,N]=l.useState(!1),[w,k]=l.useState(null),[q,C]=l.useState({name:"",description:"",download_speed:"",upload_speed:"",price:"",validity_days:"30",daily_quota:"",monthly_quota:"",burst_download:"",burst_upload:"",burst_threshold:"",burst_time:"",priority:"8",fup1_threshold:"",fup1_download_speed:"",fup1_upload_speed:"",fup2_threshold:"",fup2_download_speed:"",fup2_upload_speed:"",fup3_threshold:"",fup3_download_speed:"",fup3_upload_speed:"",monthly_fup1_threshold:"",monthly_fup1_download_speed:"",monthly_fup1_upload_speed:"",monthly_fup2_threshold:"",monthly_fup2_download_speed:"",monthly_fup2_upload_speed:"",monthly_fup3_threshold:"",monthly_fup3_download_speed:"",monthly_fup3_upload_speed:"",is_active:!0,time_based_speed_enabled:!1,time_from_hour:"12",time_from_minute:"0",time_from_ampm:"AM",time_to_hour:"12",time_to_minute:"0",time_to_ampm:"AM",time_download_ratio:"0",time_upload_ratio:"0",pool_name:"",address_list_in:"",address_list_out:"",queue_type:"simple"}),[M,S]=l.useState([]),[I,P]=l.useState(!1),{data:A,isLoading:D}=a({queryKey:["services"],queryFn:()=>m.list().then(e=>e.data.data)}),{data:F}=a({queryKey:["cdns"],queryFn:()=>_.list({active:"true"}).then(e=>e.data.data)}),{data:B}=a({queryKey:["nas-list"],queryFn:()=>p.list().then(e=>e.data.data)}),[K,U]=l.useState({}),T=async(e,a)=>{if(a){U(a=>({...a,[e]:{...a[e],loading:!0}}));try{const s=(await p.getPools(a)).data.data||[];U(a=>({...a,[e]:{loading:!1,pools:s}}))}catch(s){U(a=>({...a,[e]:{loading:!1,pools:[]}}))}}},G=s({mutationFn:async e=>{var a,s;let t;const l=M.map(e=>{let a=parseInt(e.time_from_hour)||12;"PM"===e.time_from_ampm&&12!==a&&(a+=12),"AM"===e.time_from_ampm&&12===a&&(a=0);let s=parseInt(e.time_to_hour)||12;return"PM"===e.time_to_ampm&&12!==s&&(s+=12),"AM"===e.time_to_ampm&&12===s&&(s=0),{cdn_id:e.cdn_id,speed_limit:e.speed_limit,bypass_quota:e.bypass_quota,pcq_enabled:e.pcq_enabled||!1,pcq_limit:parseInt(e.pcq_limit)||50,pcq_total_limit:parseInt(e.pcq_total_limit)||2e3,pcq_nas_id:e.pcq_nas_id||null,pcq_target_pools:e.pcq_target_pools||"",is_active:e.is_active,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:a,time_from_minute:parseInt(e.time_from_minute)||0,time_to_hour:s,time_to_minute:parseInt(e.time_to_minute)||0,time_speed_ratio:parseInt(e.time_speed_ratio)||0}});return w?(t=await m.update(w.id,e),I&&await _.updateServiceCDNs(w.id,{cdns:l})):(t=await m.create(e),(null==(s=null==(a=t.data)?void 0:a.data)?void 0:s.id)&&await _.updateServiceCDNs(t.data.data.id,{cdns:l})),t},onSuccess:()=>{g.success(w?"Service updated":"Service created"),f.invalidateQueries(["services"]),R()},onError:e=>{var a,s;return g.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save")}}),Q=s({mutationFn:e=>m.delete(e),onSuccess:()=>{g.success("Service deleted"),f.invalidateQueries(["services"])},onError:e=>{var a,s;return g.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to delete")}}),L=(e=null)=>{var a,s,t,l;e?(k(e),C({name:e.name||"",description:e.description||"",download_speed:e.download_speed||"",upload_speed:e.upload_speed||"",price:e.price||"",validity_days:e.validity_days||"30",daily_quota:e.daily_quota?Math.round(e.daily_quota/1073741824):"",monthly_quota:e.monthly_quota?Math.round(e.monthly_quota/1073741824):"",burst_download:e.burst_download||"",burst_upload:e.burst_upload||"",burst_threshold:e.burst_threshold||"",burst_time:e.burst_time||"",priority:e.priority||"8",fup1_threshold:e.fup1_threshold?Math.round(e.fup1_threshold/1073741824):"",fup1_download_speed:e.fup1_download_speed||"",fup1_upload_speed:e.fup1_upload_speed||"",fup2_threshold:e.fup2_threshold?Math.round(e.fup2_threshold/1073741824):"",fup2_download_speed:e.fup2_download_speed||"",fup2_upload_speed:e.fup2_upload_speed||"",fup3_threshold:e.fup3_threshold?Math.round(e.fup3_threshold/1073741824):"",fup3_download_speed:e.fup3_download_speed||"",fup3_upload_speed:e.fup3_upload_speed||"",monthly_fup1_threshold:e.monthly_fup1_threshold?Math.round(e.monthly_fup1_threshold/1073741824):"",monthly_fup1_download_speed:e.monthly_fup1_download_speed||"",monthly_fup1_upload_speed:e.monthly_fup1_upload_speed||"",monthly_fup2_threshold:e.monthly_fup2_threshold?Math.round(e.monthly_fup2_threshold/1073741824):"",monthly_fup2_download_speed:e.monthly_fup2_download_speed||"",monthly_fup2_upload_speed:e.monthly_fup2_upload_speed||"",monthly_fup3_threshold:e.monthly_fup3_threshold?Math.round(e.monthly_fup3_threshold/1073741824):"",monthly_fup3_download_speed:e.monthly_fup3_download_speed||"",monthly_fup3_upload_speed:e.monthly_fup3_upload_speed||"",is_active:e.is_active??!0,time_based_speed_enabled:e.time_based_speed_enabled??!1,time_from_hour:(()=>{const a=e.time_from_hour||0;return 0===a?"12":a>12?(a-12).toString():a.toString()})(),time_from_minute:(null==(a=e.time_from_minute)?void 0:a.toString())||"0",time_from_ampm:(e.time_from_hour||0)>=12?"PM":"AM",time_to_hour:(()=>{const a=e.time_to_hour||0;return 0===a?"12":a>12?(a-12).toString():a.toString()})(),time_to_minute:(null==(s=e.time_to_minute)?void 0:s.toString())||"0",time_to_ampm:(e.time_to_hour||0)>=12?"PM":"AM",time_download_ratio:(null==(t=e.time_download_ratio)?void 0:t.toString())||"0",time_upload_ratio:(null==(l=e.time_upload_ratio)?void 0:l.toString())||"0",pool_name:e.pool_name||"",address_list_in:e.address_list_in||"",address_list_out:e.address_list_out||"",queue_type:e.queue_type||"simple"})):(k(null),C({name:"",description:"",download_speed:"",upload_speed:"",price:"",validity_days:"30",daily_quota:"",monthly_quota:"",burst_download:"",burst_upload:"",burst_threshold:"",burst_time:"",priority:"8",fup1_threshold:"",fup1_download_speed:"",fup1_upload_speed:"",fup2_threshold:"",fup2_download_speed:"",fup2_upload_speed:"",fup3_threshold:"",fup3_download_speed:"",fup3_upload_speed:"",monthly_fup1_threshold:"",monthly_fup1_download_speed:"",monthly_fup1_upload_speed:"",monthly_fup2_threshold:"",monthly_fup2_download_speed:"",monthly_fup2_upload_speed:"",monthly_fup3_threshold:"",monthly_fup3_download_speed:"",monthly_fup3_upload_speed:"",is_active:!0,time_based_speed_enabled:!1,time_from_hour:"12",time_from_minute:"0",time_from_ampm:"AM",time_to_hour:"12",time_to_minute:"0",time_to_ampm:"AM",time_download_ratio:"0",time_upload_ratio:"0",pool_name:"",address_list_in:"",address_list_out:"",queue_type:"simple"})),P(!1),e?_.listServiceCDNs(e.id).then(e=>{const a=e.data.data||[];S(a.map(e=>{const a=e.time_from_hour||0,s=e.time_to_hour||0;return{cdn_id:e.cdn_id,speed_limit:e.speed_limit||0,bypass_quota:e.bypass_quota||!1,pcq_enabled:e.pcq_enabled||!1,pcq_limit:e.pcq_limit||50,pcq_total_limit:e.pcq_total_limit||2e3,pcq_nas_id:e.pcq_nas_id||null,pcq_target_pools:e.pcq_target_pools||"",is_active:e.is_active??!0,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:0===a?12:a>12?a-12:a,time_from_minute:e.time_from_minute||0,time_from_ampm:a>=12?"PM":"AM",time_to_hour:0===s?12:s>12?s-12:s,time_to_minute:e.time_to_minute||0,time_to_ampm:s>=12?"PM":"AM",time_speed_ratio:e.time_speed_ratio||0}})),P(!0)}).catch(()=>{S([]),P(!0)}):(S([]),P(!0)),N(!0)},R=()=>{N(!1),k(null),S([])},E=e=>{const{name:a,value:s,type:t,checked:l}=e.target;C(e=>({...e,[a]:"checkbox"===t?l:s}))},$=(e,a,s)=>{S(t=>t.map(t=>t.cdn_id===e?{...t,[a]:s}:t))},O=e=>{const a=null==F?void 0:F.find(a=>a.id===e);return(null==a?void 0:a.name)||"Unknown"},V=l.useMemo(()=>[{accessorKey:"name",header:"Name",cell:({row:e})=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.original.name}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.original.description})]})},{accessorKey:"speed",header:"Speed",cell:({row:e})=>t.jsxs("div",{className:"text-sm",children:[t.jsxs("div",{children:["↓ ",e.original.download_speed," kb"]}),t.jsxs("div",{children:["↑ ",e.original.upload_speed," kb"]})]})},{accessorKey:"price",header:"Price",cell:({row:e})=>{var a;return`$${null==(a=e.original.price)?void 0:a.toFixed(2)}`}},{accessorKey:"validity_days",header:"Validity",cell:({row:e})=>`${e.original.validity_days} days`},{accessorKey:"quota",header:"Quota",cell:({row:e})=>t.jsx("div",{className:"text-sm",children:e.original.daily_quota||e.original.monthly_quota?t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:["Daily: ",e.original.daily_quota?(e.original.daily_quota/1073741824).toFixed(0):"∞"," GB"]}),t.jsxs("div",{children:["Monthly: ",e.original.monthly_quota?(e.original.monthly_quota/1073741824).toFixed(0):"∞"," GB"]})]}):t.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Unlimited"})})},{accessorKey:"pool_name",header:"Pool",cell:({row:e})=>t.jsx("span",{className:x("text-sm",e.original.pool_name?"text-gray-900":"text-gray-400"),children:e.original.pool_name||"None"})},{accessorKey:"fup",header:"FUP Tiers",cell:({row:e})=>{const a=e.original,s=a.fup1_download_speed>0||a.fup2_download_speed>0||a.fup3_download_speed>0;return t.jsx("div",{className:"text-xs",children:s?t.jsxs(t.Fragment,{children:[a.fup1_threshold>0&&a.fup1_download_speed>0&&t.jsxs("div",{className:"text-orange-600",children:["FUP1: ",Math.round(a.fup1_threshold/1024/1024/1024),"GB → ",a.fup1_download_speed,"k/",a.fup1_upload_speed,"k"]}),a.fup2_threshold>0&&a.fup2_download_speed>0&&t.jsxs("div",{className:"text-red-600",children:["FUP2: ",Math.round(a.fup2_threshold/1024/1024/1024),"GB → ",a.fup2_download_speed,"k/",a.fup2_upload_speed,"k"]}),a.fup3_threshold>0&&a.fup3_download_speed>0&&t.jsxs("div",{className:"text-purple-600",children:["FUP3: ",Math.round(a.fup3_threshold/1024/1024/1024),"GB → ",a.fup3_download_speed,"k/",a.fup3_upload_speed,"k"]})]}):t.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"None"})})}},{accessorKey:"is_active",header:"Status",cell:({row:e})=>t.jsx("span",{className:x("badge",e.original.is_active?"badge-success":"badge-gray"),children:e.original.is_active?"Active":"Inactive"})},{id:"actions",header:"Actions",cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-2",children:[j("services.edit")&&t.jsx("button",{onClick:()=>L(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded",title:"Edit",children:t.jsx(b,{className:"w-4 h-4"})}),j("services.delete")&&t.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this service?")&&Q.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete",children:t.jsx(y,{className:"w-4 h-4"})})]})}],[Q,j]),z=c({data:A||[],columns:V,getCoreRowModel:h()});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Services"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage internet service plans"})]}),j("services.create")&&t.jsxs("button",{onClick:()=>L(),className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[t.jsx(i,{className:"w-4 h-4"}),"Add Service"]})]}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:z.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(e=>t.jsx("th",{children:u(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:D?t.jsx("tr",{children:t.jsx("td",{colSpan:V.length,className:"text-center py-8",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===z.getRowModel().rows.length?t.jsx("tr",{children:t.jsx("td",{colSpan:V.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No services found"})}):z.getRowModel().rows.map(e=>t.jsx("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:e.getVisibleCells().map(e=>t.jsx("td",{children:u(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),v&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:R}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold",children:w?"Edit Service":"Add Service"}),t.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:t.jsx(n,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=parseInt(q.download_speed)||0,s=parseInt(q.upload_speed)||0,t={...q,download_speed:a,upload_speed:s,download_speed_str:a>0?`${a}k`:"",upload_speed_str:s>0?`${s}k`:"",price:parseFloat(q.price)||0,validity_days:parseInt(q.validity_days)||30,daily_quota:q.daily_quota?1024*parseInt(q.daily_quota)*1024*1024:0,monthly_quota:q.monthly_quota?1024*parseInt(q.monthly_quota)*1024*1024:0,burst_download:parseInt(q.burst_download)||0,burst_upload:parseInt(q.burst_upload)||0,burst_threshold:parseInt(q.burst_threshold)||0,burst_time:parseInt(q.burst_time)||0,priority:parseInt(q.priority)||8,fup1_threshold:q.fup1_threshold?1024*parseInt(q.fup1_threshold)*1024*1024:0,fup1_download_speed:parseInt(q.fup1_download_speed)||0,fup1_upload_speed:parseInt(q.fup1_upload_speed)||0,fup2_threshold:q.fup2_threshold?1024*parseInt(q.fup2_threshold)*1024*1024:0,fup2_download_speed:parseInt(q.fup2_download_speed)||0,fup2_upload_speed:parseInt(q.fup2_upload_speed)||0,fup3_threshold:q.fup3_threshold?1024*parseInt(q.fup3_threshold)*1024*1024:0,fup3_download_speed:parseInt(q.fup3_download_speed)||0,fup3_upload_speed:parseInt(q.fup3_upload_speed)||0,monthly_fup1_threshold:q.monthly_fup1_threshold?1024*parseInt(q.monthly_fup1_threshold)*1024*1024:0,monthly_fup1_download_speed:parseInt(q.monthly_fup1_download_speed)||0,monthly_fup1_upload_speed:parseInt(q.monthly_fup1_upload_speed)||0,monthly_fup2_threshold:q.monthly_fup2_threshold?1024*parseInt(q.monthly_fup2_threshold)*1024*1024:0,monthly_fup2_download_speed:parseInt(q.monthly_fup2_download_speed)||0,monthly_fup2_upload_speed:parseInt(q.monthly_fup2_upload_speed)||0,monthly_fup3_threshold:q.monthly_fup3_threshold?1024*parseInt(q.monthly_fup3_threshold)*1024*1024:0,monthly_fup3_download_speed:parseInt(q.monthly_fup3_download_speed)||0,monthly_fup3_upload_speed:parseInt(q.monthly_fup3_upload_speed)||0,time_based_speed_enabled:q.time_based_speed_enabled,time_from_hour:(()=>{let e=parseInt(q.time_from_hour)||12;return"PM"===q.time_from_ampm&&12!==e&&(e+=12),"AM"===q.time_from_ampm&&12===e&&(e=0),e})(),time_from_minute:parseInt(q.time_from_minute)||0,time_to_hour:(()=>{let e=parseInt(q.time_to_hour)||12;return"PM"===q.time_to_ampm&&12!==e&&(e+=12),"AM"===q.time_to_ampm&&12===e&&(e=0),e})(),time_to_minute:parseInt(q.time_to_minute)||0,time_download_ratio:parseInt(q.time_download_ratio)||0,time_upload_ratio:parseInt(q.time_upload_ratio)||0};G.mutate(t)},className:"p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label",children:"Service Name"}),t.jsx("input",{type:"text",name:"name",value:q.name,onChange:E,className:"input",required:!0})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label",children:"Description"}),t.jsx("textarea",{name:"description",value:q.description,onChange:E,className:"input",rows:2})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Speed Settings"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Download Speed (kb)"}),t.jsx("input",{type:"number",name:"download_speed",value:q.download_speed,onChange:E,className:"input",placeholder:"e.g., 4000 for 4Mbps",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Upload Speed (kb)"}),t.jsx("input",{type:"number",name:"upload_speed",value:q.upload_speed,onChange:E,className:"input",placeholder:"e.g., 1400 for 1.4Mbps",required:!0})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Pricing & Validity"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Price ($)"}),t.jsx("input",{type:"number",name:"price",value:q.price,onChange:E,className:"input",step:"0.01",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Validity (Days)"}),t.jsx("input",{type:"number",name:"validity_days",value:q.validity_days,onChange:E,className:"input",required:!0})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Quota Settings (0 = Unlimited)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Daily Quota (GB)"}),t.jsx("input",{type:"number",name:"daily_quota",value:q.daily_quota,onChange:E,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Monthly Quota (GB)"}),t.jsx("input",{type:"number",name:"monthly_quota",value:q.monthly_quota,onChange:E,className:"input"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Burst Settings (Mikrotik)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Download (kb)"}),t.jsx("input",{type:"number",name:"burst_download",value:q.burst_download,onChange:E,className:"input",placeholder:"e.g., 8000"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Upload (kb)"}),t.jsx("input",{type:"number",name:"burst_upload",value:q.burst_upload,onChange:E,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Threshold (%)"}),t.jsx("input",{type:"number",name:"burst_threshold",value:q.burst_threshold,onChange:E,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Time (seconds)"}),t.jsx("input",{type:"number",name:"burst_time",value:q.burst_time,onChange:E,className:"input"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"RADIUS Settings"}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"IP Pool Name"}),t.jsx("input",{type:"text",name:"pool_name",value:q.pool_name,onChange:E,className:"input",placeholder:"e.g., pool-10mbps"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"MikroTik IP pool name (must match pool configured on router)"})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Daily FUP (Resets Every Day at Midnight)"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set up to 3 FUP tiers. When daily usage exceeds a threshold, the specified speed is applied. Speed is in Kbps (e.g., 700 = 700k)."}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-orange-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"FUP1 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup1_threshold",value:q.fup1_threshold,onChange:E,className:"input",placeholder:"e.g., 7"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup1_download_speed",value:q.fup1_download_speed,onChange:E,className:"input",placeholder:"e.g., 700"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup1_upload_speed",value:q.fup1_upload_speed,onChange:E,className:"input",placeholder:"e.g., 700"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-red-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"FUP2 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup2_threshold",value:q.fup2_threshold,onChange:E,className:"input",placeholder:"e.g., 9"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup2_download_speed",value:q.fup2_download_speed,onChange:E,className:"input",placeholder:"e.g., 500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup2_upload_speed",value:q.fup2_upload_speed,onChange:E,className:"input",placeholder:"e.g., 500"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-purple-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"FUP3 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup3_threshold",value:q.fup3_threshold,onChange:E,className:"input",placeholder:"e.g., 11"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup3_download_speed",value:q.fup3_download_speed,onChange:E,className:"input",placeholder:"e.g., 300"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup3_upload_speed",value:q.fup3_upload_speed,onChange:E,className:"input",placeholder:"e.g., 300"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Monthly FUP (Resets on Subscription Renewal)"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"When monthly usage exceeds the threshold, the specified speed is applied. Resets when the user renews their subscription."}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-cyan-50 dark:bg-cyan-900/30 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Threshold (GB)"}),t.jsx("input",{type:"number",name:"monthly_fup1_threshold",value:q.monthly_fup1_threshold,onChange:E,className:"input",placeholder:"e.g., 100"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"monthly_fup1_download_speed",value:q.monthly_fup1_download_speed,onChange:E,className:"input",placeholder:"e.g., 500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"monthly_fup1_upload_speed",value:q.monthly_fup1_upload_speed,onChange:E,className:"input",placeholder:"e.g., 500"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"font-medium",children:"Time-Based Speed Control (Automatic)"}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",name:"time_based_speed_enabled",checked:q.time_based_speed_enabled,onChange:E,className:"toggle toggle-primary"}),t.jsx("span",{className:"text-sm font-medium "+(q.time_based_speed_enabled?"text-green-600":"text-gray-500"),children:q.time_based_speed_enabled?"Enabled":"Disabled"})]})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Automatically BOOST speed during specified hours. Set ratio to 0% for no boost, 100% for double speed, 200% for triple speed."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 "+(q.time_based_speed_enabled?"":"opacity-50 pointer-events-none"),children:[t.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg",children:[t.jsx("label",{className:"label text-indigo-700 mb-2",children:"From Time"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("select",{name:"time_from_hour",value:q.time_from_hour,onChange:E,className:"input w-20",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("span",{className:"font-bold",children:":"}),t.jsx("select",{name:"time_from_minute",value:q.time_from_minute,onChange:E,className:"input w-20",children:[0,15,30,45].map(e=>t.jsx("option",{value:e,children:e.toString().padStart(2,"0")},e))}),t.jsxs("select",{name:"time_from_ampm",value:q.time_from_ampm,onChange:E,className:"input w-20 font-semibold",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]}),t.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg",children:[t.jsx("label",{className:"label text-indigo-700 mb-2",children:"To Time"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("select",{name:"time_to_hour",value:q.time_to_hour,onChange:E,className:"input w-20",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("span",{className:"font-bold",children:":"}),t.jsx("select",{name:"time_to_minute",value:q.time_to_minute,onChange:E,className:"input w-20",children:[0,15,30,45].map(e=>t.jsx("option",{value:e,children:e.toString().padStart(2,"0")},e))}),t.jsxs("select",{name:"time_to_ampm",value:q.time_to_ampm,onChange:E,className:"input w-20 font-semibold",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 bg-indigo-50 rounded-lg "+(q.time_based_speed_enabled?"":"opacity-50 pointer-events-none"),children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-indigo-700",children:"Download Boost (%)"}),t.jsx("input",{type:"number",name:"time_download_ratio",value:q.time_download_ratio,onChange:E,className:"input",placeholder:"100",min:"1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-indigo-700",children:"Upload Boost (%)"}),t.jsx("input",{type:"number",name:"time_upload_ratio",value:q.time_upload_ratio,onChange:E,className:"input",placeholder:"100",min:"1"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[t.jsx(r,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400"}),"CDN Configuration"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Configure which CDNs apply to this service with custom speed limits and bypass options."}),F&&F.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs("select",{className:"input",value:"",onChange:e=>{var a;e.target.value&&(a=parseInt(e.target.value),M.find(e=>e.cdn_id===a)||S([...M,{cdn_id:a,speed_limit:0,bypass_quota:!1,pcq_enabled:!1,pcq_limit:50,pcq_total_limit:2e3,pcq_nas_id:null,pcq_target_pools:"",is_active:!0,time_based_speed_enabled:!1,time_from_hour:12,time_from_minute:0,time_from_ampm:"AM",time_to_hour:12,time_to_minute:0,time_to_ampm:"AM",time_speed_ratio:100}]))},children:[t.jsx("option",{value:"",children:"+ Add CDN..."}),F.filter(e=>!M.find(a=>a.cdn_id===e.id)).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})}),M.length>0?t.jsx("div",{className:"space-y-3",children:M.map(e=>{var a,s,l;return t.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(r,{className:"w-5 h-5 text-indigo-500"}),t.jsx("span",{className:"font-medium",children:O(e.cdn_id)})]}),t.jsx("button",{type:"button",onClick:()=>{return a=e.cdn_id,void S(M.filter(e=>e.cdn_id!==a));var a},className:"text-red-500 hover:text-red-700 p-1",children:t.jsx(y,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs",children:"Speed Limit (Mbps)"}),t.jsx("input",{type:"number",value:e.speed_limit,onChange:a=>$(e.cdn_id,"speed_limit",parseInt(a.target.value)||0),className:"input text-sm",placeholder:"0 = unlimited",min:"0"})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2 pb-2",children:[t.jsx("input",{type:"checkbox",checked:e.bypass_quota,onChange:a=>$(e.cdn_id,"bypass_quota",a.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Bypass Quota"})]})}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2 pb-2",children:[t.jsx("input",{type:"checkbox",checked:e.is_active,onChange:a=>$(e.cdn_id,"is_active",a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{className:"text-sm",children:"Active"})]})})]}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:e.pcq_enabled,onChange:a=>$(e.cdn_id,"pcq_enabled",a.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400"}),t.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"PCQ Mode"})]}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"(Shared queue for all subscribers)"})]}),e.pcq_enabled&&t.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"Select NAS"}),t.jsxs("select",{value:e.pcq_nas_id||"",onChange:a=>{const s=a.target.value?parseInt(a.target.value):null;var t,l;t=e.cdn_id,l={pcq_nas_id:s,pcq_target_pools:""},S(e=>e.map(e=>e.cdn_id===t?{...e,...l}:e)),s&&T(e.cdn_id,s)},className:"input text-sm",children:[t.jsx("option",{value:"",children:"-- Select NAS --"}),null==B?void 0:B.filter(e=>e.is_active).map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.ip_address,")"]},e.id))]})]}),e.pcq_nas_id&&t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"Select Pools (Target)"}),(null==(a=K[e.cdn_id])?void 0:a.loading)?t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Loading pools..."}):(null==(l=null==(s=K[e.cdn_id])?void 0:s.pools)?void 0:l.length)>0?t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-1",children:K[e.cdn_id].pools.map(a=>{const s=e.pcq_target_pools?e.pcq_target_pools.split(","):[],l=s.includes(a.ranges);return t.jsxs("label",{className:"flex items-center gap-2 p-2 bg-white rounded border cursor-pointer hover:bg-blue-50",children:[t.jsx("input",{type:"checkbox",checked:l,onChange:t=>{let l=[...s];t.target.checked?l.push(a.ranges):l=l.filter(e=>e!==a.ranges),$(e.cdn_id,"pcq_target_pools",l.filter(e=>e).join(","))},className:"rounded border-gray-300 text-blue-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:a.name}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:a.ranges})]})]},a.name)})}):t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:t.jsx("button",{type:"button",onClick:()=>T(e.cdn_id,e.pcq_nas_id),className:"text-blue-600 hover:underline",children:"Click to fetch pools from NAS"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-blue-200",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"PCQ Limit (KiB)"}),t.jsx("input",{type:"number",value:e.pcq_limit,onChange:a=>$(e.cdn_id,"pcq_limit",parseInt(a.target.value)||50),className:"input text-sm",min:"1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"PCQ Total Limit (KiB)"}),t.jsx("input",{type:"number",value:e.pcq_total_limit,onChange:a=>$(e.cdn_id,"pcq_total_limit",parseInt(a.target.value)||2e3),className:"input text-sm",min:"1"})]})]}),e.pcq_target_pools&&t.jsxs("div",{className:"text-xs text-blue-600 bg-blue-100 p-2 rounded",children:[t.jsx("strong",{children:"Target:"})," ",e.pcq_target_pools]})]})]}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(o,{className:"w-4 h-4 text-purple-500"}),t.jsx("span",{className:"text-xs font-medium text-purple-700",children:"Time-Based Speed (Night Boost)"})]}),t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.time_based_speed_enabled||!1,onChange:a=>$(e.cdn_id,"time_based_speed_enabled",a.target.checked),className:"toggle toggle-xs toggle-primary"}),t.jsx("span",{className:"text-xs "+(e.time_based_speed_enabled?"text-green-600":"text-gray-400"),children:e.time_based_speed_enabled?"On":"Off"})]})]}),t.jsxs("div",{className:"grid grid-cols-12 gap-2 "+(e.time_based_speed_enabled?"":"opacity-50 pointer-events-none"),children:[t.jsxs("div",{className:"col-span-4",children:[t.jsx("label",{className:"label text-xs",children:"From"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",value:e.time_from_hour,onChange:a=>$(e.cdn_id,"time_from_hour",Math.min(12,Math.max(1,parseInt(a.target.value)||12))),className:"input text-sm w-10 text-center px-1",min:"1",max:"12"}),t.jsx("span",{className:"self-center",children:":"}),t.jsx("input",{type:"number",value:e.time_from_minute.toString().padStart(2,"0"),onChange:a=>$(e.cdn_id,"time_from_minute",Math.min(59,Math.max(0,parseInt(a.target.value)||0))),className:"input text-sm w-10 text-center px-1",min:"0",max:"59"}),t.jsxs("select",{value:e.time_from_ampm,onChange:a=>$(e.cdn_id,"time_from_ampm",a.target.value),className:"input text-sm w-14 px-1",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]}),t.jsxs("div",{className:"col-span-4",children:[t.jsx("label",{className:"label text-xs",children:"To"}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{type:"number",value:e.time_to_hour,onChange:a=>$(e.cdn_id,"time_to_hour",Math.min(12,Math.max(1,parseInt(a.target.value)||12))),className:"input text-sm w-10 text-center px-1",min:"1",max:"12"}),t.jsx("span",{className:"self-center",children:":"}),t.jsx("input",{type:"number",value:e.time_to_minute.toString().padStart(2,"0"),onChange:a=>$(e.cdn_id,"time_to_minute",Math.min(59,Math.max(0,parseInt(a.target.value)||0))),className:"input text-sm w-10 text-center px-1",min:"0",max:"59"}),t.jsxs("select",{value:e.time_to_ampm,onChange:a=>$(e.cdn_id,"time_to_ampm",a.target.value),className:"input text-sm w-14 px-1",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label text-xs",children:"Speed %"}),t.jsx("input",{type:"number",value:e.time_speed_ratio,onChange:a=>$(e.cdn_id,"time_speed_ratio",parseInt(a.target.value)||100),className:"input text-sm",min:"1",max:"1000",placeholder:"100"})]}),t.jsx("div",{className:"col-span-2 flex items-end",children:t.jsx("p",{className:"text-xs text-gray-500 pb-2",children:100===e.time_speed_ratio||e.time_from_hour===e.time_to_hour&&e.time_from_ampm===e.time_to_ampm?t.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"-"}):t.jsxs("span",{className:"font-medium text-purple-600",children:[Math.round(e.speed_limit*e.time_speed_ratio/100),"M"]})})})]})]})]},e.cdn_id)})}):t.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"No CDNs configured. Select a CDN from the dropdown above."})]}),t.jsx("div",{className:"border-t pt-4",children:t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",name:"is_active",checked:q.is_active,onChange:E,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{children:"Active Service"})]})}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[t.jsx("button",{type:"button",onClick:R,className:"btn-secondary",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:G.isLoading||w&&!I,className:"btn-primary",children:G.isLoading?"Saving...":!I&&w?"Loading CDNs...":w?"Update":"Create"})]})]})]})]})})]})}export{f as default};
