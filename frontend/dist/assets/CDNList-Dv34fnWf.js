import{b as e,u as s,d as a,j as t}from"./data-vendor-C6mPcuPT.js";import{r as i}from"./react-vendor-C4Xey-hE.js";import{t as r,a as n,c as l,h as c,o as d,n as o}from"./index-DhIu4zKA.js";import{u as m,f as x,a as h}from"./table-vendor-BZVOk-Gl.js";import{c as u,z as g}from"./ui-vendor-CMKyyIMz.js";import{F as p}from"./PencilIcon-IYn463Gm.js";import{F as v}from"./TrashIcon-BFZdbUYd.js";import"./chart-vendor-Be69IwoK.js";function j(){const j=e(),[N,b]=i.useState(!1),[y,f]=i.useState(null),[C,w]=i.useState({name:"",description:"",subnets:"",color:"#EF4444",nas_ids:"",is_active:!0}),{data:S,isLoading:k}=s({queryKey:["cdns"],queryFn:()=>d.list().then(e=>e.data.data)}),{data:A}=s({queryKey:["nas"],queryFn:()=>o.list().then(e=>e.data.data)}),D=a({mutationFn:async e=>{try{return y?await d.update(y.id,e):await d.create(e)}catch(s){throw s}},onSuccess:()=>{g.success(y?"CDN updated":"CDN created"),j.invalidateQueries({queryKey:["cdns"]}),P()},onError:e=>{var s,a;g.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to save")}}),_=a({mutationFn:e=>d.delete(e),onSuccess:()=>{g.success("CDN deleted"),j.invalidateQueries({queryKey:["cdns"]})},onError:e=>{var s,a;return g.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}}),F=a({mutationFn:e=>d.syncToNAS(e),onSuccess:e=>{var s;g.success((null==(s=e.data)?void 0:s.message)||"CDN synced to all NAS devices")},onError:e=>{var s,a;return g.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to sync")}}),E=a({mutationFn:()=>d.syncAllToNAS(),onSuccess:e=>{var s;g.success((null==(s=e.data)?void 0:s.message)||"All CDNs synced to NAS devices")},onError:e=>{var s,a;return g.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to sync")}}),G=(e=null)=>{e?(f(e),w({name:e.name||"",description:e.description||"",subnets:e.subnets||"",color:e.color||"#EF4444",nas_ids:e.nas_ids||"",is_active:e.is_active??!0})):(f(null),w({name:"",description:"",subnets:"",color:"#EF4444",nas_ids:"",is_active:!0})),b(!0)},P=()=>{b(!1),f(null)},K=e=>{const{name:s,value:a,type:t,checked:i}=e.target;w(e=>({...e,[s]:"checkbox"===t?i:a}))},q=i.useMemo(()=>[{accessorKey:"name",header:"Name",cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0 ring-2 ring-white shadow",style:{backgroundColor:e.original.color||"#EF4444"},title:`Graph color: ${e.original.color||"#EF4444"}`}),t.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:t.jsx(r,{className:"w-5 h-5 text-indigo-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-900",children:e.original.name}),t.jsx("div",{className:"text-sm text-gray-500",children:e.original.description})]})]})},{accessorKey:"subnets",header:"Subnets",cell:({row:e})=>{const s=(e=>e?e.replace(/\r?\n/g,",").split(",").map(e=>e.trim()).filter(e=>e):[])(e.original.subnets),a=s.length,i=s.slice(0,3);return t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a," subnet",1!==a?"s":""]}),t.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:[i.join(", "),a>3&&` +${a-3} more`]})]})}},{accessorKey:"nas_ids",header:"Target NAS",cell:({row:e})=>{const s=e.original.nas_ids;if(!s)return t.jsx("span",{className:"text-sm text-gray-500",children:"All NAS"});const a=s.split(",").map(e=>e.trim()).filter(e=>e).map(e=>{const s=null==A?void 0:A.find(s=>s.id===parseInt(e));return(null==s?void 0:s.name)||`NAS #${e}`});return t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-900",children:a.slice(0,2).join(", ")}),a.length>2&&t.jsxs("div",{className:"text-xs text-gray-500",children:["+",a.length-2," more"]})]})}},{accessorKey:"is_active",header:"Status",cell:({row:e})=>t.jsx("span",{className:u("badge",e.original.is_active?"badge-success":"badge-gray"),children:e.original.is_active?"Active":"Inactive"})},{id:"actions",header:"Actions",cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>F.mutate(e.original.id),disabled:!e.original.is_active||F.isPending,className:u("p-1.5 rounded",e.original.is_active?"text-gray-500 hover:text-green-600 hover:bg-green-50":"text-gray-300 cursor-not-allowed"),title:e.original.is_active?"Sync to MikroTik":"CDN is inactive",children:t.jsx(n,{className:u("w-4 h-4",F.isPending&&"animate-spin")})}),t.jsx("button",{onClick:()=>G(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded",title:"Edit",children:t.jsx(p,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this CDN?")&&_.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",title:"Delete",children:t.jsx(v,{className:"w-4 h-4"})})]})}],[_,F,A]),I=m({data:S||[],columns:q,getCoreRowModel:h()});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"CDN List"}),t.jsx("p",{className:"text-gray-500",children:"Manage Content Delivery Network configurations"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>E.mutate(),disabled:E.isPending,className:"btn-secondary flex items-center gap-2",children:[t.jsx(n,{className:u("w-4 h-4",E.isPending&&"animate-spin")}),E.isPending?"Syncing...":"Sync All to MikroTik"]}),t.jsxs("button",{onClick:()=>G(),className:"btn-primary flex items-center gap-2",children:[t.jsx(l,{className:"w-4 h-4"}),"Add CDN"]})]})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(r,{className:"w-6 h-6 text-blue-500 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-blue-900",children:"CDN Configuration"}),t.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Add CDN providers (GGC, Akamai, Cloudflare, etc.) with their IP subnets. Then assign them to services with custom speed limits and bypass options."})]})]})}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:I.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(e=>t.jsx("th",{children:x(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:k?t.jsx("tr",{children:t.jsx("td",{colSpan:q.length,className:"text-center py-8",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===I.getRowModel().rows.length?t.jsx("tr",{children:t.jsx("td",{colSpan:q.length,className:"text-center py-8 text-gray-500",children:'No CDNs found. Click "Add CDN" to create one.'})}):I.getRowModel().rows.map(e=>t.jsx("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>t.jsx("td",{children:x(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),N&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:P}),t.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl max-w-lg w-full",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold",children:y?"Edit CDN":"Add CDN"}),t.jsx("button",{onClick:P,className:"p-2 hover:bg-gray-100 rounded-lg",children:t.jsx(c,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),D.mutate(C)},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"CDN Name"}),t.jsx("input",{type:"text",name:"name",value:C.name,onChange:K,className:"input",placeholder:"e.g., GGC, Akamai, Cloudflare",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Description"}),t.jsx("input",{type:"text",name:"description",value:C.description,onChange:K,className:"input",placeholder:"e.g., Google Global Cache"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Subnets"}),t.jsx("textarea",{name:"subnets",value:C.subnets,onChange:K,className:"input font-mono text-sm",rows:5,placeholder:"Enter subnets separated by commas or new lines:\n185.82.96.0/24\n185.82.97.0/24\n34.104.35.0/24"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter IP subnets in CIDR notation, separated by commas or new lines"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Sync to NAS"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Select which NAS devices to sync this CDN address list to (leave empty for all NAS)"}),t.jsx("div",{className:"border rounded-lg p-3 max-h-40 overflow-y-auto bg-gray-50",children:A&&A.length>0?t.jsx("div",{className:"space-y-2",children:A.filter(e=>e.is_active).map(e=>{const s=C.nas_ids?C.nas_ids.split(",").map(e=>e.trim()):[],a=s.includes(String(e.id));return t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-100 p-1 rounded",children:[t.jsx("input",{type:"checkbox",checked:a,onChange:a=>{let t=s.filter(e=>""!==e);a.target.checked?t.push(String(e.id)):t=t.filter(s=>s!==String(e.id)),w(e=>({...e,nas_ids:t.join(",")}))},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{className:"text-sm",children:e.name}),t.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.ip_address,")"]})]},e.id)})}):t.jsx("p",{className:"text-sm text-gray-400",children:"No NAS devices available"})}),C.nas_ids&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selected: ",C.nas_ids.split(",").filter(e=>e).length," NAS device(s)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Graph Color"}),t.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Choose a color for the live bandwidth graph (blue and green are reserved for download/upload)"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:["#EF4444","#F97316","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#84CC16","#6366F1","#14B8A6","#D946EF"].map(e=>t.jsx("button",{type:"button",onClick:()=>w(s=>({...s,color:e})),className:u("w-8 h-8 rounded-full transition-all",C.color===e?"ring-2 ring-offset-2 ring-gray-900 scale-110":"hover:scale-105"),style:{backgroundColor:e},title:e},e))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"color",name:"color",value:C.color,onChange:K,className:"w-10 h-10 rounded cursor-pointer border-0 p-0",title:"Custom color"}),t.jsx("span",{className:"text-sm text-gray-500 font-mono",children:C.color})]})]})]}),t.jsx("div",{className:"pt-2",children:t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",name:"is_active",checked:C.is_active,onChange:K,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{children:"Active"})]})}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[t.jsx("button",{type:"button",onClick:P,className:"btn-secondary",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:D.isPending,className:"btn-primary",children:D.isPending?"Saving...":y?"Update":"Create"})]})]})]})]})})]})}export{j as default};
