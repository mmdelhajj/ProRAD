import{b as e,u as s,d as a,j as t}from"./data-vendor-Gi89QHLZ.js";import{r}from"./react-vendor-C1B6conR.js";import{N as l,a0 as n,a as i,F as d,m as c,A as o,w as x,M as m,a1 as h,h as g,g as u,B as y,e as j,a2 as p}from"./index-BUOHIkAX.js";import{u as v,f as b,b as N,a as f}from"./table-vendor-3gCiRijM.js";import{c as k,z as w}from"./ui-vendor-Bljr83Cq.js";import{F as _}from"./PlayIcon-BR5YOtV1.js";import{F as S}from"./XCircleIcon-CHlTZmp1.js";import{F as L}from"./MagnifyingGlassIcon-CymQwI_A.js";import"./chart-vendor-C_esy2x0.js";function C({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"}))}const R=r.forwardRef(C);function T({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const F=r.forwardRef(T);function D(e){switch(e){case"high":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400 rounded-full",children:[t.jsx(h,{className:"w-3 h-3"}),"High Risk"]});case"medium":return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400 rounded-full",children:[t.jsx(m,{className:"w-3 h-3"}),"Medium"]});default:return t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400 rounded-full",children:[t.jsx(d,{className:"w-3 h-3"}),"Normal"]})}}function M(e,s){return"router_detected"===e||"double_router"===e?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400 rounded-full",children:[t.jsx(g,{className:"w-3 h-3"}),"Router Detected"]}):"multiple_os"===e?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400 rounded-full",children:[t.jsx(R,{className:"w-3 h-3"}),"Multiple OS"]}):s&&s.length>0?t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 rounded-full",children:["TTL: ",s.join(", ")]}):t.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"No TTL data"})}function A(){const{companyName:C}=l(),T=e(),[A,H]=r.useState("live"),[K,q]=r.useState(""),[E,I]=r.useState(!1),[O,P]=r.useState(!1),[V,U]=r.useState(7),[z,B]=r.useState(""),{data:G,isLoading:Q,refetch:W,isFetching:Z}=s({queryKey:["sharing-detection"],queryFn:()=>p.list().then(e=>e.data),refetchInterval:6e4,enabled:"live"===A}),{data:J,isLoading:X,refetch:$}=s({queryKey:["sharing-history",V,z],queryFn:()=>p.getHistory({days:V,suspicion_level:z}).then(e=>e.data),enabled:"history"===A}),{data:Y,isLoading:ee}=s({queryKey:["sharing-trends",V],queryFn:()=>p.getTrends({days:V}).then(e=>e.data),enabled:"history"===A}),{data:se,isLoading:ae}=s({queryKey:["sharing-offenders"],queryFn:()=>p.getRepeatOffenders({days:30,min_count:3}).then(e=>e.data),enabled:"history"===A}),{data:te,isLoading:re,refetch:le}=s({queryKey:["sharing-settings"],queryFn:()=>p.getSettings().then(e=>e.data),enabled:"settings"===A}),{data:ne,refetch:ie,isLoading:de}=s({queryKey:["sharing-nas-rules"],queryFn:()=>p.getNasRuleStatus().then(e=>e.data),enabled:O}),ce=a({mutationFn:e=>p.generateTTLRules(e),onSuccess:e=>{var s;w.success((null==(s=e.data)?void 0:s.message)||"TTL rules generated successfully"),ie()},onError:e=>{var s,a;return w.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to generate rules")}}),oe=a({mutationFn:e=>p.removeTTLRules(e),onSuccess:e=>{var s;w.success((null==(s=e.data)?void 0:s.message)||"TTL rules removed successfully"),ie()},onError:e=>{var s,a;return w.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to remove rules")}}),xe=a({mutationFn:()=>p.runManualScan(),onSuccess:e=>{var s,a;w.success((null==(s=e.data)?void 0:s.message)||`Scan completed. Found ${(null==(a=e.data)?void 0:a.saved)||0} suspicious accounts.`),$(),T.invalidateQueries(["sharing-trends"]),T.invalidateQueries(["sharing-offenders"])},onError:e=>{var s,a;return w.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Scan failed")}}),me=a({mutationFn:e=>p.updateSettings(e),onSuccess:()=>{w.success("Settings saved"),le()},onError:e=>{var s,a;return w.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to save settings")}}),he=(null==G?void 0:G.data)||[],ge=(null==G?void 0:G.stats)||{},ue=(null==ne?void 0:ne.data)||[],ye=(null==J?void 0:J.data)||[],je=(null==Y?void 0:Y.data)||[],pe=(null==se?void 0:se.data)||[],ve=(null==te?void 0:te.data)||{},be=r.useMemo(()=>{let e=he;if(E&&(e=e.filter(e=>"high"===e.suspicion_level||"medium"===e.suspicion_level)),K){const s=K.toLowerCase();e=e.filter(e=>{var a,t,r;return(null==(a=e.username)?void 0:a.toLowerCase().includes(s))||(null==(t=e.full_name)?void 0:t.toLowerCase().includes(s))||(null==(r=e.ip_address)?void 0:r.includes(s))})}return e},[he,K,E]),Ne=r.useMemo(()=>[{accessorKey:"username",header:"Subscriber",cell:({row:e})=>t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.original.username}),e.original.full_name&&t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.original.full_name})]})},{accessorKey:"ip_address",header:"IP Address",cell:({row:e})=>t.jsx("code",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-sm",children:e.original.ip_address||"-"})},{accessorKey:"connection_count",header:"Connections",cell:({row:e})=>{const s=e.original.connection_count||0;return t.jsx("span",{className:k("font-mono font-medium",s>=400?"text-red-600":s>=200?"text-yellow-600":"text-gray-700 dark:text-gray-300"),children:s})}},{accessorKey:"ttl_status",header:"TTL Status",cell:({row:e})=>M(e.original.ttl_status,e.original.ttl_values)},{accessorKey:"suspicion_level",header:"Risk Level",cell:({row:e})=>D(e.original.suspicion_level)},{accessorKey:"reasons",header:"Reasons",cell:({row:e})=>{const s=e.original.reasons||[];return 0===s.length?t.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"-"}):t.jsxs("div",{className:"max-w-xs",children:[s.slice(0,2).map((e,s)=>t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e},s)),s.length>2&&t.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:["+",s.length-2," more"]})]})}},{accessorKey:"nas_name",header:"NAS",cell:({row:e})=>t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.original.nas_name||e.original.nas_ip_address||"-"})}],[]),fe=v({data:be,columns:Ne,getCoreRowModel:f(),getFilteredRowModel:N()}),ke=[{id:"live",label:"Live Analysis",icon:d},{id:"history",label:"History & Trends",icon:c},{id:"settings",label:"Settings",icon:n}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sharing Detection"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Detect accounts that may be shared with multiple users"})]}),t.jsxs("div",{className:"flex gap-2",children:["live"===A&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>P(!O),className:"btn-secondary flex items-center gap-2",children:[t.jsx(n,{className:"w-4 h-4"}),"TTL Rules"]}),t.jsxs("button",{onClick:()=>W(),disabled:Z,className:"btn-secondary flex items-center gap-2",children:[t.jsx(i,{className:k("w-4 h-4",Z&&"animate-spin")}),Z?"Analyzing...":"Refresh"]})]}),"history"===A&&t.jsxs("button",{onClick:()=>xe.mutate(),disabled:xe.isPending,className:"btn-primary flex items-center gap-2",children:[t.jsx(_,{className:k("w-4 h-4",xe.isPending&&"animate-pulse")}),xe.isPending?"Scanning...":"Run Manual Scan"]})]})]}),t.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:t.jsx("nav",{className:"-mb-px flex space-x-8",children:ke.map(e=>t.jsxs("button",{onClick:()=>H(e.id),className:k("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm",A===e.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[t.jsx(e.icon,{className:"w-5 h-5"}),e.label]},e.id))})}),"live"===A&&t.jsxs(t.Fragment,{children:[O&&t.jsxs("div",{className:"card p-6 border-2 border-primary-200 dark:border-primary-800 bg-primary-50 dark:bg-primary-900/20",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(n,{className:"w-5 h-5 text-primary-600"}),"TTL Detection Rules Configuration"]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Configure MikroTik mangle rules for TTL-based sharing detection."})]}),t.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t.jsx(S,{className:"w-5 h-5"})})]}),t.jsx("h3",{className:"font-medium text-gray-800 dark:text-gray-200 mb-3",children:"NAS Devices - TTL Rule Status:"}),de?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):0===ue.length?t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"No active NAS devices found"}):t.jsx("div",{className:"grid gap-3",children:ue.map(e=>t.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-800 p-4 rounded-lg border dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(o,{className:"w-5 h-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.nas_name}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.nas_ip_address})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[e.error?t.jsxs("span",{className:"text-sm text-red-600 flex items-center gap-1",children:[t.jsx(S,{className:"w-4 h-4"}),"Error"]}):e.rules_configured?t.jsxs("span",{className:"text-sm text-green-600 flex items-center gap-1",children:[t.jsx(x,{className:"w-4 h-4"}),e.rule_count," rules"]}):t.jsxs("span",{className:"text-sm text-yellow-600 flex items-center gap-1",children:[t.jsx(m,{className:"w-4 h-4"}),"Not configured"]}),t.jsx("div",{className:"flex gap-2",children:e.rules_configured?t.jsx("button",{onClick:()=>oe.mutate(e.nas_id),disabled:oe.isPending,className:"btn-danger text-sm px-3 py-1.5",children:"Remove"}):t.jsx("button",{onClick:()=>ce.mutate(e.nas_id),disabled:ce.isPending,className:"btn-primary text-sm px-3 py-1.5",children:"Generate"})})]})]},e.nas_id))})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:t.jsx(d,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Online Users"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:ge.total_online||0})]})]})}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/50 rounded-lg",children:t.jsx(m,{className:"w-5 h-5 text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Suspicious"}),t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:ge.suspicious_count||0})]})]})}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/50 rounded-lg",children:t.jsx(h,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"High Risk"}),t.jsx("div",{className:"text-2xl font-bold text-red-600",children:ge.high_risk_count||0})]})]})}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:t.jsx(g,{className:"w-5 h-5 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Router Detected"}),t.jsx("div",{className:"text-2xl font-bold text-purple-600",children:ge.router_detected||0})]})]})}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:t.jsx(R,{className:"w-5 h-5 text-orange-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"High Connections"}),t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:ge.high_connections||0})]})]})})]}),t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1 max-w-md",children:[t.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search by username, name, IP...",value:K,onChange:e=>q(e.target.value),className:"input pl-10"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:E,onChange:e=>I(e.target.checked),className:"w-4 h-4 text-primary-600 rounded border-gray-300 focus:ring-primary-500"}),t.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show only suspicious"})]})]})}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:fe.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(e=>t.jsx("th",{children:b(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Q?t.jsx("tr",{children:t.jsx("td",{colSpan:Ne.length,className:"text-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Analyzing connections..."})]})})}):0===fe.getRowModel().rows.length?t.jsx("tr",{children:t.jsx("td",{colSpan:Ne.length,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:E?"No suspicious accounts found":"No online users"})}):fe.getRowModel().rows.map(e=>t.jsx("tr",{className:k("hover:bg-gray-50 dark:hover:bg-gray-700","high"===e.original.suspicion_level&&"bg-red-50 dark:bg-red-900/20","medium"===e.original.suspicion_level&&"bg-yellow-50 dark:bg-yellow-900/20"),children:e.getVisibleCells().map(e=>t.jsx("td",{children:b(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})})]}),"history"===A&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"card p-4",children:t.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-5 h-5 text-gray-400"}),t.jsxs("select",{value:V,onChange:e=>U(Number(e.target.value)),className:"input w-40",children:[t.jsx("option",{value:7,children:"Last 7 days"}),t.jsx("option",{value:14,children:"Last 14 days"}),t.jsx("option",{value:30,children:"Last 30 days"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h,{className:"w-5 h-5 text-gray-400"}),t.jsxs("select",{value:z,onChange:e=>B(e.target.value),className:"input w-40",children:[t.jsx("option",{value:"",children:"All Levels"}),t.jsx("option",{value:"high",children:"High Risk"}),t.jsx("option",{value:"medium",children:"Medium"})]})]}),t.jsxs("button",{onClick:()=>$(),className:"btn-secondary flex items-center gap-2",children:[t.jsx(i,{className:"w-4 h-4"}),"Refresh"]})]})}),!ee&&je.length>0&&t.jsxs("div",{className:"card p-6",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(c,{className:"w-5 h-5 text-primary-600"}),"Detection Trends (Last ",V," Days)"]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Detections"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:je.reduce((e,s)=>e+s.total_detected,0)})]}),t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/30 p-4 rounded-lg",children:[t.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"High Risk"}),t.jsx("div",{className:"text-2xl font-bold text-red-600",children:je.reduce((e,s)=>e+s.high_risk_count,0)})]}),t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg",children:[t.jsx("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Medium Risk"}),t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:je.reduce((e,s)=>e+s.medium_risk_count,0)})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg",children:[t.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Avg Confidence"}),t.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(je.reduce((e,s)=>e+s.avg_confidence,0)/(je.length||1)),"%"]})]})]})]}),!ae&&pe.length>0&&t.jsxs("div",{className:"card p-6",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[t.jsx(y,{className:"w-5 h-5 text-red-600"}),"Repeat Offenders (Detected 3+ times in 30 days)"]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Username"}),t.jsx("th",{children:"Detections"}),t.jsx("th",{children:"High Risk Count"}),t.jsx("th",{children:"Avg Confidence"}),t.jsx("th",{children:"Last Detected"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:pe.slice(0,10).map(e=>t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t.jsx("td",{children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.username}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.full_name})]})}),t.jsx("td",{children:t.jsxs("span",{className:"font-bold text-red-600",children:[e.detection_count,"x"]})}),t.jsx("td",{children:e.high_risk_count}),t.jsxs("td",{children:[Math.round(e.avg_confidence),"%"]}),t.jsx("td",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.last_detected_at).toLocaleDateString()})]},e.subscriber_id))})]})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:t.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Detection History"})}),t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Date"}),t.jsx("th",{children:"Username"}),t.jsx("th",{children:"Connections"}),t.jsx("th",{children:"TTL Status"}),t.jsx("th",{children:"Risk Level"}),t.jsx("th",{children:"Confidence"}),t.jsx("th",{children:"Scan Type"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:X?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"text-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})})}):0===ye.length?t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No detection history found. Run a manual scan or wait for the nightly automatic scan."})}):ye.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t.jsx("td",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.detected_at).toLocaleString()}),t.jsx("td",{children:t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.username})}),t.jsx("td",{className:"font-mono",children:e.connection_count}),t.jsx("td",{children:M(e.ttl_status,e.ttl_values?JSON.parse(e.ttl_values):[])}),t.jsx("td",{children:D(e.suspicion_level)}),t.jsx("td",{children:t.jsxs("span",{className:k("font-medium",e.confidence_score>=70?"text-red-600":e.confidence_score>=40?"text-yellow-600":"text-gray-600 dark:text-gray-400"),children:[e.confidence_score,"%"]})}),t.jsx("td",{children:t.jsx("span",{className:k("px-2 py-1 text-xs rounded-full","automatic"===e.scan_type?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"),children:e.scan_type})})]},e.id))})]})})]})]}),"settings"===A&&t.jsxs("div",{className:"card p-6",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white mb-6 flex items-center gap-2",children:[t.jsx(n,{className:"w-5 h-5 text-primary-600"}),"Automatic Scan Settings"]}),re?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):t.jsxs("div",{className:"space-y-6 max-w-xl",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:"font-medium text-gray-900 dark:text-white",children:"Enable Automatic Scanning"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Run nightly scans automatically"})]}),t.jsx("button",{onClick:()=>me.mutate({enabled:!ve.enabled}),className:k("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",ve.enabled?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:t.jsx("span",{className:k("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",ve.enabled?"translate-x-6":"translate-x-1")})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block font-medium text-gray-900 dark:text-white mb-2",children:[t.jsx(j,{className:"w-4 h-4 inline mr-2"}),"Scan Time"]}),t.jsx("input",{type:"time",value:ve.scan_time||"03:00",onChange:e=>me.mutate({scan_time:e.target.value}),className:"input w-40"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Recommended: 03:00 - 05:00 (off-peak hours)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-900 dark:text-white mb-2",children:"Retention Days"}),t.jsxs("select",{value:ve.retention_days||30,onChange:e=>me.mutate({retention_days:Number(e.target.value)}),className:"input w-40",children:[t.jsx("option",{value:7,children:"7 days"}),t.jsx("option",{value:14,children:"14 days"}),t.jsx("option",{value:30,children:"30 days"}),t.jsx("option",{value:60,children:"60 days"}),t.jsx("option",{value:90,children:"90 days"})]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Old detection records will be automatically deleted"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-900 dark:text-white mb-2",children:"Minimum Risk Level to Save"}),t.jsxs("select",{value:ve.min_suspicion_level||"medium",onChange:e=>me.mutate({min_suspicion_level:e.target.value}),className:"input w-40",children:[t.jsx("option",{value:"low",children:"Low (save all)"}),t.jsx("option",{value:"medium",children:"Medium (recommended)"}),t.jsx("option",{value:"high",children:"High only"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-900 dark:text-white mb-2",children:"Connection Threshold"}),t.jsx("input",{type:"number",value:ve.connection_threshold||500,onChange:e=>me.mutate({connection_threshold:Number(e.target.value)}),className:"input w-40",min:100,max:2e3,step:100}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Users with more connections are flagged as suspicious"})]}),t.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.jsx(F,{className:"w-4 h-4 inline mr-1"}),"The automatic scan will run daily at the configured time and save suspicious accounts to history."]})})]})]})]})}export{A as default};
