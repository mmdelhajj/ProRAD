import{b as e,u as t,d as a,j as r}from"./data-vendor-Gi89QHLZ.js";import{r as s}from"./react-vendor-C1B6conR.js";import{Q as d}from"./index-GOpZM_5c.js";import{z as l}from"./ui-vendor-Bljr83Cq.js";import{F as n}from"./PlayIcon-BR5YOtV1.js";import"./chart-vendor-C_esy2x0.js";function i(){const i=e(),[c,o]=s.useState(!1),[x,u]=s.useState(null),[m,p]=s.useState({name:"",start_time:"16:00",end_time:"23:00",days_of_week:[0,1,2,3,4,5,6],speed_multiplier:100,cdn_ids:[],priority:10,enabled:!0,auto_apply:!0}),{data:g,isLoading:y}=t({queryKey:["cdn-bandwidth-rules"],queryFn:()=>d.get("/cdn-bandwidth-rules").then(e=>e.data.data||[])}),{data:h}=t({queryKey:["cdns"],queryFn:()=>d.get("/cdns").then(e=>e.data.data||[])}),b=a({mutationFn:e=>d.post("/cdn-bandwidth-rules",e),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),l.success("CDN bandwidth rule created"),w()},onError:e=>{var t,a;l.error((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Failed to create rule")}}),k=a({mutationFn:({id:e,...t})=>d.put(`/cdn-bandwidth-rules/${e}`,t),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),l.success("CDN bandwidth rule updated"),w()},onError:e=>{var t,a;l.error((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Failed to update rule")}}),f=a({mutationFn:e=>d.delete(`/cdn-bandwidth-rules/${e}`),onSuccess:()=>{i.invalidateQueries(["cdn-bandwidth-rules"]),l.success("Rule deleted")}}),N=a({mutationFn:({id:e,enabled:t})=>d.put(`/cdn-bandwidth-rules/${e}`,{enabled:t}),onSuccess:()=>i.invalidateQueries(["cdn-bandwidth-rules"])}),j=a({mutationFn:e=>d.post(`/cdn-bandwidth-rules/${e}/apply`),onSuccess:e=>{l.success(`CDN rule applied to ${e.data.applied_count} queues`)},onError:e=>{var t,a;l.error((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Failed to apply rule")}}),v=[{value:0,label:"Sun"},{value:1,label:"Mon"},{value:2,label:"Tue"},{value:3,label:"Wed"},{value:4,label:"Thu"},{value:5,label:"Fri"},{value:6,label:"Sat"}],w=()=>{o(!1),u(null),p({name:"",start_time:"16:00",end_time:"23:00",days_of_week:[0,1,2,3,4,5,6],speed_multiplier:100,cdn_ids:[],priority:10,enabled:!0,auto_apply:!0})},_=e=>{if(!e||0===e.length)return"No CDNs selected";const t=e.map(e=>{var t;return null==(t=null==h?void 0:h.find(t=>t.id===e))?void 0:t.name}).filter(Boolean);return t.length>0?t.join(", "):"No CDNs selected"};return y?r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"CDN Bandwidth Rules"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"Configure time-based CDN speed adjustments (e.g., reduce CDN speed during peak hours)"})]}),r.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Rule"})]}),r.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 p-4 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-orange-900",children:"Time-Based CDN Bandwidth Rules"}),r.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Create rules to adjust CDN speeds during peak hours. For example, reduce CDN traffic to 50% during evening hours (16:00-23:00) to prioritize regular user traffic. Enable Auto Apply to have rules activate automatically on schedule."})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden",children:[r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Name"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"CDNs"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Schedule"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Speed"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:(g||[]).map(e=>{return r.jsxs("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:_(e.cdn_ids)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:r.jsxs("div",{children:[r.jsxs("div",{children:[e.start_time," - ",e.end_time]}),r.jsx("div",{className:"text-xs",children:(t=e.days_of_week,t&&0!==t.length?7===t.length?"Every day":JSON.stringify([...t].sort())===JSON.stringify([1,2,3,4,5])?"Weekdays":JSON.stringify([...t].sort())===JSON.stringify([0,6])?"Weekends":t.map(e=>{var t;return null==(t=v.find(t=>t.value===e))?void 0:t.label}).join(", "):"Never")})]})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[r.jsxs("span",{className:"font-medium "+(e.speed_multiplier>100?"text-green-600":e.speed_multiplier<100?"text-orange-600":"text-gray-600"),children:[e.speed_multiplier,"%"]}),e.speed_multiplier<100&&r.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",100-e.speed_multiplier,"% reduction)"]})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>N.mutate({id:e.id,enabled:!e.enabled}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 "+(e.enabled?"bg-blue-600":"bg-gray-200"),children:r.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white dark:bg-gray-800 shadow transition duration-200 "+(e.enabled?"translate-x-5":"translate-x-0")})}),e.auto_apply&&r.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-green-100 text-green-700 rounded font-medium",children:"AUTO"})]})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[r.jsxs("button",{onClick:()=>j.mutate(e.id),disabled:j.isPending,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded hover:bg-green-200 mr-2",title:"Apply Now",children:[r.jsx(n,{className:"w-3 h-3 mr-1"}),"Apply"]}),r.jsx("button",{onClick:()=>(e=>{u(e),p({name:e.name,start_time:e.start_time||"16:00",end_time:e.end_time||"23:00",days_of_week:e.days_of_week||[0,1,2,3,4,5,6],speed_multiplier:e.speed_multiplier||100,cdn_ids:e.cdn_ids||[],priority:e.priority||10,enabled:e.enabled,auto_apply:e.auto_apply||!1}),o(!0)})(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Edit"}),r.jsx("button",{onClick:()=>{confirm("Delete this rule?")&&f.mutate(e.id)},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var t})})]}),0===(g||[]).length&&r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:'No CDN bandwidth rules configured. Click "Add Rule" to create one.'})]}),c&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:w}),r.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:x?"Edit CDN Bandwidth Rule":"Add CDN Bandwidth Rule"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),0!==m.cdn_ids.length?x?k.mutate({id:x.id,...m}):b.mutate(m):l.error("Please select at least one CDN")},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Rule Name"}),r.jsx("input",{type:"text",value:m.name,onChange:e=>p({...m,name:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",placeholder:"e.g., Peak Hours CDN Limit, Evening CDN Reduction",required:!0})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Start Time"}),r.jsx("input",{type:"time",value:m.start_time,onChange:e=>p({...m,start_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"End Time"}),r.jsx("input",{type:"time",value:m.end_time,onChange:e=>p({...m,end_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Days of Week"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(e=>r.jsx("button",{type:"button",onClick:()=>(e=>{const t=m.days_of_week.includes(e)?m.days_of_week.filter(t=>t!==e):[...m.days_of_week,e].sort();p({...m,days_of_week:t})})(e.value),className:"px-3 py-1 text-sm rounded-md "+(m.days_of_week.includes(e.value)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.label},e.value))})]}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 bg-blue-50 dark:bg-blue-900/30 p-2 rounded",children:"Speed multiplier: 100% = same speed, 200% = double speed, 50% = half speed"}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:["CDN Speed: ",r.jsxs("span",{className:"font-bold "+(m.speed_multiplier>100?"text-green-600":m.speed_multiplier<100?"text-orange-600":"text-gray-600"),children:[m.speed_multiplier,"%"]}),m.speed_multiplier<100&&r.jsxs("span",{className:"font-normal text-gray-500 ml-1",children:["(",100-m.speed_multiplier,"% reduction)"]})]}),r.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:m.speed_multiplier,onChange:e=>p({...m,speed_multiplier:parseInt(e.target.value)}),className:"mt-2 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),r.jsxs("div",{className:"flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1",children:[r.jsx("span",{children:"10%"}),r.jsx("span",{children:"50%"}),r.jsx("span",{children:"100%"}),r.jsx("span",{children:"200%"}),r.jsx("span",{children:"300%"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Apply to CDNs ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 "+(0===m.cdn_ids.length?"border-red-300 bg-red-50":""),children:(h||[]).map(e=>r.jsxs("label",{className:"flex items-center py-1",children:[r.jsx("input",{type:"checkbox",checked:m.cdn_ids.includes(e.id),onChange:t=>{const a=t.target.checked?[...m.cdn_ids,e.id]:m.cdn_ids.filter(t=>t!==e.id);p({...m,cdn_ids:a})},className:"rounded border-gray-300 text-blue-600"}),r.jsxs("span",{className:"ml-2 text-sm text-gray-700 flex items-center",children:[r.jsx("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:e.color||"#EF4444"}}),e.name]})]},e.id))}),r.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Select at least one CDN (required)"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:m.enabled,onChange:e=>p({...m,enabled:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400"}),r.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Enabled"})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:m.auto_apply,onChange:e=>p({...m,auto_apply:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),r.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Auto Apply (apply automatically on schedule)"})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:w,className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:bg-gray-600",children:"Cancel"}),r.jsxs("button",{type:"submit",disabled:b.isPending||k.isPending,className:"px-4 py-2 text-sm text-white bg-blue-600 rounded-md hover:bg-blue-700",children:[x?"Update":"Create"," Rule"]})]})]})]})]})})]})}export{i as default};
