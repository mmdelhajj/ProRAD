import{b as e,u as s,d as a,j as l}from"./data-vendor-C6mPcuPT.js";import{r}from"./react-vendor-C4Xey-hE.js";import{u as t,F as i,m as n,d as c,b as d,a as o,A as x}from"./index-DRJG7jyl.js";import{u as m,f as h,a as u}from"./table-vendor-BZVOk-Gl.js";import{z as j}from"./ui-vendor-CMKyyIMz.js";import{F as g}from"./ArrowUpTrayIcon-KwZNblaH.js";import{F as p}from"./XCircleIcon-ngg1M-ll.js";import{F as v}from"./MagnifyingGlassIcon-D7UyJAmN.js";import"./chart-vendor-Be69IwoK.js";function N(e){if(!e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB","TB"][s]}function f(e){if(!e)return"0s";const s=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return s>0?`${s}h ${a}m`:a>0?`${a}m ${l}s`:`${l}s`}function y(){const y=e(),{hasPermission:_}=t(),[w,b]=r.useState(""),{data:M,isLoading:C,refetch:A}=s({queryKey:["sessions"],queryFn:()=>x.list({limit:100}).then(e=>e.data.data),refetchInterval:1e4}),F=a({mutationFn:e=>x.disconnect(e),onSuccess:()=>{j.success("Session disconnected"),y.invalidateQueries(["sessions"])},onError:e=>{var s,a;return j.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to disconnect")}}),K=r.useMemo(()=>{if(!M)return[];if(!w)return M;const e=w.toLowerCase();return M.filter(s=>{var a,l,r,t,i;return(null==(a=s.username)?void 0:a.toLowerCase().includes(e))||(null==(l=s.framed_ip_address)?void 0:l.includes(e))||(null==(r=s.nas_ip_address)?void 0:r.includes(e))||(null==(t=s.calling_station_id)?void 0:t.toLowerCase().includes(e))||(null==(i=s.full_name)?void 0:i.toLowerCase().includes(e))})},[M,w]),S=r.useMemo(()=>[{accessorKey:"username",header:"Username",cell:({row:e})=>l.jsxs("div",{className:"flex flex-col",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(i,{className:"w-4 h-4 text-green-500"}),l.jsx("span",{className:"font-medium",children:e.original.username})]}),e.original.full_name&&l.jsx("span",{className:"text-xs text-gray-500 ml-6",children:e.original.full_name})]})},{accessorKey:"framed_ip_address",header:"IP Address",cell:({row:e})=>l.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:e.original.framed_ip_address||"-"})},{accessorKey:"calling_station_id",header:"MAC Address",cell:({row:e})=>l.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm text-xs",children:e.original.calling_station_id||"-"})},{accessorKey:"nas_name",header:"NAS",cell:({row:e})=>l.jsxs("div",{className:"flex flex-col",children:[l.jsx("span",{children:e.original.nas_name||e.original.nas_ip_address||"-"}),e.original.nas_name&&e.original.nas_ip_address&&l.jsx("span",{className:"text-xs text-gray-400",children:e.original.nas_ip_address})]})},{accessorKey:"acct_start_time",header:"Started",cell:({row:e})=>l.jsx("div",{className:"text-sm",children:n(e.original.acct_start_time)})},{accessorKey:"session_duration",header:"Duration",cell:({row:e})=>l.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[l.jsx(c,{className:"w-4 h-4 text-gray-400"}),f(e.original.session_duration)]})},{accessorKey:"traffic",header:"Traffic",cell:({row:e})=>l.jsxs("div",{className:"text-sm space-y-1",children:[l.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[l.jsx(d,{className:"w-3 h-3"}),N(e.original.acct_input_octets)]}),l.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[l.jsx(g,{className:"w-3 h-3"}),N(e.original.acct_output_octets)]})]})},{id:"actions",header:"Actions",cell:({row:e})=>_("subscribers.disconnect")?l.jsx("button",{onClick:()=>{confirm("Disconnect this session?")&&F.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",title:"Disconnect",children:l.jsx(p,{className:"w-5 h-5"})}):null}],[F,_]),B=m({data:K,columns:S,getCoreRowModel:u()}),D=(null==M?void 0:M.reduce((e,s)=>e+(s.acct_input_octets||0),0))||0,I=(null==M?void 0:M.reduce((e,s)=>e+(s.acct_output_octets||0),0))||0;return l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Active Sessions"}),l.jsx("p",{className:"text-gray-500",children:"Monitor live PPPoE connections"})]}),l.jsxs("button",{onClick:()=>A(),className:"btn-secondary flex items-center gap-2",children:[l.jsx(o,{className:"w-4 h-4"}),"Refresh"]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx("div",{className:"card p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:l.jsx(i,{className:"w-5 h-5 text-green-600"})}),l.jsxs("div",{children:[l.jsx("div",{className:"text-sm text-gray-500",children:"Online Users"}),l.jsx("div",{className:"text-2xl font-bold",children:(null==M?void 0:M.length)||0})]})]})}),l.jsx("div",{className:"card p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:l.jsx(d,{className:"w-5 h-5 text-blue-600"})}),l.jsxs("div",{children:[l.jsx("div",{className:"text-sm text-gray-500",children:"Total Download"}),l.jsx("div",{className:"text-2xl font-bold",children:N(D)})]})]})}),l.jsx("div",{className:"card p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:l.jsx(g,{className:"w-5 h-5 text-purple-600"})}),l.jsxs("div",{children:[l.jsx("div",{className:"text-sm text-gray-500",children:"Total Upload"}),l.jsx("div",{className:"text-2xl font-bold",children:N(I)})]})]})}),l.jsx("div",{className:"card p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:l.jsx(c,{className:"w-5 h-5 text-yellow-600"})}),l.jsxs("div",{children:[l.jsx("div",{className:"text-sm text-gray-500",children:"Auto-refresh"}),l.jsx("div",{className:"text-lg font-bold",children:"Every 10s"})]})]})})]}),l.jsx("div",{className:"card p-4",children:l.jsxs("div",{className:"relative max-w-md",children:[l.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),l.jsx("input",{type:"text",placeholder:"Search by username, IP, MAC...",value:w,onChange:e=>b(e.target.value),className:"input pl-10"})]})}),l.jsx("div",{className:"card",children:l.jsx("div",{className:"table-container",children:l.jsxs("table",{className:"table",children:[l.jsx("thead",{children:B.getHeaderGroups().map(e=>l.jsx("tr",{children:e.headers.map(e=>l.jsx("th",{children:h(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),l.jsx("tbody",{className:"divide-y divide-gray-200",children:C?l.jsx("tr",{children:l.jsx("td",{colSpan:S.length,className:"text-center py-8",children:l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===B.getRowModel().rows.length?l.jsx("tr",{children:l.jsx("td",{colSpan:S.length,className:"text-center py-8 text-gray-500",children:"No active sessions"})}):B.getRowModel().rows.map(e=>l.jsx("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>l.jsx("td",{children:h(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})})]})}export{y as default};
