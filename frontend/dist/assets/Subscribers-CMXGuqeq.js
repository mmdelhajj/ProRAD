import{b as e,u as s,d as a,j as r}from"./data-vendor-DrqtOFCb.js";import{r as t,b as l,L as n}from"./react-vendor-_qYBQpt5.js";import{u as i,f as d,F as c,a as o,b as x,c as m,d as u,e as g,g as h,h as p,i as b,j as y,s as v,k as j,n as f,r as N}from"./index-Di4L8egU.js";import{u as k,f as w,g as _,a as C}from"./table-vendor-XPl0DXXF.js";import{c as S,z as F}from"./ui-vendor-C17HITwC.js";import{L as M}from"./leaflet-src-yaYzS9J7.js";import{F as A}from"./MapPinIcon-DqwKe7Qx.js";import{F as P}from"./ArrowUpTrayIcon-LbDro8i1.js";import{F as E}from"./DocumentArrowUpIcon-BRku4nH3.js";import{F as R}from"./MagnifyingGlassIcon-Bzqxa0ti.js";import{F as D,a as I,b as $}from"./FunnelIcon-BY7b3wEB.js";import{F as U}from"./PlayIcon-DmLK71Dk.js";import{F as L}from"./XCircleIcon-BUCetHXU.js";import{F as O}from"./TrashIcon-3C89j8Vq.js";import"./chart-vendor-CsTzT1mg.js";function q({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const K=t.forwardRef(q);function B({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"}))}const T=t.forwardRef(B);function Q({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"}))}const V=t.forwardRef(Q);function X({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const z=t.forwardRef(X);function H({title:e,titleId:s,...a},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":s},a),e?t.createElement("title",{id:s},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const Z=t.forwardRef(H);function G({lat:e,lng:s}){const a=t.useRef(null),l=t.useRef(null);return t.useEffect(()=>{if(!a.current||l.current)return;const r=M.map(a.current,{center:[e,s],zoom:16});return M.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(r),M.marker([e,s]).addTo(r),l.current=r,()=>{r.remove(),l.current=null}},[e,s]),r.jsx("div",{ref:a,style:{height:"320px",width:"100%"}})}delete M.Icon.Default.prototype._getIconUrl,M.Icon.Default.mergeOptions({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});const W=[{value:"",label:"All Status"},{value:"online",label:"Online"},{value:"offline",label:"Offline"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"expired",label:"Expired"},{value:"expiring",label:"Expiring Soon"}],J=e=>{const s=e.expiry_date&&new Date(e.expiry_date)<new Date;return e.expiry_date&&(new Date(e.expiry_date),new Date(Date.now()+6048e5)),0===e.status?{color:"bg-gray-500",text:"Inactive",textColor:"text-gray-600"}:2===e.status?{color:"bg-gray-500",text:"Suspended",textColor:"text-gray-600"}:s?{color:"bg-yellow-500",text:"Expired",textColor:"text-yellow-600"}:e.is_online?{color:"bg-green-500",text:"Online",textColor:"text-green-600"}:{color:"bg-red-500",text:"Offline",textColor:"text-red-600"}},Y=e=>{if(!e||0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(1))+" "+["B","KB","MB","GB","TB"][s]};function ee(){var M,q,B,Q,X,H,ee,se,ae,re,te,le,ne,ie,de;l();const ce=e(),{hasPermission:oe}=i(),xe=t.useRef(null),[me,ue]=t.useState(1),[ge,he]=t.useState(25),[pe,be]=t.useState(""),[ye,ve]=t.useState(""),[je,fe]=t.useState(""),[Ne,ke]=t.useState(""),[we,_e]=t.useState(""),[Ce,Se]=t.useState(""),[Fe,Me]=t.useState(!1),[Ae,Pe]=t.useState(""),[Ee,Re]=t.useState(!1),[De,Ie]=t.useState([]),[$e,Ue]=t.useState("active"),[Le,Oe]=t.useState(new Set),[qe,Ke]=t.useState(()=>{const e={username:!0,full_name:!0,phone:!0,mac_address:!0,ip_address:!0,service:!0,reseller:!0,status:!0,expiry_date:!0,last_seen:!0,daily_quota:!0,monthly_quota:!0,price:!1,balance:!1,address:!1,region:!1,building:!1,notes:!1,created_at:!1};try{const s=localStorage.getItem("subscriberColumns");if(s)return{...e,...JSON.parse(s)}}catch(s){}return e}),[Be,Te]=t.useState(!1);t.useEffect(()=>{try{localStorage.setItem("subscriberColumns",JSON.stringify(qe))}catch(e){}},[qe]);const[Qe,Ve]=t.useState(!1),[Xe,ze]=t.useState(null),[He,Ze]=t.useState(""),[Ge,We]=t.useState(null),[Je,Ye]=t.useState(null),[es,ss]=t.useState(""),[as,rs]=t.useState(""),[ts,ls]=t.useState({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0}),[ns,is]=t.useState(null),[ds,cs]=t.useState(!1),[os,xs]=t.useState(null),[ms,us]=t.useState(null),[gs,hs]=t.useState(null),[ps,bs]=t.useState(null),[ys,vs]=t.useState(!1),[js,fs]=t.useState(!0),{data:Ns,isLoading:ks,refetch:ws}=s({queryKey:["subscribers",me,ge,pe,ye,je,Ne,we,Ce,$e,Fe,Ae],queryFn:()=>"archived"===$e?v.listArchived({page:me,limit:ge,search:pe}).then(e=>e.data):v.list({page:me,limit:ge,search:pe,status:ye,service_id:je,nas_id:Ne,reseller_id:we,fup_level:Ce,monthly_fup:Fe?"true":"",sort_by:Ae}).then(e=>e.data)}),{data:_s}=s({queryKey:["services-list"],queryFn:()=>j.list().then(e=>e.data.data)}),{data:Cs}=s({queryKey:["nas-list"],queryFn:()=>f.list().then(e=>e.data.data)}),{data:Ss}=s({queryKey:["resellers-list"],queryFn:()=>N.list().then(e=>e.data.data)}),Fs=t.useMemo(()=>((null==Ns?void 0:Ns.data)||[]).filter(e=>Le.has(e.id)),[null==Ns?void 0:Ns.data,Le]),Ms=Le.size,As=()=>{Oe(new Set)},Ps=a({mutationFn:e=>v.renew(e),onSuccess:()=>{F.success("Subscriber renewed successfully"),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to renew")}}),Es=a({mutationFn:e=>v.disconnect(e),onSuccess:()=>{F.success("Subscriber disconnected"),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to disconnect")}}),Rs=a({mutationFn:e=>v.resetFup(e),onSuccess:()=>{F.success("FUP quota reset successfully"),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to reset FUP")}}),Ds=a({mutationFn:({id:e,mac_address:s,reason:a})=>v.resetMac(e,{mac_address:s,reason:a}),onSuccess:()=>{F.success("MAC address reset successfully"),Ye(null),ss(""),rs(""),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to reset MAC")}}),Is=a({mutationFn:({id:e,new_username:s,reason:a})=>v.rename(e,{new_username:s,reason:a}),onSuccess:()=>{F.success("Username changed successfully"),Ye(null),ss(""),rs(""),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to rename")}}),$s=a({mutationFn:({id:e,days:s,reason:a})=>v.addDays(e,{days:s,reason:a}),onSuccess:()=>{F.success("Days added successfully"),Ye(null),ss(""),rs(""),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to add days")}}),Us=a({mutationFn:({id:e,service_id:s,extend_expiry:a,reset_fup:r,charge_price:t,prorate_price:l,reason:n})=>v.changeService(e,{service_id:s,extend_expiry:a,reset_fup:r,charge_price:t,prorate_price:l,reason:n}),onSuccess:e=>{var s;const a=null==(s=e.data)?void 0:s.data;let r="Service changed successfully";(null==a?void 0:a.charge_amount)&&(r+=`. Charged: $${a.charge_amount.toFixed(2)}`),F.success(r),Ye(null),ss(""),rs(""),is(null),ls({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0}),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to change service")}}),Ls=async e=>{var s,a,r,t;if(e&&e.is_online){vs(!0);try{const r=await v.getTorch(e.id,2);(null==(s=r.data)?void 0:s.success)?bs(r.data.data):(F.error((null==(a=r.data)?void 0:a.message)||"Failed to get torch data"),bs(null))}catch(l){F.error((null==(t=null==(r=l.response)?void 0:r.data)?void 0:t.message)||"Failed to get torch data"),bs(null)}finally{vs(!1)}}};t.useEffect(()=>{let e;return ms&&js&&!ys&&(e=setInterval(()=>{Ls(ms)},2e3)),()=>{e&&clearInterval(e)}},[ms,js,ys]);const Os=a({mutationFn:e=>v.activate(e),onSuccess:()=>{F.success("Subscriber activated"),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to activate")}}),qs=a({mutationFn:e=>v.deactivate(e),onSuccess:()=>{F.success("Subscriber deactivated"),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to deactivate")}}),Ks=a({mutationFn:({id:e,amount:s,reason:a})=>v.refill(e,{amount:s,reason:a}),onSuccess:()=>{F.success("Account refilled successfully"),Ye(null),ss(""),rs(""),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to refill")}}),Bs=a({mutationFn:e=>v.ping(e),onSuccess:e=>{const s=e.data.data;F.custom(e=>r.jsx("div",{onClick:()=>F.dismiss(e.id),className:(e.visible?"animate-enter":"animate-leave")+" max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg pointer-events-auto cursor-pointer border border-gray-200 dark:border-gray-700",children:r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(b,{className:"h-6 w-6 text-green-500"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ping Result"}),r.jsx("pre",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300 whitespace-pre-wrap font-mono",children:s.output}),r.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"Click anywhere to close"})]})]})})}),{duration:3e4})},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to ping")}}),Ts=a({mutationFn:e=>v.delete(e),onSuccess:()=>{F.success("Subscriber deleted"),As(),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}}),Qs=a({mutationFn:({file:e,serviceId:s})=>{const a=new FormData;return a.append("file",e),a.append("service_id",s),v.bulkImport(a)},onSuccess:e=>{We(e.data.data),F.success(e.data.message),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to import")}}),Vs=a({mutationFn:({ids:e,action:s})=>v.bulkAction({ids:e,action:s}),onSuccess:e=>{F.success(e.data.message),As(),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to perform action")}});a({mutationFn:e=>v.restore(e),onSuccess:()=>{F.success("Subscriber restored"),As(),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to restore")}}),a({mutationFn:e=>v.permanentDelete(e),onSuccess:()=>{F.success("Subscriber permanently deleted"),As(),ce.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return F.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}});const Xs=e=>{var s;const a=Array.from(Le);if(0!==a.length)if(a.length>1)Vs.mutate({ids:a,action:e});else{const r=a[0],t=Fs[0];switch(e){case"renew":Ps.mutate(r);break;case"disconnect":Es.mutate(r);break;case"reset_fup":Rs.mutate(r);break;case"enable":Os.mutate(r);break;case"disable":qs.mutate(r);break;case"ping":Bs.mutate(r);break;case"delete":confirm("Are you sure you want to delete this subscriber?")&&Ts.mutate(r);break;case"reset_mac":Ye({type:"resetMac",subscriber:t}),ss((null==t?void 0:t.mac_address)||"");break;case"add_days":Ye({type:"addDays",subscriber:t});break;case"change_service":Ye({type:"changeService",subscriber:t}),ss((null==(s=null==t?void 0:t.service_id)?void 0:s.toString())||"");break;case"rename":Ye({type:"rename",subscriber:t});break;case"refill":Ye({type:"refill",subscriber:t})}}},zs=e=>{const s=Array.from(Le);if(0!==s.length){if("delete"===e){const e=(null==Ns?void 0:Ns.data)||[],a=s.map(s=>{const a=e.find(e=>e.id===s);return a?a.full_name||a.username:`ID ${s}`});return void xs({ids:s,names:a})}Vs.mutate({ids:s,action:e})}},Hs=t.useMemo(()=>[{id:"status_indicator",header:"",cell:({row:e})=>{const s=J(e.original);if("daily_usage"===Ae||"monthly_usage"===Ae){const s=(me-1)*ge+e.index+1;return r.jsx("div",{className:"flex items-center justify-center",children:r.jsxs("span",{className:S("text-[10px] font-bold px-1 py-0.5 rounded min-w-[22px] text-center",1===s?"bg-yellow-400 text-yellow-900":2===s?"bg-gray-300 text-gray-700":3===s?"bg-orange-300 text-orange-900":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:["#",s]})})}return r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("span",{className:S("w-3 h-3 rounded-full",s.color,e.original.is_online&&"animate-pulse")})})},size:30},...qe.username?[{accessorKey:"username",header:"Username",cell:({row:e})=>r.jsx("div",{children:r.jsxs("span",{className:"inline-flex items-center gap-1",children:[r.jsx(n,{to:`/subscribers/${e.original.id}`,className:"font-semibold text-primary-600 dark:text-cyan-400 hover:text-primary-800 dark:hover:text-cyan-300 hover:underline",onClick:e=>e.stopPropagation(),children:e.original.username}),e.original.is_online&&oe("subscribers.torch")&&r.jsx("button",{onClick:s=>{s.stopPropagation(),us(e.original),bs(null),Ls(e.original)},className:"text-green-500 hover:text-green-700",title:"Live Traffic (Torch)",children:r.jsx(c,{className:"w-4 h-4"})}),e.original.latitude&&e.original.longitude&&0!==parseFloat(e.original.latitude)&&r.jsx("button",{onClick:s=>{s.stopPropagation(),hs(e.original)},className:"text-blue-500 hover:text-blue-700",title:"View Location on Map",children:r.jsx(A,{className:"w-4 h-4"})}),e.original.fup_level>0&&r.jsxs("span",{className:"inline-block px-1.5 py-0.5 text-[10px] font-bold text-white rounded whitespace-nowrap "+(1===e.original.fup_level?"bg-yellow-500":2===e.original.fup_level?"bg-orange-500":"bg-red-600"),children:["FUP",e.original.fup_level]}),"daily_usage"===Ae&&(()=>{const s=(e.original.daily_download_used||0)+(e.original.daily_upload_used||0),a=s/1073741824,t=a>=1?`${a.toFixed(1)} GB`:`${(s/1048576).toFixed(0)} MB`;return r.jsxs("span",{className:"inline-block px-1.5 py-0.5 text-[10px] font-bold bg-cyan-100 dark:bg-cyan-900/50 text-cyan-700 dark:text-cyan-300 rounded whitespace-nowrap",children:["↓ ",t]})})(),"monthly_usage"===Ae&&(()=>{const s=(e.original.monthly_download_used||0)+(e.original.monthly_upload_used||0),a=s/1073741824,t=a>=1?`${a.toFixed(1)} GB`:`${(s/1048576).toFixed(0)} MB`;return r.jsxs("span",{className:"inline-block px-1.5 py-0.5 text-[10px] font-bold bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded whitespace-nowrap",children:["↓ ",t]})})()]})})}]:[],...qe.full_name?[{accessorKey:"full_name",header:"Fullname"}]:[],...qe.phone?[{accessorKey:"phone",header:"Phone"}]:[],...qe.mac_address?[{accessorKey:"mac_address",header:"MAC",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"font-mono text-xs",children:e.original.mac_address||"N/A"}),e.original.mac_address&&r.jsx("button",{onClick:s=>{s.stopPropagation(),Ye({type:"resetMac",subscriber:e.original}),ss(e.original.mac_address)},className:"text-gray-400 hover:text-primary-600",title:"Reset MAC",children:r.jsx(o,{className:"w-3.5 h-3.5"})})]})}]:[],...qe.ip_address?[{accessorKey:"ip_address",header:"IP",cell:({row:e})=>r.jsx("span",{className:S("font-mono text-xs",e.original.is_online?"text-green-600 font-medium":"text-gray-500"),children:e.original.ip_address||e.original.static_ip||"N/A"})}]:[],...qe.service?[{accessorKey:"service.name",header:"Service",cell:({row:e})=>{var s,a;const t=(null==(s=e.original.service)?void 0:s.name)||"-";if(qe.daily_quota)return r.jsx("div",{className:"text-center font-medium",children:t});const l=e.original.daily_quota_used||0,n=(null==(a=e.original.service)?void 0:a.daily_quota)||0;if(0===n)return r.jsx("div",{className:"text-center font-medium",children:t});const i=Math.min(100,l/n*100),d=Y(l);return r.jsxs("div",{className:"min-w-[120px]",children:[r.jsx("div",{className:"text-center font-medium text-sm",children:t}),r.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mt-1 relative border border-gray-300 dark:border-gray-600",children:[r.jsx("div",{className:"h-full rounded-full transition-all "+(i>=100?"bg-red-500":i>=50?"bg-yellow-500":"bg-teal-500"),style:{width:`${Math.min(100,i)}%`}}),r.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800 dark:text-gray-200",children:d})]})]})}}]:[],...qe.daily_quota?[{id:"daily_quota",header:()=>r.jsxs("button",{onClick:()=>{Pe("daily_usage"===Ae?"":"daily_usage"),Ie([]),Me(!1),Se(""),ue(1)},className:"flex items-center gap-1 font-medium whitespace-nowrap "+("daily_usage"===Ae?"text-cyan-600 dark:text-cyan-400":"hover:text-cyan-600 dark:hover:text-cyan-400"),children:["Top Daily ","daily_usage"===Ae?"▼":"↕"]}),cell:({row:e})=>{var s;const a=(e.original.daily_download_used||0)+(e.original.daily_upload_used||0),t=(null==(s=e.original.service)?void 0:s.daily_quota)||0;if(0===a&&0===t)return r.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"—"});const l=t>0?Math.min(100,a/t*100):0;return r.jsxs("div",{className:"min-w-[80px]",children:[r.jsx("div",{className:"text-xs font-medium text-center mb-0.5 text-cyan-700 dark:text-cyan-300",children:Y(a)}),t>0&&r.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"h-full rounded-full "+(l>=100?"bg-red-500":l>=50?"bg-yellow-500":"bg-teal-500"),style:{width:`${l}%`}})})]})}}]:[],...qe.reseller?[{id:"reseller",header:"Reseller",cell:({row:e})=>{var s,a;const t=e.original.reseller;return t?r.jsxs("div",{className:"text-xs",children:[r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:(null==(s=t.user)?void 0:s.username)||t.name}),t.parent&&r.jsxs("div",{className:"text-gray-500 dark:text-gray-400 text-[10px]",children:["↳ Sub of: ",(null==(a=t.parent.user)?void 0:a.username)||t.parent.name]})]}):r.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"-"})}}]:[],...qe.status?[{accessorKey:"status",header:"Status",cell:({row:e})=>{const s=J(e.original);return r.jsx("span",{className:S("text-xs font-medium",s.textColor),children:s.text})}}]:[],...qe.expiry_date?[{accessorKey:"expiry_date",header:"Expiry",cell:({row:e})=>{if(!e.original.expiry_date)return"-";const s=new Date(e.original.expiry_date),a=s<new Date,t=Math.ceil((s-new Date)/864e5);return r.jsxs("div",{children:[r.jsx("div",{className:S(a?"text-red-600":"text-gray-900 dark:text-white","text-sm"),children:d(e.original.expiry_date)}),r.jsx("div",{className:S("text-xs",a?"text-red-500":"text-gray-500 dark:text-gray-400"),children:a?`${Math.abs(t)}d ago`:`${t}d left`})]})}}]:[],...qe.last_seen?[{accessorKey:"last_seen",header:"Last Seen",cell:({row:e})=>{if(e.original.is_online)return r.jsx("span",{className:"text-green-600 dark:text-green-400 text-xs font-medium",children:"Online Now"});if(!e.original.last_seen)return r.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"Never"});const s=new Date(e.original.last_seen),a=new Date-s,t=Math.floor(a/6e4),l=Math.floor(a/36e5),n=Math.floor(a/864e5);let i;return i=t<1?"Just now":t<60?`${t}m ago`:l<24?`${l}h ago`:n<30?`${n}d ago`:d(e.original.last_seen),r.jsx("div",{className:"text-xs",children:r.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:i})})}}]:[],...qe.monthly_quota?[{id:"monthly_quota",header:"Monthly",cell:({row:e})=>{var s;const a=e.original.monthly_quota_used||0,t=(null==(s=e.original.service)?void 0:s.monthly_quota)||0;if(0===t)return r.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"Unlimited"});const l=Math.min(100,a/t*100),n=Y(a);return r.jsx("div",{className:"min-w-[80px]",children:r.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 relative border border-gray-300 dark:border-gray-600",children:[r.jsx("div",{className:"h-full rounded-full "+(l>=100?"bg-red-500":l>=50?"bg-yellow-500":"bg-teal-500"),style:{width:`${Math.min(100,l)}%`}}),r.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-medium text-gray-800 dark:text-gray-200",children:n})]})})}}]:[],...qe.price?[{accessorKey:"price",header:"Price",cell:({row:e})=>{var s;const a=e.original,t=a.override_price?a.price:null==(s=a.service)?void 0:s.price;return r.jsxs("span",{className:"font-medium",children:["$",(t||0).toFixed(2),a.override_price&&r.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Custom price",children:"★"})]})}}]:[],...qe.balance?[{accessorKey:"credit_balance",header:"Balance",cell:({row:e})=>r.jsxs("span",{className:"font-medium",children:["$",(e.original.credit_balance||0).toFixed(2)]})}]:[],...qe.address?[{accessorKey:"address",header:"Address"}]:[],...qe.region?[{accessorKey:"region",header:"Region"}]:[],...qe.building?[{accessorKey:"building",header:"Building"}]:[],...qe.notes?[{accessorKey:"note",header:"Notes",cell:({row:e})=>r.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 truncate max-w-[150px] block",title:e.original.note,children:e.original.note||"-"})}]:[],...qe.created_at?[{accessorKey:"created_at",header:"Created At",cell:({row:e})=>r.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:e.original.created_at?d(e.original.created_at):"-"})}]:[],..."archived"===$e?[{accessorKey:"deleted_at",header:"Deleted At",cell:({row:e})=>d(e.original.deleted_at)}]:[]],[$e,qe,Ae,me,ge]),Zs=k({data:(null==Ns?void 0:Ns.data)||[],columns:Hs,state:{sorting:De},onSortingChange:Ie,getCoreRowModel:C(),getSortedRowModel:_(),manualPagination:!0,pageCount:Math.ceil(((null==(M=null==Ns?void 0:Ns.meta)?void 0:M.total)||0)/ge)}),Gs=Math.ceil(((null==(q=null==Ns?void 0:Ns.meta)?void 0:q.total)||0)/ge),Ws=(null==Ns?void 0:Ns.stats)||{},Js=((null==Ns?void 0:Ns.data)||[]).length>0&&Le.size===((null==Ns?void 0:Ns.data)||[]).length;return r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Subscribers"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("button",{onClick:()=>{const e=(null==Ns?void 0:Ns.data)||[];if(0===e.length)return void F.error("No data to export");const s=[["Username","Full Name","Phone","Email","Service","MAC Address","IP Address","Status","Expiry Date"],...e.map(e=>{var s;return[e.username,e.full_name,e.phone,e.email,null==(s=e.service)?void 0:s.name,e.mac_address,e.ip_address||e.static_ip,e.status,e.expiry_date?d(e.expiry_date):""]})].map(e=>e.map(e=>`"${e||""}"`).join(",")).join("\n"),a=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(a),t=document.createElement("a");t.href=r,t.download=`subscribers_${(new Date).toISOString().split("T")[0]}.csv`,t.click(),URL.revokeObjectURL(r),F.success("Exported to CSV")},className:"btn btn-secondary btn-sm flex items-center gap-1",title:"Export",children:[r.jsx(x,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:"Export"})]}),oe("subscribers.create")&&r.jsxs("button",{onClick:()=>Ve(!0),className:"btn btn-secondary btn-sm flex items-center gap-1",title:"Import CSV",children:[r.jsx(P,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:"Import CSV"})]}),oe("subscribers.create")&&r.jsxs(n,{to:"/subscribers/import",className:"btn btn-secondary btn-sm flex items-center gap-1",title:"Import Excel",children:[r.jsx(E,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden md:inline",children:"Import Excel"})]}),r.jsx("button",{onClick:()=>ws(),className:"btn btn-secondary btn-sm flex items-center gap-1",title:"Refresh",children:r.jsx(o,{className:"w-3.5 h-3.5"})}),oe("subscribers.create")&&r.jsxs(n,{to:"/subscribers/new",className:"btn btn-primary btn-sm flex items-center gap-1",children:[r.jsx(m,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:"Add"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 bg-white dark:bg-gray-800 rounded-lg border text-sm overflow-x-auto",children:[r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded","online"===ye&&"bg-green-100 dark:bg-green-900/40 ring-1 ring-green-400"),onClick:()=>{ve("online"===ye?"":"online"),ue(1)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"font-semibold text-green-600",children:Ws.online||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Online"})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded","offline"===ye&&"bg-red-100 dark:bg-red-900/40 ring-1 ring-red-400"),onClick:()=>{ve("offline"===ye?"":"offline"),ue(1)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),r.jsx("span",{className:"font-semibold text-red-600",children:Ws.offline||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Offline"})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded","active"===ye&&"bg-blue-100 dark:bg-blue-900/40 ring-1 ring-blue-400"),onClick:()=>{ve("active"===ye?"":"active"),ue(1)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),r.jsx("span",{className:"font-semibold text-blue-600",children:Ws.active||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Active"})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded","inactive"===ye&&"bg-gray-200 dark:bg-gray-600 ring-1 ring-gray-400"),onClick:()=>{ve("inactive"===ye?"":"inactive"),ue(1)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),r.jsx("span",{className:"font-semibold text-gray-600 dark:text-gray-400",children:Ws.inactive||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Inactive"})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded","expired"===ye&&"bg-yellow-100 dark:bg-yellow-900/40 ring-1 ring-yellow-400"),onClick:()=>{ve("expired"===ye?"":"expired"),ue(1)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{className:"font-semibold text-yellow-600",children:Ws.expired||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Expired"})]}),r.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-2"}),r.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded",onClick:()=>{Se("1"),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"FUP1:"}),r.jsx("span",{className:"font-semibold text-amber-600",children:Ws.fup1||0})]}),r.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded",onClick:()=>{Se("2"),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"FUP2:"}),r.jsx("span",{className:"font-semibold text-orange-600",children:Ws.fup2||0})]}),r.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded",onClick:()=>{Se("3"),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"FUP3:"}),r.jsx("span",{className:"font-semibold text-red-600",children:Ws.fup3||0})]}),Ws.fup4>0&&r.jsxs("div",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded",onClick:()=>{Se("4"),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"FUP4:"}),r.jsx("span",{className:"font-semibold text-purple-600",children:Ws.fup4||0})]}),r.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1 flex-shrink-0"}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded flex-shrink-0",Fe&&"bg-pink-100 dark:bg-pink-900/40 ring-1 ring-pink-400"),onClick:()=>{Me(!Fe),Se(""),Pe(""),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Monthly FUP:"}),r.jsx("span",{className:"font-semibold text-pink-600",children:Ws.monthly_fup||0})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded flex-shrink-0","daily_usage"===Ae&&"bg-cyan-100 dark:bg-cyan-900/40 ring-1 ring-cyan-400"),onClick:()=>{Pe("daily_usage"===Ae?"":"daily_usage"),Ie([]),Me(!1),Se(""),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Top Daily"}),"daily_usage"===Ae&&r.jsx("span",{className:"text-cyan-600 text-xs",children:"▼"})]}),r.jsxs("div",{className:S("flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-2 py-1 rounded flex-shrink-0","monthly_usage"===Ae&&"bg-indigo-100 dark:bg-indigo-900/40 ring-1 ring-indigo-400"),onClick:()=>{Pe("monthly_usage"===Ae?"":"monthly_usage"),Ie([]),Me(!1),Se(""),ue(1)},children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Top Monthly"}),"monthly_usage"===Ae&&r.jsx("span",{className:"text-indigo-600 text-xs",children:"▼"})]}),r.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[r.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:(null==(B=null==Ns?void 0:Ns.meta)?void 0:B.total)||0}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Total"})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[r.jsxs("div",{className:"flex rounded-lg border bg-gray-100 dark:bg-gray-700 dark:border-gray-600 p-0.5 shrink-0",children:[r.jsx("button",{onClick:()=>{Ue("active"),ue(1),As()},className:S("px-3 py-1 text-sm font-medium rounded-md transition-colors","active"===$e?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:"Active"}),r.jsxs("button",{onClick:()=>{Ue("archived"),ue(1),As()},className:S("px-3 py-1 text-sm font-medium rounded-md transition-colors flex items-center gap-1","archived"===$e?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[r.jsx(K,{className:"w-3.5 h-3.5"}),"Archived"]})]}),r.jsxs("div",{className:"flex-1 relative min-w-0",children:[r.jsx(R,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500"}),r.jsx("input",{type:"text",placeholder:"Search...",value:pe,onChange:e=>{be(e.target.value),ue(1)},className:"input input-sm pl-8 w-full"})]}),"active"===$e&&r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("select",{value:ye,onChange:e=>{ve(e.target.value),ue(1)},className:"input input-sm w-28 sm:w-32",children:W.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))}),r.jsxs("button",{onClick:()=>Re(!Ee),className:S("btn btn-secondary btn-sm flex items-center gap-1",Ee&&"bg-primary-50 text-primary-600"),children:[r.jsx(D,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:"Filters"})]}),r.jsxs("button",{onClick:()=>Te(!Be),className:S("btn btn-secondary btn-sm flex items-center gap-1",Be&&"bg-primary-50 text-primary-600"),children:[r.jsx(u,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:"Columns"})]})]})]}),(Ee||Be)&&r.jsxs("div",{className:"card p-3",children:[Be&&r.jsxs("div",{children:[r.jsx("div",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Visible Columns"}),r.jsx("div",{className:"flex flex-wrap gap-1.5",children:Object.entries(qe).map(([e,s])=>r.jsxs("label",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 text-xs dark:text-gray-200",children:[r.jsx("input",{type:"checkbox",checked:s,onChange:s=>Ke({...qe,[e]:s.target.checked}),className:"rounded border-gray-300 dark:border-gray-600 w-3 h-3"}),r.jsx("span",{className:"capitalize",children:e.replace("_"," ")})]},e))})]}),Ee&&"active"===$e&&r.jsx("div",{className:Be?"mt-3 pt-3 border-t dark:border-gray-700":"",children:r.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:items-end gap-2 sm:gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Service"}),r.jsxs("select",{value:je,onChange:e=>{fe(e.target.value),ue(1)},className:"input input-sm w-full sm:w-40",children:[r.jsx("option",{value:"",children:"All Services"}),null==_s?void 0:_s.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"NAS"}),r.jsxs("select",{value:Ne,onChange:e=>{ke(e.target.value),ue(1)},className:"input input-sm w-full sm:w-40",children:[r.jsx("option",{value:"",children:"All NAS"}),null==Cs?void 0:Cs.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Reseller"}),r.jsxs("select",{value:we,onChange:e=>{_e(e.target.value),ue(1)},className:"input input-sm w-full sm:w-40",children:[r.jsx("option",{value:"",children:"All Resellers"}),null==Ss?void 0:Ss.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"FUP Level"}),r.jsxs("select",{value:Ce,onChange:e=>{Se(e.target.value),ue(1)},className:"input input-sm w-full sm:w-32",children:[r.jsx("option",{value:"",children:"All FUP"}),r.jsx("option",{value:"0",children:"FUP 0 (Normal)"}),r.jsx("option",{value:"1",children:"FUP 1"}),r.jsx("option",{value:"2",children:"FUP 2"}),r.jsx("option",{value:"3",children:"FUP 3"}),r.jsx("option",{value:"4",children:"FUP 4"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Per Page"}),r.jsxs("select",{value:ge,onChange:e=>{he(parseInt(e.target.value)),ue(1)},className:"input input-sm w-full sm:w-20",children:[r.jsx("option",{value:"10",children:"10"}),r.jsx("option",{value:"25",children:"25"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"100",children:"100"})]})]}),r.jsx("button",{onClick:()=>{be(""),ve(""),fe(""),ke(""),_e(""),Se(""),ue(1)},className:"btn btn-secondary btn-sm col-span-2 sm:col-span-1",children:"Clear"})]})})]}),r.jsx("div",{className:"card p-2 sticky top-0 z-30 shadow-sm",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[r.jsxs("button",{onClick:()=>{const e=(null==Ns?void 0:Ns.data)||[];Le.size===e.length?Oe(new Set):Oe(new Set(e.map(e=>e.id)))},className:S("btn btn-sm flex items-center gap-1",Js?"btn-primary":"btn-secondary"),title:Js?"Deselect All":"Select All",children:[r.jsx(Z,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:Js?"Deselect All":"Select All"})]}),r.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1 hidden sm:block"}),oe("subscribers.renew")&&r.jsxs("button",{onClick:()=>zs("renew"),disabled:0===Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Renew",children:[r.jsx(g,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Renew"})]}),oe("subscribers.reset_fup")&&r.jsxs("button",{onClick:()=>zs("reset_fup"),disabled:0===Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Reset FUP",children:[r.jsx(o,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Reset FUP"})]}),oe("subscribers.inactivate")&&r.jsxs("button",{onClick:()=>zs("enable"),disabled:0===Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Activate",children:[r.jsx(U,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Activate"})]}),oe("subscribers.inactivate")&&r.jsxs("button",{onClick:()=>zs("disable"),disabled:0===Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Deactivate",children:[r.jsx(z,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Deactivate"})]}),oe("subscribers.disconnect")&&r.jsxs("button",{onClick:()=>zs("disconnect"),disabled:0===Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Disconnect",children:[r.jsx(L,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Disconnect"})]}),r.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1 hidden sm:block"}),oe("subscribers.rename")&&r.jsxs("button",{onClick:()=>Xs("rename"),disabled:1!==Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Rename",children:[r.jsx(V,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Rename"})]}),oe("subscribers.add_days")&&r.jsxs("button",{onClick:()=>Xs("add_days"),disabled:1!==Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Add Days",children:[r.jsx(h,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Add Days"})]}),oe("subscribers.change_service")&&r.jsxs("button",{onClick:()=>Xs("change_service"),disabled:1!==Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Change Service",children:[r.jsx(T,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden md:inline",children:"Change Service"})]}),oe("subscribers.refill_quota")&&r.jsxs("button",{onClick:()=>Xs("refill"),disabled:1!==Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Refill",children:[r.jsx(p,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Refill"})]}),oe("subscribers.ping")&&r.jsxs("button",{onClick:()=>Xs("ping"),disabled:1!==Ms,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",title:"Ping",children:[r.jsx(b,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Ping"})]}),r.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1 hidden sm:block"}),oe("subscribers.delete")&&r.jsxs("button",{onClick:()=>zs("delete"),disabled:0===Ms,className:"btn btn-sm flex items-center gap-1 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 border-red-200 dark:border-red-800 disabled:opacity-40",title:"Delete",children:[r.jsx(O,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Delete"})]}),Ms>0&&r.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"font-semibold text-primary-600",children:Ms}),r.jsx("button",{onClick:As,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:r.jsx(y,{className:"w-4 h-4"})})]})]})}),r.jsxs("div",{className:"card",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"table table-compact",children:[r.jsx("thead",{children:Zs.getHeaderGroups().map(e=>r.jsx("tr",{children:e.headers.map(e=>r.jsx("th",{onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,className:S(e.column.getCanSort()&&"cursor-pointer select-none","text-center"),children:r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[w(e.column.columnDef.header,e.getContext()),"asc"===e.column.getIsSorted()&&" ▲","desc"===e.column.getIsSorted()&&" ▼"]})},e.id))},e.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:ks?r.jsx("tr",{children:r.jsx("td",{colSpan:Hs.length,className:"text-center py-8",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===Zs.getRowModel().rows.length?r.jsx("tr",{children:r.jsx("td",{colSpan:Hs.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"archived"===$e?"No archived subscribers":"No subscribers found"})}):Zs.getRowModel().rows.map(e=>{const s=Le.has(e.original.id);return r.jsx("tr",{className:S("cursor-pointer transition-colors",s?"bg-red-300 dark:bg-red-900/60 border-l-4 border-l-red-700 dark:border-l-red-500 dark:text-white":"hover:bg-gray-50 dark:hover:bg-gray-700/50"),onClick:()=>{return s=e.original.id,void Oe(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},children:e.getVisibleCells().map(e=>r.jsx("td",{className:"text-center",children:w(e.column.columnDef.cell,e.getContext())},e.id))},e.id)})})]})}),r.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-t text-xs",children:[r.jsxs("span",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:[(me-1)*ge+1,"-",Math.min(me*ge,(null==(Q=null==Ns?void 0:Ns.meta)?void 0:Q.total)||0)," of ",(null==(X=null==Ns?void 0:Ns.meta)?void 0:X.total)||0]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>ue(e=>Math.max(1,e-1)),disabled:1===me,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:r.jsx(I,{className:"w-4 h-4"})}),r.jsxs("span",{className:"px-2 text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:[me,"/",Gs||1]}),r.jsx("button",{onClick:()=>ue(e=>Math.min(Gs,e+1)),disabled:me>=Gs,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:r.jsx($,{className:"w-4 h-4"})})]})]})]}),"resetMac"===(null==Je?void 0:Je.type)&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Reset MAC Address"}),r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["User: ",r.jsx("strong",{children:Je.subscriber.username})]}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current MAC: ",r.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:Je.subscriber.mac_address||"None"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"New MAC Address (leave empty to clear)"}),r.jsx("input",{type:"text",value:es,onChange:e=>ss(e.target.value),className:"input font-mono",placeholder:"XX:XX:XX:XX:XX:XX"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Reason"}),r.jsxs("select",{value:as,onChange:e=>rs(e.target.value),className:"input",children:[r.jsx("option",{value:"",children:"Select reason..."}),r.jsx("option",{value:"device_change",children:"User switched device"}),r.jsx("option",{value:"account_sharing",children:"Prevent account sharing"}),r.jsx("option",{value:"network_card_change",children:"Network card changed"}),r.jsx("option",{value:"sync_from_radius",children:"Sync from RADIUS"}),r.jsx("option",{value:"security",children:"Security issue"}),r.jsx("option",{value:"other",children:"Other"})]})]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>Ds.mutate({id:Je.subscriber.id,mac_address:es||null,reason:as}),disabled:Ds.isPending,className:"btn btn-primary",children:Ds.isPending?"Resetting...":"Reset MAC"})]})]})}),"rename"===(null==Je?void 0:Je.type)&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Rename Username"}),r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsx("div",{children:r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["Current Username: ",r.jsx("strong",{children:Je.subscriber.username})]})}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"New Username *"}),r.jsx("input",{type:"text",value:es,onChange:e=>ss(e.target.value),className:"input",placeholder:"Enter new username"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Reason"}),r.jsx("input",{type:"text",value:as,onChange:e=>rs(e.target.value),className:"input",placeholder:"Enter reason for change"})]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>Is.mutate({id:Je.subscriber.id,new_username:es,reason:as}),disabled:!es||Is.isPending,className:"btn btn-primary",children:Is.isPending?"Renaming...":"Rename"})]})]})}),"addDays"===(null==Je?void 0:Je.type)&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Add/Subtract Days"}),r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["User: ",r.jsx("strong",{children:Je.subscriber.username})]}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current Expiry: ",r.jsx("strong",{children:Je.subscriber.expiry_date?d(Je.subscriber.expiry_date):"N/A"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Days *"}),r.jsx("input",{type:"number",value:es,onChange:e=>ss(e.target.value),className:"input",placeholder:"Enter days (negative to subtract)"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"Use negative number to subtract days"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Reason"}),r.jsxs("select",{value:as,onChange:e=>rs(e.target.value),className:"input",children:[r.jsx("option",{value:"",children:"Select reason..."}),r.jsx("option",{value:"compensation",children:"Compensation"}),r.jsx("option",{value:"overdue_fix",children:"Overdue fix"}),r.jsx("option",{value:"promotion",children:"Promotion"}),r.jsx("option",{value:"manual_adjustment",children:"Manual adjustment"}),r.jsx("option",{value:"other",children:"Other"})]})]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>$s.mutate({id:Je.subscriber.id,days:parseInt(es),reason:as}),disabled:!es||$s.isPending,className:"btn btn-primary",children:$s.isPending?"Updating...":"Apply"})]})]})}),"changeService"===(null==Je?void 0:Je.type)&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal max-w-lg",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Change Service"}),r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs(""),is(null),ls({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0})},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["User: ",r.jsx("strong",{children:Je.subscriber.username})]}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current Service: ",r.jsx("strong",{children:(null==(H=Je.subscriber.service)?void 0:H.name)||"N/A"})," - $",(null==(se=null==(ee=Je.subscriber.service)?void 0:ee.price)?void 0:se.toFixed(2))||"0.00"]}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Expiry: ",r.jsx("strong",{children:Je.subscriber.expiry_date?new Date(Je.subscriber.expiry_date).toLocaleDateString():"N/A"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"New Service *"}),r.jsxs("select",{value:es,onChange:e=>{ss(e.target.value),e.target.value?(async(e,s)=>{var a;if(e&&s){cs(!0);try{const r=await v.calculateChangeServicePrice(e,s);is(null==(a=r.data)?void 0:a.data)}catch(r){is(null)}finally{cs(!1)}}else is(null)})(Je.subscriber.id,e.target.value):is(null)},className:"input",children:[r.jsx("option",{value:"",children:"Select Service"}),null==_s?void 0:_s.map(e=>{var s;return r.jsxs("option",{value:e.id,children:[e.name," - $",null==(s=e.price)?void 0:s.toFixed(2)]},e.id)})]})]}),ds&&r.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Calculating price..."}),ns&&!ds&&r.jsxs("div",{className:"p-3 rounded-lg text-sm "+(ns.is_upgrade?"bg-blue-50 dark:bg-blue-900/30 border border-blue-200":ns.is_downgrade?"bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200":"bg-gray-50"),children:[r.jsx("div",{className:"font-semibold mb-2",children:ns.is_upgrade?"⬆️ Upgrade":ns.is_downgrade?"⬇️ Downgrade":"↔️ Same Price"}),r.jsxs("div",{className:"space-y-1 text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Remaining days:"}),r.jsxs("span",{className:"font-medium",children:[ns.remaining_days," days"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Old day price:"}),r.jsxs("span",{children:["$",null==(ae=ns.old_day_price)?void 0:ae.toFixed(2),"/day"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"New day price:"}),r.jsxs("span",{children:["$",null==(re=ns.new_day_price)?void 0:re.toFixed(2),"/day"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Credit from old service:"}),r.jsxs("span",{className:"text-green-600",children:["-$",null==(te=ns.old_credit)?void 0:te.toFixed(2)]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Cost for new service:"}),r.jsxs("span",{className:"text-red-600",children:["+$",null==(le=ns.new_cost)?void 0:le.toFixed(2)]})]}),ns.change_fee>0&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Change fee:"}),r.jsxs("span",{children:["+$",null==(ne=ns.change_fee)?void 0:ne.toFixed(2)]})]}),r.jsxs("div",{className:"border-t pt-1 mt-1 flex justify-between font-semibold",children:[r.jsxs("span",{children:["Total to ",ns.total_charge>=0?"charge":"refund",":"]}),r.jsxs("span",{className:ns.total_charge>=0?"text-red-600":"text-green-600",children:["$",null==(ie=Math.abs(ns.total_charge))?void 0:ie.toFixed(2)]})]})]}),ns.is_downgrade&&!ns.downgrade_allowed&&r.jsx("div",{className:"mt-2 text-red-600 font-medium",children:"⚠️ Downgrade is not allowed by system settings"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:ts.extend_expiry,onChange:e=>ls({...ts,extend_expiry:e.target.checked}),className:"rounded border-gray-300 dark:border-gray-600"}),r.jsx("span",{className:"text-sm",children:"Extend Expiry"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:ts.reset_fup,onChange:e=>ls({...ts,reset_fup:e.target.checked}),className:"rounded border-gray-300 dark:border-gray-600"}),r.jsx("span",{className:"text-sm",children:"Reset FUP Quota"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:ts.prorate_price,onChange:e=>ls({...ts,prorate_price:e.target.checked,charge_price:!1}),className:"rounded border-gray-300 dark:border-gray-600"}),r.jsx("span",{className:"text-sm",children:"Prorate Price (recommended)"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:ts.charge_price,onChange:e=>ls({...ts,charge_price:e.target.checked,prorate_price:!1}),className:"rounded border-gray-300 dark:border-gray-600"}),r.jsx("span",{className:"text-sm",children:"Charge Full Price"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Reason"}),r.jsx("input",{type:"text",value:as,onChange:e=>rs(e.target.value),className:"input",placeholder:"Enter reason for change"})]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs(""),is(null),ls({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0})},className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>Us.mutate({id:Je.subscriber.id,service_id:parseInt(es),...ts,reason:as}),disabled:!es||Us.isPending||(null==ns?void 0:ns.is_downgrade)&&!(null==ns?void 0:ns.downgrade_allowed),className:"btn btn-primary",children:Us.isPending?"Changing...":"Change Service"})]})]})}),"refill"===(null==Je?void 0:Je.type)&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Refill Account"}),r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsx("div",{children:r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["User: ",r.jsx("strong",{children:Je.subscriber.username})]})}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Amount *"}),r.jsx("input",{type:"number",step:"0.01",min:"0",value:es,onChange:e=>ss(e.target.value),className:"input",placeholder:"Enter amount"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Reason"}),r.jsxs("select",{value:as,onChange:e=>rs(e.target.value),className:"input",children:[r.jsx("option",{value:"",children:"Select reason..."}),r.jsx("option",{value:"prepaid_card",children:"Prepaid Card"}),r.jsx("option",{value:"cash_payment",children:"Cash Payment"}),r.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),r.jsx("option",{value:"credit",children:"Credit"}),r.jsx("option",{value:"other",children:"Other"})]})]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ye(null),ss(""),rs("")},className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>Ks.mutate({id:Je.subscriber.id,amount:parseFloat(es),reason:as}),disabled:!es||parseFloat(es)<=0||Ks.isPending,className:"btn btn-primary",children:Ks.isPending?"Refilling...":"Refill"})]})]})}),Qe&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal modal-lg",children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Bulk Import Subscribers"}),r.jsx("button",{onClick:()=>{Ve(!1),ze(null),We(null)},className:"btn btn-ghost btn-sm",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"CSV File"}),r.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer hover:border-primary-400",onClick:()=>{var e;return null==(e=xe.current)?void 0:e.click()},children:[r.jsx(E,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:Xe?Xe.name:"Click to select CSV file"}),r.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Columns: username, password, full_name, email, phone, address"})]}),r.jsx("input",{ref:xe,type:"file",accept:".csv",onChange:e=>{var s;return ze((null==(s=e.target.files)?void 0:s[0])||null)},className:"hidden"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Service Plan *"}),r.jsxs("select",{value:He,onChange:e=>Ze(e.target.value),className:"input",children:[r.jsx("option",{value:"",children:"Select Service"}),null==_s?void 0:_s.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),Ge&&r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto",children:[r.jsx("h4",{className:"font-medium mb-2",children:"Import Results"}),r.jsxs("p",{className:"text-sm text-green-600",children:["Created: ",Ge.created]}),r.jsxs("p",{className:"text-sm text-red-600",children:["Failed: ",Ge.failed]}),null==(de=Ge.results)?void 0:de.filter(e=>!e.success).slice(0,10).map((e,s)=>r.jsxs("p",{className:"text-xs text-red-500",children:["Row ",e.row,": ",e.message]},s))]})]}),r.jsxs("div",{className:"modal-footer",children:[r.jsx("button",{onClick:()=>{Ve(!1),ze(null),We(null)},className:"btn btn-secondary",children:"Close"}),r.jsxs("button",{onClick:()=>{Xe&&He?Qs.mutate({file:Xe,serviceId:He}):F.error("Please select a file and service")},disabled:!Xe||!He||Qs.isPending,className:"btn btn-primary flex items-center gap-2",children:[Qs.isPending?r.jsx(o,{className:"w-4 h-4 animate-spin"}):r.jsx(P,{className:"w-4 h-4"}),"Import"]})]})]})}),ms&&r.jsx("div",{className:"modal-overlay",children:r.jsxs("div",{className:"modal-content w-full max-w-2xl mx-2 sm:mx-auto max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"modal-header flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r.jsx(c,{className:"w-5 h-5 text-green-500 flex-shrink-0"}),r.jsxs("h3",{className:"text-base sm:text-lg font-bold truncate",children:[r.jsx("span",{className:"hidden sm:inline",children:"Live Traffic - "}),ms.username]}),js&&r.jsxs("span",{className:"relative flex h-2.5 w-2.5 flex-shrink-0",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]})]}),r.jsx("button",{onClick:()=>{us(null),bs(null),fs(!1)},className:"btn btn-ghost btn-sm flex-shrink-0",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"modal-body flex-1 overflow-y-auto",children:[r.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["IP: ",r.jsx("code",{className:"bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-2 py-1 rounded text-xs font-mono",children:ms.ip_address||"N/A"})]}),r.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer text-gray-700 dark:text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:js,onChange:e=>fs(e.target.checked),className:"rounded border-gray-300 dark:border-gray-500"}),r.jsx("span",{className:"text-xs sm:text-sm",children:"Auto"})]}),r.jsxs("button",{onClick:()=>Ls(ms),disabled:ys,className:"btn btn-sm btn-secondary flex items-center gap-1",children:[r.jsx(o,{className:S("w-4 h-4",ys&&"animate-spin")}),r.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]}),ys&&!ps&&r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),r.jsx("span",{className:"ml-3 text-gray-500 dark:text-gray-400",children:"Capturing..."})]}),ps&&r.jsxs("div",{children:[r.jsx("div",{className:"bg-gray-900 text-white rounded-t-lg p-3",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("span",{className:"text-gray-400",children:"Interface: "}),r.jsx("span",{className:"font-mono text-green-400",children:ps.interface})]}),r.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(x,{className:"w-4 h-4 text-green-400"}),r.jsxs("span",{className:"text-green-400 font-bold",children:[(8*(ps.total_tx||0)/1e6).toFixed(1)," Mbps"]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(P,{className:"w-4 h-4 text-blue-400"}),r.jsxs("span",{className:"text-blue-400 font-bold",children:[(8*(ps.total_rx||0)/1e6).toFixed(1)," Mbps"]})]})]})]})}),ps.entries&&ps.entries.length>0?r.jsxs("div",{className:"border border-t-0 border-gray-300 dark:border-gray-600 rounded-b-lg overflow-hidden",children:[r.jsx("div",{className:"sm:hidden max-h-64 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-600 bg-white dark:bg-gray-800",children:ps.entries.slice(0,50).map((e,s)=>r.jsxs("div",{className:S("p-3 text-xs",e.tx_rate>1e6?"bg-green-50 dark:bg-green-900/30":"bg-white dark:bg-gray-800",e.tx_rate>5e6&&"bg-yellow-50 dark:bg-yellow-900/30"),children:[r.jsxs("div",{className:"flex justify-between items-start mb-1",children:[r.jsx("span",{className:S("font-bold uppercase","tcp"===e.protocol&&"text-blue-600 dark:text-blue-400","udp"===e.protocol&&"text-purple-600 dark:text-purple-400","icmp"===e.protocol&&"text-orange-600 dark:text-orange-400",!e.protocol&&"text-gray-600 dark:text-gray-400"),children:e.protocol||"-"}),r.jsxs("div",{className:"text-right",children:[r.jsxs("span",{className:"text-green-600 dark:text-green-400 font-semibold",children:["↓ ",e.tx_rate>1e6?`${(8*e.tx_rate/1e6).toFixed(1)}M`:e.tx_rate>1e3?`${(8*e.tx_rate/1e3).toFixed(0)}k`:`${(8*e.tx_rate).toFixed(0)}b`]}),r.jsx("span",{className:"text-gray-400 dark:text-gray-500 mx-1",children:"/"}),r.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-semibold",children:["↑ ",e.rx_rate>1e6?`${(8*e.rx_rate/1e6).toFixed(1)}M`:e.rx_rate>1e3?`${(8*e.rx_rate/1e3).toFixed(0)}k`:`${(8*e.rx_rate).toFixed(0)}b`]})]})]}),r.jsxs("div",{className:"text-gray-600 dark:text-gray-300 truncate font-mono",children:[e.src_address,e.src_port>0&&`:${e.src_port}`,r.jsx("span",{className:"mx-1 text-gray-400",children:"→"}),e.dst_address,e.dst_port>0&&`:${e.dst_port}`]})]},s))}),r.jsx("div",{className:"hidden sm:block max-h-80 overflow-y-auto",children:r.jsxs("table",{className:"w-full text-xs font-mono",children:[r.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 sticky top-0",children:r.jsxs("tr",{className:"text-gray-600 dark:text-gray-400",children:[r.jsx("th",{className:"px-2 py-1.5 text-left",children:"Proto"}),r.jsx("th",{className:"px-2 py-1.5 text-left",children:"Src. Address"}),r.jsx("th",{className:"px-2 py-1.5 text-left",children:"Dst. Address"}),r.jsx("th",{className:"px-2 py-1.5 text-right",children:"Download"}),r.jsx("th",{className:"px-2 py-1.5 text-right",children:"Upload"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-800",children:ps.entries.slice(0,100).map((e,s)=>r.jsxs("tr",{className:S("border-t border-gray-100 dark:border-gray-700 hover:bg-blue-50 dark:hover:bg-gray-700",e.tx_rate>1e6&&"bg-green-50 dark:bg-green-900/20",e.tx_rate>5e6&&"bg-yellow-50 dark:bg-yellow-900/20"),children:[r.jsx("td",{className:"px-2 py-1",children:r.jsx("span",{className:S("uppercase","tcp"===e.protocol&&"text-blue-600","udp"===e.protocol&&"text-purple-600","icmp"===e.protocol&&"text-orange-600"),children:e.protocol||"-"})}),r.jsxs("td",{className:"px-2 py-1 text-gray-700 dark:text-gray-300",children:[e.src_address,e.src_port>0&&`:${e.src_port}`]}),r.jsxs("td",{className:"px-2 py-1 text-gray-700 dark:text-gray-300",children:[e.dst_address,e.dst_port>0&&`:${e.dst_port}`]}),r.jsx("td",{className:"px-2 py-1 text-right text-green-700 dark:text-green-400 font-medium",children:e.tx_rate>1e6?`${(8*e.tx_rate/1e6).toFixed(1)} Mbps`:e.tx_rate>1e3?`${(8*e.tx_rate/1e3).toFixed(1)} kbps`:`${(8*e.tx_rate).toFixed(0)} bps`}),r.jsx("td",{className:"px-2 py-1 text-right text-blue-700 dark:text-blue-400 font-medium",children:e.rx_rate>1e6?`${(8*e.rx_rate/1e6).toFixed(1)} Mbps`:e.rx_rate>1e3?`${(8*e.rx_rate/1e3).toFixed(1)} kbps`:`${(8*e.rx_rate).toFixed(0)} bps`})]},s))})]})}),r.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 px-3 py-1.5 text-xs text-gray-500 dark:text-gray-400 border-t dark:border-gray-600 flex justify-between",children:[r.jsxs("span",{children:[ps.entries.length," flows"]}),r.jsx("span",{children:ps.duration})]})]}):r.jsx("div",{className:"border border-t-0 border-gray-300 dark:border-gray-600 rounded-b-lg p-6 text-center text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700",children:"No active traffic flows"})]}),!ys&&!ps&&r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Click Refresh to capture traffic"})]}),r.jsx("div",{className:"modal-footer flex-shrink-0",children:r.jsx("button",{onClick:()=>{us(null),bs(null),fs(!1)},className:"btn btn-secondary w-full sm:w-auto",children:"Close"})})]})}),gs&&r.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>hs(null),children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"bg-blue-600 px-4 py-3 flex items-center justify-between",children:[r.jsxs("h3",{className:"text-white font-semibold flex items-center gap-2",children:[r.jsx(A,{className:"w-5 h-5"}),gs.full_name||gs.username]}),r.jsx("button",{onClick:()=>hs(null),className:"text-white/80 hover:text-white",children:r.jsx(y,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"rounded-b-xl overflow-hidden",children:r.jsx(G,{lat:parseFloat(gs.latitude),lng:parseFloat(gs.longitude)})}),r.jsxs("div",{className:"px-4 py-3 flex items-center justify-between bg-gray-50 dark:bg-gray-700",children:[r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["📍 ",parseFloat(gs.latitude).toFixed(6),", ",parseFloat(gs.longitude).toFixed(6)]}),r.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${gs.latitude},${gs.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary text-xs px-3 py-1 flex items-center gap-1",children:[r.jsx(A,{className:"w-3.5 h-3.5"}),"Navigate"]})]})]})}),os&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>xs(null),children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"bg-red-600 px-6 py-4 flex items-center justify-between",children:[r.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[r.jsx(O,{className:"w-6 h-6"}),"Delete ",os.ids.length," Subscriber",os.ids.length>1?"s":"","?"]}),r.jsx("button",{onClick:()=>xs(null),className:"text-white/80 hover:text-white",children:r.jsx(y,{className:"w-6 h-6"})})]}),r.jsxs("div",{className:"px-6 py-4",children:[r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm mb-3",children:"The following will be permanently deleted:"}),r.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-1",children:[os.names.slice(0,20).map((e,s)=>r.jsx("div",{className:"flex items-center gap-2 py-1.5 px-3 bg-red-50 dark:bg-red-900/40 rounded-lg border border-red-200 dark:border-red-700",children:r.jsx("span",{className:"text-red-700 dark:text-red-200 font-bold text-lg",children:e})},s)),os.names.length>20&&r.jsxs("div",{className:"text-gray-500 dark:text-gray-400 text-sm py-1 px-3",children:["... and ",os.names.length-20," more"]})]})]}),r.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700/50 flex gap-3 justify-end",children:[r.jsx("button",{onClick:()=>xs(null),className:"btn btn-secondary px-6",children:"Cancel"}),r.jsx("button",{onClick:()=>{Vs.mutate({ids:os.ids,action:"delete"}),xs(null)},className:"btn px-6 bg-red-600 hover:bg-red-700 text-white font-bold",children:"Delete"})]})]})})]})}export{ee as default};
