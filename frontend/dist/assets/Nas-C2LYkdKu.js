import{b as e,u as a,d as s,j as r}from"./data-vendor-C6mPcuPT.js";import{r as t}from"./react-vendor-C4Xey-hE.js";import{w as l,g as i,a as n,c as d,h as c,t as o,n as m}from"./index-CqIVursa.js";import{u as x,f as p,a as h}from"./table-vendor-BZVOk-Gl.js";import{z as u}from"./ui-vendor-1qsLX2mU.js";import{F as g}from"./PencilIcon-IYn463Gm.js";import{F as j}from"./TrashIcon-BFZdbUYd.js";import{F as v}from"./EyeSlashIcon-r2xLvPEw.js";import{F as y}from"./EyeIcon-CLCqJwk9.js";import"./chart-vendor-Be69IwoK.js";const b=[{value:"mikrotik",label:"Mikrotik RouterOS"},{value:"cisco",label:"Cisco"},{value:"juniper",label:"Juniper"},{value:"ubiquiti",label:"Ubiquiti"},{value:"other",label:"Other"}];function N(){const N=e(),[_,w]=t.useState(!1),[k,f]=t.useState(null),[S,A]=t.useState(!1),[C,I]=t.useState(!1),[F,P]=t.useState([]),[R,D]=t.useState(!1),[U,$]=t.useState({ip_address:"",name:"",short_name:"",type:"mikrotik",secret:"",auth_port:1812,description:"",api_port:8728,api_username:"",api_password:"",coa_port:1700,is_active:!0,subscriber_pools:"",allowed_realms:""}),{data:E,isLoading:M}=a({queryKey:["nas"],queryFn:()=>m.list().then(e=>e.data.data)}),q=s({mutationFn:e=>k?m.update(k.id,e):m.create(e),onSuccess:()=>{u.success(k?"NAS updated":"NAS created"),N.invalidateQueries(["nas"]),Q()},onError:e=>{var a,s;return u.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save")}}),K=s({mutationFn:e=>m.delete(e),onSuccess:()=>{u.success("NAS deleted"),N.invalidateQueries(["nas"])},onError:e=>{var a,s;return u.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to delete")}}),L=s({mutationFn:e=>m.sync(e),onSuccess:()=>{u.success("NAS sync started"),N.invalidateQueries(["nas"])},onError:e=>{var a,s;return u.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to sync")}}),T=s({mutationFn:e=>m.test(e),onSuccess:e=>{var a;const s=e.data,r=(null==(a=s.router_info)?void 0:a.identity)||"",t=s.api_auth?"✓ API":"✗ API",l=s.secret_valid?"✓ RADIUS":"✗ RADIUS";s.api_auth&&s.secret_valid?u.success(`${r?r+" - ":""}${t} | ${l}`):s.api_auth||s.secret_valid?u.error(`${t} | ${l}\n${s.api_error||""} ${s.radius_error||""}`.trim()):s.is_online?u.error(`${t} | ${l}\nAPI: ${s.api_error||"Auth failed"}\nRADIUS: ${s.radius_error||"Secret invalid"}`):u.error(`✗ Cannot reach router\n${s.api_error||"Check IP address"}`),N.invalidateQueries(["nas"])},onError:e=>{var a,s;return u.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Test failed")}}),O=(e=null)=>{e?(f(e),$({ip_address:e.ip_address||"",name:e.name||"",short_name:e.short_name||"",type:e.type||"mikrotik",secret:e.secret||"",auth_port:e.auth_port||1812,description:e.description||"",api_port:e.api_port||8728,api_username:e.api_username||"",api_password:e.api_password||"",coa_port:e.coa_port||3799,is_active:e.is_active??!0,subscriber_pools:e.subscriber_pools||"",allowed_realms:e.allowed_realms||""})):(f(null),$({ip_address:"",name:"",short_name:"",type:"mikrotik",secret:"",auth_port:1812,description:"",api_port:8728,api_username:"",api_password:"",coa_port:1700,is_active:!0,subscriber_pools:"",allowed_realms:""})),P([]),w(!0)},Q=()=>{w(!1),f(null),A(!1),I(!1)},z=e=>{const{name:a,value:s,type:r,checked:t}=e.target;$(e=>({...e,[a]:"checkbox"===r?t:s}))},G=t.useMemo(()=>[{accessorKey:"name",header:"Name",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:r.jsx(l,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.original.name||e.original.short_name}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.original.description})]})]})},{accessorKey:"ip_address",header:"IP Address",cell:({row:e})=>r.jsx("code",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-sm text-gray-900 dark:text-gray-200",children:e.original.ip_address})},{accessorKey:"type",header:"Type",cell:({row:e})=>r.jsx("span",{className:"badge badge-info capitalize",children:e.original.type})},{accessorKey:"auth_port",header:"Ports",cell:({row:e})=>r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{children:["RADIUS: ",e.original.auth_port]}),"mikrotik"===e.original.type&&r.jsxs("div",{children:["API: ",e.original.api_port]})]})},{accessorKey:"is_active",header:"Status",cell:({row:e})=>r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("div",{className:"flex items-center gap-2",children:e.original.is_active?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"Active"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Inactive"})]})}),r.jsx("div",{className:"flex items-center gap-2",children:e.original.is_online?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),r.jsx("span",{className:"text-xs text-green-600",children:"Online"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),r.jsx("span",{className:"text-xs text-red-500",children:"Offline"})]})}),r.jsx("div",{className:"flex items-center gap-2",children:e.original.secret?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"Secret ✓"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{className:"text-xs text-yellow-600",children:"No Secret"})]})}),"mikrotik"===e.original.type&&r.jsx("div",{className:"flex items-center gap-2",children:e.original.api_password?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"API ✓"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{className:"text-xs text-yellow-600",children:"No API"})]})})]})},{id:"actions",header:"Actions",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>T.mutate(e.original.id),className:"p-1.5 text-gray-500 dark:text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/30 rounded",title:"Test Connection",children:r.jsx(i,{className:"w-4 h-4"})}),"mikrotik"===e.original.type&&r.jsx("button",{onClick:()=>L.mutate(e.original.id),className:"p-1.5 text-gray-500 dark:text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:"Sync with router",children:r.jsx(n,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>O(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded",title:"Edit",children:r.jsx(g,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this NAS?")&&K.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete",children:r.jsx(j,{className:"w-4 h-4"})})]})}],[K,L,T]),H=x({data:E||[],columns:G,getCoreRowModel:h()});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"NAS / Routers"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage RADIUS clients and routers"})]}),r.jsxs("button",{onClick:()=>O(),className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[r.jsx(d,{className:"w-4 h-4"}),"Add NAS"]})]}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"table-container",children:r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:H.getHeaderGroups().map(e=>r.jsx("tr",{children:e.headers.map(e=>r.jsx("th",{children:p(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:M?r.jsx("tr",{children:r.jsx("td",{colSpan:G.length,className:"text-center py-8",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===H.getRowModel().rows.length?r.jsx("tr",{children:r.jsx("td",{colSpan:G.length,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No NAS devices found"})}):H.getRowModel().rows.map(e=>r.jsx("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:e.getVisibleCells().map(e=>r.jsx("td",{children:p(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),_&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:Q}),r.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b dark:border-gray-700",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:k?"Edit NAS":"Add NAS"}),r.jsx("button",{onClick:Q,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-gray-500 dark:text-gray-400",children:r.jsx(c,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={...U};!a.secret&&k&&delete a.secret,!a.api_password&&k&&delete a.api_password,q.mutate(a)},className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"IP Address / Hostname"}),r.jsx("input",{type:"text",name:"ip_address",value:U.ip_address,onChange:z,className:"input",placeholder:"192.168.1.1",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Name"}),r.jsx("input",{type:"text",name:"name",value:U.name,onChange:z,className:"input",placeholder:"Main Router",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Short Name"}),r.jsx("input",{type:"text",name:"short_name",value:U.short_name,onChange:z,className:"input",placeholder:"Router1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Type"}),r.jsx("select",{name:"type",value:U.type,onChange:z,className:"input",children:b.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"RADIUS Secret"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:S?"text":"password",name:"secret",value:U.secret,onChange:z,className:"input pr-10",placeholder:k?"••••••••":"Enter secret",required:!k}),r.jsx("button",{type:"button",onClick:()=>A(!S),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:S?r.jsx(v,{className:"w-5 h-5"}):r.jsx(y,{className:"w-5 h-5"})})]}),k&&r.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[r.jsx(o,{className:"w-3 h-3"}),"Secret is set. Leave blank to keep current."]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"RADIUS Port"}),r.jsx("input",{type:"number",name:"auth_port",value:U.auth_port,onChange:z,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Description"}),r.jsx("textarea",{name:"description",value:U.description,onChange:z,className:"input",rows:2})]}),r.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[r.jsx("label",{className:"label",children:"Allowed Realms (for RADIUS)"}),r.jsx("input",{type:"text",name:"allowed_realms",value:U.allowed_realms,onChange:z,className:"input",placeholder:"e.g., test.mes.net.lb, other.domain.com"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Comma-separated list of realms. Users logging in as user@realm will have the realm stripped if it's in this list."})]}),"mikrotik"===U.type&&r.jsxs("div",{className:"border-t dark:border-gray-700 pt-4 space-y-4",children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Mikrotik API Settings"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Port"}),r.jsx("input",{type:"text",name:"api_port",value:U.api_port,onChange:z,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"CoA Port"}),r.jsx("input",{type:"text",name:"coa_port",value:U.coa_port,onChange:z,className:"input"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Username"}),r.jsx("input",{type:"text",name:"api_username",value:U.api_username,onChange:z,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Password"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:C?"text":"password",name:"api_password",value:U.api_password,onChange:z,className:"input pr-10",placeholder:k?"••••••••":"Enter password"}),r.jsx("button",{type:"button",onClick:()=>I(!C),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:C?r.jsx(v,{className:"w-5 h-5"}):r.jsx(y,{className:"w-5 h-5"})})]}),k&&r.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[r.jsx(o,{className:"w-3 h-3"}),"Password is set. Leave blank to keep current."]})]})]}),r.jsx("div",{className:"border-t dark:border-gray-700 pt-4",children:r.jsxs("label",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"checkbox",name:"is_active",checked:U.is_active,onChange:z,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsx("span",{className:"text-gray-900 dark:text-white",children:"Active NAS"})]})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:Q,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:q.isLoading,className:"btn-primary",children:q.isLoading?"Saving...":k?"Update":"Create"})]})]})]})]})})]})}export{N as default};
