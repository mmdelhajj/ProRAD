import{b as e,u as s,d as t,j as a}from"./data-vendor-C6mPcuPT.js";import{r as d}from"./react-vendor-C4Xey-hE.js";import{y as r}from"./index-CWMznj8v.js";import"./ui-vendor-CMKyyIMz.js";import"./chart-vendor-Be69IwoK.js";function l(){const l=e(),[i,n]=d.useState(!1),[c,o]=d.useState(!1),[u,x]=d.useState(1),[m,p]=d.useState(""),[h,b]=d.useState(""),{data:g,isLoading:y}=s({queryKey:["prepaid",u,m,h],queryFn:()=>r.get("/prepaid",{params:{page:u,is_used:m,batch_id:h}}).then(e=>e.data)}),{data:j}=s({queryKey:["prepaid-batches"],queryFn:()=>r.get("/prepaid/batches").then(e=>e.data.data)}),{data:f}=s({queryKey:["services"],queryFn:()=>r.get("/services").then(e=>e.data.data)}),[v,N]=d.useState({service_id:"",count:10,value:0,days:30,quota_refill:0,prefix:"",code_length:12,pin_length:4}),[w,C]=d.useState({code:"",pin:"",subscriber_id:""}),_=t({mutationFn:e=>r.post("/prepaid/generate",e),onSuccess:()=>{l.invalidateQueries(["prepaid"]),l.invalidateQueries(["prepaid-batches"]),n(!1)}}),k=t({mutationFn:e=>r.post("/prepaid/use",e),onSuccess:()=>{l.invalidateQueries(["prepaid"]),o(!1),alert("Card redeemed successfully!")},onError:e=>{var s,t;alert((null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.message)||"Failed to redeem card")}}),S=t({mutationFn:e=>r.delete(`/prepaid/${e}`),onSuccess:()=>l.invalidateQueries(["prepaid"])}),P=t({mutationFn:e=>r.delete(`/prepaid/batch/${e}`),onSuccess:()=>{l.invalidateQueries(["prepaid"]),l.invalidateQueries(["prepaid-batches"])}});if(y)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const q=(null==g?void 0:g.data)||[],F=(null==g?void 0:g.meta)||{};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Prepaid Cards"}),a.jsxs("div",{className:"space-x-2",children:[a.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Redeem Card"}),a.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Generate Cards"})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:(j||[]).slice(0,4).map(e=>a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:e.batch_id}),a.jsxs("div",{className:"mt-2 flex justify-between",children:[a.jsx("span",{className:"text-2xl font-semibold text-green-600",children:e.active}),a.jsxs("span",{className:"text-sm text-gray-500",children:["/ ",e.total," total"]})]}),a.jsxs("div",{className:"mt-2 flex justify-between text-sm",children:[a.jsxs("span",{className:"text-gray-500",children:["Used: ",e.used]}),e.active>0&&a.jsx("button",{onClick:()=>{confirm(`Delete all ${e.active} unused cards from ${e.batch_id}?`)&&P.mutate(e.batch_id)},className:"text-red-600 hover:text-red-800",children:"Delete Unused"})]})]},e.batch_id))}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow flex gap-4",children:[a.jsxs("select",{value:m,onChange:e=>{p(e.target.value),x(1)},className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"All Cards"}),a.jsx("option",{value:"false",children:"Available"}),a.jsx("option",{value:"true",children:"Used"})]}),a.jsxs("select",{value:h,onChange:e=>{b(e.target.value),x(1)},className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"All Batches"}),(j||[]).map(e=>a.jsx("option",{value:e.batch_id,children:e.batch_id},e.batch_id))]})]}),a.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Code"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"PIN"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Value"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Days"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Service"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Batch"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map(e=>{var s,t;return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono",children:e.code}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono",children:e.pin}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["$",null==(s=e.value)?void 0:s.toFixed(2)]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.days}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null==(t=e.service)?void 0:t.name)||"-"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+(e.is_used?"bg-gray-100 text-gray-600":"bg-green-100 text-green-800"),children:e.is_used?"Used":"Available"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.batch_id}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:!e.is_used&&a.jsx("button",{onClick:()=>S.mutate(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})})]},e.id)})})]}),F.totalPages>1&&a.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-between items-center",children:[a.jsxs("span",{className:"text-sm text-gray-500",children:["Page ",u," of ",F.totalPages]}),a.jsxs("div",{className:"space-x-2",children:[a.jsx("button",{onClick:()=>x(e=>Math.max(1,e-1)),disabled:1===u,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),a.jsx("button",{onClick:()=>x(e=>e+1),disabled:u>=F.totalPages,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]}),i&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Generate Prepaid Cards"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),_.mutate({...v,service_id:parseInt(v.service_id)||0})},className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Count"}),a.jsx("input",{type:"number",value:v.count,onChange:e=>N({...v,count:parseInt(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",min:"1",max:"1000",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Days"}),a.jsx("input",{type:"number",value:v.days,onChange:e=>N({...v,days:parseInt(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service"}),a.jsxs("select",{value:v.service_id,onChange:e=>N({...v,service_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"No service change"}),(f||[]).map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prefix (optional)"}),a.jsx("input",{type:"text",value:v.prefix,onChange:e=>N({...v,prefix:e.target.value.toUpperCase()}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",maxLength:"6"})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:_.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:["Generate ",v.count," Cards"]})]})]})]})}),c&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Redeem Prepaid Card"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),k.mutate({...w,subscriber_id:parseInt(w.subscriber_id)})},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Card Code"}),a.jsx("input",{type:"text",value:w.code,onChange:e=>C({...w,code:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"PIN"}),a.jsx("input",{type:"text",value:w.pin,onChange:e=>C({...w,pin:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subscriber ID"}),a.jsx("input",{type:"number",value:w.subscriber_id,onChange:e=>C({...w,subscriber_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:k.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Redeem"})]})]})]})})]})}export{l as default};
