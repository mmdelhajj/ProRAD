import{b as e,u as a,d as s,j as r}from"./data-vendor-Gi89QHLZ.js";import{r as t}from"./react-vendor-C1B6conR.js";import{D as l,q as n,d as i,E as d,c,j as o,B as m,r as u,G as x,n as p,k as h}from"./index-TVCpSXsz.js";import{u as g,f as v,a as y}from"./table-vendor-3gCiRijM.js";import{c as b,z as j}from"./ui-vendor-Bljr83Cq.js";import{F as N}from"./PencilIcon-BjNR2RGb.js";import{F as f}from"./TrashIcon-BFqTFmN6.js";import{F as k}from"./XCircleIcon-CHlTZmp1.js";import"./chart-vendor-C_esy2x0.js";function w({title:e,titleId:a,...s},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},s),e?t.createElement("title",{id:a},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}const _=t.forwardRef(w);function C({title:e,titleId:a,...s},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},s),e?t.createElement("title",{id:a},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"}))}const S=t.forwardRef(C);function F({title:e,titleId:a,...s},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},s),e?t.createElement("title",{id:a},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const A=t.forwardRef(F);function E({title:e,titleId:a,...s},r){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},s),e?t.createElement("title",{id:a},e):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"}))}const L=t.forwardRef(E);function R(){var w,C;const F=e(),[E,R]=t.useState(!1),[B,q]=t.useState(!1),[T,I]=t.useState(!1),[P,M]=t.useState(null),[D,K]=t.useState(null),[$,W]=t.useState(""),[O,G]=t.useState(""),[Q,U]=t.useState({}),[z,H]=t.useState("general"),[V,Z]=t.useState([]),[X,Y]=t.useState([]),[J,ee]=t.useState({username:"",password:"",fullname:"",email:"",phone:"",address:"",company:"",balance:"0",credit_limit:"0",discount:"0",is_active:!0,parent_id:"",permission_group:"",notes:""}),{data:ae,isLoading:se}=a({queryKey:["resellers"],queryFn:()=>u.list().then(e=>e.data.data)}),{data:re}=a({queryKey:["permissionGroups"],queryFn:()=>x.listGroups().then(e=>e.data.data||[])}),{data:te}=a({queryKey:["allNAS"],queryFn:()=>p.list().then(e=>e.data.data||[]),enabled:E&&!!P}),{data:le}=a({queryKey:["allServices"],queryFn:()=>h.list().then(e=>e.data.data||[]),enabled:E&&!!P}),{data:ne,refetch:ie}=a({queryKey:["resellerAssignedNAS",null==P?void 0:P.id],queryFn:()=>u.getAssignedNAS(P.id).then(e=>e.data.data||[]),enabled:E&&!!P}),{data:de,refetch:ce}=a({queryKey:["resellerAssignedServices",null==P?void 0:P.id],queryFn:()=>u.getAssignedServices(P.id).then(e=>e.data.data||[]),enabled:E&&!!P});t.useEffect(()=>{ne&&Z(ne.filter(e=>e.assigned).map(e=>e.id))},[ne]),t.useEffect(()=>{de&&Y(de.map(e=>({service_id:e.id,enabled:e.is_enabled||!1,custom_price:null!=e.custom_price?String(e.custom_price):"",custom_day_price:null!=e.custom_day_price?String(e.custom_day_price):""})))},[de]);const oe=s({mutationFn:e=>P?u.update(P.id,e):u.create(e),onSuccess:()=>{j.success(P?"Reseller updated":"Reseller created"),F.invalidateQueries(["resellers"]),be()},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save")}}),me=s({mutationFn:e=>u.delete(e),onSuccess:()=>{j.success("Reseller deleted"),F.invalidateQueries(["resellers"])},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to delete")}}),ue=s({mutationFn:e=>u.permanentDelete(e),onSuccess:()=>{j.success("Reseller permanently deleted. Username can be reused."),F.invalidateQueries(["resellers"])},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to permanently delete")}}),xe=s({mutationFn:({id:e,amount:a})=>u.transfer(e,{amount:parseFloat(a)}),onSuccess:()=>{j.success("Balance transferred successfully"),F.invalidateQueries(["resellers"]),q(!1),W("")},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Transfer failed")}}),pe=s({mutationFn:({id:e,amount:a})=>u.withdraw(e,{amount:parseFloat(a)}),onSuccess:()=>{j.success("Balance withdrawn successfully"),F.invalidateQueries(["resellers"]),I(!1),G("")},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Withdrawal failed")}}),he=s({mutationFn:({id:e,nasIds:a})=>u.updateAssignedNAS(e,a),onSuccess:()=>{j.success("NAS assignments updated"),ie()},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to update NAS assignments")}}),ge=s({mutationFn:({id:e,services:a})=>u.updateAssignedServices(e,a),onSuccess:()=>{j.success("Service assignments updated"),ce()},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to update service assignments")}}),ve=s({mutationFn:e=>u.getImpersonateToken(e),onSuccess:e=>{const{token:a}=e.data;window.open(`/impersonate?token=${a}`,"_blank")?j.success("Opening reseller session in new tab..."):j.error("Popup blocked! Please allow popups for this site.")},onError:e=>{var a,s;return j.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to get impersonation token")}}),ye=(e=null)=>{var a,s,r,t;e?(M(e),ee({username:(null==(a=e.user)?void 0:a.username)||e.username||"",password:"",fullname:(null==(s=e.user)?void 0:s.full_name)||e.fullname||"",email:(null==(r=e.user)?void 0:r.email)||e.email||"",phone:(null==(t=e.user)?void 0:t.phone)||e.phone||"",address:e.address||"",company:e.name||e.company||"",balance:e.balance||"0",credit_limit:e.credit||e.credit_limit||"0",discount:e.discount||"0",is_active:e.is_active??!0,parent_id:e.parent_id||"",permission_group:e.permission_group||"",notes:e.notes||""})):(M(null),ee({username:"",password:"",fullname:"",email:"",phone:"",address:"",company:"",balance:"0",credit_limit:"0",discount:"0",is_active:!0,parent_id:"",permission_group:"",notes:""})),R(!0)},be=()=>{R(!1),M(null),H("general"),Z([]),Y([])},je=e=>{const{name:a,value:s,type:r,checked:t}=e.target;ee(e=>({...e,[a]:"checkbox"===r?t:s}))},Ne=(e,a,s)=>{Y(r=>r.find(a=>a.service_id===e)?r.map(r=>r.service_id===e?{...r,[a]:s}:r):[...r,{service_id:e,enabled:!1,custom_price:"",custom_day_price:"",[a]:s}])},fe=t.useMemo(()=>[{accessorKey:"username",header:"Username",cell:({row:e})=>{var a;return r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:r.jsx(l,{className:"w-5 h-5 text-primary-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:(null==(a=e.original.user)?void 0:a.username)||e.original.username}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.original.name||e.original.company})]})]})}},{accessorKey:"password",header:"Password",cell:({row:e})=>{var a;const s=null==(a=e.original.user)?void 0:a.password_plain,t=Q[e.original.id];return r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-mono text-sm",children:s?t?s:"••••••••":"-"}),s&&r.jsx("button",{onClick:()=>{return a=e.original.id,void U(e=>({...e,[a]:!e[a]}));var a},className:"p-1 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",title:t?"Hide password":"Show password",children:t?r.jsx(n,{className:"w-4 h-4"}):r.jsx(i,{className:"w-4 h-4"})})]})}},{accessorKey:"contact",header:"Contact",cell:({row:e})=>{var a,s;return r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{children:(null==(a=e.original.user)?void 0:a.email)||e.original.email}),r.jsx("div",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==(s=e.original.user)?void 0:s.phone)||e.original.phone})]})}},{accessorKey:"balance",header:"Balance",cell:({row:e})=>{var a;return r.jsxs("div",{className:b("font-semibold",e.original.balance>=0?"text-green-600":"text-red-600"),children:["$",null==(a=e.original.balance)?void 0:a.toFixed(2)]})}},{accessorKey:"credit",header:"Credit",cell:({row:e})=>`$${(e.original.credit||0).toFixed(2)}`},{accessorKey:"subscriber_count",header:"Subscribers",cell:({row:e})=>e.original.subscriber_count||0},{accessorKey:"is_active",header:"Status",cell:({row:e})=>r.jsx("span",{className:b("badge",e.original.is_active?"badge-success":"badge-gray"),children:e.original.is_active?"Active":"Inactive"})},{id:"actions",header:"Actions",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>{var a;confirm(`Login as ${(null==(a=e.original.user)?void 0:a.username)||e.original.username}?`)&&ve.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",title:"Login as Reseller",children:r.jsx(d,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{K(e.original),q(!0)},className:"p-1.5 text-gray-500 dark:text-gray-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/30 rounded",title:"Transfer Balance",children:r.jsx(S,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{K(e.original),I(!0)},className:"p-1.5 text-gray-500 hover:text-yellow-600 hover:bg-yellow-50 rounded",title:"Withdraw Balance",children:r.jsx(_,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>ye(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded",title:"Edit",children:r.jsx(N,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this reseller?")&&me.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete (can restore)",children:r.jsx(f,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{confirm("⚠️ PERMANENT DELETE ⚠️\n\nThis will permanently remove the reseller from the database.\nThe username can be reused after this.\n\nTHIS CANNOT BE UNDONE!\n\nAre you sure?")&&ue.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-700 hover:bg-red-100 dark:hover:bg-red-900/50 rounded",title:"Permanent Delete (cannot undo)",children:r.jsx(k,{className:"w-4 h-4"})})]})}],[me,ue,ve,Q]),ke=g({data:ae||[],columns:fe,getCoreRowModel:y()});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Resellers"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage reseller accounts and balances"})]}),r.jsxs("button",{onClick:()=>ye(),className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[r.jsx(c,{className:"w-4 h-4"}),"Add Reseller"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"card p-4",children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Resellers"}),r.jsx("div",{className:"text-2xl font-bold",children:(null==ae?void 0:ae.length)||0})]}),r.jsxs("div",{className:"card p-4",children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Balance"}),r.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",null==ae?void 0:ae.reduce((e,a)=>e+(a.balance||0),0).toFixed(2)]})]}),r.jsxs("div",{className:"card p-4",children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Active Resellers"}),r.jsx("div",{className:"text-2xl font-bold",children:(null==ae?void 0:ae.filter(e=>e.is_active).length)||0})]}),r.jsxs("div",{className:"card p-4",children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Subscribers"}),r.jsx("div",{className:"text-2xl font-bold",children:null==ae?void 0:ae.reduce((e,a)=>e+(a.subscriber_count||0),0)})]})]}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"table-container",children:r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:ke.getHeaderGroups().map(e=>r.jsx("tr",{children:e.headers.map(e=>r.jsx("th",{children:v(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:se?r.jsx("tr",{children:r.jsx("td",{colSpan:fe.length,className:"text-center py-8",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===ke.getRowModel().rows.length?r.jsx("tr",{children:r.jsx("td",{colSpan:fe.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No resellers found"})}):ke.getRowModel().rows.map(e=>r.jsx("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:e.getVisibleCells().map(e=>r.jsx("td",{children:v(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),E&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:be}),r.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[r.jsx("h2",{className:"text-xl font-semibold",children:P?"Edit Reseller":"Add Reseller"}),r.jsx("button",{onClick:be,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(o,{className:"w-5 h-5"})})]}),P&&r.jsx("div",{className:"border-b px-6",children:r.jsxs("nav",{className:"flex gap-4 -mb-px",children:[r.jsxs("button",{type:"button",onClick:()=>H("general"),className:b("flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium","general"===z?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:[r.jsx(A,{className:"w-4 h-4"}),"General"]}),r.jsxs("button",{type:"button",onClick:()=>H("nas"),className:b("flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium","nas"===z?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:[r.jsx(m,{className:"w-4 h-4"}),"Assigned NAS",r.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:V.length})]}),r.jsxs("button",{type:"button",onClick:()=>H("services"),className:b("flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium","services"===z?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:[r.jsx(L,{className:"w-4 h-4"}),"Assigned Services",r.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:X.filter(e=>e.enabled).length})]})]})}),("general"===z||!P)&&r.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={...J,balance:parseFloat(J.balance)||0,credit_limit:parseFloat(J.credit_limit)||0,discount:parseFloat(J.discount)||0,parent_id:J.parent_id?parseInt(J.parent_id):null,permission_group:J.permission_group?parseInt(J.permission_group):null};!a.password&&P&&delete a.password,oe.mutate(a)},className:"p-6 space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Username"}),r.jsx("input",{type:"text",name:"username",value:J.username,onChange:je,className:"input",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Password"}),r.jsx("input",{type:"password",name:"password",value:J.password,onChange:je,className:"input",placeholder:P?"Leave blank to keep current":"",required:!P})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Full Name"}),r.jsx("input",{type:"text",name:"fullname",value:J.fullname,onChange:je,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Company"}),r.jsx("input",{type:"text",name:"company",value:J.company,onChange:je,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Email"}),r.jsx("input",{type:"email",name:"email",value:J.email,onChange:je,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Phone"}),r.jsx("input",{type:"tel",name:"phone",value:J.phone,onChange:je,className:"input"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Address"}),r.jsx("textarea",{name:"address",value:J.address,onChange:je,className:"input",rows:2})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Initial Balance ($)"}),r.jsx("input",{type:"number",name:"balance",value:J.balance,onChange:je,className:"input",step:"0.01",disabled:P})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Credit Limit ($)"}),r.jsx("input",{type:"number",name:"credit_limit",value:J.credit_limit,onChange:je,className:"input",step:"0.01"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Discount (%)"}),r.jsx("input",{type:"number",name:"discount",value:J.discount,onChange:je,className:"input",min:"0",max:"100"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Parent Reseller (Optional)"}),r.jsxs("select",{name:"parent_id",value:J.parent_id,onChange:je,className:"input",children:[r.jsx("option",{value:"",children:"No Parent (Direct Reseller)"}),null==ae?void 0:ae.filter(e=>e.id!==(null==P?void 0:P.id)).map(e=>{var a;return r.jsxs("option",{value:e.id,children:[(null==(a=e.user)?void 0:a.username)||e.username," - ",e.name||e.company]},e.id)})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Permission Group"}),r.jsxs("select",{name:"permission_group",value:J.permission_group,onChange:je,className:"input",children:[r.jsx("option",{value:"",children:"No Permission Group"}),null==re?void 0:re.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Notes"}),r.jsx("textarea",{name:"notes",value:J.notes,onChange:je,className:"input",rows:2})]}),r.jsx("div",{className:"border-t pt-4",children:r.jsxs("label",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"checkbox",name:"is_active",checked:J.is_active,onChange:je,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsx("span",{children:"Active Reseller"})]})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx("button",{type:"button",onClick:be,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:oe.isLoading,className:"btn-primary",children:oe.isLoading?"Saving...":P?"Update":"Create"})]})]}),"nas"===z&&P&&r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Select the NAS devices this reseller can manage. Reseller will only see subscribers on these NAS."}),r.jsx("div",{className:"grid grid-cols-2 gap-3 max-h-96 overflow-y-auto",children:null==te?void 0:te.map(e=>r.jsxs("label",{className:b("flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors",V.includes(e.id)?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:[r.jsx("input",{type:"checkbox",checked:V.includes(e.id),onChange:()=>{return a=e.id,void Z(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:e.name}),r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.ip_address})]})]},e.id))}),(!te||0===te.length)&&r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No NAS devices found"}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx("button",{type:"button",onClick:be,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"button",onClick:()=>{P&&he.mutate({id:P.id,nasIds:V})},disabled:he.isLoading,className:"btn-primary",children:he.isLoading?"Saving...":"Save NAS Assignments"})]})]}),"services"===z&&P&&r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Select which services this reseller can sell. You can set custom prices for each service."}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:r.jsxs("table",{className:"w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 sticky top-0",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left px-3 py-2",children:"Service"}),r.jsx("th",{className:"text-left px-3 py-2",children:"Base Price"}),r.jsx("th",{className:"text-left px-3 py-2",children:"Custom Price"}),r.jsx("th",{className:"text-left px-3 py-2",children:"Custom Day Price"})]})}),r.jsx("tbody",{className:"divide-y",children:null==le?void 0:le.map(e=>{var a;const s=X.find(a=>a.service_id===e.id),t=(null==s?void 0:s.enabled)||!1;return r.jsxs("tr",{className:b(t&&"bg-primary-50"),children:[r.jsx("td",{className:"px-3 py-2",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:t,onChange:()=>{return a=e.id,void Y(e=>e.find(e=>e.service_id===a)?e.map(e=>e.service_id===a?{...e,enabled:!e.enabled}:e):[...e,{service_id:a,enabled:!0,custom_price:"",custom_day_price:""}]);var a},className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsx("span",{className:"font-medium",children:e.name})]})}),r.jsxs("td",{className:"px-3 py-2 text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["$",null==(a=e.price)?void 0:a.toFixed(2)]}),r.jsx("td",{className:"px-3 py-2",children:r.jsx("input",{type:"number",value:(null==s?void 0:s.custom_price)||"",onChange:a=>Ne(e.id,"custom_price",a.target.value),placeholder:"Same as base",className:"input w-24 py-1 px-2 text-sm",step:"0.01",disabled:!t})}),r.jsx("td",{className:"px-3 py-2",children:r.jsx("input",{type:"number",value:(null==s?void 0:s.custom_day_price)||"",onChange:a=>Ne(e.id,"custom_day_price",a.target.value),placeholder:"Auto",className:"input w-24 py-1 px-2 text-sm",step:"0.01",disabled:!t})})]},e.id)})})]})}),(!le||0===le.length)&&r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No services found"}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx("button",{type:"button",onClick:be,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"button",onClick:()=>{if(P){const e=X.filter(e=>e.enabled).map(e=>({service_id:e.service_id,custom_price:e.custom_price?parseFloat(e.custom_price):null,custom_day_price:e.custom_day_price?parseFloat(e.custom_day_price):null}));ge.mutate({id:P.id,services:e})}},disabled:ge.isLoading,className:"btn-primary",children:ge.isLoading?"Saving...":"Save Service Assignments"})]})]})]})]})}),B&&D&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>q(!1)}),r.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Transfer Balance"}),r.jsx("button",{onClick:()=>q(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(o,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Transfer balance to ",r.jsx("span",{className:"font-semibold",children:D.username})]}),r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current Balance: ",r.jsxs("span",{className:"font-semibold text-green-600",children:["$",null==(w=D.balance)?void 0:w.toFixed(2)]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Amount ($)"}),r.jsx("input",{type:"number",value:$,onChange:e=>W(e.target.value),className:"input",step:"0.01",min:"0.01",required:!0})]}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>xe.mutate({id:D.id,amount:$}),disabled:!$||xe.isLoading,className:"btn-primary",children:xe.isLoading?"Transferring...":"Transfer"})]})]})]})]})}),T&&D&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>I(!1)}),r.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Withdraw Balance"}),r.jsx("button",{onClick:()=>I(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:r.jsx(o,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-4",children:[r.jsxs("p",{className:"text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Withdraw balance from ",r.jsx("span",{className:"font-semibold",children:D.username})]}),r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current Balance: ",r.jsxs("span",{className:"font-semibold text-green-600",children:["$",null==(C=D.balance)?void 0:C.toFixed(2)]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Amount ($)"}),r.jsx("input",{type:"number",value:O,onChange:e=>G(e.target.value),className:"input",step:"0.01",min:"0.01",max:D.balance,required:!0})]}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>I(!1),className:"btn-secondary",children:"Cancel"}),r.jsx("button",{onClick:()=>pe.mutate({id:D.id,amount:O}),disabled:!O||pe.isLoading,className:"btn-primary",children:pe.isLoading?"Withdrawing...":"Withdraw"})]})]})]})]})})]})}export{R as default};
