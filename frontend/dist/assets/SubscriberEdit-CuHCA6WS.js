import{b as e,u as a,d as s,j as l}from"./data-vendor-Gi89QHLZ.js";import{f as n,b as i,r as t,L as r}from"./react-vendor-C1B6conR.js";import{u as d,l as o,m as c,o as x,p as u,e as h,q as p,d as m,t as v,F as g,s as j,k as y,n as b,r as N,v as f}from"./index-D10VjtWx.js";import{c as _,z as w}from"./ui-vendor-Bljr83Cq.js";import{E as k}from"./chart-vendor-C_esy2x0.js";const S=[{id:"info",name:"Info",icon:o},{id:"usage",name:"Usage",icon:c},{id:"graph",name:"Live Graph",icon:x},{id:"invoices",name:"Invoices",icon:u},{id:"logs",name:"Logs",icon:h}];function A(){var o,c,x;const{id:u}=n(),h=i(),A=e(),{hasPermission:C}=d(),I=!u||"new"===u,[M,F]=t.useState(!1),[B,D]=t.useState(()=>{if(I)return"info";const e=localStorage.getItem(`subscriber-tab-${u}`);return["info","usage","graph","invoices","logs"].includes(e)?e:"info"}),[P,$]=t.useState({download:0,upload:0,uptime:"",ipAddress:"",cdnTraffic:[],portRuleTraffic:[]}),E=t.useRef(null),L=t.useRef(Array(30).fill(0)),R=t.useRef(Array(30).fill(0)),U=t.useRef({}),T=t.useRef({}),[q,G]=t.useState([]),K=t.useRef({});t.useRef({});const[z,H]=t.useState([]),[J,O]=t.useState({ms:0,ok:!1}),Q=t.useRef(Array(30).fill(null)),[Y,V]=t.useState({username:"",password:"",full_name:"",email:"",phone:"",address:"",region:"",building:"",nationality:"",country:"",service_id:"",nas_id:"",reseller_id:"",status:1,auto_renew:!1,mac_address:"",save_mac:!0,static_ip:"",simultaneous_sessions:1,expiry_date:"",note:"",price:"",override_price:!1}),{data:Z,isLoading:W}=a({queryKey:["subscriber",u],queryFn:()=>j.get(u).then(e=>e.data),enabled:!I}),X=null==Z?void 0:Z.data,ee=(null==Z?void 0:Z.password)||"",ae=null==Z?void 0:Z.daily_quota,se=null==Z?void 0:Z.monthly_quota,le=(null==Z?void 0:Z.sessions)||[],{data:ne}=a({queryKey:["services-list"],queryFn:()=>y.list().then(e=>e.data.data)}),{data:ie}=a({queryKey:["nas-list"],queryFn:()=>b.list().then(e=>e.data.data)}),{data:te}=a({queryKey:["resellers-list"],queryFn:()=>N.list().then(e=>e.data.data)}),{data:re,refetch:de}=a({queryKey:["bandwidth-rules",u],queryFn:()=>j.getBandwidthRules(u).then(e=>e.data),enabled:!I&&!!u}),oe=(null==re?void 0:re.data)||[],{data:ce}=a({queryKey:["cdn-upgrades",u],queryFn:()=>j.getCDNUpgrades(u).then(e=>e.data),enabled:!I&&!!u});null==ce||ce.available_upgrades;const xe=(null==ce?void 0:ce.current_cdns)||[],{data:ue}=a({queryKey:["cdn-speeds"],queryFn:()=>f.getSpeeds().then(e=>e.data)}),he=(null==ue?void 0:ue.data)||[],pe=he.filter(e=>{if(!Y.nas_id)return!0;if(!e.nas_ids||""===e.nas_ids)return!0;return e.nas_ids.split(",").map(e=>e.trim()).includes(String(Y.nas_id))}),me=e=>{const a=he.find(a=>a.cdn_id===parseInt(e));return(null==a?void 0:a.speeds)||[]},[ve,ge]=t.useState(!1),[je,ye]=t.useState(null),[be,Ne]=t.useState({rule_type:"internet",enabled:!0,download_speed:"",upload_speed:"",duration:"permanent",priority:0,cdn_id:"",cdn_speed:""}),fe=()=>{Ne({rule_type:"internet",enabled:!0,download_speed:"",upload_speed:"",duration:"permanent",priority:0,cdn_id:"",cdn_speed:""}),ye(null)},_e=(e=null)=>{if(e){ye(e);const a="cdn"===e.rule_type;Ne({rule_type:e.rule_type||"internet",enabled:e.enabled??!0,download_speed:a?Math.round((e.download_speed||0)/1e3):e.download_speed||"",upload_speed:a?Math.round((e.upload_speed||0)/1e3):e.upload_speed||"",duration:e.duration||"permanent",priority:e.priority||0,cdn_id:e.cdn_id||"",cdn_speed:e.cdn_speed||""})}else fe();ge(!0)};t.useEffect(()=>{X&&V({username:X.username||"",password:ee||"",full_name:X.full_name||"",email:X.email||"",phone:X.phone||"",address:X.address||"",region:X.region||"",building:X.building||"",nationality:X.nationality||"",country:X.country||"",service_id:X.service_id||"",nas_id:X.nas_id||"",reseller_id:X.reseller_id||"",status:X.status??1,auto_renew:X.auto_renew??!1,mac_address:X.mac_address||"",save_mac:X.save_mac??!1,static_ip:X.static_ip||"",simultaneous_sessions:X.simultaneous_sessions||1,expiry_date:X.expiry_date?X.expiry_date.split("T")[0]:"",note:X.note||"",price:X.price||"",override_price:X.override_price||!1})},[X,ee,u,I]),t.useEffect(()=>{if("graph"!==B||!(null==X?void 0:X.is_online)||I)return;let e=!0;const a=async()=>{try{const a=await j.getBandwidth(u);if(a.data.success&&e){const e=a.data.data,s=e.download||0,l=e.upload||0,n=e.cdn_traffic||[],i=e.cdn_is_rate||!1,t=e.port_rule_traffic||[],r=[];let d=0;n.forEach(e=>{U.current[e.cdn_id]||(U.current[e.cdn_id]=Array(30).fill(0));const a=e.bytes||0;let s=0;if(i)s=8*a/1e6||0;else{const l=T.current[e.cdn_id];if(void 0!==l&&a>=l){s=8*(a-l)/1e6/2||0}T.current[e.cdn_id]=a}U.current[e.cdn_id]=[...U.current[e.cdn_id].slice(1),s],d+=s,r.push({id:e.cdn_id,name:e.cdn_name,color:e.color})}),G(r);const o=[];t.forEach(e=>{K.current[e.rule_id]||(K.current[e.rule_id]=Array(30).fill(0));const a=8*(e.bytes||0)/1e6||0;K.current[e.rule_id]=[...K.current[e.rule_id].slice(1),a],o.push({id:e.rule_id,name:e.rule_name,color:e.color})}),H(o);const c=Math.max(0,s-d);if($({download:c.toFixed(2),upload:l.toFixed(2),uptime:e.uptime||"",ipAddress:e.ip_address||"",cdnTraffic:n,portRuleTraffic:t}),e.ping_ok?(O({ms:e.ping_ms,ok:!0}),Q.current=[...Q.current.slice(1),e.ping_ms]):(O(e=>({...e,ok:!1})),Q.current=[...Q.current.slice(1),null]),L.current=[...L.current.slice(1),c],R.current=[...R.current.slice(1),l],E.current){const e=E.current.getEchartsInstance();if(e){const a=["Download","Upload","Ping (ms)",...r.map(e=>e.name),...o.map(e=>e.name)],s=[{name:"Download",data:L.current},{name:"Upload",data:R.current},{name:"Ping (ms)",type:"line",yAxisIndex:1,smooth:!1,data:Q.current,lineStyle:{color:"#F59E0B",width:1.5,type:"dotted"},itemStyle:{color:"#F59E0B"},showSymbol:!1,connectNulls:!1,z:10},...r.map(e=>({name:e.name,type:"line",smooth:!0,data:U.current[e.id]||Array(30).fill(0),lineStyle:{color:e.color,width:2},itemStyle:{color:e.color},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:e.color+"66"},{offset:1,color:e.color+"0D"}]}},showSymbol:!1})),...o.map(e=>({name:e.name,type:"line",smooth:!0,data:K.current[e.id]||Array(30).fill(0),lineStyle:{color:e.color,width:2,type:"dashed"},itemStyle:{color:e.color},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:e.color+"55"},{offset:1,color:e.color+"0D"}]}},showSymbol:!1}))];e.setOption({legend:{data:a},series:s})}}}}catch(a){}};a();const s=setInterval(a,2e3);return()=>{e=!1,clearInterval(s)}},[B,null==X?void 0:X.is_online,I,u]);const we=s({mutationFn:e=>I?j.create(e):j.update(u,e),onSuccess:()=>{w.success(I?"Subscriber created":"Subscriber updated"),A.invalidateQueries(["subscribers"]),h("/subscribers")},onError:e=>{var a,s;return w.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save")}}),ke=s({mutationFn:e=>je?j.updateBandwidthRule(u,je.id,e):j.createBandwidthRule(u,e),onSuccess:()=>{w.success(je?"Rule updated":"Rule created"),de(),ge(!1),fe()},onError:e=>{var a,s;return w.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save rule")}}),Se=s({mutationFn:e=>j.deleteBandwidthRule(u,e),onSuccess:()=>{w.success("Rule deleted"),de()},onError:e=>{var a,s;return w.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to delete rule")}}),Ae=e=>{const{name:a,value:s,type:l,checked:n}=e.target;V(e=>({...e,[a]:"checkbox"===l?n:s}))},Ce={animation:!0,animationDuration:300,animationEasing:"linear",tooltip:{trigger:"axis",formatter:e=>{let a=e[0].name+"<br/>";return e.forEach(e=>{if(null===e.value||void 0===e.value)return;const s="Ping (ms)"===e.seriesName,l="number"==typeof e.value?e.value.toFixed(s?1:2):"—",n=s?"ms":"Mbps";a+=`${e.marker} ${e.seriesName}: ${l} ${n}<br/>`}),a}},legend:{data:["Download","Upload","Ping (ms)"],top:0},grid:{left:"3%",right:"8%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:Array.from({length:30},(e,a)=>30-a+"s"),axisLine:{lineStyle:{color:"#ccc"}}},yAxis:[{type:"value",min:0,max:e=>{const a=Math.max(e.max,.1);return Math.max(3,Math.ceil(1.2*a))},axisLabel:{formatter:"{value} Mbps"},axisLine:{lineStyle:{color:"#ccc"}},splitLine:{lineStyle:{color:"#eee"}}},{type:"value",name:"ms",min:0,max:e=>Math.max(100,Math.ceil(1.3*e.max)),position:"right",axisLabel:{formatter:"{value} ms",color:"#F59E0B"},axisLine:{lineStyle:{color:"#F59E0B33"}},splitLine:{show:!1}}],series:[{name:"Download",type:"line",yAxisIndex:0,smooth:!0,data:L.current,lineStyle:{color:"#10B981",width:2},itemStyle:{color:"#10B981"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(16, 185, 129, 0.4)"},{offset:1,color:"rgba(16, 185, 129, 0.05)"}]}},showSymbol:!1},{name:"Upload",type:"line",yAxisIndex:0,smooth:!0,data:R.current,lineStyle:{color:"#3B82F6",width:2},itemStyle:{color:"#3B82F6"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(59, 130, 246, 0.4)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}]}},showSymbol:!1},{name:"Ping (ms)",type:"line",yAxisIndex:1,smooth:!1,data:Q.current,lineStyle:{color:"#F59E0B",width:1.5,type:"dotted"},itemStyle:{color:"#F59E0B"},showSymbol:!1,connectNulls:!1,z:10}]};return!I&&W?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I?"Add Subscriber":`Edit: ${null==X?void 0:X.username}`}),l.jsx("p",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:I?"Create a new PPPoE subscriber":"Manage subscriber details"})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[!I&&(null==X?void 0:X.is_online)&&l.jsx("span",{className:"badge badge-success",children:"Online"}),!I&&!(null==X?void 0:X.is_online)&&l.jsx("span",{className:"badge badge-gray",children:"Offline"}),!I&&(null==X?void 0:X.fup_level)>0&&l.jsxs("span",{className:"px-2.5 py-1 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse",children:["FUP ",1===X.fup_level?"(Daily)":"(Monthly)"]})]})]}),!I&&l.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:l.jsx("nav",{className:"-mb-px flex space-x-8",children:S.map(e=>l.jsxs("button",{onClick:()=>{return a=e.id,D(a),void(I||localStorage.setItem(`subscriber-tab-${u}`,a));var a},className:_("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm",B===e.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:[l.jsx(e.icon,{className:"w-5 h-5"}),e.name]},e.id))})}),(I||"info"===B)&&l.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={...Y};a.password||delete a.password,a.override_price&&""!==a.price?a.price=parseFloat(a.price):(a.price=0,a.override_price=!1),a.service_id&&(a.service_id=parseInt(a.service_id)),a.nas_id?a.nas_id=parseInt(a.nas_id):delete a.nas_id,a.reseller_id?a.reseller_id=parseInt(a.reseller_id):delete a.reseller_id,a.status=parseInt(a.status),a.simultaneous_sessions=parseInt(a.simultaneous_sessions)||1,we.mutate(a)},className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Account Information"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"label",children:["Username (PPPoE) ",!I&&l.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(locked)"})]}),l.jsx("input",{type:"text",name:"username",value:Y.username,onChange:Ae,className:"input "+(I?"":"bg-gray-100 cursor-not-allowed"),required:!0,autoComplete:"off",disabled:!I})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Password"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx("input",{type:M?"text":"password",name:"password",value:Y.password,onChange:Ae,className:"input pr-10",placeholder:I?"":"Leave blank to keep current",required:I,autoComplete:"new-password"}),l.jsx("button",{type:"button",onClick:()=>F(!M),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:M?l.jsx(p,{className:"h-5 w-5"}):l.jsx(m,{className:"h-5 w-5"})})]}),l.jsx("button",{type:"button",onClick:()=>{const e="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789",a=8+Math.floor(3*Math.random());let s="";for(let l=0;l<a;l++)s+=e.charAt(Math.floor(55*Math.random()));V(e=>({...e,password:s})),F(!0)},className:"btn btn-secondary whitespace-nowrap",children:"Generate"})]})]}),I||C("subscribers.change_service")?l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Service Plan"}),l.jsxs("select",{name:"service_id",value:Y.service_id,onChange:Ae,className:"input",required:!0,children:[l.jsx("option",{value:"",children:"Select Service"}),null==ne?void 0:ne.map(e=>l.jsxs("option",{value:e.id,children:[e.name," - $",e.price]},e.id))]})]}):l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Service Plan"}),l.jsx("input",{type:"text",value:(null==(o=null==ne?void 0:ne.find(e=>e.id===parseInt(Y.service_id)))?void 0:o.name)||"N/A",className:"input bg-gray-100 dark:bg-gray-700",disabled:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Price"}),l.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[l.jsx("input",{type:"checkbox",id:"override_price",name:"override_price",checked:Y.override_price,onChange:Ae,className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),l.jsx("label",{htmlFor:"override_price",className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:"Override service price for this subscriber"})]}),Y.override_price?l.jsx("input",{type:"number",name:"price",value:Y.price,onChange:Ae,placeholder:"Enter custom price",step:"0.01",min:"0",className:"input"}):l.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:["Using service default: $",(null==(c=null==ne?void 0:ne.find(e=>e.id==Y.service_id))?void 0:c.price)??"—"]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"NAS"}),l.jsxs("select",{name:"nas_id",value:Y.nas_id,onChange:Ae,className:"input",children:[l.jsx("option",{value:"",children:"Select NAS"}),null==ie?void 0:ie.map(e=>l.jsxs("option",{value:e.id,children:[e.name," (",e.ip_address,")"]},e.id))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Reseller"}),l.jsxs("select",{name:"reseller_id",value:Y.reseller_id,onChange:Ae,className:"input",children:[l.jsx("option",{value:"",children:"No Reseller (Admin)"}),null==te?void 0:te.map(e=>l.jsxs("option",{value:e.id,children:[e.name||e.username," (Balance: $",e.balance,")"]},e.id))]})]}),!I&&(null==X?void 0:X.created_at)&&l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Created At"}),l.jsx("div",{className:"input bg-gray-50 dark:bg-gray-700 cursor-default text-gray-700 dark:text-gray-200 font-medium",children:v(X.created_at)})]})]})]}),l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Personal Information"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Full Name"}),l.jsx("input",{type:"text",name:"full_name",value:Y.full_name,onChange:Ae,className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Email"}),l.jsx("input",{type:"email",name:"email",value:Y.email,onChange:Ae,className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Phone"}),l.jsx("input",{type:"tel",name:"phone",value:Y.phone,onChange:Ae,className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Address"}),l.jsx("textarea",{name:"address",value:Y.address,onChange:Ae,className:"input",rows:3})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Region"}),l.jsx("input",{type:"text",name:"region",value:Y.region,onChange:Ae,className:"input"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Building"}),l.jsx("input",{type:"text",name:"building",value:Y.building,onChange:Ae,className:"input"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Nationality"}),l.jsxs("select",{name:"nationality",value:Y.nationality,onChange:Ae,className:"input",children:[l.jsx("option",{value:"",children:"Select Nationality"}),l.jsx("option",{value:"Afghan",children:"Afghan"}),l.jsx("option",{value:"Albanian",children:"Albanian"}),l.jsx("option",{value:"Algerian",children:"Algerian"}),l.jsx("option",{value:"Argentine",children:"Argentine"}),l.jsx("option",{value:"Australian",children:"Australian"}),l.jsx("option",{value:"Austrian",children:"Austrian"}),l.jsx("option",{value:"Bahraini",children:"Bahraini"}),l.jsx("option",{value:"Bangladeshi",children:"Bangladeshi"}),l.jsx("option",{value:"Belgian",children:"Belgian"}),l.jsx("option",{value:"Brazilian",children:"Brazilian"}),l.jsx("option",{value:"Canadian",children:"Canadian"}),l.jsx("option",{value:"Chinese",children:"Chinese"}),l.jsx("option",{value:"Colombian",children:"Colombian"}),l.jsx("option",{value:"Czech",children:"Czech"}),l.jsx("option",{value:"Danish",children:"Danish"}),l.jsx("option",{value:"Egyptian",children:"Egyptian"}),l.jsx("option",{value:"Finnish",children:"Finnish"}),l.jsx("option",{value:"French",children:"French"}),l.jsx("option",{value:"German",children:"German"}),l.jsx("option",{value:"Greek",children:"Greek"}),l.jsx("option",{value:"Hong Konger",children:"Hong Konger"}),l.jsx("option",{value:"Hungarian",children:"Hungarian"}),l.jsx("option",{value:"Indian",children:"Indian"}),l.jsx("option",{value:"Indonesian",children:"Indonesian"}),l.jsx("option",{value:"Iranian",children:"Iranian"}),l.jsx("option",{value:"Iraqi",children:"Iraqi"}),l.jsx("option",{value:"Irish",children:"Irish"}),l.jsx("option",{value:"Israeli",children:"Israeli"}),l.jsx("option",{value:"Italian",children:"Italian"}),l.jsx("option",{value:"Japanese",children:"Japanese"}),l.jsx("option",{value:"Jordanian",children:"Jordanian"}),l.jsx("option",{value:"Kuwaiti",children:"Kuwaiti"}),l.jsx("option",{value:"Lebanese",children:"Lebanese"}),l.jsx("option",{value:"Libyan",children:"Libyan"}),l.jsx("option",{value:"Malaysian",children:"Malaysian"}),l.jsx("option",{value:"Mexican",children:"Mexican"}),l.jsx("option",{value:"Moroccan",children:"Moroccan"}),l.jsx("option",{value:"Dutch",children:"Dutch"}),l.jsx("option",{value:"New Zealander",children:"New Zealander"}),l.jsx("option",{value:"Nigerian",children:"Nigerian"}),l.jsx("option",{value:"Norwegian",children:"Norwegian"}),l.jsx("option",{value:"Omani",children:"Omani"}),l.jsx("option",{value:"Pakistani",children:"Pakistani"}),l.jsx("option",{value:"Palestinian",children:"Palestinian"}),l.jsx("option",{value:"Filipino",children:"Filipino"}),l.jsx("option",{value:"Polish",children:"Polish"}),l.jsx("option",{value:"Portuguese",children:"Portuguese"}),l.jsx("option",{value:"Qatari",children:"Qatari"}),l.jsx("option",{value:"Romanian",children:"Romanian"}),l.jsx("option",{value:"Russian",children:"Russian"}),l.jsx("option",{value:"Saudi",children:"Saudi"}),l.jsx("option",{value:"Singaporean",children:"Singaporean"}),l.jsx("option",{value:"South African",children:"South African"}),l.jsx("option",{value:"South Korean",children:"South Korean"}),l.jsx("option",{value:"Spanish",children:"Spanish"}),l.jsx("option",{value:"Sudanese",children:"Sudanese"}),l.jsx("option",{value:"Swedish",children:"Swedish"}),l.jsx("option",{value:"Swiss",children:"Swiss"}),l.jsx("option",{value:"Syrian",children:"Syrian"}),l.jsx("option",{value:"Taiwanese",children:"Taiwanese"}),l.jsx("option",{value:"Thai",children:"Thai"}),l.jsx("option",{value:"Tunisian",children:"Tunisian"}),l.jsx("option",{value:"Turkish",children:"Turkish"}),l.jsx("option",{value:"Ukrainian",children:"Ukrainian"}),l.jsx("option",{value:"Emirati",children:"Emirati"}),l.jsx("option",{value:"British",children:"British"}),l.jsx("option",{value:"American",children:"American"}),l.jsx("option",{value:"Vietnamese",children:"Vietnamese"}),l.jsx("option",{value:"Yemeni",children:"Yemeni"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Country"}),l.jsxs("select",{name:"country",value:Y.country,onChange:Ae,className:"input",children:[l.jsx("option",{value:"",children:"Select Country"}),l.jsx("option",{value:"Afghanistan",children:"Afghanistan"}),l.jsx("option",{value:"Albania",children:"Albania"}),l.jsx("option",{value:"Algeria",children:"Algeria"}),l.jsx("option",{value:"Argentina",children:"Argentina"}),l.jsx("option",{value:"Australia",children:"Australia"}),l.jsx("option",{value:"Austria",children:"Austria"}),l.jsx("option",{value:"Bahrain",children:"Bahrain"}),l.jsx("option",{value:"Bangladesh",children:"Bangladesh"}),l.jsx("option",{value:"Belgium",children:"Belgium"}),l.jsx("option",{value:"Brazil",children:"Brazil"}),l.jsx("option",{value:"Canada",children:"Canada"}),l.jsx("option",{value:"China",children:"China"}),l.jsx("option",{value:"Colombia",children:"Colombia"}),l.jsx("option",{value:"Czech Republic",children:"Czech Republic"}),l.jsx("option",{value:"Denmark",children:"Denmark"}),l.jsx("option",{value:"Egypt",children:"Egypt"}),l.jsx("option",{value:"Finland",children:"Finland"}),l.jsx("option",{value:"France",children:"France"}),l.jsx("option",{value:"Germany",children:"Germany"}),l.jsx("option",{value:"Greece",children:"Greece"}),l.jsx("option",{value:"Hong Kong",children:"Hong Kong"}),l.jsx("option",{value:"Hungary",children:"Hungary"}),l.jsx("option",{value:"India",children:"India"}),l.jsx("option",{value:"Indonesia",children:"Indonesia"}),l.jsx("option",{value:"Iran",children:"Iran"}),l.jsx("option",{value:"Iraq",children:"Iraq"}),l.jsx("option",{value:"Ireland",children:"Ireland"}),l.jsx("option",{value:"Israel",children:"Israel"}),l.jsx("option",{value:"Italy",children:"Italy"}),l.jsx("option",{value:"Japan",children:"Japan"}),l.jsx("option",{value:"Jordan",children:"Jordan"}),l.jsx("option",{value:"Kuwait",children:"Kuwait"}),l.jsx("option",{value:"Lebanon",children:"Lebanon"}),l.jsx("option",{value:"Libya",children:"Libya"}),l.jsx("option",{value:"Malaysia",children:"Malaysia"}),l.jsx("option",{value:"Mexico",children:"Mexico"}),l.jsx("option",{value:"Morocco",children:"Morocco"}),l.jsx("option",{value:"Netherlands",children:"Netherlands"}),l.jsx("option",{value:"New Zealand",children:"New Zealand"}),l.jsx("option",{value:"Nigeria",children:"Nigeria"}),l.jsx("option",{value:"Norway",children:"Norway"}),l.jsx("option",{value:"Oman",children:"Oman"}),l.jsx("option",{value:"Pakistan",children:"Pakistan"}),l.jsx("option",{value:"Palestine",children:"Palestine"}),l.jsx("option",{value:"Philippines",children:"Philippines"}),l.jsx("option",{value:"Poland",children:"Poland"}),l.jsx("option",{value:"Portugal",children:"Portugal"}),l.jsx("option",{value:"Qatar",children:"Qatar"}),l.jsx("option",{value:"Romania",children:"Romania"}),l.jsx("option",{value:"Russia",children:"Russia"}),l.jsx("option",{value:"Saudi Arabia",children:"Saudi Arabia"}),l.jsx("option",{value:"Singapore",children:"Singapore"}),l.jsx("option",{value:"South Africa",children:"South Africa"}),l.jsx("option",{value:"South Korea",children:"South Korea"}),l.jsx("option",{value:"Spain",children:"Spain"}),l.jsx("option",{value:"Sudan",children:"Sudan"}),l.jsx("option",{value:"Sweden",children:"Sweden"}),l.jsx("option",{value:"Switzerland",children:"Switzerland"}),l.jsx("option",{value:"Syria",children:"Syria"}),l.jsx("option",{value:"Taiwan",children:"Taiwan"}),l.jsx("option",{value:"Thailand",children:"Thailand"}),l.jsx("option",{value:"Tunisia",children:"Tunisia"}),l.jsx("option",{value:"Turkey",children:"Turkey"}),l.jsx("option",{value:"Ukraine",children:"Ukraine"}),l.jsx("option",{value:"United Arab Emirates",children:"United Arab Emirates"}),l.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),l.jsx("option",{value:"United States",children:"United States"}),l.jsx("option",{value:"Vietnam",children:"Vietnam"}),l.jsx("option",{value:"Yemen",children:"Yemen"})]})]})]})]})]}),l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Connection Settings"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"label",children:["MAC Address ",!I&&l.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(locked)"})]}),l.jsx("input",{type:"text",name:"mac_address",value:Y.mac_address,onChange:e=>{const a=e.target.value.toUpperCase();(""===a||/^[0-9A-F:-]*$/.test(a))&&V(e=>({...e,mac_address:a}))},className:"input "+(I?"":"bg-gray-100 cursor-not-allowed"),placeholder:"Leave empty - auto-saves on first connect",disabled:!I}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"Leave empty to auto-capture MAC on first connection"})]}),l.jsxs("label",{className:"flex items-center gap-3",children:[l.jsx("input",{type:"checkbox",name:"save_mac",checked:Y.save_mac,onChange:Ae,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"Save MAC"}),l.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Lock to current MAC address (reject other devices)"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Static IP"}),l.jsx("input",{type:"text",name:"static_ip",value:Y.static_ip,onChange:Ae,className:"input",placeholder:"Leave blank for dynamic"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Simultaneous Sessions"}),l.jsx("input",{type:"number",name:"simultaneous_sessions",value:Y.simultaneous_sessions,onChange:Ae,className:"input",min:1,max:10})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Expiry Date"}),l.jsx("input",{type:"date",name:"expiry_date",value:Y.expiry_date,onChange:Ae,className:"input"})]})]})]}),!I&&C("subscribers.bandwidth_rules")&&l.jsxs("div",{className:"card p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bandwidth Rules"}),l.jsx("button",{type:"button",onClick:()=>_e(),className:"btn btn-primary btn-sm",children:"Add Rule"})]}),l.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Custom speed overrides for this subscriber. Set duration for temporary speed changes."}),0===oe.length?l.jsx("p",{className:"text-gray-500 text-center py-4",children:"No bandwidth rules configured"}):l.jsx("div",{className:"space-y-3",children:oe.map(e=>{const a=(e=>{if(!e.expires_at)return"Permanent";const a=new Date(e.expires_at),s=new Date;if(a<=s)return"Expired";const l=a-s,n=Math.floor(l/36e5),i=Math.floor(l%36e5/6e4);if(n>=24)return`${Math.floor(n/24)}d ${n%24}h remaining`;return`${n}h ${i}m remaining`})(e),s="Expired"===a;return l.jsx("div",{className:_("border rounded-lg p-4",!e.enabled||s?"border-gray-100 bg-gray-50 opacity-60":"border-gray-200 bg-white"),children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:_("px-2 py-1 text-xs font-medium rounded","internet"===e.rule_type?"bg-blue-100 text-blue-800":"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"),children:"internet"===e.rule_type?"Internet":e.cdn_name||"CDN"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium",children:"cdn"===e.rule_type?`${Math.round(e.download_speed/1e3)}M`:`${e.download_speed}k / ${e.upload_speed}k`}),l.jsx("p",{className:_("text-sm",s?"text-red-500":"text-gray-500"),children:a})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{type:"button",onClick:()=>_e(e),className:"text-primary-600 hover:text-primary-800 text-sm",children:"Edit"}),l.jsx("button",{type:"button",onClick:()=>{return a=e.id,void(confirm("Are you sure you want to delete this rule?")&&Se.mutate(a));var a},className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]})},e.id)})})]}),l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Status & Options"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Status"}),l.jsxs("select",{name:"status",value:Y.status,onChange:Ae,className:"input",children:[l.jsx("option",{value:1,children:"Active"}),l.jsx("option",{value:0,children:"Inactive"}),l.jsx("option",{value:2,children:"Suspended"})]})]}),l.jsxs("label",{className:"flex items-center gap-3",children:[l.jsx("input",{type:"checkbox",name:"auto_renew",checked:Y.auto_renew,onChange:Ae,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),l.jsx("span",{children:"Auto Renew"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Notes"}),l.jsx("textarea",{name:"note",value:Y.note,onChange:Ae,className:"input",rows:4,placeholder:"Internal notes about this subscriber..."})]})]})]})]}),l.jsxs("div",{className:"flex items-center justify-end gap-4",children:[l.jsx(r,{to:"/subscribers",className:"btn-secondary",children:"Cancel"}),C(I?"subscribers.create":"subscribers.edit")&&l.jsx("button",{type:"submit",disabled:we.isLoading,className:"btn-primary",children:we.isLoading?"Saving...":I?"Create Subscriber":"Save Changes"})]})]}),!I&&"usage"===B&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Monthly"}),l.jsxs("div",{className:"flex items-end gap-8 h-48",children:[l.jsxs("div",{className:"flex flex-col items-center flex-1",children:[l.jsx("div",{className:"w-full max-w-[120px] bg-gray-100 rounded-t relative h-40 flex items-end",children:l.jsx("div",{className:"w-full rounded-t transition-all duration-500",style:{height:(()=>{const e=(null==se?void 0:se.download_used)||0,a=(null==se?void 0:se.download_limit)||0;return a>0?`${Math.min(e/a*100,100)}%`:e>0?`${Math.min(e/107374182400*100,100)}%`:"0%"})(),backgroundColor:"#14B8A6",minHeight:((null==se?void 0:se.download_used)||0)>0?"8px":"0"}})}),l.jsxs("div",{className:"mt-3 text-center",children:[l.jsxs("div",{className:"text-2xl font-bold text-teal-500",children:[(((null==se?void 0:se.download_used)||0)/1073741824).toFixed(2)," GB"]}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==se?void 0:se.download_limit)>0?`/ ${(se.download_limit/1073741824).toFixed(0)} GB`:"Unlimited"}),l.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Download"})]})]}),l.jsxs("div",{className:"flex flex-col items-center flex-1",children:[l.jsx("div",{className:"w-full max-w-[120px] bg-gray-100 rounded-t relative h-40 flex items-end",children:l.jsx("div",{className:"w-full rounded-t transition-all duration-500",style:{height:(()=>{const e=(null==se?void 0:se.upload_used)||0,a=(null==se?void 0:se.upload_limit)||0;return a>0?`${Math.min(e/a*100,100)}%`:e>0?`${Math.min(e/107374182400*100,100)}%`:"0%"})(),backgroundColor:"#F97316",minHeight:((null==se?void 0:se.upload_used)||0)>0?"8px":"0"}})}),l.jsxs("div",{className:"mt-3 text-center",children:[l.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[(((null==se?void 0:se.upload_used)||0)/1073741824).toFixed(2)," GB"]}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==se?void 0:se.upload_limit)>0?`/ ${(se.upload_limit/1073741824).toFixed(0)} GB`:"Unlimited"}),l.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Upload"})]})]})]})]}),l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Daily"}),l.jsx(k,{option:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{let a=`Day ${e[0].name}<br/>`;return e.forEach(e=>{const s=(e.value/1073741824).toFixed(2);a+=`${e.marker} ${e.seriesName}: ${s} GB<br/>`}),a}},legend:{data:["Download","Upload"],top:0},grid:{left:"3%",right:"4%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"category",data:Array.from({length:(null==(x=null==ae?void 0:ae.daily_download)?void 0:x.length)||new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate()},(e,a)=>a+1),axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#666"}},yAxis:{type:"value",axisLabel:{formatter:e=>(e/1073741824).toFixed(1)+" GB",color:"#666"},axisLine:{lineStyle:{color:"#ccc"}},splitLine:{lineStyle:{color:"#eee"}}},series:[{name:"Download",type:"bar",data:(null==ae?void 0:ae.daily_download)||[],itemStyle:{color:"#14B8A6"},barWidth:"35%"},{name:"Upload",type:"bar",data:(null==ae?void 0:ae.daily_upload)||[],itemStyle:{color:"#F97316"},barWidth:"35%"}]},style:{height:"300px"}})]}),l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Today's Usage"}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsxs("div",{className:"text-center p-4 bg-teal-50 rounded-lg",children:[l.jsxs("div",{className:"text-3xl font-bold text-teal-600",children:[(((null==ae?void 0:ae.download_used)||0)/1073741824).toFixed(2)," GB"]}),l.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:["Download ",(null==ae?void 0:ae.download_limit)>0&&`/ ${(ae.download_limit/1073741824).toFixed(0)} GB`]})]}),l.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[l.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:[(((null==ae?void 0:ae.upload_used)||0)/1073741824).toFixed(2)," GB"]}),l.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:["Upload ",(null==ae?void 0:ae.upload_limit)>0&&`/ ${(ae.upload_limit/1073741824).toFixed(0)} GB`]})]})]})]})]}),!I&&"graph"===B&&l.jsxs("div",{className:"space-y-6",children:[(null==X?void 0:X.is_online)&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[l.jsxs("div",{className:"card p-4 text-center",children:[l.jsx("div",{className:"text-3xl font-bold text-green-500",children:P.download}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Download (Mbps)"})]}),l.jsxs("div",{className:"card p-4 text-center",children:[l.jsx("div",{className:"text-3xl font-bold text-blue-500",children:P.upload}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Upload (Mbps)"})]}),l.jsxs("div",{className:"card p-4 text-center",style:{borderTop:"3px solid #F59E0B"},children:[l.jsx("div",{className:"text-3xl font-bold "+(J.ok?J.ms<20?"text-green-500":J.ms<80?"text-yellow-500":"text-red-500":"text-gray-400 dark:text-gray-500"),children:J.ok?`${J.ms.toFixed(1)}`:"—"}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Latency (ms)"})]}),l.jsxs("div",{className:"card p-4 text-center",children:[l.jsx("div",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300",children:P.ipAddress||"-"}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IP Address"})]}),l.jsxs("div",{className:"card p-4 text-center",children:[l.jsx("div",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300",children:P.uptime||"-"}),l.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Uptime"})]})]}),q.length>0&&l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:q.map(e=>{const a=U.current[e.id]||[],s=a.length>0?a[a.length-1]:0;return l.jsxs("div",{className:"card p-3 text-center",style:{borderTop:`3px solid ${e.color}`},children:[l.jsxs("div",{className:"text-xl font-bold",style:{color:e.color},children:[s.toFixed(2)," Mbps"]}),l.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.name})]},e.id)})}),z.length>0&&l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:z.map(e=>{const a=K.current[e.id]||[],s=a.length>0?a[a.length-1]:0;return l.jsxs("div",{className:"card p-3 text-center",style:{borderTop:`3px dashed ${e.color}`},children:[l.jsxs("div",{className:"text-xl font-bold",style:{color:e.color},children:[s.toFixed(2)," Mbps"]}),l.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Port: ",e.name]})]},e.id)})})]}),l.jsxs("div",{className:"card p-6",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Live Bandwidth Graph"}),(null==X?void 0:X.is_online)&&l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[l.jsxs("span",{className:"relative flex h-3 w-3",children:[l.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),l.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),"Live (updating every 2s)"]}),J.ok?l.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono px-2 py-0.5 rounded-full "+(J.ms<20?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-400":J.ms<80?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400"),children:[l.jsx(g,{className:"h-3.5 w-3.5"}),J.ms.toFixed(1)," ms"]}):l.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono px-2 py-0.5 rounded-full bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500",children:[l.jsx(g,{className:"h-3.5 w-3.5"}),"— ms"]})]})]}),(null==X?void 0:X.is_online)?l.jsx(k,{ref:E,option:Ce,notMerge:!1,lazyUpdate:!0,style:{height:"400px"}}):l.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Subscriber is offline. Live graph is only available when connected."})]})]}),!I&&"invoices"===B&&l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Invoices & Payments"}),l.jsx("div",{className:"table-container",children:l.jsxs("table",{className:"table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Date"}),l.jsx("th",{children:"Invoice #"}),l.jsx("th",{children:"Amount"}),l.jsx("th",{children:"Status"}),l.jsx("th",{children:"Actions"})]})}),l.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.jsx("tr",{children:l.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-8",children:"No invoices found"})})})]})})]}),!I&&"logs"===B&&l.jsxs("div",{className:"card p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Session & Activity Logs"}),l.jsx("div",{className:"table-container",children:l.jsxs("table",{className:"table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Session ID"}),l.jsx("th",{children:"Start Time"}),l.jsx("th",{children:"End Time"}),l.jsx("th",{children:"Duration"}),l.jsx("th",{children:"IP Address"}),l.jsx("th",{children:"MAC Address"}),l.jsx("th",{children:"Download"}),l.jsx("th",{children:"Upload"})]})}),l.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===le.length?l.jsx("tr",{children:l.jsx("td",{colSpan:8,className:"text-center text-gray-500 py-8",children:"No session logs found"})}):le.map((e,a)=>{const s=e.acctstarttime?new Date(e.acctstarttime):null,n=e.acctstoptime?new Date(e.acctstoptime):null,i=!e.acctstoptime;let t="-";if(e.acctsessiontime>0){t=`${Math.floor(e.acctsessiontime/3600)}h ${Math.floor(e.acctsessiontime%3600/60)}m`}else if(s&&!n){const e=new Date-s;t=`${Math.floor(e/36e5)}h ${Math.floor(e%36e5/6e4)}m`}const r=e=>{if(!e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(2)} ${["B","KB","MB","GB"][a]}`};return l.jsxs("tr",{className:i?"bg-green-50":"",children:[l.jsxs("td",{className:"font-mono text-sm",children:[e.acctsessionid,i&&l.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full",children:"Active"})]}),l.jsx("td",{className:"text-sm",children:v(e.acctstarttime)}),l.jsx("td",{className:"text-sm",children:v(e.acctstoptime)}),l.jsx("td",{className:"text-sm",children:t}),l.jsx("td",{className:"font-mono text-sm",children:e.framedipaddress||"-"}),l.jsx("td",{className:"font-mono text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.callingstationid||"-"}),l.jsx("td",{className:"text-sm text-green-600",children:r(e.acctoutputoctets)}),l.jsx("td",{className:"text-sm text-blue-600",children:r(e.acctinputoctets)})]},e.acctsessionid||a)})})]})})]}),ve&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[l.jsx("h3",{className:"text-lg font-semibold mb-4",children:je?"Edit Bandwidth Rule":"Add Bandwidth Rule"}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Rule Type"}),l.jsxs("select",{value:be.rule_type,onChange:e=>Ne({...be,rule_type:e.target.value}),className:"input",children:[l.jsx("option",{value:"internet",children:"Internet Speed"}),l.jsx("option",{value:"cdn",children:"CDN Speed"})]})]}),"cdn"===be.rule_type?l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Select CDN"}),pe.length>0?l.jsxs("select",{value:be.cdn_id||"",onChange:e=>Ne({...be,cdn_id:e.target.value,download_speed:"",upload_speed:""}),className:"input",children:[l.jsx("option",{value:"",children:"Select CDN..."}),pe.map(e=>l.jsx("option",{value:e.cdn_id,children:e.cdn_name},e.cdn_id))]}):l.jsx("p",{className:"text-sm text-gray-500 italic",children:"No CDNs available for this NAS"})]}),be.cdn_id&&l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Select Speed"}),me(be.cdn_id).length>0?l.jsxs("select",{value:be.download_speed||"",onChange:e=>Ne({...be,download_speed:e.target.value,upload_speed:e.target.value}),className:"input",children:[l.jsx("option",{value:"",children:"Select speed..."}),me(be.cdn_id).map((e,a)=>l.jsxs("option",{value:e.speed_limit,children:[e.speed_limit,"M (",e.service_name,")"]},a))]}):l.jsx("p",{className:"text-sm text-gray-500 italic",children:"No speeds configured for this CDN"})]}),xe.length>0&&l.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current service CDNs: ",xe.map(e=>`${e.cdn_name} ${e.speed_limit}M`).join(", ")]})]}):l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Download (kbps)"}),l.jsx("input",{type:"number",value:be.download_speed,onChange:e=>Ne({...be,download_speed:e.target.value}),className:"input",placeholder:"e.g., 50000"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Upload (kbps)"}),l.jsx("input",{type:"number",value:be.upload_speed,onChange:e=>Ne({...be,upload_speed:e.target.value}),className:"input",placeholder:"e.g., 10000"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"label",children:"Duration"}),l.jsxs("select",{value:be.duration,onChange:e=>Ne({...be,duration:e.target.value}),className:"input",children:[l.jsx("option",{value:"permanent",children:"Permanent"}),l.jsx("option",{value:"1h",children:"1 Hour"}),l.jsx("option",{value:"2h",children:"2 Hours"}),l.jsx("option",{value:"6h",children:"6 Hours"}),l.jsx("option",{value:"12h",children:"12 Hours"}),l.jsx("option",{value:"1d",children:"1 Day"}),l.jsx("option",{value:"2d",children:"2 Days"}),l.jsx("option",{value:"7d",children:"7 Days"}),l.jsx("option",{value:"14d",children:"14 Days"}),l.jsx("option",{value:"30d",children:"30 Days"})]}),l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"permanent"===be.duration?"Rule will apply until manually disabled or deleted":"After duration expires, subscriber returns to normal service speed"})]}),l.jsxs("label",{className:"flex items-center gap-3",children:[l.jsx("input",{type:"checkbox",checked:be.enabled,onChange:e=>Ne({...be,enabled:e.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),l.jsx("span",{children:"Enabled"})]})]}),l.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[l.jsx("button",{type:"button",onClick:()=>{ge(!1),fe()},className:"btn btn-secondary",children:"Cancel"}),l.jsx("button",{type:"button",onClick:()=>{const e="cdn"===be.rule_type,a=parseInt(be.download_speed)||0,s=parseInt(be.upload_speed)||0,l={...be,download_speed:e?1e3*a:a,upload_speed:e?1e3*s:s,priority:parseInt(be.priority)||0,cdn_id:be.cdn_id?parseInt(be.cdn_id):0};ke.mutate(l)},disabled:ke.isPending,className:"btn btn-primary",children:ke.isPending?"Saving...":"Save"})]})]})})]})}export{A as default};
