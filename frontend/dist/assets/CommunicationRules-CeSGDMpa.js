import{b as e,u as a,d as t,j as s}from"./data-vendor-C6mPcuPT.js";import{r as l}from"./react-vendor-C4Xey-hE.js";import{y as n}from"./index-DmOIf-MM.js";import"./ui-vendor-CMKyyIMz.js";import"./chart-vendor-Be69IwoK.js";function r(){const r=e(),[i,d]=l.useState(!1),[c,o]=l.useState(null),[m,u]=l.useState({name:"",trigger_event:"expiry_warning",channel:"sms",days_before:3,template:"",enabled:!0,send_to_reseller:!1}),{data:x,isLoading:h}=a({queryKey:["communication-rules"],queryFn:()=>n.get("/communication/rules").then(e=>e.data.data||[])}),{data:p}=a({queryKey:["communication-templates"],queryFn:()=>n.get("/communication/templates").then(e=>e.data.data||[])}),b=t({mutationFn:e=>n.post("/communication/rules",e),onSuccess:()=>{r.invalidateQueries(["communication-rules"]),j()}}),g=t({mutationFn:({id:e,...a})=>n.put(`/communication/rules/${e}`,a),onSuccess:()=>{r.invalidateQueries(["communication-rules"]),j()}}),y=t({mutationFn:e=>n.delete(`/communication/rules/${e}`),onSuccess:()=>r.invalidateQueries(["communication-rules"])}),v=t({mutationFn:({id:e,enabled:a})=>n.put(`/communication/rules/${e}`,{enabled:a}),onSuccess:()=>r.invalidateQueries(["communication-rules"])}),f=[{value:"expiry_warning",label:"Expiry Warning",description:"Send X days before expiry"},{value:"expired",label:"Account Expired",description:"When subscription expires"},{value:"quota_warning",label:"Quota Warning",description:"When quota reaches threshold"},{value:"quota_exceeded",label:"Quota Exceeded",description:"When quota is fully used"},{value:"payment_received",label:"Payment Received",description:"After successful payment"},{value:"account_created",label:"Account Created",description:"When new account is created"},{value:"account_renewed",label:"Account Renewed",description:"When subscription is renewed"},{value:"password_changed",label:"Password Changed",description:"When password is updated"},{value:"session_started",label:"Session Started",description:"When user connects"},{value:"fup_applied",label:"FUP Applied",description:"When FUP limit is reached"}],j=()=>{d(!1),o(null),u({name:"",trigger_event:"expiry_warning",channel:"sms",days_before:3,template:"",enabled:!0,send_to_reseller:!1})},N=e=>{const a=f.find(a=>a.value===e);return a?a.label:e};return h?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Communication Rules"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure automated SMS, Email, and WhatsApp notifications"})]}),s.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Rule"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(x||[]).length}),s.jsx("div",{className:"text-sm text-gray-500",children:"Total Rules"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:(x||[]).filter(e=>e.enabled).length}),s.jsx("div",{className:"text-sm text-gray-500",children:"Active Rules"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(x||[]).filter(e=>"sms"===e.channel).length}),s.jsx("div",{className:"text-sm text-gray-500",children:"SMS Rules"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(x||[]).filter(e=>"email"===e.channel).length}),s.jsx("div",{className:"text-sm text-gray-500",children:"Email Rules"})]})]}),s.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Trigger"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Channel"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Days Before"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(x||[]).map(e=>{return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.send_to_reseller&&s.jsx("div",{className:"text-xs text-gray-500",children:"+ Send to Reseller"})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"text-sm text-gray-900",children:N(e.trigger_event)})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`px-2 py-1 text-xs rounded-full capitalize ${a=e.channel,{sms:"bg-green-100 text-green-800",email:"bg-blue-100 text-blue-800",whatsapp:"bg-emerald-100 text-emerald-800"}[a]||"bg-gray-100 text-gray-800"}`,children:e.channel})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.days_before>0?`${e.days_before} days`:"-"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("button",{onClick:()=>v.mutate({id:e.id,enabled:!e.enabled}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 "+(e.enabled?"bg-blue-600":"bg-gray-200"),children:s.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow transition duration-200 "+(e.enabled?"translate-x-5":"translate-x-0")})})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[s.jsx("button",{onClick:()=>(e=>{o(e),u({name:e.name,trigger_event:e.trigger_event,channel:e.channel,days_before:e.days_before||0,template:e.template,enabled:e.enabled,send_to_reseller:e.send_to_reseller||!1}),d(!0)})(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Edit"}),s.jsx("button",{onClick:()=>{confirm("Delete this rule?")&&y.mutate(e.id)},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id);var a})})]}),0===(x||[]).length&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:'No communication rules configured. Click "Add Rule" to create one.'})]}),i&&s.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:s.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[s.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:j}),s.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:c?"Edit Rule":"Add Communication Rule"}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),c?g.mutate({id:c.id,...m}):b.mutate(m)},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rule Name"}),s.jsx("input",{type:"text",value:m.name,onChange:e=>u({...m,name:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Trigger Event"}),s.jsx("select",{value:m.trigger_event,onChange:e=>u({...m,trigger_event:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:f.map(e=>s.jsxs("option",{value:e.value,children:[e.label," - ",e.description]},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Channel"}),s.jsx("select",{value:m.channel,onChange:e=>u({...m,channel:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[{value:"sms",label:"SMS"},{value:"email",label:"Email"},{value:"whatsapp",label:"WhatsApp"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),["expiry_warning","quota_warning"].includes(m.trigger_event)&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Days Before"}),s.jsx("input",{type:"number",min:"1",max:"30",value:m.days_before,onChange:e=>u({...m,days_before:parseInt(e.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Message Template"}),s.jsx("textarea",{value:m.template,onChange:e=>u({...m,template:e.target.value}),rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Use variables: {username}, {full_name}, {expiry_date}, {service_name}, {balance}"}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Available variables: ","{username}",", ","{full_name}",", ","{expiry_date}",", ","{service_name}",", ","{balance}",", ","{quota_used}",", ","{quota_total}"]})]}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:m.enabled,onChange:e=>u({...m,enabled:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enabled"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:m.send_to_reseller,onChange:e=>u({...m,send_to_reseller:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Also notify Reseller"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),s.jsxs("button",{type:"submit",disabled:b.isPending||g.isPending,className:"px-4 py-2 text-sm text-white bg-blue-600 rounded-md hover:bg-blue-700",children:[c?"Update":"Create"," Rule"]})]})]})]})]})})]})}export{r as default};
