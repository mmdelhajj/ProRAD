import{b as e,u as r,d as a,j as t}from"./data-vendor-DrqtOFCb.js";import{r as s,c as l}from"./react-vendor-_qYBQpt5.js";import{M as d,N as n,O as i,e as o,x as c,u as m,P as x,Q as g,R as u,S as h,T as b,U as y,L as p}from"./index-4adktXTF.js";import{n as v,z as k}from"./ui-vendor-C17HITwC.js";import{F as f}from"./PhotoIcon-CvHog_6Y.js";import{F as j}from"./TrashIcon-3C89j8Vq.js";import"./chart-vendor-CsTzT1mg.js";function N({title:e,titleId:r,...a},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),e?s.createElement("title",{id:r},e):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z"}))}const w=s.forwardRef(N),_=()=>{var l,n,i;const o=e(),[c,m]=s.useState(null),[x,g]=s.useState(""),[u,h]=s.useState(""),[b,y]=s.useState(""),[p,k]=s.useState(""),[f,j]=s.useState("secondary"),[N,w]=s.useState(null),[_,C]=s.useState(!1),[S,P]=s.useState(!1),[M,L]=s.useState(!1),[A,F]=s.useState(""),[T,D]=s.useState(""),[I,R]=s.useState(null),[U,B]=s.useState(!1),{data:W,isLoading:E}=r({queryKey:["cluster-config"],queryFn:async()=>(await d.getConfig()).data.data}),{data:$,isLoading:z,refetch:q}=r({queryKey:["cluster-status"],queryFn:async()=>(await d.getStatus()).data.data,refetchInterval:1e4,enabled:null==W?void 0:W.is_active}),{data:H,refetch:O}=r({queryKey:["cluster-main-status"],queryFn:async()=>(await d.checkMainStatus()).data.data,refetchInterval:3e4,enabled:(null==W?void 0:W.is_active)&&"main"!==(null==W?void 0:W.server_role)}),Q=a({mutationFn:e=>d.setupMain(e),onSuccess:e=>{v.success("Main server configured successfully"),m(null),o.invalidateQueries(["cluster-config"]),o.invalidateQueries(["cluster-status"])},onError:e=>{var r,a;v.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to configure main server")}}),Y=a({mutationFn:e=>d.setupSecondary(e),onSuccess:e=>{v.success("Successfully joined cluster"),m(null),o.invalidateQueries(["cluster-config"]),o.invalidateQueries(["cluster-status"])},onError:e=>{var r,a;v.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to join cluster")}}),G=a({mutationFn:()=>d.leaveCluster(),onSuccess:()=>{v.success("Left cluster successfully"),o.invalidateQueries(["cluster-config"]),o.invalidateQueries(["cluster-status"])},onError:e=>{var r,a;v.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to leave cluster")}}),V=a({mutationFn:e=>d.removeNode(e),onSuccess:()=>{v.success("Node removed from cluster"),o.invalidateQueries(["cluster-status"])},onError:e=>{var r,a;v.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to remove node")}}),K=async()=>{var e,r;C(!0),w(null);try{const e=await d.testConnection({main_server_ip:x,cluster_secret:u});w(e.data)}catch(a){w({success:!1,message:(null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Connection failed"})}finally{C(!1)}},J=()=>{Q.mutate({server_name:b||"Main Server",server_ip:p||(null==W?void 0:W.server_ip)})},X=()=>{x&&u?Y.mutate({main_server_ip:x,cluster_secret:u,server_name:b||"Secondary Server",server_ip:p||(null==W?void 0:W.server_ip),server_role:f}):v.error("Main server IP and cluster secret are required")},Z=async()=>{var e,r;B(!0),R(null);try{const e=await d.testSourceConnection({source_server_ip:A,root_password:T});R(e.data)}catch(a){R({success:!1,message:(null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Connection failed"})}finally{B(!1)}},ee=async()=>{var e,r;if(null==I?void 0:I.success){if(confirm(`Are you sure you want to recover data from ${A}?\n\nThis will:\nâ€¢ Download the full database from the source server\nâ€¢ Replace all data on this server\nâ€¢ Configure this server as the new main\n\nThis process may take a few minutes.`)){L(!0);try{const e=await d.recoverFromServer({source_server_ip:A,root_password:T,become_main:!0});e.data.success?(v.success("Recovery complete! Refreshing page..."),setTimeout(()=>{window.location.reload()},2e3)):v.error(e.data.message||"Recovery failed")}catch(a){v.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Recovery failed")}finally{L(!1)}}}else v.error("Please test the connection first")},re=e=>{switch(e){case"online":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"syncing":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"offline":default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400";case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}},ae=e=>{switch(e){case"online":return"ðŸŸ¢";case"syncing":return"ðŸŸ¡";case"offline":return"âš«";case"error":return"ðŸ”´";default:return"âšª"}};return E?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(null==W?void 0:W.is_active)&&"standalone"!==(null==W?void 0:W.server_role)?t.jsxs("div",{className:"space-y-6",children:["main"!==(null==W?void 0:W.server_role)&&(null==H?void 0:H.can_promote)&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-8 w-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-300",children:"Main Server Offline"}),t.jsxs("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:["Main server (",null==H?void 0:H.main_server_ip,") has been offline for ",null==H?void 0:H.offline_minutes," minutes.",(null==H?void 0:H.main_last_seen)&&t.jsxs("span",{className:"block mt-1",children:["Last seen: ",H.main_last_seen]})]}),t.jsx("p",{className:"mt-2 text-sm text-red-700 dark:text-red-400",children:"Your data is safe on this server. You can promote this server to become the new main server."}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:async()=>{var e,r;if(confirm("Are you sure you want to promote this server to MAIN?\n\nThis will:\nâ€¢ Make this server the primary database\nâ€¢ Allow all write operations\nâ€¢ Stop replication from old main\n\nOnly do this if the main server is offline!")){P(!0);try{const e=await d.promoteToMain();e.data.success?(v.success("Successfully promoted to main server!"),o.invalidateQueries(["cluster-config"]),o.invalidateQueries(["cluster-status"]),o.invalidateQueries(["cluster-main-status"])):v.error(e.data.message||"Failed to promote")}catch(a){v.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Failed to promote to main")}finally{P(!1)}}},disabled:S,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 font-medium text-lg",children:S?t.jsxs("span",{className:"flex items-center",children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Promoting..."]}):"ðŸ”„ Promote to Main Server"})})]})]})}),"main"!==(null==W?void 0:W.server_role)&&(null==H?void 0:H.is_main_online)&&t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("svg",{className:"h-5 w-5 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-400",children:["This is a ",t.jsx("strong",{children:"secondary server"})," (read-only). To create or edit data, use the main server (",null==H?void 0:H.main_server_ip,")."]})]})}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"HA Cluster Status"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Cluster ID: ",t.jsx("span",{className:"font-mono",children:null==W?void 0:W.cluster_id})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${re("online")}`,children:[ae("online")," Active"]}),t.jsx("button",{onClick:()=>q(),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"ðŸ”„"})]})]}),"main"===(null==W?void 0:W.server_role)&&t.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300",children:"Cluster Secret Key"}),t.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400 mt-1",children:"Share this key with secondary servers to join the cluster"})]}),t.jsx("button",{onClick:()=>{navigator.clipboard.writeText((null==W?void 0:W.cluster_secret)||""),v.success("Copied to clipboard")},className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"ðŸ“‹ Copy"})]}),t.jsx("div",{className:"mt-3 p-3 bg-white dark:bg-gray-800 rounded font-mono text-sm",children:null==W?void 0:W.cluster_secret})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Server"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Role"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"IP Address"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Version"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Status"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"DB Sync"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Resources"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Last Seen"}),t.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Actions"})]})}),t.jsx("tbody",{children:null==(n=null==$?void 0:$.nodes)?void 0:n.map(e=>{var r,a;return t.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700",children:[t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.server_name})}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("main"===e.server_role?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"),children:e.server_role})}),t.jsx("td",{className:"py-3 px-4 font-mono text-sm text-gray-600 dark:text-gray-400",children:e.server_ip}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",children:e.version||"Unknown"})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${re(e.status)}`,children:[ae(e.status)," ",e.status]})}),t.jsx("td",{className:"py-3 px-4",children:t.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${re(e.db_sync_status)}`,children:[e.db_sync_status,e.db_replication_lag>0&&t.jsxs("span",{className:"ml-1",children:["(",e.db_replication_lag,"s lag)"]})]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{title:"CPU",children:["ðŸ’» ",null==(r=e.cpu_usage)?void 0:r.toFixed(0),"%"]}),t.jsxs("span",{title:"Memory",children:["ðŸ§  ",null==(a=e.memory_usage)?void 0:a.toFixed(0),"%"]})]})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-400",children:e.last_heartbeat?new Date(e.last_heartbeat).toLocaleTimeString():"Never"}),t.jsx("td",{className:"py-3 px-4",children:"main"!==e.server_role&&"main"===(null==W?void 0:W.server_role)&&t.jsx("button",{onClick:()=>{confirm(`Remove ${e.server_name} from cluster?`)&&V.mutate(e.id)},className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})})]},e.id)})})]})}),t.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[t.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[(null==$?void 0:$.online_nodes)||0,"/",(null==$?void 0:$.total_nodes)||0]}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Nodes Online"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(null==$?void 0:$.db_replication_ok)?"âœ“":"âœ—"}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"DB Replication"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white capitalize",children:null==W?void 0:W.server_role}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"This Server Role"})]})]})]}),(null==(i=null==$?void 0:$.events)?void 0:i.length)>0&&t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Recent Cluster Events"}),t.jsx("div",{className:"space-y-2",children:$.events.map(e=>t.jsxs("div",{className:"p-3 rounded-lg "+("error"===e.severity?"bg-red-50 dark:bg-red-900/30":"warning"===e.severity?"bg-yellow-50 dark:bg-yellow-900/30":"bg-gray-50 dark:bg-gray-700"),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.event_type}),t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.created_at).toLocaleString()})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description})]},e.id))})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Cluster Actions"}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsx("button",{onClick:()=>q(),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"ðŸ”„ Force Sync"}),"main"!==(null==W?void 0:W.server_role)&&t.jsx("button",{onClick:()=>{confirm("Are you sure you want to leave the cluster?")&&G.mutate()},disabled:G.isPending,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:G.isPending?"Leaving...":"âŒ Leave Cluster"}),"main"===(null==W?void 0:W.server_role)&&1===(null==$?void 0:$.total_nodes)&&t.jsx("button",{onClick:()=>{confirm("Dissolve the cluster and return to standalone mode?")&&G.mutate()},disabled:G.isPending,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:G.isPending?"Dissolving...":"âŒ Dissolve Cluster"})]})]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"HA Cluster Configuration"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Set up High Availability clustering to improve performance, redundancy, and backup capabilities."}),c?"recover"===c?t.jsxs("div",{className:"max-w-lg",children:[t.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-4",children:"Recover Data from Existing Server"}),t.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-4 mb-4",children:[t.jsx("h5",{className:"font-medium text-orange-900 dark:text-orange-300 mb-2",children:"âš ï¸ Important"}),t.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400",children:"This will download all data from the source server and replace any existing data on this server. Make sure the source server is running and accessible."})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Source Server IP Address *"}),t.jsx("input",{type:"text",value:A,onChange:e=>F(e.target.value),placeholder:"10.0.0.219",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The IP of your existing ProISP server with the data"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Root Password *"}),t.jsx("input",{type:"password",value:T,onChange:e=>D(e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SSH root password for the source server"})]}),t.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[t.jsx("button",{onClick:Z,disabled:U||!A||!T,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:U?"Testing...":"ðŸ” Test Connection"}),I&&t.jsxs("div",{className:"mt-3 p-3 rounded-lg "+(I.success?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"),children:[t.jsx("p",{className:"font-medium "+(I.success?"text-green-800 dark:text-green-400":"text-red-800 dark:text-red-400"),children:I.success?"âœ“ Connection successful":"âœ— Connection failed"}),I.success&&I.data&&t.jsxs("div",{className:"mt-2 text-sm text-green-700 dark:text-green-400",children:[t.jsxs("p",{children:["SSH: ",I.data.ssh_ok?"âœ“":"âœ—"]}),t.jsxs("p",{children:["Database: ",I.data.database_ok?"âœ“":"âœ—"]}),t.jsxs("p",{children:["Subscribers: ",(null==(l=I.data.subscribers)?void 0:l.toLocaleString())||0]})]}),I.message&&!I.success&&t.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:I.message})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:ee,disabled:M||!(null==I?void 0:I.success),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50",children:M?"Recovering... Please wait":"ðŸ“¥ Recover Data"}),t.jsx("button",{onClick:()=>{m(null),R(null)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})]})]})]}):"main"===c?t.jsxs("div",{className:"max-w-lg",children:[t.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-4",children:"Configure as Main Server"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Server Name"}),t.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"Main Server",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Server IP Address"}),t.jsx("input",{type:"text",value:p||(null==W?void 0:W.server_ip)||"",onChange:e=>k(e.target.value),placeholder:(null==W?void 0:W.server_ip)||"Auto-detect",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to auto-detect"})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsx("h5",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"What happens next?"}),t.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-400 space-y-1",children:[t.jsx("li",{children:"â€¢ A unique Cluster ID and Secret will be generated"}),t.jsx("li",{children:"â€¢ PostgreSQL will be configured for replication"}),t.jsx("li",{children:"â€¢ Redis will be configured as primary"}),t.jsx("li",{children:"â€¢ You'll receive the cluster secret to share with secondary servers"})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:J,disabled:Q.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:Q.isPending?"Configuring...":"Configure as Main"}),t.jsx("button",{onClick:()=>m(null),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})]})]})]}):t.jsxs("div",{className:"max-w-lg",children:[t.jsx("h4",{className:"text-md font-medium text-gray-900 dark:text-white mb-4",children:"Join Cluster as Secondary"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Main Server IP Address *"}),t.jsx("input",{type:"text",value:x,onChange:e=>g(e.target.value),placeholder:"192.168.1.10",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cluster Secret Key *"}),t.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"xxxx-xxxx-xxxx-xxxx",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Get this from the main server's cluster settings"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Server Role"}),t.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"secondary",children:"Secondary (Failover + RADIUS backup)"}),t.jsx("option",{value:"server3",children:"Server 3 (Read-only + Reports)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Server Name"}),t.jsx("input",{type:"text",value:b,onChange:e=>y(e.target.value),placeholder:"Secondary Server",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),t.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[t.jsx("button",{onClick:K,disabled:_||!x,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:_?"Testing...":"ðŸ” Test Connection"}),N&&t.jsxs("div",{className:"mt-3 p-3 rounded-lg "+(N.success?"bg-green-50 dark:bg-green-900/30":"bg-red-50 dark:bg-red-900/30"),children:[t.jsx("p",{className:"font-medium "+(N.success?"text-green-800 dark:text-green-400":"text-red-800 dark:text-red-400"),children:N.success?"âœ“ Connection successful":"âœ— Connection failed"}),N.success&&t.jsxs("div",{className:"mt-2 text-sm text-green-700 dark:text-green-400",children:[t.jsxs("p",{children:["API: ",N.api_ok?"âœ“":"âœ—"]}),t.jsxs("p",{children:["Database: ",N.db_ok?"âœ“":"âœ—"]}),t.jsxs("p",{children:["Redis: ",N.redis_ok?"âœ“":"âœ—"]})]}),N.message&&!N.success&&t.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:N.message})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:X,disabled:Y.isPending||!x||!u,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:Y.isPending?"Joining...":"Join Cluster"}),t.jsx("button",{onClick:()=>m(null),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})]})]})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:border-blue-500 dark:hover:border-blue-500 cursor-pointer transition-colors",onClick:()=>m("main"),children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Main Server"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Primary node"})]})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Configure this server as the main (primary) server. Other servers will replicate from this server."}),t.jsxs("ul",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"â€¢ Database primary (all writes)"}),t.jsx("li",{children:"â€¢ Redis primary"}),t.jsx("li",{children:"â€¢ RADIUS primary"}),t.jsx("li",{children:"â€¢ API active"})]})]}),t.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:border-green-500 dark:hover:border-green-500 cursor-pointer transition-colors",onClick:()=>m("secondary"),children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Secondary Server"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Replica node"})]})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Join an existing cluster as a secondary server. Data will be replicated from the main server."}),t.jsxs("ul",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"â€¢ Database replica (real-time sync)"}),t.jsx("li",{children:"â€¢ Redis replica"}),t.jsx("li",{children:"â€¢ RADIUS backup"}),t.jsx("li",{children:"â€¢ API standby (auto-failover)"})]})]})]}),t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:t.jsxs("div",{className:"border border-orange-200 dark:border-orange-700 rounded-lg p-6 hover:border-orange-500 dark:hover:border-orange-500 cursor-pointer transition-colors bg-orange-50 dark:bg-orange-900/20",onClick:()=>m("recover"),children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center",children:t.jsx("svg",{className:"w-6 h-6 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Recover from Existing Server"}),t.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Disaster Recovery"})]})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Restore data from an existing server. Use this if you're replacing a failed main server or migrating to new hardware."}),t.jsxs("ul",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"â€¢ Download full database backup"}),t.jsx("li",{children:"â€¢ Restore all subscribers and settings"}),t.jsx("li",{children:"â€¢ Sync uploads (logo, favicon)"}),t.jsx("li",{children:"â€¢ Become the new main server"})]})]})})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Current Server Information"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Server IP:"}),t.jsx("p",{className:"font-mono text-gray-900 dark:text-white",children:(null==W?void 0:W.server_ip)||"Unknown"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Hardware ID:"}),t.jsx("p",{className:"font-mono text-gray-900 dark:text-white truncate",children:(null==W?void 0:W.hardware_id)||"Unknown"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Database ID:"}),t.jsx("p",{className:"font-mono text-gray-900 dark:text-white truncate",children:(null==W?void 0:W.database_id)||"Unknown"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Status:"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:"Standalone"})]})]})]})]})};function C(){const[e,r]=s.useState(!0),[a,l]=s.useState(null),[d,m]=s.useState(!1),[x,g]=s.useState({interface:"eth0",ip_address:"",gateway:"",dns1:"8.8.8.8",dns2:"8.8.4.4",dns_method:"netplan"}),[u,h]=s.useState([]),[b,y]=s.useState(!1),[p,v]=s.useState(60),[f,j]=s.useState(null);s.useEffect(()=>{w(),N()},[]);const N=async()=>{try{const e=await n.detectDNSMethod();if(e.data.success){const r=e.data.data;g(e=>({...e,dns_method:r.detected_method})),"netplan"===r.detected_method&&r.netplan_dns.length>0?g(e=>({...e,dns1:r.netplan_dns[0]||"8.8.8.8",dns2:r.netplan_dns[1]||"8.8.4.4"})):"resolv"===r.detected_method&&r.resolv_dns.length>0&&g(e=>({...e,dns1:r.resolv_dns[0]||"8.8.8.8",dns2:r.resolv_dns[1]||"8.8.4.4"}))}}catch(e){}},w=async()=>{try{r(!0);const e=await n.getCurrentConfig();if(e.data.success){const r=e.data.data;if(l(r),r.current_ip_info){const e=r.current_ip_info.split("\n"),a=new Map;let t=null;for(let r=0;r<e.length;r++){const s=e[r],l=s.match(/\d+:\s+([^:@\s]+)/);if(l){t=l[1];const e=t.startsWith("docker")||t.startsWith("br-")||t.startsWith("veth");"lo"===t||e||a.has(t)||a.set(t,{name:t,ip:"No IPv4"})}const d=s.match(/inet\s+(\d+\.\d+\.\d+\.\d+\/\d+)/);d&&t&&a.has(t)&&!d[1].startsWith("127.")&&a.set(t,{name:t,ip:d[1]})}const s=Array.from(a.values());h(s);const l=s.find(e=>"No IPv4"!==e.ip)||s[0];l&&g(e=>({...e,interface:l.name,ip_address:"No IPv4"!==l.ip?l.ip:""}))}if(r.current_routes){const e=r.current_routes.match(/default via\s+(\d+\.\d+\.\d+\.\d+)/);e&&g(r=>({...r,gateway:e[1]}))}if(r.netplan_config){const e=r.netplan_config.split("\n"),a=[];let t=!1;const s=r.netplan_config.includes("dhcp4: true")||r.netplan_config.includes("dhcp4:true")||r.netplan_config.includes("dhcp6: true")||r.netplan_config.includes("dhcp6:true");m(s),s&&k.warning("âš ï¸ DHCP Detected: Server is using automatic IP. Consider converting to static IP for stability.",{duration:6e3});for(const r of e)if(r.includes("nameservers:"))t=!0;else if(!t||!r.includes("addresses:")){if(t&&r.trim().startsWith("- ")){const e=r.trim().replace(/^-\s*/,"");a.push(e)}!t||r.trim().startsWith("-")||""===r.trim()||r.includes("addresses:")||(t=!1)}a.length>0&&g(e=>({...e,dns1:a[0]||"8.8.8.8",dns2:a[1]||"8.8.4.4"}))}}}catch(e){k.error("Failed to load current network configuration")}finally{r(!1)}};s.useEffect(()=>{let e;return b&&p>0&&(e=setInterval(()=>{v(e=>e<=1?(y(!1),j(null),k.info("Test mode ended - settings reverted"),60):e-1)},1e3)),()=>clearInterval(e)},[b,p]);const _=async(e,r)=>{if(g(a=>({...a,[e]:r})),"dns_method"===e)try{const e=await n.detectDNSMethod();if(e.data.success){const a=e.data.data;"netplan"===r&&a.netplan_dns.length>0?(g(e=>({...e,dns1:a.netplan_dns[0]||"8.8.8.8",dns2:a.netplan_dns[1]||"8.8.4.4",dns_method:r})),k.success(`Loaded DNS from netplan: ${a.netplan_dns.join(", ")}`,{duration:3e3})):"resolv"===r&&a.resolv_dns.length>0?(g(e=>({...e,dns1:a.resolv_dns[0]||"8.8.8.8",dns2:a.resolv_dns[1]||"8.8.4.4",dns_method:r})),k.success(`Loaded DNS from resolv.conf: ${a.resolv_dns.join(", ")}`,{duration:3e3})):k.info(`No DNS found in ${r}, keeping current values`,{duration:3e3})}}catch(a){}};return e&&!a?t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})}):t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Network Configuration"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Configure server network settings (IP, Gateway, DNS)"})]}),t.jsx("button",{onClick:w,disabled:e,className:"text-sm text-primary-600 hover:text-primary-700 disabled:opacity-50",children:"Refresh"})]}),d&&t.jsx("div",{className:"mb-4 bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 dark:border-orange-600 p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(i,{className:"w-6 h-6 text-orange-600 dark:text-orange-500 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h5",{className:"text-sm font-semibold text-orange-800 dark:text-orange-400 mb-1",children:"âš ï¸ DHCP Detected - Automatic IP Configuration"}),t.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 mb-2",children:["Your server is currently using ",t.jsx("strong",{children:"DHCP (automatic IP assignment)"}),". This means your IP address may change unexpectedly, causing service interruptions."]}),t.jsxs("div",{className:"text-sm text-orange-700 dark:text-orange-300 space-y-1",children:[t.jsx("p",{children:t.jsx("strong",{children:"Current DHCP-assigned values:"})}),t.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[t.jsxs("li",{children:["IP Address: ",x.ip_address||"Loading..."]}),t.jsxs("li",{children:["Gateway: ",x.gateway||"Loading..."]}),t.jsxs("li",{children:["DNS: ",x.dns1,", ",x.dns2]})]})]}),t.jsx("div",{className:"mt-3 p-3 bg-orange-100 dark:bg-orange-900/40 rounded border border-orange-200 dark:border-orange-700",children:t.jsxs("p",{className:"text-sm font-medium text-orange-900 dark:text-orange-200",children:["ðŸ’¡ ",t.jsx("strong",{children:"Recommendation:"}),' Click "Test Configuration" below to convert DHCP to a permanent static IP. This will ensure your server maintains the same IP address and prevents connectivity issues.']})})]})]})}),t.jsx("div",{className:"mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(i,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-500 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-500",children:"Caution: Network Configuration"}),t.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400 mt-1",children:"Changing network settings incorrectly may cause loss of connectivity. Always test first before applying permanently. Test mode will automatically revert after 60 seconds if not confirmed."})]})]})}),b&&t.jsx("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsx(o,{className:"w-5 h-5 text-blue-600 dark:text-blue-500 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("h5",{className:"text-sm font-medium text-blue-800 dark:text-blue-500",children:"Test Mode Active"}),t.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400 mt-1",children:["Settings will auto-revert in ",t.jsx("strong",{children:p}),' seconds. Click "Apply Permanently" to keep these settings.']})]})]}),t.jsxs("button",{onClick:async()=>{var e,a;try{r(!0);(await n.applyConfig(x)).data.success&&(y(!1),v(60),j(null),k.success("Network settings applied permanently"),w())}catch(t){k.error((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"Failed to apply network configuration permanently")}finally{r(!1)}},disabled:e,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md disabled:opacity-50",children:[t.jsx(c,{className:"w-4 h-4 mr-2"}),d?"Confirm: Convert to Static IP":"Apply Permanently"]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Network Interface"}),u.length>=1?t.jsx("select",{value:x.interface,onChange:e=>{const r=e.target.value,a=u.find(e=>e.name===r);a&&(g(e=>({...e,interface:a.name,ip_address:a.ip})),k.success(`Switched to ${a.name} (${a.ip})`))},className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",children:u.map(e=>t.jsxs("option",{value:e.name,children:[e.name," (",e.ip,")"]},e.name))}):t.jsx("input",{type:"text",value:x.interface,onChange:e=>_("interface",e.target.value),placeholder:"eth0, ens3, enp0s3",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:u.length>=1?`${u.length} interface${u.length>1?"s":""} detected`:"Common: eth0, ens3, enp0s3"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"IP Address / CIDR"}),t.jsx("input",{type:"text",value:x.ip_address,onChange:e=>_("ip_address",e.target.value),placeholder:"192.168.1.100/24",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Example: 192.168.1.100/24"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Gateway"}),t.jsx("input",{type:"text",value:x.gateway,onChange:e=>_("gateway",e.target.value),placeholder:"192.168.1.1",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Example: 192.168.1.1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Primary DNS"}),t.jsx("input",{type:"text",value:x.dns1,onChange:e=>_("dns1",e.target.value),placeholder:"8.8.8.8",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Default: 8.8.8.8 (Google DNS)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Secondary DNS"}),t.jsx("input",{type:"text",value:x.dns2,onChange:e=>_("dns2",e.target.value),placeholder:"8.8.4.4",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Default: 8.8.4.4 (Google DNS)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"DNS Configuration Method"}),t.jsxs("select",{value:x.dns_method,onChange:e=>_("dns_method",e.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",children:[t.jsx("option",{value:"netplan",children:"Netplan + systemd-resolved (Ubuntu/Debian)"}),t.jsx("option",{value:"resolv",children:"Direct /etc/resolv.conf (Traditional)"})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Netplan: Modern Ubuntu/Debian | resolv.conf: Traditional/Other distros"})]})]}),t.jsxs("div",{className:"mt-6 flex gap-4",children:[t.jsx("button",{onClick:async()=>{var e,a,t,s;if(x.interface&&x.ip_address&&x.gateway)try{r(!0);const e=await n.testConfig(x);if(e.data.success)if(e.data.test_mode)y(!0),v(e.data.revert_seconds||60),k.success('TEST MODE: You have 60 seconds to access the new IP and click "Save Changes"',{duration:8e3});else{const r=e.data.message||"Network configuration saved";k.success(r,{duration:5e3})}}catch(l){const r=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"Failed to apply network configuration",d=null==(s=null==(t=l.response)?void 0:t.data)?void 0:s.error;k.error(d?`${r}: ${d}`:r,{duration:8e3})}finally{r(!1)}else k.error("Interface, IP address, and gateway are required")},disabled:e||b,className:"inline-flex items-center px-6 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-md disabled:opacity-50",children:e?"Applying...":d?"Convert DHCP â†’ Static (Test 60s)":"Test (60s)"}),b&&t.jsx("button",{onClick:()=>{y(!1),v(60),j(null),k.info("Test mode cancelled")},className:"inline-flex items-center px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:"Cancel Test"})]})]})}function S(){var d,n,o,v,N,S,P,M,L,A,F,T,D,I,R,U,B,W,E,$,z,q,H,O,Q,Y,G,V,K,J,X,Z,ee,re,ae,te,se,le;const de=e(),{user:ne,refreshUser:ie}=m(),{companyName:oe,companyLogo:ce,loginBackground:me,favicon:xe,footerText:ge,primaryColor:ue,fetchBranding:he,updateBranding:be}=x(),[ye,pe]=l(),ve=["branding","general","billing","service_change","radius","notifications","security","account","license","cluster","system","ssl"],ke=ye.get("tab"),fe=ke&&ve.includes(ke)?ke:"branding",[je,Ne]=s.useState(fe);s.useEffect(()=>{const e=ye.get("tab");e&&ve.includes(e)&&e!==je&&Ne(e)},[ye]);const[we,_e]=s.useState({}),[Ce,Se]=s.useState(!1),Pe=s.useRef(null),Me=s.useRef(null),Le=s.useRef(null),[Ae,Fe]=s.useState(!1),[Te,De]=s.useState(!1),[Ie,Re]=s.useState(!1),[Ue,Be]=s.useState(null),[We,Ee]=s.useState(""),[$e,ze]=s.useState(""),[qe,He]=s.useState(""),[Oe,Qe]=s.useState(!1),[Ye,Ge]=s.useState(!1),[Ve,Ke]=s.useState(!1),[Je,Xe]=s.useState(""),[Ze,er]=s.useState(""),[rr,ar]=s.useState(""),[tr,sr]=s.useState(""),[lr,dr]=s.useState(""),[nr,ir]=s.useState(!1),[or,cr]=s.useState(null),mr=s.useRef(null),[xr,gr]=s.useState([]),[ur,hr]=s.useState(!1),[br,yr]=s.useState(""),[pr,vr]=s.useState([]),[kr,fr]=s.useState(!1),[jr,Nr]=s.useState(""),[wr,_r]=s.useState(!1),[Cr,Sr]=s.useState(null),[Pr,Mr]=s.useState(""),[Lr,Ar]=s.useState(""),[Fr,Tr]=s.useState([]),[Dr,Ir]=s.useState(!1),Rr=s.useRef(null),{data:Ur,isLoading:Br}=r({queryKey:["settings"],queryFn:()=>g.get("/settings").then(e=>e.data.items||[])}),{data:Wr}=r({queryKey:["timezones"],queryFn:()=>g.get("/settings/timezones").then(e=>e.data.data||[])});s.useEffect(()=>{if(Ur){const e={};Ur.forEach(r=>{e[r.key]=r.value}),_e(e),Se(!1)}},[Ur]),s.useEffect(()=>{"notifications"===je&&(oa(),ca())},[je]);const Er=a({mutationFn:e=>g.put("/settings/bulk",{settings:e}),onSuccess:()=>{de.invalidateQueries(["settings"]),Se(!1),we.system_timezone&&y(we.system_timezone),k.success("Settings saved successfully")}}),{data:$r,refetch:zr}=r({queryKey:["2fa-status"],queryFn:()=>g.get("/auth/2fa/status").then(e=>e.data.data),enabled:"account"===je}),qr=a({mutationFn:()=>g.post("/auth/2fa/setup"),onSuccess:e=>{Be(e.data.data)},onError:e=>{var r,a;k.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to setup 2FA")}}),Hr=a({mutationFn:e=>g.post("/auth/2fa/verify",{code:e}),onSuccess:()=>{k.success("2FA enabled successfully!"),Be(null),Ee(""),zr(),ie()},onError:e=>{var r,a;k.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Invalid code")}}),Or=a({mutationFn:e=>g.post("/auth/2fa/disable",e),onSuccess:()=>{k.success("2FA disabled successfully"),ze(""),He(""),zr(),ie()},onError:e=>{var r,a;k.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to disable 2FA")}}),Qr=(e,r)=>{_e(a=>({...a,[e]:r})),Se(!0)},Yr=()=>{const e=Object.entries(we).map(([e,r])=>({key:e,value:String(r)}));Er.mutate(e)},{data:Gr,isLoading:Vr,refetch:Kr}=r({queryKey:["license",je],queryFn:()=>g.get("/license").then(e=>e.data.data),enabled:"license"===je,staleTime:0,refetchOnMount:"always"}),{data:Jr,refetch:Xr}=r({queryKey:["license-status-detail",je],queryFn:()=>g.get("/license/status").then(e=>e.data),enabled:"license"===je,staleTime:0,refetchOnMount:"always"}),Zr=a({mutationFn:()=>g.post("/license/revalidate"),onSuccess:e=>{e.data.success?k.success("License validated successfully"):k.error(e.data.message||"License validation failed"),Kr(),Xr(),de.invalidateQueries(["license-status"])},onError:e=>{var r,a;k.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to validate license")}}),{data:ea,refetch:ra}=r({queryKey:["ssl-status"],queryFn:()=>u.getSSLStatus().then(e=>e.data),enabled:"system"===je||"ssl"===je,staleTime:3e4});s.useEffect(()=>{(null==ea?void 0:ea.domain)&&!Pr&&Mr(ea.domain)},[ea]);const{data:aa,refetch:ta,isLoading:sa}=r({queryKey:["system-update-check",je],queryFn:()=>g.get("/system/update/check").then(e=>e.data),enabled:"license"===je,staleTime:0,refetchOnMount:"always"}),la=a({mutationFn:()=>g.get("/system/update/check").then(e=>e.data),onSuccess:e=>{e.update_available?k.success(`Update available: v${e.new_version}`):k.success("You are running the latest version"),de.invalidateQueries(["system-update-check"])},onError:e=>{var r,a;k.error((null==(a=null==(r=e.response)?void 0:r.data)?void 0:a.message)||"Failed to check for updates")}}),{data:da,isLoading:na,refetch:ia}=r({queryKey:["system-info",je],queryFn:()=>p.systemInfo().then(e=>e.data.data),enabled:"system"===je,staleTime:3e4,refetchOnMount:"always"}),oa=async()=>{try{const e=await g.get("/notifications/proxrad/access");cr(e.data)}catch{}},ca=async(e="")=>{hr(!0);try{const r=await g.get("/notifications/whatsapp/subscribers",{params:{search:e}});r.data.success&&gr(r.data.subscribers||[])}catch(r){}hr(!1)};if(Br)return t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const ma=e=>{const r=we[e.key]||"";if("toggle"===e.type){const a="true"===r||"1"===r||!0===r;return t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:()=>Qr(e.key,a?"false":"true"),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 "+(a?"bg-blue-600":"bg-gray-200 dark:bg-gray-600"),children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white dark:bg-gray-800 shadow ring-0 transition duration-200 ease-in-out "+(a?"translate-x-5":"translate-x-0")})}),e.description&&t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:e.description})]})}return"timezone"===e.type?t.jsxs("div",{children:[t.jsxs("select",{value:r,onChange:r=>Qr(e.key,r.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[t.jsx("option",{value:"",children:"Select timezone..."}),(Wr||[]).map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]}),e.description&&t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:e.description})]}):"select"===e.type?t.jsxs("select",{value:r,onChange:r=>Qr(e.key,r.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[t.jsx("option",{value:"",children:"Select..."}),e.options.map(e=>t.jsx("option",{value:e,children:e},e))]}):"textarea"===e.type?t.jsx("textarea",{value:r,onChange:r=>Qr(e.key,r.target.value),placeholder:e.placeholder,rows:3,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}):t.jsxs("div",{children:[t.jsx("input",{type:e.type,value:r,onChange:r=>Qr(e.key,r.target.value),placeholder:e.placeholder,step:"number"===e.type?"0.01":void 0,className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.description&&t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:e.description})]})};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Settings"}),t.jsxs("div",{className:"flex space-x-3",children:[Ce&&t.jsx("button",{onClick:()=>{if(Ur){const e={};Ur.forEach(r=>{e[r.key]=r.value}),_e(e),Se(!1)}},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:bg-gray-700",children:"Reset"}),t.jsx("button",{onClick:Yr,disabled:!Ce||Er.isPending,className:"px-4 py-2 text-sm font-medium text-white rounded-md "+(Ce?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"),children:Er.isPending?"Saving...":"Save Changes"})]})]}),Er.isSuccess&&t.jsx("div",{className:"bg-green-50 dark:bg-green-900/30 border border-green-200 text-green-700 px-4 py-3 rounded",children:"Settings saved successfully!"}),Er.isError&&t.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border border-red-200 text-red-700 px-4 py-3 rounded",children:"Failed to save settings. Please try again."}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:[t.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:t.jsx("nav",{className:"flex -mb-px",children:[{id:"branding",label:"Branding"},{id:"general",label:"General"},{id:"billing",label:"Billing"},{id:"service_change",label:"Service Change"},{id:"radius",label:"RADIUS"},{id:"notifications",label:"Notifications"},{id:"security",label:"Security"},{id:"account",label:"My Account"},{id:"license",label:"License"},{id:"cluster",label:"HA Cluster"},{id:"system",label:"Network"},{id:"ssl",label:"SSL Certificate"}].map(e=>t.jsx("button",{onClick:()=>{return r=e.id,Ne(r),void pe({tab:r},{replace:!0});var r},className:"px-6 py-4 text-sm font-medium border-b-2 "+(je===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:e.label},e.id))})}),t.jsx("div",{className:"p-6",children:"branding"===je?t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Company Name"}),t.jsx("input",{type:"text",value:we.company_name||"",onChange:e=>Qr("company_name",e.target.value),placeholder:"Your Company Name",className:"block w-full max-w-md rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"This name appears in the sidebar and login page"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Company Logo"}),t.jsxs("div",{className:"flex items-start gap-6",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-32 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-700 overflow-hidden",children:ce?t.jsx("img",{src:ce,alt:"Company Logo",className:"max-w-full max-h-full object-contain"}):t.jsx(f,{className:"w-12 h-12 text-gray-400"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{ref:Pe,type:"file",accept:"image/png,image/jpeg,image/jpg,image/svg+xml,image/webp",onChange:async e=>{var r,a,t;const s=null==(r=e.target.files)?void 0:r[0];if(!s)return;if(!["image/png","image/jpeg","image/jpg","image/svg+xml","image/webp"].includes(s.type))return void k.error("Invalid file type. Use PNG, JPG, SVG, or WEBP");if(s.size>2097152)return void k.error("File too large. Maximum size is 2MB");Fe(!0);const l=new FormData;l.append("logo",s);try{const e=await u.uploadLogo(l);e.data.success&&(k.success("Logo uploaded successfully"),be({company_logo:e.data.data.url}),de.invalidateQueries(["settings"]))}catch(d){k.error((null==(t=null==(a=d.response)?void 0:a.data)?void 0:t.message)||"Failed to upload logo")}finally{Fe(!1),Pe.current&&(Pe.current.value="")}},className:"hidden"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=Pe.current)?void 0:e.click()},disabled:Ae,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 w-fit",children:[t.jsx(f,{className:"w-4 h-4 mr-2"}),Ae?"Uploading...":"Upload Logo"]}),ce&&t.jsxs("button",{type:"button",onClick:async()=>{if(ce)try{await u.deleteLogo(),k.success("Logo deleted"),be({company_logo:""}),de.invalidateQueries(["settings"])}catch(e){k.error("Failed to delete logo")}},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-red-600 bg-white dark:bg-gray-700 border border-red-300 dark:border-red-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 w-fit",children:[t.jsx(j,{className:"w-4 h-4 mr-2"}),"Remove Logo"]})]}),t.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:["Recommended: ",t.jsx("strong",{children:"180 x 36 pixels"})," (horizontal logo). PNG with transparent background, max 2MB."]})]})]})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[t.jsx(w,{className:"w-4 h-4 inline mr-1"}),"Primary Color"]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{type:"color",value:we.primary_color||"#2563eb",onChange:e=>Qr("primary_color",e.target.value),className:"w-16 h-10 rounded border border-gray-300 dark:border-gray-600 cursor-pointer"}),t.jsx("input",{type:"text",value:we.primary_color||"#2563eb",onChange:e=>Qr("primary_color",e.target.value),placeholder:"#2563eb",className:"w-32 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),t.jsx("div",{className:"flex gap-2",children:["#2563eb","#10b981","#8b5cf6","#f59e0b","#ef4444","#06b6d4"].map(e=>t.jsx("button",{type:"button",onClick:()=>Qr("primary_color",e),className:"w-8 h-8 rounded-full border-2 border-white dark:border-gray-600 shadow-sm hover:scale-110 transition-transform",style:{backgroundColor:e},title:e},e))})]}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Used for buttons, links, and accent elements throughout the app"})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Login Page Background"}),t.jsxs("div",{className:"flex items-start gap-6",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-48 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gradient-to-br from-blue-600 to-indigo-800 overflow-hidden",children:me?t.jsx("img",{src:me,alt:"Login Background",className:"w-full h-full object-cover"}):t.jsx("span",{className:"text-white text-xs",children:"Default Gradient"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{ref:Me,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:async e=>{var r,a,t;const s=null==(r=e.target.files)?void 0:r[0];if(!s)return;if(s.size>5242880)return void k.error("File too large. Maximum size is 5MB");De(!0);const l=new FormData;l.append("background",s);try{const e=await u.uploadLoginBackground(l);e.data.success&&(k.success("Login background uploaded successfully"),be({login_background:e.data.data.url}),de.invalidateQueries(["settings"]))}catch(d){k.error((null==(t=null==(a=d.response)?void 0:a.data)?void 0:t.message)||"Failed to upload background")}finally{De(!1),Me.current&&(Me.current.value="")}},className:"hidden"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=Me.current)?void 0:e.click()},disabled:Te,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 w-fit",children:[t.jsx(f,{className:"w-4 h-4 mr-2"}),Te?"Uploading...":"Upload Background"]}),me&&t.jsxs("button",{type:"button",onClick:async()=>{if(me)try{await u.deleteLoginBackground(),k.success("Login background deleted"),be({login_background:""}),de.invalidateQueries(["settings"])}catch(e){k.error("Failed to delete background")}},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-red-600 bg-white dark:bg-gray-700 border border-red-300 dark:border-red-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 w-fit",children:[t.jsx(j,{className:"w-4 h-4 mr-2"}),"Use Default Gradient"]})]}),t.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:["Recommended: ",t.jsx("strong",{children:"1920 x 1080 pixels"}),". JPG or PNG, max 5MB.",t.jsx("br",{}),"This image appears on the left side of the login page."]})]})]})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Favicon (Browser Tab Icon)"}),t.jsxs("div",{className:"flex items-start gap-6",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-16 h-16 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-700 overflow-hidden",children:xe?t.jsx("img",{src:xe,alt:"Favicon",className:"w-8 h-8 object-contain"}):t.jsx("span",{className:"text-gray-400 text-xl",children:"ðŸŒ"})})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("input",{ref:Le,type:"file",accept:"image/png,image/x-icon,image/svg+xml",onChange:async e=>{var r,a,t;const s=null==(r=e.target.files)?void 0:r[0];if(!s)return;if(s.size>512e3)return void k.error("File too large. Maximum size is 500KB");Re(!0);const l=new FormData;l.append("favicon",s);try{const e=await u.uploadFavicon(l);e.data.success&&(k.success("Favicon uploaded successfully"),be({favicon:e.data.data.url}),de.invalidateQueries(["settings"]))}catch(d){k.error((null==(t=null==(a=d.response)?void 0:a.data)?void 0:t.message)||"Failed to upload favicon")}finally{Re(!1),Le.current&&(Le.current.value="")}},className:"hidden"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=Le.current)?void 0:e.click()},disabled:Ie,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 w-fit",children:[t.jsx(f,{className:"w-4 h-4 mr-2"}),Ie?"Uploading...":"Upload Favicon"]}),xe&&t.jsxs("button",{type:"button",onClick:async()=>{if(xe)try{await u.deleteFavicon(),k.success("Favicon deleted"),be({favicon:""}),de.invalidateQueries(["settings"])}catch(e){k.error("Failed to delete favicon")}},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-red-600 bg-white dark:bg-gray-700 border border-red-300 dark:border-red-500 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 w-fit",children:[t.jsx(j,{className:"w-4 h-4 mr-2"}),"Remove Favicon"]})]}),t.jsxs("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:["Recommended: ",t.jsx("strong",{children:"32 x 32 pixels"}),". PNG, ICO, or SVG, max 500KB."]})]})]})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Footer Copyright Text"}),t.jsx("input",{type:"text",value:we.footer_text||"",onChange:e=>Qr("footer_text",e.target.value),placeholder:"Â© 2026 Your Company Name. All rights reserved.",className:"block w-full max-w-lg rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Appears at the bottom of the login page"})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Login Page Features"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Tagline (bottom of left panel)"}),t.jsx("input",{type:"text",value:we.login_tagline||"",onChange:e=>Qr("login_tagline",e.target.value),placeholder:"High Performance ISP Management Solution",className:"block w-full max-w-lg rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),t.jsx("div",{className:"mb-4",children:t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"checkbox",checked:"false"!==we.show_login_features,onChange:e=>Qr("show_login_features",e.target.checked?"true":"false"),className:"sr-only"}),t.jsx("div",{className:"w-10 h-6 rounded-full transition-colors "+("false"!==we.show_login_features?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:t.jsx("div",{className:"absolute top-1 w-4 h-4 bg-white rounded-full transition-transform "+("false"!==we.show_login_features?"translate-x-5":"translate-x-1")})})]}),t.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show feature boxes on login page"})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 1 Title"}),t.jsx("input",{type:"text",value:we.login_feature_1_title||"",onChange:e=>Qr("login_feature_1_title",e.target.value),placeholder:"PPPoE Management",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 1 Description"}),t.jsx("input",{type:"text",value:we.login_feature_1_desc||"",onChange:e=>Qr("login_feature_1_desc",e.target.value),placeholder:"Complete subscriber and session management...",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 2 Title"}),t.jsx("input",{type:"text",value:we.login_feature_2_title||"",onChange:e=>Qr("login_feature_2_title",e.target.value),placeholder:"Bandwidth Control",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 2 Description"}),t.jsx("input",{type:"text",value:we.login_feature_2_desc||"",onChange:e=>Qr("login_feature_2_desc",e.target.value),placeholder:"FUP quotas, time-based speed control...",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 3 Title"}),t.jsx("input",{type:"text",value:we.login_feature_3_title||"",onChange:e=>Qr("login_feature_3_title",e.target.value),placeholder:"MikroTik Integration",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Feature 3 Description"}),t.jsx("input",{type:"text",value:we.login_feature_3_desc||"",onChange:e=>Qr("login_feature_3_desc",e.target.value),placeholder:"Seamless RADIUS and API integration...",className:"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]})]}),t.jsxs("div",{className:"border-t dark:border-gray-700 pt-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Sidebar Preview"}),t.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-4",children:t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 max-w-xs",children:t.jsx("div",{className:"flex items-center gap-3",children:ce?t.jsx("img",{src:ce,alt:"Logo",className:"h-10 object-contain"}):t.jsx("span",{className:"text-lg font-bold",style:{color:we.primary_color||"#2563eb"},children:we.company_name||"Your Company Name"})})})})]})]}):"account"===je?t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Account Information"}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Username"}),t.jsx("p",{className:"font-medium",children:null==ne?void 0:ne.username})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Email"}),t.jsx("p",{className:"font-medium",children:(null==ne?void 0:ne.email)||"-"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Full Name"}),t.jsx("p",{className:"font-medium",children:(null==ne?void 0:ne.full_name)||"-"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Role"}),t.jsx("p",{className:"font-medium capitalize",children:null==ne?void 0:ne.user_type})]})]})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Two-Factor Authentication"}),(null==$r?void 0:$r.enabled)?t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 border border-green-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),t.jsx("span",{className:"font-medium text-green-800",children:"2FA is enabled"})]}),t.jsx("p",{className:"text-sm text-green-700 mb-4",children:"Your account is protected with two-factor authentication."}),t.jsxs("div",{className:"border-t border-green-200 pt-4 mt-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Disable 2FA"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{type:"password",placeholder:"Current password",value:$e,onChange:e=>ze(e.target.value),className:"block w-full max-w-xs rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),t.jsx("input",{type:"text",placeholder:"2FA code",value:qe,onChange:e=>He(e.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,className:"block w-full max-w-xs rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),t.jsx("button",{onClick:()=>Or.mutate({password:$e,code:qe}),disabled:Or.isPending||!$e||6!==qe.length,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 disabled:opacity-50",children:Or.isPending?"Disabling...":"Disable 2FA"})]})]})]}):Ue?t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-4",children:"Setup Two-Factor Authentication"}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[t.jsxs("div",{className:"flex-shrink-0",children:[t.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"1. Scan this QR code with your authenticator app"}),t.jsx("img",{src:Ue.qr_code,alt:"2FA QR Code",className:"w-48 h-48 border rounded"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"Or enter this code manually:"}),t.jsx("code",{className:"block bg-white px-3 py-2 rounded border text-sm font-mono mb-4 break-all",children:Ue.secret}),t.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"2. Enter the 6-digit code from your app:"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",placeholder:"000000",value:We,onChange:e=>Ee(e.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,className:"block w-32 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 text-center text-lg tracking-widest"}),t.jsx("button",{onClick:()=>Hr.mutate(We),disabled:Hr.isPending||6!==We.length,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:Hr.isPending?"Verifying...":"Verify & Enable"})]})]})]}),t.jsx("button",{onClick:()=>{Be(null),Ee("")},className:"mt-4 text-sm text-blue-600 hover:text-blue-800",children:"Cancel setup"})]}):t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("svg",{className:"w-5 h-5 text-gray-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300 dark:text-gray-400",children:"2FA is not enabled"})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add an extra layer of security to your account by enabling two-factor authentication. You'll need an authenticator app like Google Authenticator or Authy."}),t.jsx("button",{onClick:()=>qr.mutate(),disabled:qr.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:qr.isPending?"Setting up...":"Enable 2FA"})]})]})]}):"notifications"===je?t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Email Notifications (SMTP)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Host"}),t.jsx("input",{type:"text",value:we.smtp_host||"",onChange:e=>Qr("smtp_host",e.target.value),placeholder:"smtp.gmail.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Port"}),t.jsx("input",{type:"number",value:we.smtp_port||"",onChange:e=>Qr("smtp_port",e.target.value),placeholder:"587",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Username"}),t.jsx("input",{type:"text",value:we.smtp_username||"",onChange:e=>Qr("smtp_username",e.target.value),placeholder:"user@gmail.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMTP Password"}),t.jsx("input",{type:"password",value:we.smtp_password||"",onChange:e=>Qr("smtp_password",e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"From Name"}),t.jsx("input",{type:"text",value:we.smtp_from_name||"",onChange:e=>Qr("smtp_from_name",e.target.value),placeholder:"Company Name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"From Email"}),t.jsx("input",{type:"email",value:we.smtp_from_email||"",onChange:e=>Qr("smtp_from_email",e.target.value),placeholder:"noreply@company.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Test Email Address"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"email",value:Je,onChange:e=>Xe(e.target.value),placeholder:"test@example.com",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"}),t.jsx("button",{onClick:async()=>{var e,r;Qe(!0);try{const e=await g.post("/notifications/test-smtp",{smtp_host:we.smtp_host,smtp_port:we.smtp_port,smtp_username:we.smtp_username,smtp_password:we.smtp_password,smtp_from_name:we.smtp_from_name,smtp_from_email:we.smtp_from_email,test_email:Je||we.notification_email});k.success(e.data.message||"SMTP test successful!")}catch(a){k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"SMTP test failed")}finally{Qe(!1)}},disabled:Oe||!we.smtp_host,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Oe?"Testing...":"Test SMTP"})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"SMS Notifications"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"SMS Provider"}),t.jsxs("select",{value:we.sms_provider||"",onChange:e=>Qr("sms_provider",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white",children:[t.jsx("option",{value:"",children:"Select Provider"}),t.jsx("option",{value:"twilio",children:"Twilio"}),t.jsx("option",{value:"vonage",children:"Vonage (Nexmo)"}),t.jsx("option",{value:"custom",children:"Custom API"})]})]}),"twilio"===we.sms_provider&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Twilio Account SID"}),t.jsx("input",{type:"text",value:we.sms_twilio_sid||"",onChange:e=>Qr("sms_twilio_sid",e.target.value),placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Twilio Auth Token"}),t.jsx("input",{type:"password",value:we.sms_twilio_token||"",onChange:e=>Qr("sms_twilio_token",e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Twilio Phone Number"}),t.jsx("input",{type:"text",value:we.sms_twilio_from||"",onChange:e=>Qr("sms_twilio_from",e.target.value),placeholder:"+1234567890",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]})]}),"vonage"===we.sms_provider&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vonage API Key"}),t.jsx("input",{type:"text",value:we.sms_vonage_key||"",onChange:e=>Qr("sms_vonage_key",e.target.value),placeholder:"API Key",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vonage API Secret"}),t.jsx("input",{type:"password",value:we.sms_vonage_secret||"",onChange:e=>Qr("sms_vonage_secret",e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sender Name/Number"}),t.jsx("input",{type:"text",value:we.sms_vonage_from||"",onChange:e=>Qr("sms_vonage_from",e.target.value),placeholder:"CompanyName or +1234567890",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]})]}),"custom"===we.sms_provider&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API URL"}),t.jsx("input",{type:"text",value:we.sms_custom_url||"",onChange:e=>Qr("sms_custom_url",e.target.value),placeholder:"https://api.provider.com/sms/send",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"HTTP Method"}),t.jsxs("select",{value:we.sms_custom_method||"POST",onChange:e=>Qr("sms_custom_method",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white",children:[t.jsx("option",{value:"POST",children:"POST"}),t.jsx("option",{value:"GET",children:"GET"})]})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Request Body (JSON)"}),t.jsx("textarea",{value:we.sms_custom_body||"",onChange:e=>Qr("sms_custom_body",e.target.value),placeholder:'{"to": "{{to}}", "message": "{{message}}"}',rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white font-mono text-sm"}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Use ","{{to}}"," and ","{{message}}"," as placeholders"]})]})]}),we.sms_provider&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Test Phone Number"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:Ze,onChange:e=>er(e.target.value),placeholder:"+1234567890",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"}),t.jsx("button",{onClick:async()=>{var e,r;Ge(!0);try{const e=await g.post("/notifications/test-sms",{sms_provider:we.sms_provider,sms_twilio_sid:we.sms_twilio_sid,sms_twilio_token:we.sms_twilio_token,sms_twilio_from:we.sms_twilio_from,sms_vonage_key:we.sms_vonage_key,sms_vonage_secret:we.sms_vonage_secret,sms_vonage_from:we.sms_vonage_from,sms_custom_url:we.sms_custom_url,sms_custom_method:we.sms_custom_method,sms_custom_body:we.sms_custom_body,test_phone:Ze});k.success(e.data.message||"SMS test successful!")}catch(a){k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"SMS test failed")}finally{Ge(!1)}},disabled:Ye||!Ze,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Ye?"Testing...":"Test SMS"})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"WhatsApp Notifications"}),t.jsxs("div",{className:"mb-5",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Provider"}),t.jsxs("select",{value:we.whatsapp_provider||"ultramsg",onChange:e=>{return r="whatsapp_provider",a=e.target.value,_e(e=>({...e,[r]:a})),void g.put("/settings/bulk",{settings:[{key:r,value:String(a)}]}).then(()=>de.invalidateQueries(["settings"])).catch(()=>{});var r,a},className:"w-full sm:w-64 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white",children:[t.jsx("option",{value:"ultramsg",children:"Ultramsg"}),t.jsx("option",{value:"proxrad",children:"ProxRad WhatsApp"})]})]}),"ultramsg"===(we.whatsapp_provider||"ultramsg")?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Get your Instance ID and Token from ",t.jsx("a",{href:"https://ultramsg.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"ultramsg.com"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Instance ID"}),t.jsx("input",{type:"text",value:we.whatsapp_instance_id||"",onChange:e=>Qr("whatsapp_instance_id",e.target.value),placeholder:"instanceXXXXX",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Token"}),t.jsx("input",{type:"password",value:we.whatsapp_token||"",onChange:e=>Qr("whatsapp_token",e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Test Phone Number"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:Ze,onChange:e=>er(e.target.value),placeholder:"+1234567890 (with country code)",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"}),t.jsx("button",{onClick:async()=>{var e,r;Ke(!0);try{const e=await g.post("/notifications/test-whatsapp",{whatsapp_instance_id:we.whatsapp_instance_id,whatsapp_token:we.whatsapp_token,test_phone:Ze});k.success(e.data.message||"WhatsApp test successful!")}catch(a){k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"WhatsApp test failed")}finally{Ke(!1)}},disabled:Ve||!we.whatsapp_instance_id||!we.whatsapp_token,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Ve?"Testing...":"Test WhatsApp"})]})]})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Link your WhatsApp number via ProxRad (proxsms.com). Scan the QR code below to connect your number."}),or&&t.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border "+("subscribed"===or.type?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-700":"expired"===or.type?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-700":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700"),children:[t.jsx("span",{className:"text-lg mt-0.5",children:"subscribed"===or.type?"âœ…":"expired"===or.type?"ðŸ”’":"â³"}),t.jsxs("div",{children:["subscribed"===or.type&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"Subscribed"}),t.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["Active until ",new Date(or.expires_at).toLocaleDateString()]})]}),"trial"===or.type&&or.trial_ends&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-300",children:"Trial Mode"}),t.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:or.trial_hours_left>0?`${or.trial_hours_left} hour${1!==or.trial_hours_left?"s":""} remaining â€” contact your provider to subscribe`:"Trial ending soon"})]}),"trial"===or.type&&!or.trial_ends&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-300",children:"Trial Mode"}),t.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"2-day trial starts when you link your number"})]}),"expired"===or.type&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Trial / Subscription Expired"}),t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Sending is blocked. Contact your provider to subscribe."})]})]})]}),we.proxrad_account_unique&&!nr&&t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg",children:[t.jsx("span",{className:"text-green-600 dark:text-green-400 text-xl",children:"âœ…"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-300",children:"WhatsApp Account Linked"}),t.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:rr||we.proxrad_phone||we.proxrad_account_unique})]}),t.jsx("button",{onClick:async()=>{var e,r;try{await g.delete("/notifications/proxrad/unlink"),Qr("proxrad_account_unique",""),Qr("proxrad_phone",""),ar(""),cr(null),k.success("WhatsApp account unlinked")}catch(a){k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Failed to unlink account")}},className:"text-xs text-red-500 hover:text-red-700 font-medium",children:"Unlink"})]}),nr&&t.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-blue-200 dark:border-blue-700 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[t.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"ðŸ“± Scan with WhatsApp to link your number"}),tr?t.jsx("img",{src:tr,alt:"WhatsApp QR Code",className:"w-48 h-48 border border-gray-200 rounded-lg bg-white p-1",onError:e=>{e.target.style.display="none"}}):t.jsx("div",{className:"w-48 h-48 flex items-center justify-center",children:t.jsx("span",{className:"animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"})}),t.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 text-center",children:"Open WhatsApp â†’ Linked Devices â†’ Link a Device â†’ Scan this QR"}),t.jsx("p",{className:"text-xs text-gray-400 animate-pulse",children:"Waiting for connection..."}),t.jsx("button",{onClick:()=>{clearInterval(mr.current),ir(!1),sr(""),dr("")},className:"text-xs text-red-500 hover:text-red-700 underline",children:"Cancel"})]}),!nr&&!we.proxrad_account_unique&&t.jsx("div",{className:"flex gap-2 flex-wrap",children:t.jsx("button",{onClick:async()=>{var e,r;ir(!0),sr(""),dr("");try{const e=await g.get("/notifications/proxrad/create-link");sr(e.data.qr_image_url),dr(e.data.info_url),mr.current=setInterval(async()=>{try{const r=await g.get(`/notifications/proxrad/link-status?info_url=${encodeURIComponent(e.data.info_url)}`);r.data.connected&&(clearInterval(mr.current),ir(!1),sr(""),dr(""),Qr("proxrad_account_unique",r.data.unique),ar(r.data.phone||r.data.unique),oa(),k.success("WhatsApp account linked successfully!"))}catch{}},3e3)}catch(a){ir(!1),k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Failed to create WhatsApp link")}},className:"px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 flex items-center gap-2",children:"ðŸ“± Link via QR Code"})}),we.proxrad_account_unique&&!nr&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Test Phone Number"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:Ze,onChange:e=>er(e.target.value),placeholder:"+1234567890",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white"}),t.jsx("button",{onClick:async()=>{var e,r;Ke(!0);try{const e=await g.post("/notifications/proxrad/test-send",{test_phone:Ze});k.success(e.data.message||"Test message sent!")}catch(a){k.error((null==(r=null==(e=a.response)?void 0:e.data)?void 0:r.message)||"Test send failed")}finally{Ke(!1)}},disabled:Ve||!Ze,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50",children:Ve?"Testing...":"Test Send"})]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1 flex items-center gap-2",children:"ðŸ“± Send WhatsApp to Subscribers"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Select subscribers and send a WhatsApp message directly, or manage auto-notification settings."}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:"Select Subscribers"}),t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[xr.length," with phone",xr.filter(e=>e.whatsapp_notifications).length>0&&t.jsxs("span",{className:"ml-2 text-green-600 dark:text-green-400 font-medium",children:["ðŸ”” ",xr.filter(e=>e.whatsapp_notifications).length," notif ON"]})]})]}),t.jsxs("label",{className:"flex items-center gap-2 mb-3 cursor-pointer",children:[t.jsx("div",{onClick:()=>{fr(!kr),vr([])},className:"relative w-10 h-5 rounded-full transition-colors "+(kr?"bg-green-500":"bg-gray-300 dark:bg-gray-600"),children:t.jsx("div",{className:"absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform "+(kr?"translate-x-5":"translate-x-0.5")})}),t.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Send to all subscribers (",xr.length,")"]})]}),!kr&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative mb-2",children:[t.jsx("input",{type:"text",value:br,onChange:e=>{yr(e.target.value),ca(e.target.value)},placeholder:"Search subscribers...",className:"w-full px-3 py-2 pl-8 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white text-sm"}),t.jsx("svg",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),t.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap items-center text-xs",children:[t.jsx("button",{onClick:()=>vr(xr.map(e=>e.id)),className:"text-blue-600 hover:underline",children:"Select all"}),t.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),t.jsx("button",{onClick:()=>vr([]),className:"text-gray-500 hover:underline",children:"Clear"}),t.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),t.jsx("button",{onClick:async()=>{try{await g.post("/notifications/whatsapp/notifications/set-all",{enabled:!0}),gr(e=>e.map(e=>({...e,whatsapp_notifications:!0})))}catch(e){}},className:"text-green-600 dark:text-green-400 hover:underline font-medium",children:"ðŸ”” All notif ON"}),t.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),t.jsx("button",{onClick:async()=>{try{await g.post("/notifications/whatsapp/notifications/set-all",{enabled:!1}),gr(e=>e.map(e=>({...e,whatsapp_notifications:!1})))}catch(e){}},className:"text-gray-500 dark:text-gray-400 hover:underline font-medium",children:"ðŸ”• All notif OFF"}),pr.length>0&&t.jsxs("span",{className:"text-green-600 font-medium",children:[pr.length," selected"]})]}),t.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1 border border-gray-200 dark:border-gray-600 rounded-lg p-2",children:ur?t.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"Loading..."}):0===xr.length?t.jsx("p",{className:"text-center py-4 text-gray-400 text-sm",children:"No subscribers with phone numbers"}):xr.map(e=>t.jsxs("label",{className:"flex items-center gap-2 px-2 py-1.5 rounded cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 "+(pr.includes(e.id)?"bg-blue-50 dark:bg-blue-900/20":""),children:[t.jsx("input",{type:"checkbox",checked:pr.includes(e.id),onChange:()=>vr(r=>r.includes(e.id)?r.filter(r=>r!==e.id):[...r,e.id]),className:"rounded border-gray-300"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.username}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.phone})]}),t.jsx("button",{onClick:r=>{r.stopPropagation(),(async e=>{Sr(e.id);try{const r=await g.post(`/notifications/whatsapp/subscribers/${e.id}/toggle-notifications`);r.data.success&&gr(a=>a.map(a=>a.id===e.id?{...a,whatsapp_notifications:r.data.whatsapp_notifications}:a))}catch(r){}finally{Sr(null)}})(e)},disabled:Cr===e.id,title:e.whatsapp_notifications?"Auto-notif ON â€” click to disable":"Auto-notif OFF â€” click to enable",className:`shrink-0 p-1 rounded-full transition-colors ${e.whatsapp_notifications?"text-green-500 hover:bg-green-100 dark:hover:bg-green-900/30":"text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"} ${Cr===e.id?"opacity-50 cursor-wait":""}`,children:e.whatsapp_notifications?t.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}):t.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9M3 3l18 18"})})})]},e.id))})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2 mb-3",children:"âœ‰ï¸ Compose Message"}),t.jsx("textarea",{value:jr,onChange:e=>Nr(e.target.value),rows:8,placeholder:"Type your message here...\n\nYou can use:\n{username} â€” subscriber username\n{full_name} â€” subscriber full name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white resize-none text-sm mb-2"}),t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("p",{className:"text-xs text-gray-400",children:[jr.length," characters"]}),t.jsxs("p",{className:"text-xs text-gray-400",children:["Recipients: ",kr?`All (${xr.length})`:pr.length]})]}),t.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:["{username}","{full_name}"].map(e=>t.jsx("button",{onClick:()=>Nr(r=>r+e),className:"text-xs bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded hover:bg-gray-200 dark:hover:bg-gray-500",children:e},e))}),t.jsx("button",{onClick:async()=>{var e,r;if(!jr.trim())return void k.error("Enter a message");if(!kr&&0===pr.length)return void k.error("Select at least one subscriber");const a=kr?xr.length:pr.length;if(confirm(`Send message to ${a} subscriber${1!==a?"s":""}?`)){_r(!0);try{const e=await g.post("/notifications/whatsapp/send",{message:jr.trim(),send_all:kr,subscriber_ids:kr?[]:pr});e.data.success?(k.success(`âœ… Sent to ${e.data.sent} subscribers${e.data.failed>0?`, ${e.data.failed} failed`:""}`),0===e.data.failed&&(Nr(""),vr([]),fr(!1))):k.error(e.data.message||"Send failed")}catch(t){k.error((null==(r=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:r.message)||"Failed to send")}_r(!1)}},disabled:wr||!jr.trim()||!kr&&0===pr.length,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:wr?"Sending...":"ðŸ“¤ Send WhatsApp Message"})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:Yr,disabled:!Ce||Er.isPending,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Er.isPending?"Saving...":"Save Notification Settings"})})]}):"license"===je?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"License Information"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>la.mutate(),disabled:la.isPending,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50",children:la.isPending?t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-700 dark:text-gray-300 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Checking..."]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Check for Updates"]})}),t.jsx("button",{onClick:()=>Zr.mutate(),disabled:Zr.isPending,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:Zr.isPending?t.jsxs(t.Fragment,{children:[t.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Checking..."]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Check License"]})})]})]}),Vr?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[(()=>{const e=(null==Jr?void 0:Jr.license_status)||((null==Gr?void 0:Gr.valid)?"active":"blocked"),r={active:{bg:"bg-green-50 dark:bg-green-900/30 border-green-200",text:"text-green-800",subtext:"text-green-700",icon:"text-green-600",label:"License Active",desc:"Your license is valid and active"},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200",text:"text-yellow-800",subtext:"text-yellow-700",icon:"text-yellow-600",label:"License Expiring Soon",desc:(null==Jr?void 0:Jr.warning_message)||"Please renew soon"},grace:{bg:"bg-orange-50 border-orange-200",text:"text-orange-800",subtext:"text-orange-700",icon:"text-orange-600",label:"Grace Period",desc:"License expired - renew now to avoid service interruption"},readonly:{bg:"bg-red-50 dark:bg-red-900/30 border-red-200",text:"text-red-800",subtext:"text-red-700",icon:"text-red-600",label:"Read-Only Mode",desc:"License expired - system is read-only. Renew immediately!"},blocked:{bg:"bg-red-50 dark:bg-red-900/30 border-red-200",text:"text-red-800",subtext:"text-red-700",icon:"text-red-600",label:"License Blocked",desc:(null==Gr?void 0:Gr.message)||"License invalid or expired"},unknown:{bg:"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600",text:"text-gray-800",subtext:"text-gray-700",icon:"text-gray-600",label:"Unknown Status",desc:"Unable to determine license status"}},a=r[e]||r.unknown;return t.jsx("div",{className:`rounded-lg p-4 border ${a.bg}`,children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:`flex-shrink-0 ${a.icon}`,children:"active"===e?t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}):"warning"===e?t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}):t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),t.jsxs("div",{className:"ml-3 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:`font-medium ${a.text}`,children:a.label}),(null==Jr?void 0:Jr.read_only)&&t.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 rounded",children:"READ-ONLY"})]}),t.jsx("p",{className:`text-sm ${a.subtext}`,children:a.desc}),void 0!==(null==Jr?void 0:Jr.days_until_expiry)&&0!==(null==Jr?void 0:Jr.days_until_expiry)&&t.jsx("p",{className:`text-sm mt-1 font-medium ${a.subtext}`,children:Jr.days_until_expiry>0?`${Jr.days_until_expiry} days remaining`:`${Math.abs(Jr.days_until_expiry)} days overdue`})]})]})})})(),aa&&t.jsx("div",{className:"rounded-lg p-4 border "+(aa.update_available?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600"),children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"flex-shrink-0 "+(aa.update_available?"text-blue-600":"text-gray-500"),children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"font-medium "+(aa.update_available?"text-blue-800":"text-gray-800"),children:aa.update_available?"Update Available":"System Up to Date"}),t.jsxs("p",{className:"text-sm "+(aa.update_available?"text-blue-700":"text-gray-600"),children:["Current version: v",aa.current_version||"1.0.0",aa.update_available&&` â†’ v${aa.new_version}`]}),aa.update_available&&aa.release_notes&&t.jsx("p",{className:"text-sm text-blue-600 mt-1",children:aa.release_notes})]})]}),aa.update_available&&t.jsx("button",{onClick:()=>{window.location.href="/settings?tab=license"},className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Update Now"})]})}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Service Management"})}),t.jsxs("div",{className:"p-4",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Restart services if you experience issues after updates or configuration changes."}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:async()=>{k.loading("Restarting API service...",{id:"restart"});try{await u.restartServices(["api"])}catch(e){}k.success("API service is restarting. Page will reload in 10 seconds.",{id:"restart"}),setTimeout(()=>window.location.reload(),1e4)},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-orange-600 rounded-md hover:bg-orange-700",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Restart API"]}),t.jsxs("button",{onClick:async()=>{k.loading("Restarting all services...",{id:"restart"});try{await u.restartServices(["all"])}catch(e){}k.success("All services are restarting. Page will reload in 15 seconds.",{id:"restart"}),setTimeout(()=>window.location.reload(),15e3)},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:[t.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Restart All Services"]})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 rounded-lg overflow-hidden",children:[t.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"License Details"})}),t.jsxs("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"License Key"}),t.jsx("span",{className:"font-mono text-sm",children:(null==Gr?void 0:Gr.license_key)||"-"})]}),t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Customer Name"}),t.jsx("span",{className:"font-medium",children:(null==Gr?void 0:Gr.customer_name)||"-"})]}),t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Plan / Tier"}),t.jsx("span",{className:"font-medium capitalize",children:(null==Gr?void 0:Gr.tier)||"-"})]}),t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Max Subscribers"}),t.jsx("span",{className:"font-medium",children:(null==(d=null==Gr?void 0:Gr.max_subscribers)?void 0:d.toLocaleString())||"-"})]}),t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"License Type"}),t.jsx("span",{className:"font-medium",children:(null==Gr?void 0:Gr.is_lifetime)?"Lifetime":"Subscription"})]}),!(null==Gr?void 0:Gr.is_lifetime)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Expires At"}),t.jsx("span",{className:"font-medium",children:(null==Gr?void 0:Gr.expires_at)?new Date(Gr.expires_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})]}),t.jsxs("div",{className:"px-4 py-3 flex justify-between",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Days Remaining"}),t.jsx("span",{className:"font-medium "+(((null==Jr?void 0:Jr.days_until_expiry)||(null==Gr?void 0:Gr.days_remaining)||0)<=0||((null==Jr?void 0:Jr.days_until_expiry)||(null==Gr?void 0:Gr.days_remaining)||0)<=7?"text-red-600":((null==Jr?void 0:Jr.days_until_expiry)||(null==Gr?void 0:Gr.days_remaining)||0)<=14?"text-yellow-600":"text-green-600"),children:void 0!==(null==Jr?void 0:Jr.days_until_expiry)?Jr.days_until_expiry>0?`${Jr.days_until_expiry} days`:`${Math.abs(Jr.days_until_expiry)} days overdue`:void 0!==(null==Gr?void 0:Gr.days_remaining)?`${Gr.days_remaining} days`:"-"})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Need to upgrade or renew?"}),t.jsx("p",{className:"text-sm text-blue-700",children:"Contact support to upgrade your plan or renew your license."})]})]})]}):"cluster"===je?t.jsx(_,{}):"system"===je?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"System Information"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hardware specifications and system health"})]}),t.jsx("button",{onClick:()=>ia(),disabled:na,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600",children:na?"Loading...":"Refresh"})]}),na?t.jsx("div",{className:"flex justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):da?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:t.jsx(h,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"CPU"})]}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[null==(n=da.cpu)?void 0:n.cores," Cores"]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",title:null==(o=da.cpu)?void 0:o.model,children:null==(v=da.cpu)?void 0:v.model}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage"}),t.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[null==(N=da.cpu)?void 0:N.usage,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full "+((null==(S=da.cpu)?void 0:S.usage)>80?"bg-red-500":(null==(P=da.cpu)?void 0:P.usage)>60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min((null==(M=da.cpu)?void 0:M.usage)||0,100)}%`}})})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:t.jsx("svg",{className:"w-5 h-5 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})})}),t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Memory"})]}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[null==(L=da.memory)?void 0:L.total_gb," GB"]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Math.round((null==(A=da.memory)?void 0:A.used_mb)/1024*10)/10," GB used"]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage"}),t.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[null==(F=da.memory)?void 0:F.usage,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full "+((null==(T=da.memory)?void 0:T.usage)>80?"bg-red-500":(null==(D=da.memory)?void 0:D.usage)>60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min((null==(I=da.memory)?void 0:I.usage)||0,100)}%`}})})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:t.jsx("svg",{className:"w-5 h-5 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})})}),t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Storage"})]}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[null==(R=da.disk)?void 0:R.total_gb," GB"]}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[null==(B=null==(U=da.disk)?void 0:U.type)?void 0:B.toUpperCase()," â€¢ ",null==(W=da.disk)?void 0:W.free_gb," GB free"]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage"}),t.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[null==(E=da.disk)?void 0:E.usage,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full "+((null==($=da.disk)?void 0:$.usage)>80?"bg-red-500":(null==(z=da.disk)?void 0:z.usage)>60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min((null==(q=da.disk)?void 0:q.usage)||0,100)}%`}})})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/50 rounded-lg",children:t.jsx("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Capacity"})]}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:null==(O=null==(H=da.capacity)?void 0:H.current_subscribers)?void 0:O.toLocaleString()}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["of ",null==(Y=null==(Q=da.capacity)?void 0:Q.estimated_max)?void 0:Y.toLocaleString()," max subscribers"]}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage"}),t.jsxs("span",{className:"font-medium "+("critical"===(null==(G=da.capacity)?void 0:G.status)?"text-red-600":"warning"===(null==(V=da.capacity)?void 0:V.status)?"text-yellow-600":"text-green-600"),children:[null==(K=da.capacity)?void 0:K.usage_percent,"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full "+("critical"===(null==(J=da.capacity)?void 0:J.status)?"bg-red-500":"warning"===(null==(X=da.capacity)?void 0:X.status)?"bg-yellow-500":"moderate"===(null==(Z=da.capacity)?void 0:Z.status)?"bg-blue-500":"bg-green-500"),style:{width:`${Math.min((null==(ee=da.capacity)?void 0:ee.usage_percent)||0,100)}%`}})})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-4",children:"Operating System"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"OS"}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:null==(re=da.os)?void 0:re.name})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Version"}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:null==(ae=da.os)?void 0:ae.version})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Uptime"}),t.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:null==(te=da.os)?void 0:te.uptime})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CPU Speed"}),t.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(null==(se=da.cpu)?void 0:se.speed)||"N/A"," MHz"]})]})]})]}),t.jsx(C,{})]}):t.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Failed to load system information"})]}):"ssl"===je?t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[t.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:t.jsx(b,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Custom Domain & SSL Certificate"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Point your domain to this server and get a free HTTPS certificate from Let's Encrypt"})]})]}),(null==ea?void 0:ea.cert_exists)&&t.jsxs("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[t.jsx(c,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0"}),t.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["SSL active â€” panel accessible at ",t.jsxs("strong",{children:["https://",ea.domain]})]})]}),(null==ea?void 0:ea.domain)&&!(null==ea?void 0:ea.cert_exists)&&t.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg flex items-center gap-2",children:[t.jsx(i,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),t.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:["Domain configured (",t.jsx("strong",{children:ea.domain}),") but no certificate found â€” run installation below."]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Domain / Subdomain"}),t.jsx("input",{type:"text",value:Pr,onChange:e=>Mr(e.target.value.trim()),placeholder:"panel.yourisp.com",className:"input w-full",disabled:Dr}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Must point to this server's public IP address via DNS"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email (Let's Encrypt)"}),t.jsx("input",{type:"email",value:Lr,onChange:e=>Ar(e.target.value.trim()),placeholder:"admin@yourisp.com",className:"input w-full",disabled:Dr}),t.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Used for certificate expiry notifications"})]})]}),t.jsx("button",{onClick:async()=>{if(!Pr||!Lr)return;Tr([]),Ir(!0);const e=new AbortController;Rr.current=e;try{const r=m.getState().token,a=new FormData;a.append("domain",Pr),a.append("email",Lr);const t=await fetch("/api/settings/ssl-stream",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:a,signal:e.signal});if(!t.ok){const e=await t.text();let r="SSL installation failed";try{r=JSON.parse(e).message||r}catch{}return Tr([`âŒ ${r}`]),void Ir(!1)}const s=t.body.getReader(),l=new TextDecoder;let d="";for(;;){const{value:e,done:r}=await s.read();if(r)break;d+=l.decode(e,{stream:!0});const a=d.split("\n");d=a.pop();for(const t of a)if(t.trim())try{const e=JSON.parse(t);"success"===e.status?ra():"error"===e.status||e.msg&&Tr(r=>[...r,e.msg])}catch{}}}catch(r){"AbortError"!==r.name&&Tr(e=>[...e,`âŒ Error: ${r.message}`])}finally{Ir(!1),Rr.current=null}},disabled:Dr||!Pr||!Lr,className:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:Dr?t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Installing SSL..."]}):(null==ea?void 0:ea.cert_exists)?"Renew SSL Certificate":"Get SSL Certificate"}),Fr.length>0&&t.jsx("div",{className:"mt-4 bg-gray-900 rounded-lg p-4 font-mono text-xs max-h-80 overflow-y-auto space-y-0.5",children:Fr.map((e,r)=>t.jsx("div",{className:e.includes("âŒ")?"text-red-400":e.includes("âœ…")||e.startsWith("âœ“")?"text-green-400":e.includes("âš ")?"text-yellow-400":"text-gray-300",children:e},r))})]})}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:null==(le={general:[{key:"company_name",label:"Company Name",type:"text",placeholder:"Your Company Name"},{key:"company_address",label:"Company Address",type:"textarea",placeholder:"Full address"},{key:"company_phone",label:"Phone Number",type:"text",placeholder:"+1 234 567 890"},{key:"company_email",label:"Email",type:"email",placeholder:"info@company.com"},{key:"system_timezone",label:"System Timezone",type:"timezone",description:"Used for FUP reset, bandwidth rules, and all time-based features"},{key:"date_format",label:"Date Format",type:"select",options:["YYYY-MM-DD","DD/MM/YYYY","MM/DD/YYYY","DD-MM-YYYY"]}],billing:[{key:"currency",label:"Currency Code",type:"text",placeholder:"USD"},{key:"currency_symbol",label:"Currency Symbol",type:"text",placeholder:"$"},{key:"tax_rate",label:"Tax Rate (%)",type:"number",placeholder:"0"},{key:"invoice_prefix",label:"Invoice Prefix",type:"text",placeholder:"INV-"},{key:"payment_methods",label:"Payment Methods",type:"text",placeholder:"cash,bank,mpesa"},{key:"auto_generate_invoice",label:"Auto Generate Invoice",type:"toggle"},{key:"invoice_due_days",label:"Invoice Due Days",type:"number",placeholder:"7"}],service_change:[{key:"upgrade_change_service_fee",label:"Upgrade Fee ($)",type:"number",placeholder:"0",description:"Fee charged when subscriber upgrades to a higher-priced service"},{key:"downgrade_change_service_fee",label:"Downgrade Fee ($)",type:"number",placeholder:"0",description:"Fee charged when subscriber downgrades to a lower-priced service"},{key:"allow_downgrade",label:"Allow Downgrade",type:"toggle",description:"Allow subscribers to change to a lower-priced service"},{key:"downgrade_refund",label:"Refund on Downgrade",type:"toggle",description:"Refund the difference when downgrading (prorate credit)"}],radius:[{key:"daily_quota_reset_time",label:"Daily Quota Reset Time",type:"time",placeholder:"00:00"},{key:"notification_send_time",label:"Notification Send Time",type:"time",placeholder:"08:00",description:"Time to send expiry warning and expired notifications daily"},{key:"default_session_timeout",label:"Default Session Timeout (sec)",type:"number",placeholder:"86400"},{key:"max_sessions_per_user",label:"Max Sessions Per User",type:"number",placeholder:"1"},{key:"accounting_interval",label:"Accounting Interval (sec)",type:"number",placeholder:"300"},{key:"idle_timeout",label:"Idle Timeout (sec)",type:"number",placeholder:"600"},{key:"simultaneous_use",label:"Allow Simultaneous Use",type:"toggle"},{key:"mac_auth_enabled",label:"MAC Authentication",type:"toggle"},{key:"block_on_daily_quota_exceeded",label:"Block Internet on Daily Quota Exceeded",type:"toggle",description:"When enabled, users will lose internet completely when daily quota is exceeded. When disabled, users get reduced FUP speed."},{key:"block_on_monthly_quota_exceeded",label:"Block Internet on Monthly Quota Exceeded",type:"toggle",description:"When enabled, users will lose internet completely when monthly quota is exceeded. When disabled, users get reduced FUP speed."}],notifications:[],security:[{key:"session_timeout",label:"Admin Session Timeout (min)",type:"number",placeholder:"60"},{key:"max_login_attempts",label:"Max Login Attempts",type:"number",placeholder:"5"},{key:"password_min_length",label:"Min Password Length",type:"number",placeholder:"8"},{key:"api_rate_limit",label:"API Rate Limit (req/min)",type:"number",placeholder:"100"},{key:"allowed_ips",label:"Allowed Admin IPs",type:"text",placeholder:"Leave empty for all"},{key:"remote_support_enabled",label:"Remote Support Access",type:"toggle",description:"Allow ProxPanel support team to access your server for troubleshooting. After enabling, run: proxpanel-support enable"}]}[je])?void 0:le.map(e=>t.jsxs("div",{className:"textarea"===e.type?"md:col-span-2":"",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:e.label}),ma(e)]},e.key))})})]}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(null==Ur?void 0:Ur.length)||0," settings configured â€¢",Ce?" Unsaved changes":" All changes saved"]})})]})}export{S as default};
