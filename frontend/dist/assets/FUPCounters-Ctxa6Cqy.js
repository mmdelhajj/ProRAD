import{b as e,u as a,d as t,j as s}from"./data-vendor-C6mPcuPT.js";import{r}from"./react-vendor-C4Xey-hE.js";import{c as l,u as d,f as i,a as n}from"./table-vendor-BZVOk-Gl.js";import{F as c,a as o,k as x,J as g,q as m,y as u}from"./index-BMh19Dj_.js";import{c as h}from"./ui-vendor-CMKyyIMz.js";import{F as y}from"./MagnifyingGlassIcon-D7UyJAmN.js";import"./chart-vendor-Be69IwoK.js";const p=l();function b(e){if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB","TB"][a]}function j({used:e,total:a,label:t}){if(0===a)return s.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Unlimited"});const r=Math.min(e/a*100,100),l=r>=100?"bg-red-500":r>=80?"bg-yellow-500":"bg-green-500";return s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[s.jsx("span",{children:b(e)}),s.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:b(a)})]}),s.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:s.jsx("div",{className:h("h-full rounded-full transition-all",l),style:{width:`${r}%`}})}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[r.toFixed(1),"%"]})]})}function v(){const l=e(),[v,N]=r.useState(1),[f,k]=r.useState(""),[w,_]=r.useState(""),[S,q]=r.useState(""),[F,C]=r.useState({}),{data:M}=a({queryKey:["fup-stats"],queryFn:()=>u.get("/fup/stats").then(e=>e.data.data),refetchInterval:3e4}),{data:P,isLoading:R}=a({queryKey:["fup-quotas",v,f,w,S],queryFn:()=>u.get("/fup/quotas",{params:{page:v,limit:25,search:f,fup_status:w,quota_status:S}}).then(e=>e.data)}),{data:U}=a({queryKey:["fup-top-users"],queryFn:()=>u.get("/fup/top-users",{params:{limit:5,period:"monthly"}}).then(e=>e.data.data)}),Q=t({mutationFn:e=>u.post(`/fup/reset/${e}`),onSuccess:()=>{l.invalidateQueries(["fup-quotas"]),l.invalidateQueries(["fup-stats"])}}),A=t({mutationFn:e=>u.post("/fup/bulk-reset",e),onSuccess:()=>{l.invalidateQueries(["fup-quotas"]),l.invalidateQueries(["fup-stats"]),C({})}}),B=t({mutationFn:()=>u.post("/fup/reset-all"),onSuccess:()=>{l.invalidateQueries(["fup-quotas"]),l.invalidateQueries(["fup-stats"])}}),D=r.useMemo(()=>[p.display({id:"select",header:({table:e})=>s.jsx("input",{type:"checkbox",checked:e.getIsAllRowsSelected(),onChange:e.getToggleAllRowsSelectedHandler(),className:"rounded border-gray-300 dark:border-gray-600"}),cell:({row:e})=>s.jsx("input",{type:"checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),className:"rounded border-gray-300 dark:border-gray-600"})}),p.accessor("username",{header:"Username",cell:e=>s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.getValue()}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.row.original.full_name})]})}),p.accessor("service_name",{header:"Service"}),p.accessor("reseller_name",{header:"Reseller"}),p.display({id:"daily_quota",header:"Daily Quota",cell:({row:e})=>s.jsx(j,{used:e.original.daily_used,total:e.original.daily_quota})}),p.display({id:"monthly_quota",header:"Monthly Quota",cell:({row:e})=>s.jsx(j,{used:e.original.monthly_used,total:e.original.monthly_quota})}),p.accessor("fup_level",{header:"FUP Level",cell:e=>{const a=e.getValue();return s.jsx("span",{className:h("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",0===a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:0===a?"Normal":`Level ${a}`})}}),p.accessor("is_online",{header:"Status",cell:e=>s.jsxs("span",{className:h("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",e.getValue()?"bg-green-100 text-green-800":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"),children:[s.jsx(c,{className:h("w-3 h-3 mr-1",e.getValue()?"text-green-500":"text-gray-400")}),e.getValue()?"Online":"Offline"]})}),p.display({id:"actions",header:"Actions",cell:({row:e})=>s.jsxs("button",{onClick:()=>Q.mutate(e.original.id),disabled:Q.isPending,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 disabled:opacity-50",children:[s.jsx(o,{className:"w-4 h-4 mr-1"}),"Reset"]})})],[Q]),V=d({data:(null==P?void 0:P.data)||[],columns:D,getCoreRowModel:n(),state:{rowSelection:F},onRowSelectionChange:C,getRowId:e=>String(e.id)}),I=Object.keys(F).map(Number),T=e=>{0!==I.length&&A.mutate({subscriber_ids:I,reset_type:e})},E=M||{};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"FUP & Counters"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Manage Fair Usage Policy and quota counters"})]}),s.jsxs("button",{onClick:()=>B.mutate(),disabled:B.isPending||0===E.active_fup,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[s.jsx(o,{className:"w-5 h-5 mr-2"}),"Reset All FUP (",E.active_fup||0,")"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(x,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Subscribers"}),s.jsx("p",{className:"text-xl font-bold",children:E.total_subscribers||0})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:s.jsx(g,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Active FUP"}),s.jsx("p",{className:"text-xl font-bold text-red-600",children:E.active_fup||0})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:s.jsx(g,{className:"w-6 h-6 text-yellow-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Daily Exceeded"}),s.jsx("p",{className:"text-xl font-bold text-yellow-600",children:E.daily_quota_exceeded||0})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:s.jsx(g,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Monthly Exceeded"}),s.jsx("p",{className:"text-xl font-bold text-orange-600",children:E.monthly_quota_exceeded||0})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(m,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Unlimited"}),s.jsx("p",{className:"text-xl font-bold text-green-600",children:E.unlimited_quota||0})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"lg:col-span-3 bg-white dark:bg-gray-800 rounded-xl shadow-sm border",children:[s.jsxs("div",{className:"p-4 border-b",children:[s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx("div",{className:"flex-1 min-w-[200px]",children:s.jsxs("div",{className:"relative",children:[s.jsx(y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 dark:text-gray-500 dark:text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search username...",value:f,onChange:e=>{k(e.target.value),N(1)},className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500"})]})}),s.jsxs("select",{value:w,onChange:e=>{_(e.target.value),N(1)},className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"",children:"All FUP Status"}),s.jsx("option",{value:"active",children:"Active FUP"}),s.jsx("option",{value:"normal",children:"Normal"})]}),s.jsxs("select",{value:S,onChange:e=>{q(e.target.value),N(1)},className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"",children:"All Quota Status"}),s.jsx("option",{value:"daily_exceeded",children:"Daily Exceeded"}),s.jsx("option",{value:"monthly_exceeded",children:"Monthly Exceeded"}),s.jsx("option",{value:"warning",children:"Warning (80%+)"}),s.jsx("option",{value:"unlimited",children:"Unlimited"})]})]}),I.length>0&&s.jsxs("div",{className:"mt-4 flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[s.jsxs("span",{className:"text-sm text-blue-800 font-medium",children:[I.length," selected"]}),s.jsx("button",{onClick:()=>T("all"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Reset All"}),s.jsx("button",{onClick:()=>T("fup"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",children:"Reset FUP"}),s.jsx("button",{onClick:()=>T("daily"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"Reset Daily"}),s.jsx("button",{onClick:()=>T("monthly"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:opacity-50",children:"Reset Monthly"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:V.getHeaderGroups().map(e=>s.jsx("tr",{children:e.headers.map(e=>s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:i(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:R?s.jsx("tr",{children:s.jsx("td",{colSpan:D.length,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Loading..."})}):0===V.getRowModel().rows.length?s.jsx("tr",{children:s.jsx("td",{colSpan:D.length,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No subscribers found"})}):V.getRowModel().rows.map(e=>s.jsx("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:e.getVisibleCells().map(e=>s.jsx("td",{className:"px-4 py-3",children:i(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),(null==P?void 0:P.meta)&&s.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Showing ",25*(v-1)+1," to ",Math.min(25*v,P.meta.total)," of ",P.meta.total]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>N(e=>Math.max(1,e-1)),disabled:1===v,className:"px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),s.jsx("button",{onClick:()=>N(e=>e+1),disabled:v>=P.meta.totalPages,className:"px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Top Quota Users"}),s.jsxs("div",{className:"space-y-4",children:[null==U?void 0:U.map((e,a)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:h("w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm",0===a?"bg-yellow-500":1===a?"bg-gray-400":2===a?"bg-amber-700":"bg-gray-300"),children:a+1}),s.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[s.jsx("p",{className:"font-medium text-sm truncate",children:e.username}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.service_name})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-medium",children:b(e.quota_used)}),s.jsxs("p",{className:h("text-xs",e.percent>=100?"text-red-600":e.percent>=80?"text-yellow-600":"text-green-600"),children:[e.percent.toFixed(1),"%"]})]})]},e.id)),!(null==U?void 0:U.length)&&s.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No data available"})]})]})]})]})}export{v as default};
