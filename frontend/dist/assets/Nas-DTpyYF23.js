import{b as e,u as s,d as a,j as r}from"./data-vendor-C6mPcuPT.js";import{r as t}from"./react-vendor-C4Xey-hE.js";import{v as l,g as i,a as n,c,h as d,q as o,n as m}from"./index-DRJG7jyl.js";import{u as p,f as x,a as h}from"./table-vendor-BZVOk-Gl.js";import{z as u}from"./ui-vendor-CMKyyIMz.js";import{F as j}from"./PencilIcon-IYn463Gm.js";import{F as g}from"./TrashIcon-BFZdbUYd.js";import{F as v}from"./EyeSlashIcon-r2xLvPEw.js";import{F as N}from"./EyeIcon-CLCqJwk9.js";import"./chart-vendor-Be69IwoK.js";const b=[{value:"mikrotik",label:"Mikrotik RouterOS"},{value:"cisco",label:"Cisco"},{value:"juniper",label:"Juniper"},{value:"ubiquiti",label:"Ubiquiti"},{value:"other",label:"Other"}];function y(){const y=e(),[_,w]=t.useState(!1),[f,S]=t.useState(null),[k,A]=t.useState(!1),[C,I]=t.useState(!1),[F,P]=t.useState([]),[R,D]=t.useState(!1),[U,$]=t.useState({ip_address:"",name:"",short_name:"",type:"mikrotik",secret:"",auth_port:1812,description:"",api_port:8728,api_username:"",api_password:"",coa_port:1700,is_active:!0,subscriber_pools:"",allowed_realms:""}),{data:E,isLoading:q}=s({queryKey:["nas"],queryFn:()=>m.list().then(e=>e.data.data)}),M=a({mutationFn:e=>f?m.update(f.id,e):m.create(e),onSuccess:()=>{u.success(f?"NAS updated":"NAS created"),y.invalidateQueries(["nas"]),O()},onError:e=>{var s,a;return u.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to save")}}),K=a({mutationFn:e=>m.delete(e),onSuccess:()=>{u.success("NAS deleted"),y.invalidateQueries(["nas"])},onError:e=>{var s,a;return u.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}}),L=a({mutationFn:e=>m.sync(e),onSuccess:()=>{u.success("NAS sync started"),y.invalidateQueries(["nas"])},onError:e=>{var s,a;return u.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to sync")}}),T=a({mutationFn:e=>m.test(e),onSuccess:e=>{var s;const a=e.data,r=(null==(s=a.router_info)?void 0:s.identity)||"",t=a.api_auth?"✓ API":"✗ API",l=a.secret_valid?"✓ RADIUS":"✗ RADIUS";a.api_auth&&a.secret_valid?u.success(`${r?r+" - ":""}${t} | ${l}`):a.api_auth||a.secret_valid?u.error(`${t} | ${l}\n${a.api_error||""} ${a.radius_error||""}`.trim()):a.is_online?u.error(`${t} | ${l}\nAPI: ${a.api_error||"Auth failed"}\nRADIUS: ${a.radius_error||"Secret invalid"}`):u.error(`✗ Cannot reach router\n${a.api_error||"Check IP address"}`),y.invalidateQueries(["nas"])},onError:e=>{var s,a;return u.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Test failed")}}),z=(e=null)=>{e?(S(e),$({ip_address:e.ip_address||"",name:e.name||"",short_name:e.short_name||"",type:e.type||"mikrotik",secret:e.secret||"",auth_port:e.auth_port||1812,description:e.description||"",api_port:e.api_port||8728,api_username:e.api_username||"",api_password:e.api_password||"",coa_port:e.coa_port||3799,is_active:e.is_active??!0,subscriber_pools:e.subscriber_pools||"",allowed_realms:e.allowed_realms||""})):(S(null),$({ip_address:"",name:"",short_name:"",type:"mikrotik",secret:"",auth_port:1812,description:"",api_port:8728,api_username:"",api_password:"",coa_port:1700,is_active:!0,subscriber_pools:"",allowed_realms:""})),P([]),w(!0)},O=()=>{w(!1),S(null),A(!1),I(!1)},Q=e=>{const{name:s,value:a,type:r,checked:t}=e.target;$(e=>({...e,[s]:"checkbox"===r?t:a}))},H=t.useMemo(()=>[{accessorKey:"name",header:"Name",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:r.jsx(l,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:e.original.name||e.original.short_name}),r.jsx("div",{className:"text-sm text-gray-500",children:e.original.description})]})]})},{accessorKey:"ip_address",header:"IP Address",cell:({row:e})=>r.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:e.original.ip_address})},{accessorKey:"type",header:"Type",cell:({row:e})=>r.jsx("span",{className:"badge badge-info capitalize",children:e.original.type})},{accessorKey:"auth_port",header:"Ports",cell:({row:e})=>r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{children:["RADIUS: ",e.original.auth_port]}),"mikrotik"===e.original.type&&r.jsxs("div",{children:["API: ",e.original.api_port]})]})},{accessorKey:"is_active",header:"Status",cell:({row:e})=>r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("div",{className:"flex items-center gap-2",children:e.original.is_active?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"Active"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Inactive"})]})}),r.jsx("div",{className:"flex items-center gap-2",children:e.original.is_online?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),r.jsx("span",{className:"text-xs text-green-600",children:"Online"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),r.jsx("span",{className:"text-xs text-red-500",children:"Offline"})]})}),r.jsx("div",{className:"flex items-center gap-2",children:e.original.secret?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"Secret ✓"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{className:"text-xs text-yellow-600",children:"No Secret"})]})}),"mikrotik"===e.original.type&&r.jsx("div",{className:"flex items-center gap-2",children:e.original.api_password?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"text-xs text-green-600",children:"API ✓"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{className:"text-xs text-yellow-600",children:"No API"})]})})]})},{id:"actions",header:"Actions",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>T.mutate(e.original.id),className:"p-1.5 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded",title:"Test Connection",children:r.jsx(i,{className:"w-4 h-4"})}),"mikrotik"===e.original.type&&r.jsx("button",{onClick:()=>L.mutate(e.original.id),className:"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded",title:"Sync with router",children:r.jsx(n,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>z(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 rounded",title:"Edit",children:r.jsx(j,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this NAS?")&&K.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded",title:"Delete",children:r.jsx(g,{className:"w-4 h-4"})})]})}],[K,L,T]),G=p({data:E||[],columns:H,getCoreRowModel:h()});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"NAS / Routers"}),r.jsx("p",{className:"text-gray-500",children:"Manage RADIUS clients and routers"})]}),r.jsxs("button",{onClick:()=>z(),className:"btn-primary flex items-center gap-2",children:[r.jsx(c,{className:"w-4 h-4"}),"Add NAS"]})]}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"table-container",children:r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:G.getHeaderGroups().map(e=>r.jsx("tr",{children:e.headers.map(e=>r.jsx("th",{children:x(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:q?r.jsx("tr",{children:r.jsx("td",{colSpan:H.length,className:"text-center py-8",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===G.getRowModel().rows.length?r.jsx("tr",{children:r.jsx("td",{colSpan:H.length,className:"text-center py-8 text-gray-500",children:"No NAS devices found"})}):G.getRowModel().rows.map(e=>r.jsx("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>r.jsx("td",{children:x(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),_&&r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:r.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:O}),r.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[r.jsx("h2",{className:"text-xl font-semibold",children:f?"Edit NAS":"Add NAS"}),r.jsx("button",{onClick:O,className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(d,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={...U};!s.secret&&f&&delete s.secret,!s.api_password&&f&&delete s.api_password,M.mutate(s)},className:"p-6 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"IP Address / Hostname"}),r.jsx("input",{type:"text",name:"ip_address",value:U.ip_address,onChange:Q,className:"input",placeholder:"192.168.1.1",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Name"}),r.jsx("input",{type:"text",name:"name",value:U.name,onChange:Q,className:"input",placeholder:"Main Router",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Short Name"}),r.jsx("input",{type:"text",name:"short_name",value:U.short_name,onChange:Q,className:"input",placeholder:"Router1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Type"}),r.jsx("select",{name:"type",value:U.type,onChange:Q,className:"input",children:b.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"RADIUS Secret"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:k?"text":"password",name:"secret",value:U.secret,onChange:Q,className:"input pr-10",placeholder:f?"••••••••":"Enter secret",required:!f}),r.jsx("button",{type:"button",onClick:()=>A(!k),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-500 hover:text-gray-700",children:k?r.jsx(v,{className:"w-5 h-5"}):r.jsx(N,{className:"w-5 h-5"})})]}),f&&r.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[r.jsx(o,{className:"w-3 h-3"}),"Secret is set. Leave blank to keep current."]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"RADIUS Port"}),r.jsx("input",{type:"number",name:"auth_port",value:U.auth_port,onChange:Q,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"Description"}),r.jsx("textarea",{name:"description",value:U.description,onChange:Q,className:"input",rows:2})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsx("label",{className:"label",children:"Allowed Realms (for RADIUS)"}),r.jsx("input",{type:"text",name:"allowed_realms",value:U.allowed_realms,onChange:Q,className:"input",placeholder:"e.g., test.mes.net.lb, other.domain.com"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Comma-separated list of realms. Users logging in as user@realm will have the realm stripped if it's in this list."})]}),"mikrotik"===U.type&&r.jsxs("div",{className:"border-t pt-4 space-y-4",children:[r.jsx("h3",{className:"font-medium",children:"Mikrotik API Settings"}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Port"}),r.jsx("input",{type:"text",name:"api_port",value:U.api_port,onChange:Q,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"CoA Port"}),r.jsx("input",{type:"text",name:"coa_port",value:U.coa_port,onChange:Q,className:"input"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Username"}),r.jsx("input",{type:"text",name:"api_username",value:U.api_username,onChange:Q,className:"input"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"label",children:"API Password"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:C?"text":"password",name:"api_password",value:U.api_password,onChange:Q,className:"input pr-10",placeholder:f?"••••••••":"Enter password"}),r.jsx("button",{type:"button",onClick:()=>I(!C),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-gray-500 hover:text-gray-700",children:C?r.jsx(v,{className:"w-5 h-5"}):r.jsx(N,{className:"w-5 h-5"})})]}),f&&r.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center gap-1",children:[r.jsx(o,{className:"w-3 h-3"}),"Password is set. Leave blank to keep current."]})]})]}),r.jsx("div",{className:"border-t pt-4",children:r.jsxs("label",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"checkbox",name:"is_active",checked:U.is_active,onChange:Q,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsx("span",{children:"Active NAS"})]})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx("button",{type:"button",onClick:O,className:"btn-secondary",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:M.isLoading,className:"btn-primary",children:M.isLoading?"Saving...":f?"Update":"Create"})]})]})]})]})})]})}export{y as default};
