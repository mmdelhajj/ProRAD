import{b as e,u as a,d as t,j as r}from"./data-vendor-Gi89QHLZ.js";import{r as s}from"./react-vendor-C1B6conR.js";import{O as d}from"./index-DcnEDZ_c.js";import"./ui-vendor-Bljr83Cq.js";import"./chart-vendor-C_esy2x0.js";function i(){const i=e(),[l,n]=s.useState(!1),[c,x]=s.useState(!1),[o,g]=s.useState(1),[u,m]=s.useState(""),[b,y]=s.useState(""),{data:p,isLoading:h}=a({queryKey:["prepaid",o,u,b],queryFn:()=>d.get("/prepaid",{params:{page:o,is_used:u,batch_id:b}}).then(e=>e.data)}),{data:k}=a({queryKey:["prepaid-batches"],queryFn:()=>d.get("/prepaid/batches").then(e=>e.data.data)}),{data:f}=a({queryKey:["services"],queryFn:()=>d.get("/services").then(e=>e.data.data)}),[v,j]=s.useState({service_id:"",count:10,value:0,days:30,quota_refill:0,prefix:"",code_length:12,pin_length:4}),[N,w]=s.useState({code:"",pin:"",subscriber_id:""}),C=t({mutationFn:e=>d.post("/prepaid/generate",e),onSuccess:()=>{i.invalidateQueries(["prepaid"]),i.invalidateQueries(["prepaid-batches"]),n(!1)}}),_=t({mutationFn:e=>d.post("/prepaid/use",e),onSuccess:()=>{i.invalidateQueries(["prepaid"]),x(!1),alert("Card redeemed successfully!")},onError:e=>{var a,t;alert((null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to redeem card")}}),S=t({mutationFn:e=>d.delete(`/prepaid/${e}`),onSuccess:()=>i.invalidateQueries(["prepaid"])}),P=t({mutationFn:e=>d.delete(`/prepaid/batch/${e}`),onSuccess:()=>{i.invalidateQueries(["prepaid"]),i.invalidateQueries(["prepaid-batches"])}});if(h)return r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const q=(null==p?void 0:p.data)||[],F=(null==p?void 0:p.meta)||{};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Prepaid Cards"}),r.jsxs("div",{className:"space-x-2",children:[r.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Redeem Card"}),r.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Generate Cards"})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:(k||[]).slice(0,4).map(e=>r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.batch_id}),r.jsxs("div",{className:"mt-2 flex justify-between",children:[r.jsx("span",{className:"text-2xl font-semibold text-green-600 dark:text-green-400",children:e.active}),r.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["/ ",e.total," total"]})]}),r.jsxs("div",{className:"mt-2 flex justify-between text-sm",children:[r.jsxs("span",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Used: ",e.used]}),e.active>0&&r.jsx("button",{onClick:()=>{confirm(`Delete all ${e.active} unused cards from ${e.batch_id}?`)&&P.mutate(e.batch_id)},className:"text-red-600 hover:text-red-800",children:"Delete Unused"})]})]},e.batch_id))}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow flex gap-4",children:[r.jsxs("select",{value:u,onChange:e=>{m(e.target.value),g(1)},className:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",children:[r.jsx("option",{value:"",children:"All Cards"}),r.jsx("option",{value:"false",children:"Available"}),r.jsx("option",{value:"true",children:"Used"})]}),r.jsxs("select",{value:b,onChange:e=>{y(e.target.value),g(1)},className:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",children:[r.jsx("option",{value:"",children:"All Batches"}),(k||[]).map(e=>r.jsx("option",{value:e.batch_id,children:e.batch_id},e.batch_id))]})]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden",children:[r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Code"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"PIN"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Value"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Days"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Service"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Batch"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:q.map(e=>{var a,t;return r.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono dark:text-gray-200",children:e.code}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-mono dark:text-gray-200",children:e.pin}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm dark:text-gray-200",children:["$",null==(a=e.value)?void 0:a.toFixed(2)]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm dark:text-gray-200",children:e.days}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm dark:text-gray-200",children:(null==(t=e.service)?void 0:t.name)||"-"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+(e.is_used?"bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300":"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300"),children:e.is_used?"Used":"Available"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.batch_id}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:!e.is_used&&r.jsx("button",{onClick:()=>S.mutate(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:"Delete"})})]},e.id)})})]}),F.totalPages>1&&r.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-700 flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Page ",o," of ",F.totalPages]}),r.jsxs("div",{className:"space-x-2",children:[r.jsx("button",{onClick:()=>g(e=>Math.max(1,e-1)),disabled:1===o,className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 dark:text-white rounded disabled:opacity-50",children:"Previous"}),r.jsx("button",{onClick:()=>g(e=>e+1),disabled:o>=F.totalPages,className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 dark:text-white rounded disabled:opacity-50",children:"Next"})]})]})]}),l&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Generate Prepaid Cards"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),C.mutate({...v,service_id:parseInt(v.service_id)||0})},className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Count"}),r.jsx("input",{type:"number",value:v.count,onChange:e=>j({...v,count:parseInt(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",min:"1",max:"1000",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Days"}),r.jsx("input",{type:"number",value:v.days,onChange:e=>j({...v,days:parseInt(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Service"}),r.jsxs("select",{value:v.service_id,onChange:e=>j({...v,service_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",children:[r.jsx("option",{value:"",children:"No service change"}),(f||[]).map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Prefix (optional)"}),r.jsx("input",{type:"text",value:v.prefix,onChange:e=>j({...v,prefix:e.target.value.toUpperCase()}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",maxLength:"6"})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),r.jsxs("button",{type:"submit",disabled:C.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:["Generate ",v.count," Cards"]})]})]})]})}),c&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 dark:text-white",children:"Redeem Prepaid Card"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),_.mutate({...N,subscriber_id:parseInt(N.subscriber_id)})},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Card Code"}),r.jsx("input",{type:"text",value:N.code,onChange:e=>w({...N,code:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"PIN"}),r.jsx("input",{type:"text",value:N.pin,onChange:e=>w({...N,pin:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Subscriber ID"}),r.jsx("input",{type:"number",value:N.subscriber_id,onChange:e=>w({...N,subscriber_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",required:!0})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:_.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Redeem"})]})]})]})})]})}export{i as default};
