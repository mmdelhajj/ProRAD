import{b as e,u as t,d as s,j as a}from"./data-vendor-C6mPcuPT.js";import{r as l}from"./react-vendor-C4Xey-hE.js";import{y as i}from"./index-DRJG7jyl.js";import{z as d}from"./ui-vendor-CMKyyIMz.js";import{F as r}from"./PlayIcon-0-RjI_79.js";import"./chart-vendor-Be69IwoK.js";function n(){const n=e(),[c,o]=l.useState(!1),[m,u]=l.useState(null),[x,p]=l.useState({name:"",trigger_type:"time",start_time:"00:00",end_time:"06:00",days_of_week:[0,1,2,3,4,5,6],upload_multiplier:100,download_multiplier:100,service_ids:[],priority:10,enabled:!0,auto_apply:!0}),{data:h,isLoading:b}=t({queryKey:["bandwidth-rules"],queryFn:()=>i.get("/bandwidth/rules").then(e=>e.data.data||[])}),{data:g}=t({queryKey:["services"],queryFn:()=>i.get("/services").then(e=>e.data.data||[])}),y=s({mutationFn:e=>i.post("/bandwidth/rules",e),onSuccess:()=>{n.invalidateQueries(["bandwidth-rules"]),_()}}),j=s({mutationFn:({id:e,...t})=>i.put(`/bandwidth/rules/${e}`,t),onSuccess:()=>{n.invalidateQueries(["bandwidth-rules"]),_()}}),v=s({mutationFn:e=>i.delete(`/bandwidth/rules/${e}`),onSuccess:()=>n.invalidateQueries(["bandwidth-rules"])}),f=s({mutationFn:({id:e,enabled:t})=>i.put(`/bandwidth/rules/${e}`,{enabled:t}),onSuccess:()=>n.invalidateQueries(["bandwidth-rules"])}),N=s({mutationFn:e=>i.post(`/bandwidth/rules/${e}/apply`),onSuccess:e=>{d.success(`Rule applied to ${e.data.applied_count} subscribers`)},onError:e=>{var t,s;d.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)||"Failed to apply rule")}}),w=[{value:0,label:"Sun"},{value:1,label:"Mon"},{value:2,label:"Tue"},{value:3,label:"Wed"},{value:4,label:"Thu"},{value:5,label:"Fri"},{value:6,label:"Sat"}],_=()=>{o(!1),u(null),p({name:"",trigger_type:"time",start_time:"00:00",end_time:"06:00",days_of_week:[0,1,2,3,4,5,6],upload_multiplier:100,download_multiplier:100,service_ids:[],priority:10,enabled:!0,auto_apply:!1})};return b?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Bandwidth Rules"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure time-based bandwidth adjustments"})]}),a.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Rule"})]}),a.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-blue-900",children:"Time-Based Bandwidth Rules"}),a.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Create rules to adjust bandwidth during specific hours (e.g., night boost). Enable Auto Apply to have rules activate automatically on schedule."})]}),a.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Schedule"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Speed Adjustment"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(h||[]).map(e=>{var t,s;return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(null==(t=e.service_ids)?void 0:t.length)>0&&a.jsxs("div",{className:"text-xs text-gray-500",children:[e.service_ids.length," service(s)"]})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.jsxs("div",{children:[a.jsxs("div",{children:[e.start_time," - ",e.end_time]}),a.jsx("div",{className:"text-xs",children:(s=e.days_of_week,s&&0!==s.length?7===s.length?"Every day":JSON.stringify(s.sort())===JSON.stringify([1,2,3,4,5])?"Weekdays":JSON.stringify(s.sort())===JSON.stringify([0,6])?"Weekends":s.map(e=>{var t;return null==(t=w.find(t=>t.value===e))?void 0:t.label}).join(", "):"Never")})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:e.upload_multiplier>100?"text-green-600":e.upload_multiplier<100?"text-red-600":"text-gray-600",children:[e.upload_multiplier>100?"+":"",e.upload_multiplier-100,"% UP"]}),a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsxs("span",{className:e.download_multiplier>100?"text-green-600":e.download_multiplier<100?"text-red-600":"text-gray-600",children:[e.download_multiplier>100?"+":"",e.download_multiplier-100,"% DN"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>f.mutate({id:e.id,enabled:!e.enabled}),className:"relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 "+(e.enabled?"bg-blue-600":"bg-gray-200"),children:a.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow transition duration-200 "+(e.enabled?"translate-x-5":"translate-x-0")})}),e.auto_apply&&a.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-green-100 text-green-700 rounded font-medium",children:"AUTO"})]})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[a.jsxs("button",{onClick:()=>N.mutate(e.id),disabled:N.isPending,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded hover:bg-green-200 mr-2",title:"Apply Now",children:[a.jsx(r,{className:"w-3 h-3 mr-1"}),"Apply"]}),a.jsx("button",{onClick:()=>(e=>{u(e),p({name:e.name,trigger_type:e.trigger_type,start_time:e.start_time||"00:00",end_time:e.end_time||"06:00",days_of_week:e.days_of_week||[0,1,2,3,4,5,6],upload_multiplier:e.upload_multiplier||100,download_multiplier:e.download_multiplier||100,service_ids:e.service_ids||[],priority:e.priority||10,enabled:e.enabled,auto_apply:e.auto_apply||!1}),o(!0)})(e),className:"text-blue-600 hover:text-blue-900 mr-3",children:"Edit"}),a.jsx("button",{onClick:()=>{confirm("Delete this rule?")&&v.mutate(e.id)},className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]}),0===(h||[]).length&&a.jsx("div",{className:"text-center py-8 text-gray-500",children:'No bandwidth rules configured. Click "Add Rule" to create one.'})]}),c&&a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[a.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75",onClick:_}),a.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:m?"Edit Rule":"Add Bandwidth Rule"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),m?j.mutate({id:m.id,...x}):y.mutate(x)},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rule Name"}),a.jsx("input",{type:"text",value:x.name,onChange:e=>p({...x,name:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"e.g., Night Boost, FUP Limit",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Time"}),a.jsx("input",{type:"time",value:x.start_time,onChange:e=>p({...x,start_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Time"}),a.jsx("input",{type:"time",value:x.end_time,onChange:e=>p({...x,end_time:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Days of Week"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(e=>a.jsx("button",{type:"button",onClick:()=>(e=>{const t=x.days_of_week.includes(e)?x.days_of_week.filter(t=>t!==e):[...x.days_of_week,e].sort();p({...x,days_of_week:t})})(e.value),className:"px-3 py-1 text-sm rounded-md "+(x.days_of_week.includes(e.value)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:e.label},e.value))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Upload Speed: ",a.jsxs("span",{className:"font-bold "+(x.upload_multiplier>100?"text-green-600":x.upload_multiplier<100?"text-red-600":"text-gray-600"),children:[x.upload_multiplier,"%"]})]}),a.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:x.upload_multiplier,onChange:e=>p({...x,upload_multiplier:parseInt(e.target.value)}),className:"mt-2 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),a.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[a.jsx("span",{children:"10%"}),a.jsx("span",{children:"50%"}),a.jsx("span",{children:"100%"}),a.jsx("span",{children:"200%"}),a.jsx("span",{children:"300%"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Download Speed: ",a.jsxs("span",{className:"font-bold "+(x.download_multiplier>100?"text-green-600":x.download_multiplier<100?"text-red-600":"text-gray-600"),children:[x.download_multiplier,"%"]})]}),a.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:x.download_multiplier,onChange:e=>p({...x,download_multiplier:parseInt(e.target.value)}),className:"mt-2 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),a.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[a.jsx("span",{children:"10%"}),a.jsx("span",{children:"50%"}),a.jsx("span",{children:"100%"}),a.jsx("span",{children:"200%"}),a.jsx("span",{children:"300%"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apply to Services"}),a.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2",children:(g||[]).map(e=>a.jsxs("label",{className:"flex items-center py-1",children:[a.jsx("input",{type:"checkbox",checked:x.service_ids.includes(e.id),onChange:t=>{const s=t.target.checked?[...x.service_ids,e.id]:x.service_ids.filter(t=>t!==e.id);p({...x,service_ids:s})},className:"rounded border-gray-300 text-blue-600"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:e.name})]},e.id))}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to apply to all services"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:x.enabled,onChange:e=>p({...x,enabled:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enabled"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:x.auto_apply,onChange:e=>p({...x,auto_apply:e.target.checked}),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Auto Apply (apply automatically on schedule)"})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:y.isPending||j.isPending,className:"px-4 py-2 text-sm text-white bg-blue-600 rounded-md hover:bg-blue-700",children:[m?"Update":"Create"," Rule"]})]})]})]})]})})]})}export{n as default};
