import{b as e,u as t,d as s,j as a}from"./data-vendor-C6mPcuPT.js";import{r}from"./react-vendor-C4Xey-hE.js";import{f as l,y as i}from"./index-DRJG7jyl.js";import"./ui-vendor-CMKyyIMz.js";import"./chart-vendor-Be69IwoK.js";const d={pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"};function n(){const n=e(),[o,c]=r.useState(!1),[u,m]=r.useState(!1),[x,p]=r.useState(null),[b,h]=r.useState(1),[g,y]=r.useState(""),{data:f,isLoading:j}=t({queryKey:["invoices",b,g],queryFn:()=>i.get("/invoices",{params:{page:b,status:g}}).then(e=>e.data)}),[v,N]=r.useState({subscriber_id:"",due_date:"",notes:"",items:[{description:"",quantity:1,unit_price:0}]}),[w,C]=r.useState({amount:0,method:"cash",reference:"",notes:""}),k=s({mutationFn:e=>i.post("/invoices",e),onSuccess:()=>{n.invalidateQueries(["invoices"]),c(!1)}}),_=s({mutationFn:({id:e,data:t})=>i.post(`/invoices/${e}/payment`,t),onSuccess:()=>{n.invalidateQueries(["invoices"]),m(!1)}}),S=s({mutationFn:e=>i.delete(`/invoices/${e}`),onSuccess:()=>n.invalidateQueries(["invoices"])}),P=(e,t,s)=>{const a=[...v.items];a[e][t]="quantity"===t||"unit_price"===t?parseFloat(s)||0:s,N({...v,items:a})};if(j)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const F=(null==f?void 0:f.data)||[],q=(null==f?void 0:f.meta)||{};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Invoices"}),a.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Invoice"})]}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:a.jsxs("select",{value:g,onChange:e=>{y(e.target.value),h(1)},className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"All Status"}),a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"completed",children:"Completed"}),a.jsx("option",{value:"failed",children:"Failed"})]})}),a.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Invoice #"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Subscriber"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Paid"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Due Date"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F.map(e=>{var t,s,r;return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.invoice_number}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null==(t=e.subscriber)?void 0:t.username)||"N/A"}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",null==(s=e.total)?void 0:s.toFixed(2)]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",null==(r=e.amount_paid)?void 0:r.toFixed(2)]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${d[e.status]||"bg-gray-100"}`,children:e.status})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l(e.due_date)}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:["completed"!==e.status&&a.jsx("button",{onClick:()=>(e=>{p(e),C({amount:e.total-e.amount_paid,method:"cash",reference:"",notes:""}),m(!0)})(e),className:"text-green-600 hover:text-green-900 mr-3",children:"Add Payment"}),"completed"!==e.status&&a.jsx("button",{onClick:()=>S.mutate(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]}),q.totalPages>1&&a.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-between items-center",children:[a.jsxs("span",{className:"text-sm text-gray-500",children:["Page ",b," of ",q.totalPages," (",q.total," total)"]}),a.jsxs("div",{className:"space-x-2",children:[a.jsx("button",{onClick:()=>h(e=>Math.max(1,e-1)),disabled:1===b,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Previous"}),a.jsx("button",{onClick:()=>h(e=>e+1),disabled:b>=q.totalPages,className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]})]}),o&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Create Invoice"}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),k.mutate({...v,subscriber_id:parseInt(v.subscriber_id)})},className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subscriber ID"}),a.jsx("input",{type:"number",value:v.subscriber_id,onChange:e=>N({...v,subscriber_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),a.jsx("input",{type:"date",value:v.due_date,onChange:e=>N({...v,due_date:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Items"}),v.items.map((e,t)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",placeholder:"Description",value:e.description,onChange:e=>P(t,"description",e.target.value),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),a.jsx("input",{type:"number",placeholder:"Qty",value:e.quantity,onChange:e=>P(t,"quantity",e.target.value),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),a.jsx("input",{type:"number",step:"0.01",placeholder:"Price",value:e.unit_price,onChange:e=>P(t,"unit_price",e.target.value),className:"w-24 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),v.items.length>1&&a.jsx("button",{type:"button",onClick:()=>(e=>{N({...v,items:v.items.filter((t,s)=>s!==e)})})(t),className:"px-2 text-red-600 hover:text-red-800",children:"X"})]},t)),a.jsx("button",{type:"button",onClick:()=>{N({...v,items:[...v.items,{description:"",quantity:1,unit_price:0}]})},className:"text-sm text-blue-600 hover:text-blue-800",children:"+ Add Item"})]}),a.jsxs("div",{className:"text-right text-lg font-semibold",children:["Total: $",v.items.reduce((e,t)=>e+t.quantity*t.unit_price,0).toFixed(2)]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),a.jsx("textarea",{value:v.notes,onChange:e=>N({...v,notes:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:3})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:k.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Create Invoice"})]})]})]})}),u&&x&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Add Payment"}),a.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Invoice: ",x.invoice_number," | Balance: $",(x.total-x.amount_paid).toFixed(2)]}),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),_.mutate({id:x.id,data:w})},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Amount"}),a.jsx("input",{type:"number",step:"0.01",value:w.amount,onChange:e=>C({...w,amount:parseFloat(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Method"}),a.jsxs("select",{value:w.method,onChange:e=>C({...w,method:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"cash",children:"Cash"}),a.jsx("option",{value:"card",children:"Card"}),a.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),a.jsx("option",{value:"online",children:"Online"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reference"}),a.jsx("input",{type:"text",value:w.reference,onChange:e=>C({...w,reference:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:_.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Add Payment"})]})]})]})})]})}export{n as default};
