import{b as e,u as s,d as r,j as a}from"./data-vendor-Gi89QHLZ.js";import{r as t}from"./react-vendor-C1B6conR.js";import{w as i,a as d,c as n,G as l}from"./index-DVgICkVZ.js";import{z as o}from"./ui-vendor-Bljr83Cq.js";import{F as c}from"./MagnifyingGlassIcon-CymQwI_A.js";import{F as m}from"./PencilIcon-BjNR2RGb.js";import{F as x}from"./TrashIcon-BFqTFmN6.js";import"./chart-vendor-C_esy2x0.js";function p(){const p=e(),[u,g]=t.useState("list"),[h,y]=t.useState(null),[b,j]=t.useState({name:"",description:"",permissions:[]}),[f,N]=t.useState(""),[v,k]=t.useState(""),{data:w,isLoading:S,refetch:C}=s({queryKey:["permissions"],queryFn:async()=>(await l.list()).data}),{data:P,isLoading:F,refetch:I}=s({queryKey:["permission-groups"],queryFn:async()=>(await l.listGroups()).data}),D=r({mutationFn:()=>l.seed(),onSuccess:()=>{p.invalidateQueries(["permissions"]),o.success("Default permissions seeded successfully")}}),G=r({mutationFn:e=>h?l.updateGroup(h.id,e):l.createGroup(e),onSuccess:()=>{p.invalidateQueries(["permission-groups"]),o.success(h?"Permission group updated":"Permission group created"),g("list"),y(null),j({name:"",description:"",permissions:[]})},onError:e=>{var s,r;o.error((null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.message)||"Failed to save permission group")}}),L=r({mutationFn:e=>l.deleteGroup(e),onSuccess:()=>{p.invalidateQueries(["permission-groups"]),o.success("Permission group deleted")}}),E=(null==w?void 0:w.data)||[],R=((null==P?void 0:P.data)||[]).filter(e=>e.name.toLowerCase().includes(f.toLowerCase())),q=v?E.filter(e=>{var s,r;return(null==(s=e.name)?void 0:s.toLowerCase().includes(v.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(v.toLowerCase()))}):E,O=q.reduce((e,s)=>{var r;const a=(null==(r=s.name)?void 0:r.split(".")[0])||"Other";return e[a]||(e[a]=[]),e[a].push(s),e},{}),A=Object.keys(O).sort(),M=e=>{e.preventDefault(),b.name.trim()?G.mutate({name:b.name,description:b.description,permission_ids:b.permissions}):o.error("Group name is required")};return S||F?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):"edit"===u?a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:h?"EDIT PERMISSIONS":"ADD PERMISSION GROUP"})}),a.jsx("form",{onSubmit:M,children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"flex items-end gap-6",children:[a.jsxs("div",{className:"flex-1 max-w-md",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"GroupName*"}),a.jsx("input",{type:"text",value:b.name,onChange:e=>j({...b,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter group name",required:!0})]}),a.jsxs("div",{className:"relative",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search Permissions"}),a.jsxs("div",{className:"relative",children:[a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",value:v,onChange:e=>k(e.target.value),className:"pl-9 pr-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 w-64",placeholder:"Search permissions..."})]})]})]}),v&&a.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Found ",q.length," permission",1!==q.length?"s":"",' matching "',v,'"',0===q.length&&a.jsx("span",{className:"text-red-500 ml-2",children:"- No results found"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-teal-500 text-white px-4 py-2 rounded-t-md font-medium",children:"Permissions"}),a.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 dark:bg-gray-700 rounded-b-md p-4 space-y-4 max-h-[500px] overflow-y-auto",children:[0===A.length&&a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No permissions found"}),A.map(e=>a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"font-medium text-gray-900 dark:text-white capitalize text-sm",children:e}),a.jsxs("label",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[a.jsx("input",{type:"checkbox",checked:O[e].every(e=>b.permissions.includes(e.id)),onChange:s=>((e,s)=>{const r=O[e].map(e=>e.id);j(e=>({...e,permissions:s?[...new Set([...e.permissions,...r])]:e.permissions.filter(e=>!r.includes(e))}))})(e,s.target.checked),className:"rounded border-gray-300 text-teal-600 mr-1"}),"All"]})]}),a.jsx("div",{className:"space-y-1 pl-2",children:O[e].map(e=>a.jsxs("label",{className:"flex items-center cursor-pointer py-0.5",children:[a.jsx("input",{type:"checkbox",checked:b.permissions.includes(e.id),onChange:()=>{return s=e.id,void j(e=>({...e,permissions:e.permissions.includes(s)?e.permissions.filter(e=>e!==s):[...e.permissions,s]}));var s},className:"rounded border-gray-300 text-teal-600 focus:ring-teal-500"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:e.description||e.name})]},e.id))})]},e))]})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"submit",disabled:G.isPending,className:"px-6 py-2 bg-teal-500 text-white rounded-md hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 disabled:opacity-50",children:G.isPending?"Saving...":h?"Update":"Create"}),a.jsxs("button",{type:"button",onClick:()=>{g("list"),y(null)},className:"px-6 py-2 bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:[a.jsx(i,{className:"h-4 w-4 inline mr-1"}),"Back to List"]})]})]})})]})}):a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"PERMISSIONS"})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>{I(),C(),o.success("Refreshed")},className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white hover:bg-gray-50 dark:bg-gray-700",children:[a.jsx(d,{className:"h-4 w-4 mr-2"}),"Refresh"]}),a.jsxs("button",{onClick:()=>{y(null),j({name:"",description:"",permissions:[]}),k(""),g("edit")},className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white hover:bg-gray-50 dark:bg-gray-700",children:[a.jsx(n,{className:"h-4 w-4 mr-2"}),"Add"]}),0===E.length&&a.jsx("button",{onClick:()=>D.mutate(),disabled:D.isPending,className:"inline-flex items-center px-4 py-2 border border-blue-300 rounded-md shadow-sm text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100",children:D.isPending?"Seeding...":"Seed Default Permissions"})]}),a.jsxs("div",{className:"relative",children:[a.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search groups...",value:f,onChange:e=>N(e.target.value),className:"pl-9 pr-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm w-48"})]})]}),a.jsx("div",{className:"overflow-x-auto border border-gray-200 dark:border-gray-600 rounded-md",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-20",children:"ID"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-32",children:"Permissions"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Resellers"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-32",children:"Actions"})]})}),a.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:0===R.length?a.jsx("tr",{children:a.jsx("td",{colSpan:"5",className:"px-6 py-8 text-center text-gray-500 dark:text-gray-400",children:"No permission groups found"})}):R.map((e,s)=>{var r;return a.jsxs("tr",{className:s%2==0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.id}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:(null==(r=e.permissions)?void 0:r.length)||0}),a.jsx("td",{className:"px-6 py-4 text-sm",children:e.resellers&&e.resellers.length>0?a.jsx("div",{className:"flex flex-wrap gap-1",children:e.resellers.map(e=>a.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",title:e.full_name||e.username,children:e.username},e.id))}):a.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"-"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>(e=>{var s;y(e),j({name:e.name,description:e.description||"",permissions:(null==(s=e.permissions)?void 0:s.map(e=>e.id))||[]}),k(""),g("edit")})(e),className:"text-blue-600 hover:text-blue-900",title:"Edit",children:a.jsx(m,{className:"h-5 w-5"})}),a.jsx("button",{onClick:()=>{confirm("Delete this permission group?")&&L.mutate(e.id)},className:"text-red-600 hover:text-red-900",title:"Delete",children:a.jsx(x,{className:"h-5 w-5"})})]})})]},e.id)})})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-4 text-sm text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{children:["total: ",R.length]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"Page size:"}),a.jsxs("select",{className:"border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded px-2 py-1 text-sm",children:[a.jsx("option",{children:"10"}),a.jsx("option",{children:"25"}),a.jsx("option",{children:"50"})]})]})]})]})]})})}export{p as default};
