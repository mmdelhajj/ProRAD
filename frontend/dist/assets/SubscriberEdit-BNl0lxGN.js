import{b as e,u as a,d as t,j as s}from"./data-vendor-DrqtOFCb.js";import{f as n,b as l,r as i,L as r}from"./react-vendor-_qYBQpt5.js";import{u as d,l as o,m as c,o as u,p as x,e as p,q as h,d as m,t as g,F as v,s as j,k as y,n as b,r as f,v as N}from"./index-WRM7fWDP.js";import{c as _,z as w}from"./ui-vendor-C17HITwC.js";import{E as k}from"./chart-vendor-CsTzT1mg.js";import{L as S}from"./leaflet-src-yaYzS9J7.js";import{F as C}from"./MapPinIcon-DqwKe7Qx.js";function A({lat:e,lng:a,onLocationChange:t,flyTarget:n}){const l=i.useRef(null),r=i.useRef(null),d=i.useRef(null),o=i.useRef(t);return i.useEffect(()=>{o.current=t}),i.useEffect(()=>{if(!l.current)return;const t=S.map(l.current,{center:[e||33.8938,a||35.5018],zoom:e&&a?15:9});if(S.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(t),e&&a){const s=S.marker([e,a],{draggable:!0}).addTo(t);s.on("dragend",e=>{const a=e.target.getLatLng();o.current(a.lat,a.lng)}),d.current=s}return t.on("click",e=>o.current(e.latlng.lat,e.latlng.lng)),r.current=t,()=>{t.remove(),r.current=null,d.current=null}},[]),i.useEffect(()=>{const t=r.current;if(t)if(e&&a)if(d.current)d.current.setLatLng([e,a]);else{const s=S.marker([e,a],{draggable:!0}).addTo(t);s.on("dragend",e=>{const a=e.target.getLatLng();o.current(a.lat,a.lng)}),d.current=s}else d.current&&(d.current.remove(),d.current=null)},[e,a]),i.useEffect(()=>{r.current&&n&&r.current.flyTo(n,15,{duration:.5})},[n]),s.jsx("div",{ref:l,style:{height:"280px",width:"100%"}})}delete S.Icon.Default.prototype._getIconUrl,S.Icon.Default.mergeOptions({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});const M=[{id:"info",name:"Info",icon:o},{id:"usage",name:"Usage",icon:c},{id:"graph",name:"Live Graph",icon:u},{id:"invoices",name:"Invoices",icon:x},{id:"logs",name:"Logs",icon:p}];function F(){var o,c,u;const{id:x}=n(),p=l(),S=e(),{hasPermission:F}=d(),I=!x||"new"===x,[B,D]=i.useState(!1),[L,P]=i.useState(()=>{if(I)return"info";const e=localStorage.getItem(`subscriber-tab-${x}`);return["info","usage","graph","invoices","logs"].includes(e)?e:"info"}),[E,R]=i.useState({download:0,upload:0,uptime:"",ipAddress:"",cdnTraffic:[],portRuleTraffic:[]}),$=i.useRef(null),U=i.useRef(Array(30).fill(0)),T=i.useRef(Array(30).fill(0)),G=i.useRef({}),q=i.useRef({}),[K,z]=i.useState([]),H=i.useRef({});i.useRef({});const[O,J]=i.useState([]),[Q,W]=i.useState({ms:0,ok:!1}),Y=i.useRef(Array(30).fill(null)),[V,Z]=i.useState({username:"",password:"",full_name:"",email:"",phone:"",address:"",region:"",building:"",nationality:"",country:"",service_id:"",nas_id:"",reseller_id:"",status:1,auto_renew:!1,mac_address:"",save_mac:!0,static_ip:"",simultaneous_sessions:1,expiry_date:"",note:"",price:"",override_price:!1,latitude:0,longitude:0}),{data:X,isLoading:ee}=a({queryKey:["subscriber",x],queryFn:()=>j.get(x).then(e=>e.data),enabled:!I}),ae=null==X?void 0:X.data,te=(null==X?void 0:X.password)||"",se=null==X?void 0:X.daily_quota,ne=null==X?void 0:X.monthly_quota,le=(null==X?void 0:X.sessions)||[],{data:ie}=a({queryKey:["services-list"],queryFn:()=>y.list().then(e=>e.data.data)}),{data:re}=a({queryKey:["nas-list"],queryFn:()=>b.list().then(e=>e.data.data)}),{data:de}=a({queryKey:["resellers-list"],queryFn:()=>f.list().then(e=>e.data.data)}),{data:oe,refetch:ce}=a({queryKey:["bandwidth-rules",x],queryFn:()=>j.getBandwidthRules(x).then(e=>e.data),enabled:!I&&!!x}),ue=(null==oe?void 0:oe.data)||[],{data:xe}=a({queryKey:["cdn-upgrades",x],queryFn:()=>j.getCDNUpgrades(x).then(e=>e.data),enabled:!I&&!!x});null==xe||xe.available_upgrades;const pe=(null==xe?void 0:xe.current_cdns)||[],{data:he}=a({queryKey:["cdn-speeds"],queryFn:()=>N.getSpeeds().then(e=>e.data)}),me=(null==he?void 0:he.data)||[],ge=me.filter(e=>{if(!V.nas_id)return!0;if(!e.nas_ids||""===e.nas_ids)return!0;return e.nas_ids.split(",").map(e=>e.trim()).includes(String(V.nas_id))}),ve=e=>{const a=me.find(a=>a.cdn_id===parseInt(e));return(null==a?void 0:a.speeds)||[]},[je,ye]=i.useState(null),[be,fe]=i.useState(!1),[Ne,_e]=i.useState(!1),[we,ke]=i.useState(null),[Se,Ce]=i.useState({rule_type:"internet",enabled:!0,download_speed:"",upload_speed:"",duration:"permanent",priority:0,cdn_id:"",cdn_speed:""}),Ae=()=>{Ce({rule_type:"internet",enabled:!0,download_speed:"",upload_speed:"",duration:"permanent",priority:0,cdn_id:"",cdn_speed:""}),ke(null)},Me=(e=null)=>{if(e){ke(e);const a="cdn"===e.rule_type;Ce({rule_type:e.rule_type||"internet",enabled:e.enabled??!0,download_speed:a?Math.round((e.download_speed||0)/1e3):e.download_speed||"",upload_speed:a?Math.round((e.upload_speed||0)/1e3):e.upload_speed||"",duration:e.duration||"permanent",priority:e.priority||0,cdn_id:e.cdn_id||"",cdn_speed:e.cdn_speed||""})}else Ae();_e(!0)};i.useEffect(()=>{ae&&Z({username:ae.username||"",password:te||"",full_name:ae.full_name||"",email:ae.email||"",phone:ae.phone||"",address:ae.address||"",region:ae.region||"",building:ae.building||"",nationality:ae.nationality||"",country:ae.country||"",service_id:ae.service_id||"",nas_id:ae.nas_id||"",reseller_id:ae.reseller_id||"",status:ae.status??1,auto_renew:ae.auto_renew??!1,mac_address:ae.mac_address||"",save_mac:ae.save_mac??!1,static_ip:ae.static_ip||"",simultaneous_sessions:ae.simultaneous_sessions||1,expiry_date:ae.expiry_date?ae.expiry_date.split("T")[0]:"",note:ae.note||"",price:ae.price||"",override_price:ae.override_price||!1,latitude:ae.latitude||0,longitude:ae.longitude||0})},[ae,te,x,I]),i.useEffect(()=>{if("graph"!==L||!(null==ae?void 0:ae.is_online)||I)return;let e=!0;const a=async()=>{try{const a=await j.getBandwidth(x);if(a.data.success&&e){const e=a.data.data,t=e.download||0,s=e.upload||0,n=e.cdn_traffic||[],l=e.cdn_is_rate||!1,i=e.port_rule_traffic||[],r=[];let d=0;n.forEach(e=>{G.current[e.cdn_id]||(G.current[e.cdn_id]=Array(30).fill(0));const a=e.bytes||0;let t=0;if(l)t=8*a/1e6||0;else{const s=q.current[e.cdn_id];if(void 0!==s&&a>=s){t=8*(a-s)/1e6/2||0}q.current[e.cdn_id]=a}G.current[e.cdn_id]=[...G.current[e.cdn_id].slice(1),t],d+=t,r.push({id:e.cdn_id,name:e.cdn_name,color:e.color})}),z(r);const o=[];i.forEach(e=>{H.current[e.rule_id]||(H.current[e.rule_id]=Array(30).fill(0));const a=8*(e.bytes||0)/1e6||0;H.current[e.rule_id]=[...H.current[e.rule_id].slice(1),a],o.push({id:e.rule_id,name:e.rule_name,color:e.color})}),J(o);const c=Math.max(0,t-d);if(R({download:c.toFixed(2),upload:s.toFixed(2),uptime:e.uptime||"",ipAddress:e.ip_address||"",cdnTraffic:n,portRuleTraffic:i}),e.ping_ok?(W({ms:e.ping_ms,ok:!0}),Y.current=[...Y.current.slice(1),e.ping_ms]):(W(e=>({...e,ok:!1})),Y.current=[...Y.current.slice(1),null]),U.current=[...U.current.slice(1),c],T.current=[...T.current.slice(1),s],$.current){const e=$.current.getEchartsInstance();if(e){const a=["Download","Upload","Ping (ms)",...r.map(e=>e.name),...o.map(e=>e.name)],t=[{name:"Download",data:U.current},{name:"Upload",data:T.current},{name:"Ping (ms)",type:"line",yAxisIndex:1,smooth:!1,data:Y.current,lineStyle:{color:"#F59E0B",width:1.5,type:"dotted"},itemStyle:{color:"#F59E0B"},showSymbol:!1,connectNulls:!1,z:10},...r.map(e=>({name:e.name,type:"line",smooth:!0,data:G.current[e.id]||Array(30).fill(0),lineStyle:{color:e.color,width:2},itemStyle:{color:e.color},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:e.color+"66"},{offset:1,color:e.color+"0D"}]}},showSymbol:!1})),...o.map(e=>({name:e.name,type:"line",smooth:!0,data:H.current[e.id]||Array(30).fill(0),lineStyle:{color:e.color,width:2,type:"dashed"},itemStyle:{color:e.color},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:e.color+"55"},{offset:1,color:e.color+"0D"}]}},showSymbol:!1}))];e.setOption({legend:{data:a},series:t})}}}}catch(a){}};a();const t=setInterval(a,2e3);return()=>{e=!1,clearInterval(t)}},[L,null==ae?void 0:ae.is_online,I,x]);const Fe=t({mutationFn:e=>I?j.create(e):j.update(x,e),onSuccess:e=>{var a;w.success(I?"Subscriber created":"Subscriber updated"),S.invalidateQueries(["subscribers"]),I?p(`/subscribers/${(null==(a=e.data.data)?void 0:a.id)||e.data.id}`):S.invalidateQueries(["subscriber",x])},onError:e=>{var a,t;return w.error((null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to save")}}),Ie=t({mutationFn:e=>we?j.updateBandwidthRule(x,we.id,e):j.createBandwidthRule(x,e),onSuccess:()=>{w.success(we?"Rule updated":"Rule created"),ce(),_e(!1),Ae()},onError:e=>{var a,t;return w.error((null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to save rule")}}),Be=t({mutationFn:e=>j.deleteBandwidthRule(x,e),onSuccess:()=>{w.success("Rule deleted"),ce()},onError:e=>{var a,t;return w.error((null==(t=null==(a=e.response)?void 0:a.data)?void 0:t.message)||"Failed to delete rule")}}),De=e=>{const{name:a,value:t,type:s,checked:n}=e.target;Z(e=>({...e,[a]:"checkbox"===s?n:t}))},Le={animation:!0,animationDuration:300,animationEasing:"linear",tooltip:{trigger:"axis",formatter:e=>{let a=e[0].name+"<br/>";return e.forEach(e=>{if(null===e.value||void 0===e.value)return;const t="Ping (ms)"===e.seriesName,s="number"==typeof e.value?e.value.toFixed(t?1:2):"â€”",n=t?"ms":"Mbps";a+=`${e.marker} ${e.seriesName}: ${s} ${n}<br/>`}),a}},legend:{data:["Download","Upload","Ping (ms)"],top:0},grid:{left:"3%",right:"8%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:Array.from({length:30},(e,a)=>30-a+"s"),axisLine:{lineStyle:{color:"#ccc"}}},yAxis:[{type:"value",min:0,max:e=>{const a=Math.max(e.max,.1);return Math.max(3,Math.ceil(1.2*a))},axisLabel:{formatter:"{value} Mbps"},axisLine:{lineStyle:{color:"#ccc"}},splitLine:{lineStyle:{color:"#eee"}}},{type:"value",name:"ms",min:0,max:e=>Math.max(100,Math.ceil(1.3*e.max)),position:"right",axisLabel:{formatter:"{value} ms",color:"#F59E0B"},axisLine:{lineStyle:{color:"#F59E0B33"}},splitLine:{show:!1}}],series:[{name:"Download",type:"line",yAxisIndex:0,smooth:!0,data:U.current,lineStyle:{color:"#10B981",width:2},itemStyle:{color:"#10B981"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(16, 185, 129, 0.4)"},{offset:1,color:"rgba(16, 185, 129, 0.05)"}]}},showSymbol:!1},{name:"Upload",type:"line",yAxisIndex:0,smooth:!0,data:T.current,lineStyle:{color:"#3B82F6",width:2},itemStyle:{color:"#3B82F6"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(59, 130, 246, 0.4)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}]}},showSymbol:!1},{name:"Ping (ms)",type:"line",yAxisIndex:1,smooth:!1,data:Y.current,lineStyle:{color:"#F59E0B",width:1.5,type:"dotted"},itemStyle:{color:"#F59E0B"},showSymbol:!1,connectNulls:!1,z:10}]};return!I&&ee?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:I?"Add Subscriber":`Edit: ${null==ae?void 0:ae.username}`}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:I?"Create a new PPPoE subscriber":"Manage subscriber details"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[!I&&(null==ae?void 0:ae.is_online)&&s.jsx("span",{className:"badge badge-success",children:"Online"}),!I&&!(null==ae?void 0:ae.is_online)&&s.jsx("span",{className:"badge badge-gray",children:"Offline"}),!I&&(null==ae?void 0:ae.fup_level)>0&&s.jsxs("span",{className:"px-2.5 py-1 text-xs font-bold bg-red-500 text-white rounded-full animate-pulse",children:["FUP ",1===ae.fup_level?"(Daily)":"(Monthly)"]})]})]}),!I&&s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:M.map(e=>s.jsxs("button",{onClick:()=>{return a=e.id,P(a),void(I||localStorage.setItem(`subscriber-tab-${x}`,a));var a},className:_("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm",L===e.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-200 hover:border-gray-300"),children:[s.jsx(e.icon,{className:"w-5 h-5"}),e.name]},e.id))})}),(I||"info"===L)&&s.jsxs("form",{onSubmit:e=>{e.preventDefault();const a={...V};a.password||delete a.password,a.override_price&&""!==a.price?a.price=parseFloat(a.price):(a.price=0,a.override_price=!1),a.service_id&&(a.service_id=parseInt(a.service_id)),a.nas_id?a.nas_id=parseInt(a.nas_id):delete a.nas_id,a.reseller_id?a.reseller_id=parseInt(a.reseller_id):delete a.reseller_id,a.status=parseInt(a.status),a.simultaneous_sessions=parseInt(a.simultaneous_sessions)||1,Fe.mutate(a)},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Account Information"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"label",children:["Username (PPPoE) ",!I&&s.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(locked)"})]}),s.jsx("input",{type:"text",name:"username",value:V.username,onChange:De,className:"input "+(I?"":"bg-gray-100 cursor-not-allowed"),required:!0,autoComplete:"off",disabled:!I})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Password"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx("input",{type:B?"text":"password",name:"password",value:V.password,onChange:De,className:"input pr-10",placeholder:I?"":"Leave blank to keep current",required:I,autoComplete:"new-password"}),s.jsx("button",{type:"button",onClick:()=>D(!B),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:B?s.jsx(h,{className:"h-5 w-5"}):s.jsx(m,{className:"h-5 w-5"})})]}),s.jsx("button",{type:"button",onClick:()=>{const e="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789",a=8+Math.floor(3*Math.random());let t="";for(let s=0;s<a;s++)t+=e.charAt(Math.floor(55*Math.random()));Z(e=>({...e,password:t})),D(!0)},className:"btn btn-secondary whitespace-nowrap",children:"Generate"})]})]}),I||F("subscribers.change_service")?s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Service Plan"}),s.jsxs("select",{name:"service_id",value:V.service_id,onChange:De,className:"input",required:!0,children:[s.jsx("option",{value:"",children:"Select Service"}),null==ie?void 0:ie.map(e=>s.jsxs("option",{value:e.id,children:[e.name," - $",e.price]},e.id))]})]}):s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Service Plan"}),s.jsx("input",{type:"text",value:(null==(o=null==ie?void 0:ie.find(e=>e.id===parseInt(V.service_id)))?void 0:o.name)||"N/A",className:"input bg-gray-100 dark:bg-gray-700",disabled:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Price"}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("input",{type:"checkbox",id:"override_price",name:"override_price",checked:V.override_price,onChange:De,className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),s.jsx("label",{htmlFor:"override_price",className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer",children:"Override service price for this subscriber"})]}),V.override_price?s.jsx("input",{type:"number",name:"price",value:V.price,onChange:De,placeholder:"Enter custom price",step:"0.01",min:"0",className:"input"}):s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600",children:["Using service default: $",(null==(c=null==ie?void 0:ie.find(e=>e.id==V.service_id))?void 0:c.price)??"â€”"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"NAS"}),s.jsxs("select",{name:"nas_id",value:V.nas_id,onChange:De,className:"input",children:[s.jsx("option",{value:"",children:"Select NAS"}),null==re?void 0:re.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.ip_address,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Reseller"}),s.jsxs("select",{name:"reseller_id",value:V.reseller_id,onChange:De,className:"input",children:[s.jsx("option",{value:"",children:"No Reseller (Admin)"}),null==de?void 0:de.map(e=>s.jsxs("option",{value:e.id,children:[e.name||e.username," (Balance: $",e.balance,")"]},e.id))]})]}),!I&&(null==ae?void 0:ae.created_at)&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Created At"}),s.jsx("div",{className:"input bg-gray-50 dark:bg-gray-700 cursor-default text-gray-700 dark:text-gray-200 font-medium",children:g(ae.created_at)})]})]})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Personal Information"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Full Name"}),s.jsx("input",{type:"text",name:"full_name",value:V.full_name,onChange:De,className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Email"}),s.jsx("input",{type:"email",name:"email",value:V.email,onChange:De,className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Phone"}),s.jsx("input",{type:"tel",name:"phone",value:V.phone,onChange:De,className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Address"}),s.jsx("textarea",{name:"address",value:V.address,onChange:De,className:"input",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Region"}),s.jsx("input",{type:"text",name:"region",value:V.region,onChange:De,className:"input"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Building"}),s.jsx("input",{type:"text",name:"building",value:V.building,onChange:De,className:"input"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Nationality"}),s.jsxs("select",{name:"nationality",value:V.nationality,onChange:De,className:"input",children:[s.jsx("option",{value:"",children:"Select Nationality"}),s.jsx("option",{value:"Afghan",children:"Afghan"}),s.jsx("option",{value:"Albanian",children:"Albanian"}),s.jsx("option",{value:"Algerian",children:"Algerian"}),s.jsx("option",{value:"Argentine",children:"Argentine"}),s.jsx("option",{value:"Australian",children:"Australian"}),s.jsx("option",{value:"Austrian",children:"Austrian"}),s.jsx("option",{value:"Bahraini",children:"Bahraini"}),s.jsx("option",{value:"Bangladeshi",children:"Bangladeshi"}),s.jsx("option",{value:"Belgian",children:"Belgian"}),s.jsx("option",{value:"Brazilian",children:"Brazilian"}),s.jsx("option",{value:"Canadian",children:"Canadian"}),s.jsx("option",{value:"Chinese",children:"Chinese"}),s.jsx("option",{value:"Colombian",children:"Colombian"}),s.jsx("option",{value:"Czech",children:"Czech"}),s.jsx("option",{value:"Danish",children:"Danish"}),s.jsx("option",{value:"Egyptian",children:"Egyptian"}),s.jsx("option",{value:"Finnish",children:"Finnish"}),s.jsx("option",{value:"French",children:"French"}),s.jsx("option",{value:"German",children:"German"}),s.jsx("option",{value:"Greek",children:"Greek"}),s.jsx("option",{value:"Hong Konger",children:"Hong Konger"}),s.jsx("option",{value:"Hungarian",children:"Hungarian"}),s.jsx("option",{value:"Indian",children:"Indian"}),s.jsx("option",{value:"Indonesian",children:"Indonesian"}),s.jsx("option",{value:"Iranian",children:"Iranian"}),s.jsx("option",{value:"Iraqi",children:"Iraqi"}),s.jsx("option",{value:"Irish",children:"Irish"}),s.jsx("option",{value:"Israeli",children:"Israeli"}),s.jsx("option",{value:"Italian",children:"Italian"}),s.jsx("option",{value:"Japanese",children:"Japanese"}),s.jsx("option",{value:"Jordanian",children:"Jordanian"}),s.jsx("option",{value:"Kuwaiti",children:"Kuwaiti"}),s.jsx("option",{value:"Lebanese",children:"Lebanese"}),s.jsx("option",{value:"Libyan",children:"Libyan"}),s.jsx("option",{value:"Malaysian",children:"Malaysian"}),s.jsx("option",{value:"Mexican",children:"Mexican"}),s.jsx("option",{value:"Moroccan",children:"Moroccan"}),s.jsx("option",{value:"Dutch",children:"Dutch"}),s.jsx("option",{value:"New Zealander",children:"New Zealander"}),s.jsx("option",{value:"Nigerian",children:"Nigerian"}),s.jsx("option",{value:"Norwegian",children:"Norwegian"}),s.jsx("option",{value:"Omani",children:"Omani"}),s.jsx("option",{value:"Pakistani",children:"Pakistani"}),s.jsx("option",{value:"Palestinian",children:"Palestinian"}),s.jsx("option",{value:"Filipino",children:"Filipino"}),s.jsx("option",{value:"Polish",children:"Polish"}),s.jsx("option",{value:"Portuguese",children:"Portuguese"}),s.jsx("option",{value:"Qatari",children:"Qatari"}),s.jsx("option",{value:"Romanian",children:"Romanian"}),s.jsx("option",{value:"Russian",children:"Russian"}),s.jsx("option",{value:"Saudi",children:"Saudi"}),s.jsx("option",{value:"Singaporean",children:"Singaporean"}),s.jsx("option",{value:"South African",children:"South African"}),s.jsx("option",{value:"South Korean",children:"South Korean"}),s.jsx("option",{value:"Spanish",children:"Spanish"}),s.jsx("option",{value:"Sudanese",children:"Sudanese"}),s.jsx("option",{value:"Swedish",children:"Swedish"}),s.jsx("option",{value:"Swiss",children:"Swiss"}),s.jsx("option",{value:"Syrian",children:"Syrian"}),s.jsx("option",{value:"Taiwanese",children:"Taiwanese"}),s.jsx("option",{value:"Thai",children:"Thai"}),s.jsx("option",{value:"Tunisian",children:"Tunisian"}),s.jsx("option",{value:"Turkish",children:"Turkish"}),s.jsx("option",{value:"Ukrainian",children:"Ukrainian"}),s.jsx("option",{value:"Emirati",children:"Emirati"}),s.jsx("option",{value:"British",children:"British"}),s.jsx("option",{value:"American",children:"American"}),s.jsx("option",{value:"Vietnamese",children:"Vietnamese"}),s.jsx("option",{value:"Yemeni",children:"Yemeni"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Country"}),s.jsxs("select",{name:"country",value:V.country,onChange:De,className:"input",children:[s.jsx("option",{value:"",children:"Select Country"}),s.jsx("option",{value:"Afghanistan",children:"Afghanistan"}),s.jsx("option",{value:"Albania",children:"Albania"}),s.jsx("option",{value:"Algeria",children:"Algeria"}),s.jsx("option",{value:"Argentina",children:"Argentina"}),s.jsx("option",{value:"Australia",children:"Australia"}),s.jsx("option",{value:"Austria",children:"Austria"}),s.jsx("option",{value:"Bahrain",children:"Bahrain"}),s.jsx("option",{value:"Bangladesh",children:"Bangladesh"}),s.jsx("option",{value:"Belgium",children:"Belgium"}),s.jsx("option",{value:"Brazil",children:"Brazil"}),s.jsx("option",{value:"Canada",children:"Canada"}),s.jsx("option",{value:"China",children:"China"}),s.jsx("option",{value:"Colombia",children:"Colombia"}),s.jsx("option",{value:"Czech Republic",children:"Czech Republic"}),s.jsx("option",{value:"Denmark",children:"Denmark"}),s.jsx("option",{value:"Egypt",children:"Egypt"}),s.jsx("option",{value:"Finland",children:"Finland"}),s.jsx("option",{value:"France",children:"France"}),s.jsx("option",{value:"Germany",children:"Germany"}),s.jsx("option",{value:"Greece",children:"Greece"}),s.jsx("option",{value:"Hong Kong",children:"Hong Kong"}),s.jsx("option",{value:"Hungary",children:"Hungary"}),s.jsx("option",{value:"India",children:"India"}),s.jsx("option",{value:"Indonesia",children:"Indonesia"}),s.jsx("option",{value:"Iran",children:"Iran"}),s.jsx("option",{value:"Iraq",children:"Iraq"}),s.jsx("option",{value:"Ireland",children:"Ireland"}),s.jsx("option",{value:"Israel",children:"Israel"}),s.jsx("option",{value:"Italy",children:"Italy"}),s.jsx("option",{value:"Japan",children:"Japan"}),s.jsx("option",{value:"Jordan",children:"Jordan"}),s.jsx("option",{value:"Kuwait",children:"Kuwait"}),s.jsx("option",{value:"Lebanon",children:"Lebanon"}),s.jsx("option",{value:"Libya",children:"Libya"}),s.jsx("option",{value:"Malaysia",children:"Malaysia"}),s.jsx("option",{value:"Mexico",children:"Mexico"}),s.jsx("option",{value:"Morocco",children:"Morocco"}),s.jsx("option",{value:"Netherlands",children:"Netherlands"}),s.jsx("option",{value:"New Zealand",children:"New Zealand"}),s.jsx("option",{value:"Nigeria",children:"Nigeria"}),s.jsx("option",{value:"Norway",children:"Norway"}),s.jsx("option",{value:"Oman",children:"Oman"}),s.jsx("option",{value:"Pakistan",children:"Pakistan"}),s.jsx("option",{value:"Palestine",children:"Palestine"}),s.jsx("option",{value:"Philippines",children:"Philippines"}),s.jsx("option",{value:"Poland",children:"Poland"}),s.jsx("option",{value:"Portugal",children:"Portugal"}),s.jsx("option",{value:"Qatar",children:"Qatar"}),s.jsx("option",{value:"Romania",children:"Romania"}),s.jsx("option",{value:"Russia",children:"Russia"}),s.jsx("option",{value:"Saudi Arabia",children:"Saudi Arabia"}),s.jsx("option",{value:"Singapore",children:"Singapore"}),s.jsx("option",{value:"South Africa",children:"South Africa"}),s.jsx("option",{value:"South Korea",children:"South Korea"}),s.jsx("option",{value:"Spain",children:"Spain"}),s.jsx("option",{value:"Sudan",children:"Sudan"}),s.jsx("option",{value:"Sweden",children:"Sweden"}),s.jsx("option",{value:"Switzerland",children:"Switzerland"}),s.jsx("option",{value:"Syria",children:"Syria"}),s.jsx("option",{value:"Taiwan",children:"Taiwan"}),s.jsx("option",{value:"Thailand",children:"Thailand"}),s.jsx("option",{value:"Tunisia",children:"Tunisia"}),s.jsx("option",{value:"Turkey",children:"Turkey"}),s.jsx("option",{value:"Ukraine",children:"Ukraine"}),s.jsx("option",{value:"United Arab Emirates",children:"United Arab Emirates"}),s.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),s.jsx("option",{value:"United States",children:"United States"}),s.jsx("option",{value:"Vietnam",children:"Vietnam"}),s.jsx("option",{value:"Yemen",children:"Yemen"})]})]})]})]})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Connection Settings"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"label",children:["MAC Address ",!I&&s.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(locked)"})]}),s.jsx("input",{type:"text",name:"mac_address",value:V.mac_address,onChange:e=>{const a=e.target.value.toUpperCase();(""===a||/^[0-9A-F:-]*$/.test(a))&&Z(e=>({...e,mac_address:a}))},className:"input "+(I?"":"bg-gray-100 cursor-not-allowed"),placeholder:"Leave empty - auto-saves on first connect",disabled:!I}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"Leave empty to auto-capture MAC on first connection"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",name:"save_mac",checked:V.save_mac,onChange:De,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Save MAC"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Lock to current MAC address (reject other devices)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Static IP"}),s.jsx("input",{type:"text",name:"static_ip",value:V.static_ip,onChange:De,className:"input",placeholder:"Leave blank for dynamic"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Simultaneous Sessions"}),s.jsx("input",{type:"number",name:"simultaneous_sessions",value:V.simultaneous_sessions,onChange:De,className:"input",min:1,max:10})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Expiry Date"}),s.jsx("input",{type:"date",name:"expiry_date",value:V.expiry_date,onChange:De,className:"input"})]})]})]}),!I&&F("subscribers.bandwidth_rules")&&s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Bandwidth Rules"}),s.jsx("button",{type:"button",onClick:()=>Me(),className:"btn btn-primary btn-sm",children:"Add Rule"})]}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Custom speed overrides for this subscriber. Set duration for temporary speed changes."}),0===ue.length?s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No bandwidth rules configured"}):s.jsx("div",{className:"space-y-3",children:ue.map(e=>{const a=(e=>{if(!e.expires_at)return"Permanent";const a=new Date(e.expires_at),t=new Date;if(a<=t)return"Expired";const s=a-t,n=Math.floor(s/36e5),l=Math.floor(s%36e5/6e4);if(n>=24)return`${Math.floor(n/24)}d ${n%24}h remaining`;return`${n}h ${l}m remaining`})(e),t="Expired"===a;return s.jsx("div",{className:_("border rounded-lg p-4",!e.enabled||t?"border-gray-100 bg-gray-50 opacity-60":"border-gray-200 bg-white"),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:_("px-2 py-1 text-xs font-medium rounded","internet"===e.rule_type?"bg-blue-100 text-blue-800":"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"),children:"internet"===e.rule_type?"Internet":e.cdn_name||"CDN"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"cdn"===e.rule_type?`${Math.round(e.download_speed/1e3)}M`:`${e.download_speed}k / ${e.upload_speed}k`}),s.jsx("p",{className:_("text-sm",t?"text-red-500":"text-gray-500"),children:a})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",onClick:()=>Me(e),className:"text-primary-600 hover:text-primary-800 text-sm",children:"Edit"}),s.jsx("button",{type:"button",onClick:()=>{return a=e.id,void(confirm("Are you sure you want to delete this rule?")&&Be.mutate(a));var a},className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]})},e.id)})})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Status & Options"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Status"}),s.jsxs("select",{name:"status",value:V.status,onChange:De,className:"input",children:[s.jsx("option",{value:1,children:"Active"}),s.jsx("option",{value:0,children:"Inactive"}),s.jsx("option",{value:2,children:"Suspended"})]})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",name:"auto_renew",checked:V.auto_renew,onChange:De,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),s.jsx("span",{children:"Auto Renew"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Notes"}),s.jsx("textarea",{name:"note",value:V.note,onChange:De,className:"input",rows:4,placeholder:"Internal notes about this subscriber..."})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"label flex items-center justify-between",children:[s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(C,{className:"w-4 h-4"}),"Location"]}),(0!==V.latitude||0!==V.longitude)&&s.jsx("button",{type:"button",onClick:()=>{Z(e=>({...e,latitude:0,longitude:0})),ye(null)},className:"text-xs text-red-500 hover:text-red-700 font-normal",children:"Clear"})]}),s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsx("input",{type:"number",step:"any",placeholder:"Latitude (e.g. 34.4324)",value:V.latitude||"",onChange:e=>Z(a=>({...a,latitude:parseFloat(e.target.value)||0})),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),ye([V.latitude,V.longitude]))},className:"input flex-1 text-sm"}),s.jsx("input",{type:"number",step:"any",placeholder:"Longitude (e.g. 35.8328)",value:V.longitude||"",onChange:e=>Z(a=>({...a,longitude:parseFloat(e.target.value)||0})),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),ye([V.latitude,V.longitude]))},className:"input flex-1 text-sm"}),s.jsx("button",{type:"button",onClick:()=>ye([V.latitude,V.longitude]),className:"btn-secondary text-sm px-3",title:"Go to coordinates",children:"Go"}),s.jsxs("button",{type:"button",disabled:be,onClick:()=>{navigator.geolocation?(fe(!0),navigator.geolocation.getCurrentPosition(e=>{const a=e.coords.latitude,t=e.coords.longitude;Z(e=>({...e,latitude:a,longitude:t})),ye([a,t]),fe(!1)},e=>{fe(!1),1===e.code?alert('Location blocked by Safari.\n\nSafari stores a separate permission per website. To reset it:\n\n1. Open iPhone Settings\n2. Go to Safari â†’ Advanced â†’ Website Data\n3. Find this website and swipe to delete it\n4. Reload the page â€” Safari will ask permission again\n5. Tap "Allow"\n\nAlternatively:\nSettings â†’ Privacy & Security â†’ Location Services â†’ Safari Websites â†’ set to "While Using"'):2===e.code?alert("GPS unavailable. Make sure Location Services is ON in Settings â†’ Privacy & Security â†’ Location Services."):alert("Location timed out. Make sure GPS is enabled and try again.")},{enableHighAccuracy:!0,timeout:1e4})):alert("Geolocation is not supported by your browser")},className:"btn-secondary text-sm px-3 flex items-center gap-1 whitespace-nowrap",title:"Use my current location",children:[be?s.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}):s.jsx(C,{className:"w-4 h-4"}),be?"Getting...":"My Location"]})]}),!ee&&s.jsx("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600",children:s.jsx(A,{lat:V.latitude,lng:V.longitude,onLocationChange:(e,a)=>{Z(t=>({...t,latitude:e,longitude:a})),ye([e,a])},flyTarget:je})}),0!==V.latitude&&0!==V.longitude&&s.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.jsxs("p",{className:"text-xs text-gray-400",children:["ðŸ“ ",V.latitude.toFixed(6),", ",V.longitude.toFixed(6)]}),s.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${V.latitude},${V.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary text-xs px-3 py-1 flex items-center gap-1",children:[s.jsx(C,{className:"w-3.5 h-3.5"}),"Navigate"]})]})]})]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-4",children:[s.jsx(r,{to:"/subscribers",className:"btn-secondary",children:"Cancel"}),F(I?"subscribers.create":"subscribers.edit")&&s.jsx("button",{type:"submit",disabled:Fe.isLoading,className:"btn-primary",children:Fe.isLoading?"Saving...":I?"Create Subscriber":"Save Changes"})]})]}),!I&&"usage"===L&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Monthly"}),s.jsxs("div",{className:"flex items-end gap-8 h-48",children:[s.jsxs("div",{className:"flex flex-col items-center flex-1",children:[s.jsx("div",{className:"w-full max-w-[120px] bg-gray-100 rounded-t relative h-40 flex items-end",children:s.jsx("div",{className:"w-full rounded-t transition-all duration-500",style:{height:(()=>{const e=(null==ne?void 0:ne.download_used)||0,a=(null==ne?void 0:ne.download_limit)||0;return a>0?`${Math.min(e/a*100,100)}%`:e>0?`${Math.min(e/107374182400*100,100)}%`:"0%"})(),backgroundColor:"#14B8A6",minHeight:((null==ne?void 0:ne.download_used)||0)>0?"8px":"0"}})}),s.jsxs("div",{className:"mt-3 text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-teal-500",children:[(((null==ne?void 0:ne.download_used)||0)/1073741824).toFixed(2)," GB"]}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==ne?void 0:ne.download_limit)>0?`/ ${(ne.download_limit/1073741824).toFixed(0)} GB`:"Unlimited"}),s.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Download"})]})]}),s.jsxs("div",{className:"flex flex-col items-center flex-1",children:[s.jsx("div",{className:"w-full max-w-[120px] bg-gray-100 rounded-t relative h-40 flex items-end",children:s.jsx("div",{className:"w-full rounded-t transition-all duration-500",style:{height:(()=>{const e=(null==ne?void 0:ne.upload_used)||0,a=(null==ne?void 0:ne.upload_limit)||0;return a>0?`${Math.min(e/a*100,100)}%`:e>0?`${Math.min(e/107374182400*100,100)}%`:"0%"})(),backgroundColor:"#F97316",minHeight:((null==ne?void 0:ne.upload_used)||0)>0?"8px":"0"}})}),s.jsxs("div",{className:"mt-3 text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:[(((null==ne?void 0:ne.upload_used)||0)/1073741824).toFixed(2)," GB"]}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==ne?void 0:ne.upload_limit)>0?`/ ${(ne.upload_limit/1073741824).toFixed(0)} GB`:"Unlimited"}),s.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Upload"})]})]})]})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Daily"}),s.jsx(k,{option:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{let a=`Day ${e[0].name}<br/>`;return e.forEach(e=>{const t=(e.value/1073741824).toFixed(2);a+=`${e.marker} ${e.seriesName}: ${t} GB<br/>`}),a}},legend:{data:["Download","Upload"],top:0},grid:{left:"3%",right:"4%",bottom:"3%",top:"40px",containLabel:!0},xAxis:{type:"category",data:Array.from({length:(null==(u=null==se?void 0:se.daily_download)?void 0:u.length)||new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate()},(e,a)=>a+1),axisLine:{lineStyle:{color:"#ccc"}},axisLabel:{color:"#666"}},yAxis:{type:"value",axisLabel:{formatter:e=>(e/1073741824).toFixed(1)+" GB",color:"#666"},axisLine:{lineStyle:{color:"#ccc"}},splitLine:{lineStyle:{color:"#eee"}}},series:[{name:"Download",type:"bar",data:(null==se?void 0:se.daily_download)||[],itemStyle:{color:"#14B8A6"},barWidth:"35%"},{name:"Upload",type:"bar",data:(null==se?void 0:se.daily_upload)||[],itemStyle:{color:"#F97316"},barWidth:"35%"}]},style:{height:"300px"}})]}),s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Today's Usage"}),s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"text-center p-4 bg-teal-50 rounded-lg",children:[s.jsxs("div",{className:"text-3xl font-bold text-teal-600",children:[(((null==se?void 0:se.download_used)||0)/1073741824).toFixed(2)," GB"]}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:["Download ",(null==se?void 0:se.download_limit)>0&&`/ ${(se.download_limit/1073741824).toFixed(0)} GB`]})]}),s.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[s.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:[(((null==se?void 0:se.upload_used)||0)/1073741824).toFixed(2)," GB"]}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:["Upload ",(null==se?void 0:se.upload_limit)>0&&`/ ${(se.upload_limit/1073741824).toFixed(0)} GB`]})]})]})]})]}),!I&&"graph"===L&&s.jsxs("div",{className:"space-y-6",children:[(null==ae?void 0:ae.is_online)&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"card p-4 text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-green-500",children:E.download}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Download (Mbps)"})]}),s.jsxs("div",{className:"card p-4 text-center",children:[s.jsx("div",{className:"text-3xl font-bold text-blue-500",children:E.upload}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Upload (Mbps)"})]}),s.jsxs("div",{className:"card p-4 text-center",style:{borderTop:"3px solid #F59E0B"},children:[s.jsx("div",{className:"text-3xl font-bold "+(Q.ok?Q.ms<20?"text-green-500":Q.ms<80?"text-yellow-500":"text-red-500":"text-gray-400 dark:text-gray-500"),children:Q.ok?`${Q.ms.toFixed(1)}`:"â€”"}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Latency (ms)"})]}),s.jsxs("div",{className:"card p-4 text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300",children:E.ipAddress||"-"}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IP Address"})]}),s.jsxs("div",{className:"card p-4 text-center",children:[s.jsx("div",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300",children:E.uptime||"-"}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Uptime"})]})]}),K.length>0&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:K.map(e=>{const a=G.current[e.id]||[],t=a.length>0?a[a.length-1]:0;return s.jsxs("div",{className:"card p-3 text-center",style:{borderTop:`3px solid ${e.color}`},children:[s.jsxs("div",{className:"text-xl font-bold",style:{color:e.color},children:[t.toFixed(2)," Mbps"]}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.name})]},e.id)})}),O.length>0&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:O.map(e=>{const a=H.current[e.id]||[],t=a.length>0?a[a.length-1]:0;return s.jsxs("div",{className:"card p-3 text-center",style:{borderTop:`3px dashed ${e.color}`},children:[s.jsxs("div",{className:"text-xl font-bold",style:{color:e.color},children:[t.toFixed(2)," Mbps"]}),s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Port: ",e.name]})]},e.id)})})]}),s.jsxs("div",{className:"card p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Live Bandwidth Graph"}),(null==ae?void 0:ae.is_online)&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[s.jsxs("span",{className:"relative flex h-3 w-3",children:[s.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),s.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-green-500"})]}),"Live (updating every 2s)"]}),Q.ok?s.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono px-2 py-0.5 rounded-full "+(Q.ms<20?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-400":Q.ms<80?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-400"),children:[s.jsx(v,{className:"h-3.5 w-3.5"}),Q.ms.toFixed(1)," ms"]}):s.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono px-2 py-0.5 rounded-full bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500",children:[s.jsx(v,{className:"h-3.5 w-3.5"}),"â€” ms"]})]})]}),(null==ae?void 0:ae.is_online)?s.jsx(k,{ref:$,option:Le,notMerge:!1,lazyUpdate:!0,style:{height:"400px"}}):s.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Subscriber is offline. Live graph is only available when connected."})]})]}),!I&&"invoices"===L&&s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Invoices & Payments"}),s.jsx("div",{className:"table-container",children:s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Date"}),s.jsx("th",{children:"Invoice #"}),s.jsx("th",{children:"Amount"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-8",children:"No invoices found"})})})]})})]}),!I&&"logs"===L&&s.jsxs("div",{className:"card p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Session & Activity Logs"}),s.jsx("div",{className:"table-container",children:s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Session ID"}),s.jsx("th",{children:"Start Time"}),s.jsx("th",{children:"End Time"}),s.jsx("th",{children:"Duration"}),s.jsx("th",{children:"IP Address"}),s.jsx("th",{children:"MAC Address"}),s.jsx("th",{children:"Download"}),s.jsx("th",{children:"Upload"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===le.length?s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"text-center text-gray-500 py-8",children:"No session logs found"})}):le.map((e,a)=>{const t=e.acctstarttime?new Date(e.acctstarttime):null,n=e.acctstoptime?new Date(e.acctstoptime):null,l=!e.acctstoptime;let i="-";if(e.acctsessiontime>0){i=`${Math.floor(e.acctsessiontime/3600)}h ${Math.floor(e.acctsessiontime%3600/60)}m`}else if(t&&!n){const e=new Date-t;i=`${Math.floor(e/36e5)}h ${Math.floor(e%36e5/6e4)}m`}const r=e=>{if(!e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,a)).toFixed(2)} ${["B","KB","MB","GB"][a]}`};return s.jsxs("tr",{className:l?"bg-green-50":"",children:[s.jsxs("td",{className:"font-mono text-sm",children:[e.acctsessionid,l&&s.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full",children:"Active"})]}),s.jsx("td",{className:"text-sm",children:g(e.acctstarttime)}),s.jsx("td",{className:"text-sm",children:g(e.acctstoptime)}),s.jsx("td",{className:"text-sm",children:i}),s.jsx("td",{className:"font-mono text-sm",children:e.framedipaddress||"-"}),s.jsx("td",{className:"font-mono text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.callingstationid||"-"}),s.jsx("td",{className:"text-sm text-green-600",children:r(e.acctoutputoctets)}),s.jsx("td",{className:"text-sm text-blue-600",children:r(e.acctinputoctets)})]},e.acctsessionid||a)})})]})})]}),Ne&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:we?"Edit Bandwidth Rule":"Add Bandwidth Rule"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Rule Type"}),s.jsxs("select",{value:Se.rule_type,onChange:e=>Ce({...Se,rule_type:e.target.value}),className:"input",children:[s.jsx("option",{value:"internet",children:"Internet Speed"}),s.jsx("option",{value:"cdn",children:"CDN Speed"})]})]}),"cdn"===Se.rule_type?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Select CDN"}),ge.length>0?s.jsxs("select",{value:Se.cdn_id||"",onChange:e=>Ce({...Se,cdn_id:e.target.value,download_speed:"",upload_speed:""}),className:"input",children:[s.jsx("option",{value:"",children:"Select CDN..."}),ge.map(e=>s.jsx("option",{value:e.cdn_id,children:e.cdn_name},e.cdn_id))]}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"No CDNs available for this NAS"})]}),Se.cdn_id&&s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Select Speed"}),ve(Se.cdn_id).length>0?s.jsxs("select",{value:Se.download_speed||"",onChange:e=>Ce({...Se,download_speed:e.target.value,upload_speed:e.target.value}),className:"input",children:[s.jsx("option",{value:"",children:"Select speed..."}),ve(Se.cdn_id).map((e,a)=>s.jsxs("option",{value:e.speed_limit,children:[e.speed_limit,"M (",e.service_name,")"]},a))]}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"No speeds configured for this CDN"})]}),pe.length>0&&s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Current service CDNs: ",pe.map(e=>`${e.cdn_name} ${e.speed_limit}M`).join(", ")]})]}):s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Download (kbps)"}),s.jsx("input",{type:"number",value:Se.download_speed,onChange:e=>Ce({...Se,download_speed:e.target.value}),className:"input",placeholder:"e.g., 50000"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Upload (kbps)"}),s.jsx("input",{type:"number",value:Se.upload_speed,onChange:e=>Ce({...Se,upload_speed:e.target.value}),className:"input",placeholder:"e.g., 10000"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:"Duration"}),s.jsxs("select",{value:Se.duration,onChange:e=>Ce({...Se,duration:e.target.value}),className:"input",children:[s.jsx("option",{value:"permanent",children:"Permanent"}),s.jsx("option",{value:"1h",children:"1 Hour"}),s.jsx("option",{value:"2h",children:"2 Hours"}),s.jsx("option",{value:"6h",children:"6 Hours"}),s.jsx("option",{value:"12h",children:"12 Hours"}),s.jsx("option",{value:"1d",children:"1 Day"}),s.jsx("option",{value:"2d",children:"2 Days"}),s.jsx("option",{value:"7d",children:"7 Days"}),s.jsx("option",{value:"14d",children:"14 Days"}),s.jsx("option",{value:"30d",children:"30 Days"})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 mt-1",children:"permanent"===Se.duration?"Rule will apply until manually disabled or deleted":"After duration expires, subscriber returns to normal service speed"})]}),s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:Se.enabled,onChange:e=>Ce({...Se,enabled:e.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),s.jsx("span",{children:"Enabled"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>{_e(!1),Ae()},className:"btn btn-secondary",children:"Cancel"}),s.jsx("button",{type:"button",onClick:()=>{const e="cdn"===Se.rule_type,a=parseInt(Se.download_speed)||0,t=parseInt(Se.upload_speed)||0,s={...Se,download_speed:e?1e3*a:a,upload_speed:e?1e3*t:t,priority:parseInt(Se.priority)||0,cdn_id:Se.cdn_id?parseInt(Se.cdn_id):0};Ie.mutate(s)},disabled:Ie.isPending,className:"btn btn-primary",children:Ie.isPending?"Saving...":"Save"})]})]})})]})}export{F as default};
