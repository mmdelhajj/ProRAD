import{b as e,u as s,d as t,j as a}from"./data-vendor-C6mPcuPT.js";import{r as l}from"./react-vendor-C4Xey-hE.js";import{c as d,u as r,f as i,a as n}from"./table-vendor-BZVOk-Gl.js";import{F as c,a as o,k as x,J as m,q as u,y as h}from"./index-DhIu4zKA.js";import{c as g}from"./ui-vendor-CMKyyIMz.js";import{F as p}from"./MagnifyingGlassIcon-D7UyJAmN.js";import"./chart-vendor-Be69IwoK.js";const j=d();function b(e){if(0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB","TB"][s]}function y({used:e,total:s,label:t}){if(0===s)return a.jsx("div",{className:"text-xs text-gray-400",children:"Unlimited"});const l=Math.min(e/s*100,100),d=l>=100?"bg-red-500":l>=80?"bg-yellow-500":"bg-green-500";return a.jsxs("div",{className:"w-full",children:[a.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[a.jsx("span",{children:b(e)}),a.jsx("span",{className:"text-gray-400",children:b(s)})]}),a.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:a.jsx("div",{className:g("h-full rounded-full transition-all",d),style:{width:`${l}%`}})}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[l.toFixed(1),"%"]})]})}function v(){const d=e(),[v,N]=l.useState(1),[f,w]=l.useState(""),[_,S]=l.useState(""),[q,F]=l.useState(""),[C,M]=l.useState({}),{data:k}=s({queryKey:["fup-stats"],queryFn:()=>h.get("/fup/stats").then(e=>e.data.data),refetchInterval:3e4}),{data:P,isLoading:R}=s({queryKey:["fup-quotas",v,f,_,q],queryFn:()=>h.get("/fup/quotas",{params:{page:v,limit:25,search:f,fup_status:_,quota_status:q}}).then(e=>e.data)}),{data:U}=s({queryKey:["fup-top-users"],queryFn:()=>h.get("/fup/top-users",{params:{limit:5,period:"monthly"}}).then(e=>e.data.data)}),Q=t({mutationFn:e=>h.post(`/fup/reset/${e}`),onSuccess:()=>{d.invalidateQueries(["fup-quotas"]),d.invalidateQueries(["fup-stats"])}}),A=t({mutationFn:e=>h.post("/fup/bulk-reset",e),onSuccess:()=>{d.invalidateQueries(["fup-quotas"]),d.invalidateQueries(["fup-stats"]),M({})}}),B=t({mutationFn:()=>h.post("/fup/reset-all"),onSuccess:()=>{d.invalidateQueries(["fup-quotas"]),d.invalidateQueries(["fup-stats"])}}),D=l.useMemo(()=>[j.display({id:"select",header:({table:e})=>a.jsx("input",{type:"checkbox",checked:e.getIsAllRowsSelected(),onChange:e.getToggleAllRowsSelectedHandler(),className:"rounded border-gray-300"}),cell:({row:e})=>a.jsx("input",{type:"checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),className:"rounded border-gray-300"})}),j.accessor("username",{header:"Username",cell:e=>a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.getValue()}),a.jsx("div",{className:"text-xs text-gray-500",children:e.row.original.full_name})]})}),j.accessor("service_name",{header:"Service"}),j.accessor("reseller_name",{header:"Reseller"}),j.display({id:"daily_quota",header:"Daily Quota",cell:({row:e})=>a.jsx(y,{used:e.original.daily_used,total:e.original.daily_quota})}),j.display({id:"monthly_quota",header:"Monthly Quota",cell:({row:e})=>a.jsx(y,{used:e.original.monthly_used,total:e.original.monthly_quota})}),j.accessor("fup_level",{header:"FUP Level",cell:e=>{const s=e.getValue();return a.jsx("span",{className:g("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",0===s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:0===s?"Normal":`Level ${s}`})}}),j.accessor("is_online",{header:"Status",cell:e=>a.jsxs("span",{className:g("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",e.getValue()?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:[a.jsx(c,{className:g("w-3 h-3 mr-1",e.getValue()?"text-green-500":"text-gray-400")}),e.getValue()?"Online":"Offline"]})}),j.display({id:"actions",header:"Actions",cell:({row:e})=>a.jsxs("button",{onClick:()=>Q.mutate(e.original.id),disabled:Q.isPending,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 disabled:opacity-50",children:[a.jsx(o,{className:"w-4 h-4 mr-1"}),"Reset"]})})],[Q]),V=r({data:(null==P?void 0:P.data)||[],columns:D,getCoreRowModel:n(),state:{rowSelection:C},onRowSelectionChange:M,getRowId:e=>String(e.id)}),I=Object.keys(C).map(Number),T=e=>{0!==I.length&&A.mutate({subscriber_ids:I,reset_type:e})},E=k||{};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"FUP & Counters"}),a.jsx("p",{className:"text-gray-500",children:"Manage Fair Usage Policy and quota counters"})]}),a.jsxs("button",{onClick:()=>B.mutate(),disabled:B.isPending||0===E.active_fup,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[a.jsx(o,{className:"w-5 h-5 mr-2"}),"Reset All FUP (",E.active_fup||0,")"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(x,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Total Subscribers"}),a.jsx("p",{className:"text-xl font-bold",children:E.total_subscribers||0})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx(m,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Active FUP"}),a.jsx("p",{className:"text-xl font-bold text-red-600",children:E.active_fup||0})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx(m,{className:"w-6 h-6 text-yellow-600"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Daily Exceeded"}),a.jsx("p",{className:"text-xl font-bold text-yellow-600",children:E.daily_quota_exceeded||0})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:a.jsx(m,{className:"w-6 h-6 text-orange-600"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Monthly Exceeded"}),a.jsx("p",{className:"text-xl font-bold text-orange-600",children:E.monthly_quota_exceeded||0})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm p-4 border",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(u,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"Unlimited"}),a.jsx("p",{className:"text-xl font-bold text-green-600",children:E.unlimited_quota||0})]})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"lg:col-span-3 bg-white rounded-xl shadow-sm border",children:[a.jsxs("div",{className:"p-4 border-b",children:[a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsx("div",{className:"flex-1 min-w-[200px]",children:a.jsxs("div",{className:"relative",children:[a.jsx(p,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search username...",value:f,onChange:e=>{w(e.target.value),N(1)},className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500"})]})}),a.jsxs("select",{value:_,onChange:e=>{S(e.target.value),N(1)},className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",children:[a.jsx("option",{value:"",children:"All FUP Status"}),a.jsx("option",{value:"active",children:"Active FUP"}),a.jsx("option",{value:"normal",children:"Normal"})]}),a.jsxs("select",{value:q,onChange:e=>{F(e.target.value),N(1)},className:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500",children:[a.jsx("option",{value:"",children:"All Quota Status"}),a.jsx("option",{value:"daily_exceeded",children:"Daily Exceeded"}),a.jsx("option",{value:"monthly_exceeded",children:"Monthly Exceeded"}),a.jsx("option",{value:"warning",children:"Warning (80%+)"}),a.jsx("option",{value:"unlimited",children:"Unlimited"})]})]}),I.length>0&&a.jsxs("div",{className:"mt-4 flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[a.jsxs("span",{className:"text-sm text-blue-800 font-medium",children:[I.length," selected"]}),a.jsx("button",{onClick:()=>T("all"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Reset All"}),a.jsx("button",{onClick:()=>T("fup"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",children:"Reset FUP"}),a.jsx("button",{onClick:()=>T("daily"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"Reset Daily"}),a.jsx("button",{onClick:()=>T("monthly"),disabled:A.isPending,className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700 disabled:opacity-50",children:"Reset Monthly"})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:V.getHeaderGroups().map(e=>a.jsx("tr",{children:e.headers.map(e=>a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:i(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:R?a.jsx("tr",{children:a.jsx("td",{colSpan:D.length,className:"px-4 py-8 text-center text-gray-500",children:"Loading..."})}):0===V.getRowModel().rows.length?a.jsx("tr",{children:a.jsx("td",{colSpan:D.length,className:"px-4 py-8 text-center text-gray-500",children:"No subscribers found"})}):V.getRowModel().rows.map(e=>a.jsx("tr",{className:"hover:bg-gray-50",children:e.getVisibleCells().map(e=>a.jsx("td",{className:"px-4 py-3",children:i(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),(null==P?void 0:P.meta)&&a.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",25*(v-1)+1," to ",Math.min(25*v,P.meta.total)," of ",P.meta.total]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>N(e=>Math.max(1,e-1)),disabled:1===v,className:"px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),a.jsx("button",{onClick:()=>N(e=>e+1),disabled:v>=P.meta.totalPages,className:"px-3 py-1 border rounded hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Top Quota Users"}),a.jsxs("div",{className:"space-y-4",children:[null==U?void 0:U.map((e,s)=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:g("w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm",0===s?"bg-yellow-500":1===s?"bg-gray-400":2===s?"bg-amber-700":"bg-gray-300"),children:s+1}),a.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium text-sm truncate",children:e.username}),a.jsx("p",{className:"text-xs text-gray-500",children:e.service_name})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm font-medium",children:b(e.quota_used)}),a.jsxs("p",{className:g("text-xs",e.percent>=100?"text-red-600":e.percent>=80?"text-yellow-600":"text-green-600"),children:[e.percent.toFixed(1),"%"]})]})]},e.id)),!(null==U?void 0:U.length)&&a.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No data available"})]})]})]})]})}export{v as default};
