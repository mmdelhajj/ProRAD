import{u as e,j as a}from"./data-vendor-Gi89QHLZ.js";import{r as s}from"./react-vendor-C1B6conR.js";import{f as r,B as t,C as l,D as d,a as i,E as n}from"./index-4rvhAeCM.js";import{u as c,f as x,a as o}from"./table-vendor-3gCiRijM.js";import{c as m}from"./ui-vendor-Bljr83Cq.js";import{F as g}from"./BanknotesIcon-Zi7xdgxr.js";import{F as h}from"./MagnifyingGlassIcon-CymQwI_A.js";import{F as u,a as v,b as j}from"./FunnelIcon-DfkPDPOw.js";import"./chart-vendor-C_esy2x0.js";const y=[{value:"",label:"All Types"},{value:"new",label:"New Subscription"},{value:"renewal",label:"Renewal"},{value:"change_service",label:"Change Service"},{value:"refund",label:"Refund"},{value:"transfer",label:"Transfer"},{value:"withdraw",label:"Withdrawal"},{value:"reset_fup",label:"Reset FUP"},{value:"refill",label:"Refill"}];function p(){var p,b,N,f,w,k;const[_,C]=s.useState(1),[F]=s.useState(25),[S,R]=s.useState(""),[M,K]=s.useState(""),[D,T]=s.useState(""),[P,$]=s.useState(""),[I,A]=s.useState(!1),{data:B,isLoading:U,refetch:q}=e({queryKey:["transactions",_,F,S,M,D,P],queryFn:()=>n.transactions({page:_,limit:F,search:S,type:M,date_from:D,date_to:P}).then(e=>e.data)}),E=s.useMemo(()=>[{accessorKey:"created_at",header:"Date",cell:({row:e})=>a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{children:r(e.original.created_at)}),a.jsx("div",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:t(e.original.created_at)})]})},{accessorKey:"type",header:"Type",cell:({row:e})=>a.jsx("span",{className:m("badge",{new:"badge-success",renewal:"badge-info",change_service:"badge-purple",refund:"badge-warning",transfer:"badge-primary",withdraw:"badge-danger",reset_fup:"badge-orange",refill:"badge-success",adjustment:"badge-gray"}[e.original.type]||"badge-gray"),children:{new:"New",renewal:"Renewal",change_service:"Change Service",refund:"Refund",transfer:"Transfer",withdraw:"Withdrawal",reset_fup:"Reset FUP",refill:"Refill"}[e.original.type]||e.original.type})},{accessorKey:"subscriber",header:"User",cell:({row:e})=>{var s,r,t;return a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:(null==(s=e.original.subscriber)?void 0:s.username)||"-"}),a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==(r=e.original.subscriber)?void 0:r.fullname)||(null==(t=e.original.reseller)?void 0:t.username)||""})]})}},{accessorKey:"service",header:"Service",cell:({row:e})=>{const s=e.original;return"change_service"===s.type&&(s.old_service_name||s.new_service_name)?a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:s.old_service_name||"-"}),a.jsx("span",{className:"mx-1 text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"â†’"}),a.jsx("span",{className:"font-medium text-primary-600",children:s.new_service_name||"-"})]}):s.service_name?a.jsx("span",{className:"text-sm",children:s.service_name}):a.jsx("span",{className:"text-sm text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"-"})}},{accessorKey:"amount",header:"Amount",cell:({row:e})=>a.jsxs("div",{className:m("flex items-center gap-1 font-semibold",e.original.amount>=0?"text-green-600":"text-red-600"),children:[e.original.amount>=0?a.jsx(l,{className:"w-4 h-4"}):a.jsx(d,{className:"w-4 h-4"}),"$",Math.abs(e.original.amount).toFixed(2)]})},{accessorKey:"balance_after",header:"Balance After",cell:({row:e})=>{var a;return void 0!==e.original.balance_after?`$${null==(a=e.original.balance_after)?void 0:a.toFixed(2)}`:"-"}},{accessorKey:"description",header:"Description",cell:({row:e})=>a.jsx("div",{className:"max-w-xs truncate text-sm text-gray-600 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.original.description||"-"})},{accessorKey:"reference",header:"Reference",cell:({row:e})=>a.jsx("code",{className:"text-xs px-2 py-1 bg-gray-100 rounded",children:e.original.reference||"-"})}],[]),G=c({data:(null==B?void 0:B.data)||[],columns:E,getCoreRowModel:o()}),W=Math.ceil(((null==(p=null==B?void 0:B.meta)?void 0:p.total)||0)/F),z=(null==(b=null==B?void 0:B.data)?void 0:b.reduce((e,a)=>a.amount>0?e+a.amount:e,0))||0,H=(null==(N=null==B?void 0:B.data)?void 0:N.reduce((e,a)=>a.amount<0?e+Math.abs(a.amount):e,0))||0;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Transactions"}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Financial transaction history"})]}),a.jsxs("button",{onClick:()=>q(),className:"btn-secondary flex items-center gap-2 w-full sm:w-auto justify-center",children:[a.jsx(i,{className:"w-4 h-4"}),"Refresh"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(g,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Transactions"}),a.jsx("div",{className:"text-2xl font-bold",children:(null==(f=null==B?void 0:B.meta)?void 0:f.total)||0})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(l,{className:"w-5 h-5 text-green-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Page Income"}),a.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",z.toFixed(2)]})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx(d,{className:"w-5 h-5 text-red-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Page Expense"}),a.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",H.toFixed(2)]})]})]})}),a.jsx("div",{className:"card p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:a.jsx(g,{className:"w-5 h-5 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Page Net"}),a.jsxs("div",{className:m("text-2xl font-bold",z-H>=0?"text-green-600":"text-red-600"),children:["$",(z-H).toFixed(2)]})]})]})})]}),a.jsxs("div",{className:"card p-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 dark:text-gray-500 dark:text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search by username, description, reference...",value:S,onChange:e=>{R(e.target.value),C(1)},className:"input pl-10"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("select",{value:M,onChange:e=>{K(e.target.value),C(1)},className:"input",children:y.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsxs("button",{onClick:()=>A(!I),className:m("btn-secondary flex items-center gap-2",I&&"bg-primary-50 text-primary-600"),children:[a.jsx(u,{className:"w-4 h-4"}),"Filters"]})]})]}),I&&a.jsxs("div",{className:"mt-4 pt-4 border-t grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"label",children:"Date From"}),a.jsx("input",{type:"date",value:D,onChange:e=>{T(e.target.value),C(1)},className:"input"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"label",children:"Date To"}),a.jsx("input",{type:"date",value:P,onChange:e=>{$(e.target.value),C(1)},className:"input"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{R(""),K(""),T(""),$(""),C(1)},className:"btn-secondary",children:"Clear Filters"})})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:G.getHeaderGroups().map(e=>a.jsx("tr",{children:e.headers.map(e=>a.jsx("th",{children:x(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),a.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:U?a.jsx("tr",{children:a.jsx("td",{colSpan:E.length,className:"text-center py-8",children:a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===G.getRowModel().rows.length?a.jsx("tr",{children:a.jsx("td",{colSpan:E.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No transactions found"})}):G.getRowModel().rows.map(e=>a.jsx("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:e.getVisibleCells().map(e=>a.jsx("td",{children:x(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})}),a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t",children:[a.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Showing ",(_-1)*F+1," to ",Math.min(_*F,(null==(w=null==B?void 0:B.meta)?void 0:w.total)||0)," of"," ",(null==(k=null==B?void 0:B.meta)?void 0:k.total)||0," results"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>C(e=>Math.max(1,e-1)),disabled:1===_,className:"btn-secondary p-2 disabled:opacity-50",children:a.jsx(v,{className:"w-5 h-5"})}),a.jsxs("span",{className:"px-4 py-2 text-sm",children:["Page ",_," of ",W||1]}),a.jsx("button",{onClick:()=>C(e=>Math.min(W,e+1)),disabled:_>=W,className:"btn-secondary p-2 disabled:opacity-50",children:a.jsx(j,{className:"w-5 h-5"})})]})]})]})]})}export{p as default};
