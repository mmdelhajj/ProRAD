import{b as e,u as t,d as a,j as r}from"./data-vendor-C6mPcuPT.js";import{r as s}from"./react-vendor-C4Xey-hE.js";import{f as d,y as i}from"./index-Di-Elqtf.js";import"./ui-vendor-CMKyyIMz.js";import"./chart-vendor-Be69IwoK.js";const l={pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"};function n(){const n=e(),[o,c]=s.useState(!1),[x,u]=s.useState(!1),[g,m]=s.useState(null),[b,y]=s.useState(1),[h,p]=s.useState(""),{data:k,isLoading:f}=t({queryKey:["invoices",b,h],queryFn:()=>i.get("/invoices",{params:{page:b,status:h}}).then(e=>e.data)}),[v,j]=s.useState({subscriber_id:"",due_date:"",notes:"",items:[{description:"",quantity:1,unit_price:0}]}),[N,w]=s.useState({amount:0,method:"cash",reference:"",notes:""}),C=a({mutationFn:e=>i.post("/invoices",e),onSuccess:()=>{n.invalidateQueries(["invoices"]),c(!1)}}),_=a({mutationFn:({id:e,data:t})=>i.post(`/invoices/${e}/payment`,t),onSuccess:()=>{n.invalidateQueries(["invoices"]),u(!1)}}),S=a({mutationFn:e=>i.delete(`/invoices/${e}`),onSuccess:()=>n.invalidateQueries(["invoices"])}),P=(e,t,a)=>{const r=[...v.items];r[e][t]="quantity"===t||"unit_price"===t?parseFloat(a)||0:a,j({...v,items:r})};if(f)return r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const F=(null==k?void 0:k.data)||[],q=(null==k?void 0:k.meta)||{};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Invoices"}),r.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Invoice"})]}),r.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:r.jsxs("select",{value:h,onChange:e=>{p(e.target.value),y(1)},className:"rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",children:[r.jsx("option",{value:"",children:"All Status"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"completed",children:"Completed"}),r.jsx("option",{value:"failed",children:"Failed"})]})}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden",children:[r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Invoice #"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Subscriber"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Total"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Paid"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Due Date"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:F.map(e=>{var t,a,s;return r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.invoice_number}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:(null==(t=e.subscriber)?void 0:t.username)||"N/A"}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["$",null==(a=e.total)?void 0:a.toFixed(2)]}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["$",null==(s=e.amount_paid)?void 0:s.toFixed(2)]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${l[e.status]||"bg-gray-100"}`,children:e.status})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:d(e.due_date)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:["completed"!==e.status&&r.jsx("button",{onClick:()=>(e=>{m(e),w({amount:e.total-e.amount_paid,method:"cash",reference:"",notes:""}),u(!0)})(e),className:"text-green-600 hover:text-green-900 mr-3",children:"Add Payment"}),"completed"!==e.status&&r.jsx("button",{onClick:()=>S.mutate(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.id)})})]}),q.totalPages>1&&r.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:["Page ",b," of ",q.totalPages," (",q.total," total)"]}),r.jsxs("div",{className:"space-x-2",children:[r.jsx("button",{onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===b,className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded disabled:opacity-50",children:"Previous"}),r.jsx("button",{onClick:()=>y(e=>e+1),disabled:b>=q.totalPages,className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded disabled:opacity-50",children:"Next"})]})]})]}),o&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Create Invoice"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),C.mutate({...v,subscriber_id:parseInt(v.subscriber_id)})},className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Subscriber ID"}),r.jsx("input",{type:"number",value:v.subscriber_id,onChange:e=>j({...v,subscriber_id:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Due Date"}),r.jsx("input",{type:"date",value:v.due_date,onChange:e=>j({...v,due_date:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Items"}),v.items.map((e,t)=>r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{type:"text",placeholder:"Description",value:e.description,onChange:e=>P(t,"description",e.target.value),className:"flex-1 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"}),r.jsx("input",{type:"number",placeholder:"Qty",value:e.quantity,onChange:e=>P(t,"quantity",e.target.value),className:"w-20 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"}),r.jsx("input",{type:"number",step:"0.01",placeholder:"Price",value:e.unit_price,onChange:e=>P(t,"unit_price",e.target.value),className:"w-24 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"}),v.items.length>1&&r.jsx("button",{type:"button",onClick:()=>(e=>{j({...v,items:v.items.filter((t,a)=>a!==e)})})(t),className:"px-2 text-red-600 hover:text-red-800",children:"X"})]},t)),r.jsx("button",{type:"button",onClick:()=>{j({...v,items:[...v.items,{description:"",quantity:1,unit_price:0}]})},className:"text-sm text-blue-600 hover:text-blue-800",children:"+ Add Item"})]}),r.jsxs("div",{className:"text-right text-lg font-semibold",children:["Total: $",v.items.reduce((e,t)=>e+t.quantity*t.unit_price,0).toFixed(2)]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Notes"}),r.jsx("textarea",{value:v.notes,onChange:e=>j({...v,notes:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",rows:3})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:C.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Create Invoice"})]})]})]})}),x&&g&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Add Payment"}),r.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Invoice: ",g.invoice_number," | Balance: $",(g.total-g.amount_paid).toFixed(2)]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),_.mutate({id:g.id,data:N})},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Amount"}),r.jsx("input",{type:"number",step:"0.01",value:N.amount,onChange:e=>w({...N,amount:parseFloat(e.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Method"}),r.jsxs("select",{value:N.method,onChange:e=>w({...N,method:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400",children:[r.jsx("option",{value:"cash",children:"Cash"}),r.jsx("option",{value:"card",children:"Card"}),r.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),r.jsx("option",{value:"online",children:"Online"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 dark:text-gray-500 dark:text-gray-400",children:"Reference"}),r.jsx("input",{type:"text",value:N.reference,onChange:e=>w({...N,reference:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:focus:ring-blue-400"})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-600 rounded-md hover:bg-gray-200 dark:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:_.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Add Payment"})]})]})]})})]})}export{n as default};
