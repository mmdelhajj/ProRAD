import{b as e,u as a,d as s,j as t}from"./data-vendor-Gi89QHLZ.js";import{r as l}from"./react-vendor-C1B6conR.js";import{u as d,c as i,y as n,z as o,j as r,A as p,n as _,k as m,v as c}from"./index-GTNkj1yj.js";import{u,f as h,g as x,a as g}from"./table-vendor-3gCiRijM.js";import{c as b,z as f}from"./ui-vendor-Bljr83Cq.js";import{F as y}from"./PencilIcon-BjNR2RGb.js";import{F as v}from"./TrashIcon-BFqTFmN6.js";import"./chart-vendor-C_esy2x0.js";function j({title:e,titleId:a,...s},t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},s),e?l.createElement("title",{id:a},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"}))}const N=l.forwardRef(j);function w(){var j;const w=e(),{hasPermission:q}=d(),[S,k]=l.useState(!1),[C,I]=l.useState(null),[M,P]=l.useState(()=>{try{const e=localStorage.getItem("services_sorting");return e?JSON.parse(e):[]}catch{return[]}});l.useEffect(()=>{localStorage.setItem("services_sorting",JSON.stringify(M))},[M]);const[A,F]=l.useState({name:"",description:"",download_speed:"",upload_speed:"",price:"",validity_days:"30",daily_quota:"",monthly_quota:"",burst_download:"",burst_upload:"",burst_threshold:"",burst_time:"",priority:"8",fup1_threshold:"",fup1_download_speed:"",fup1_upload_speed:"",fup2_threshold:"",fup2_download_speed:"",fup2_upload_speed:"",fup3_threshold:"",fup3_download_speed:"",fup3_upload_speed:"",monthly_fup1_threshold:"",monthly_fup1_download_speed:"",monthly_fup1_upload_speed:"",monthly_fup2_threshold:"",monthly_fup2_download_speed:"",monthly_fup2_upload_speed:"",monthly_fup3_threshold:"",monthly_fup3_download_speed:"",monthly_fup3_upload_speed:"",is_active:!0,time_based_speed_enabled:!1,time_from_hour:"12",time_from_minute:"0",time_from_ampm:"AM",time_to_hour:"12",time_to_minute:"0",time_to_ampm:"AM",time_download_ratio:"100",time_upload_ratio:"100",nas_id:null,pool_name:"",address_list_in:"",address_list_out:"",queue_type:"simple"}),[D,U]=l.useState([]),[B,K]=l.useState(!1),[L,T]=l.useState(null),[G,Q]=l.useState([]),[R,E]=l.useState(!1),{data:$,isLoading:z}=a({queryKey:["services"],queryFn:()=>m.list().then(e=>e.data.data)}),{data:V}=a({queryKey:["cdns"],queryFn:()=>c.list({active:"true"}).then(e=>e.data.data)}),{data:H}=a({queryKey:["nas-list"],queryFn:()=>_.list().then(e=>e.data.data)}),[W,O]=l.useState({}),J=async(e,a)=>{if(a){O(a=>({...a,[e]:{...a[e],loading:!0}}));try{const s=(await _.getPools(a)).data.data||[];O(a=>({...a,[e]:{loading:!1,pools:s}}));const t=A.pool_name;if(t){const a=s.find(e=>e.name===t);a&&U(s=>s.map(s=>{if(s.cdn_id!==e)return s;return s.pcq_target_pools&&s.pcq_target_pools.includes("/")?s:{...s,pcq_target_pools:a.ranges}}))}}catch(s){O(a=>({...a,[e]:{loading:!1,pools:[]}}))}}},X=async e=>{if(e){E(!0);try{const a=(await _.getPools(e)).data.data||[];Q(a)}catch(a){Q([]),f.error("Failed to fetch IP pools from NAS")}finally{E(!1)}}else Q([])},Y=s({mutationFn:async e=>{var a,s;let t;const l=D.map(e=>{let a=parseInt(e.time_from_hour)||12;"PM"===e.time_from_ampm&&12!==a&&(a+=12),"AM"===e.time_from_ampm&&12===a&&(a=0);let s=parseInt(e.time_to_hour)||12;return"PM"===e.time_to_ampm&&12!==s&&(s+=12),"AM"===e.time_to_ampm&&12===s&&(s=0),{cdn_id:e.cdn_id,speed_limit:e.speed_limit,bypass_quota:e.bypass_quota,pcq_enabled:e.pcq_enabled||!1,pcq_limit:parseInt(e.pcq_limit)||50,pcq_total_limit:parseInt(e.pcq_total_limit)||2e3,pcq_nas_id:e.pcq_nas_id||null,pcq_target_pools:e.pcq_target_pools||"",is_active:e.is_active,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:a,time_from_minute:parseInt(e.time_from_minute)||0,time_to_hour:s,time_to_minute:parseInt(e.time_to_minute)||0,time_speed_ratio:parseInt(e.time_speed_ratio)||0}});return C?(t=await m.update(C.id,e),B&&await c.updateServiceCDNs(C.id,{cdns:l})):(t=await m.create(e),(null==(s=null==(a=t.data)?void 0:a.data)?void 0:s.id)&&await c.updateServiceCDNs(t.data.data.id,{cdns:l})),t},onSuccess:()=>{f.success(C?"Service updated":"Service created"),w.invalidateQueries(["services"]),ae()},onError:e=>{var a,s;return f.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to save")}}),Z=s({mutationFn:e=>m.delete(e),onSuccess:()=>{f.success("Service deleted"),w.invalidateQueries(["services"])},onError:e=>{var a,s;return f.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to delete")}}),ee=(e=null)=>{var a,s,t,l;e?(I(e),F({name:e.name||"",description:e.description||"",download_speed:e.download_speed||"",upload_speed:e.upload_speed||"",price:e.price||"",validity_days:e.validity_days||"30",daily_quota:e.daily_quota?Math.round(e.daily_quota/1073741824):"",monthly_quota:e.monthly_quota?Math.round(e.monthly_quota/1073741824):"",burst_download:e.burst_download||"",burst_upload:e.burst_upload||"",burst_threshold:e.burst_threshold||"",burst_time:e.burst_time||"",priority:e.priority||"8",fup1_threshold:e.fup1_threshold?Math.round(e.fup1_threshold/1073741824):"",fup1_download_speed:e.fup1_download_speed||"",fup1_upload_speed:e.fup1_upload_speed||"",fup2_threshold:e.fup2_threshold?Math.round(e.fup2_threshold/1073741824):"",fup2_download_speed:e.fup2_download_speed||"",fup2_upload_speed:e.fup2_upload_speed||"",fup3_threshold:e.fup3_threshold?Math.round(e.fup3_threshold/1073741824):"",fup3_download_speed:e.fup3_download_speed||"",fup3_upload_speed:e.fup3_upload_speed||"",monthly_fup1_threshold:e.monthly_fup1_threshold?Math.round(e.monthly_fup1_threshold/1073741824):"",monthly_fup1_download_speed:e.monthly_fup1_download_speed||"",monthly_fup1_upload_speed:e.monthly_fup1_upload_speed||"",monthly_fup2_threshold:e.monthly_fup2_threshold?Math.round(e.monthly_fup2_threshold/1073741824):"",monthly_fup2_download_speed:e.monthly_fup2_download_speed||"",monthly_fup2_upload_speed:e.monthly_fup2_upload_speed||"",monthly_fup3_threshold:e.monthly_fup3_threshold?Math.round(e.monthly_fup3_threshold/1073741824):"",monthly_fup3_download_speed:e.monthly_fup3_download_speed||"",monthly_fup3_upload_speed:e.monthly_fup3_upload_speed||"",is_active:e.is_active??!0,time_based_speed_enabled:e.time_based_speed_enabled??!1,time_from_hour:(()=>{const a=e.time_from_hour||0;return 0===a?"12":a>12?(a-12).toString():a.toString()})(),time_from_minute:(null==(a=e.time_from_minute)?void 0:a.toString())||"0",time_from_ampm:(e.time_from_hour||0)>=12?"PM":"AM",time_to_hour:(()=>{const a=e.time_to_hour||0;return 0===a?"12":a>12?(a-12).toString():a.toString()})(),time_to_minute:(null==(s=e.time_to_minute)?void 0:s.toString())||"0",time_to_ampm:(e.time_to_hour||0)>=12?"PM":"AM",time_download_ratio:(null==(t=e.time_download_ratio)?void 0:t.toString())||"0",time_upload_ratio:(null==(l=e.time_upload_ratio)?void 0:l.toString())||"0",nas_id:e.nas_id||null,pool_name:e.pool_name||"",address_list_in:e.address_list_in||"",address_list_out:e.address_list_out||"",queue_type:e.queue_type||"simple"})):(I(null),F({name:"",description:"",download_speed:"",upload_speed:"",price:"",validity_days:"30",daily_quota:"",monthly_quota:"",burst_download:"",burst_upload:"",burst_threshold:"",burst_time:"",priority:"8",fup1_threshold:"",fup1_download_speed:"",fup1_upload_speed:"",fup2_threshold:"",fup2_download_speed:"",fup2_upload_speed:"",fup3_threshold:"",fup3_download_speed:"",fup3_upload_speed:"",monthly_fup1_threshold:"",monthly_fup1_download_speed:"",monthly_fup1_upload_speed:"",monthly_fup2_threshold:"",monthly_fup2_download_speed:"",monthly_fup2_upload_speed:"",monthly_fup3_threshold:"",monthly_fup3_download_speed:"",monthly_fup3_upload_speed:"",is_active:!0,time_based_speed_enabled:!1,time_from_hour:"12",time_from_minute:"0",time_from_ampm:"AM",time_to_hour:"12",time_to_minute:"0",time_to_ampm:"AM",time_download_ratio:"100",time_upload_ratio:"100",pool_name:"",address_list_in:"",address_list_out:"",queue_type:"simple"}));const d=(null==e?void 0:e.nas_id)||null;T(d),Q([]),E(!1),d&&X(d),K(!1),e?c.listServiceCDNs(e.id).then(e=>{const a=e.data.data||[];U(a.map(e=>{const a=e.time_from_hour||0,s=e.time_to_hour||0;return{cdn_id:e.cdn_id,speed_limit:e.speed_limit||0,bypass_quota:e.bypass_quota||!1,pcq_enabled:e.pcq_enabled||!1,pcq_limit:e.pcq_limit||50,pcq_total_limit:e.pcq_total_limit||2e3,pcq_nas_id:e.pcq_nas_id||null,pcq_target_pools:e.pcq_target_pools||"",is_active:e.is_active??!0,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:0===a?12:a>12?a-12:a,time_from_minute:e.time_from_minute||0,time_from_ampm:a>=12?"PM":"AM",time_to_hour:0===s?12:s>12?s-12:s,time_to_minute:e.time_to_minute||0,time_to_ampm:s>=12?"PM":"AM",time_speed_ratio:e.time_speed_ratio||0}})),K(!0)}).catch(()=>{U([]),K(!0)}):(U([]),K(!0)),k(!0)},ae=()=>{k(!1),I(null),U([])},[se,te]=l.useState(!1),[le,de]=l.useState(null),[ie,ne]=l.useState(""),oe=s({mutationFn:async({originalService:e,newName:a})=>{var s,t;const l={name:a,description:e.description||"",download_speed:e.download_speed||0,upload_speed:e.upload_speed||0,download_speed_str:e.download_speed?`${e.download_speed}k`:"",upload_speed_str:e.upload_speed?`${e.upload_speed}k`:"",price:e.price||0,day_price:e.day_price||0,validity_days:e.validity_days||30,daily_quota:e.daily_quota||0,monthly_quota:e.monthly_quota||0,burst_download:e.burst_download||0,burst_upload:e.burst_upload||0,burst_threshold:e.burst_threshold||0,burst_time:e.burst_time||0,priority:e.priority||8,fup1_threshold:e.fup1_threshold||0,fup1_download_speed:e.fup1_download_speed||0,fup1_upload_speed:e.fup1_upload_speed||0,fup2_threshold:e.fup2_threshold||0,fup2_download_speed:e.fup2_download_speed||0,fup2_upload_speed:e.fup2_upload_speed||0,fup3_threshold:e.fup3_threshold||0,fup3_download_speed:e.fup3_download_speed||0,fup3_upload_speed:e.fup3_upload_speed||0,monthly_fup1_threshold:e.monthly_fup1_threshold||0,monthly_fup1_download_speed:e.monthly_fup1_download_speed||0,monthly_fup1_upload_speed:e.monthly_fup1_upload_speed||0,monthly_fup2_threshold:e.monthly_fup2_threshold||0,monthly_fup2_download_speed:e.monthly_fup2_download_speed||0,monthly_fup2_upload_speed:e.monthly_fup2_upload_speed||0,monthly_fup3_threshold:e.monthly_fup3_threshold||0,monthly_fup3_download_speed:e.monthly_fup3_download_speed||0,monthly_fup3_upload_speed:e.monthly_fup3_upload_speed||0,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:e.time_from_hour||0,time_from_minute:e.time_from_minute||0,time_to_hour:e.time_to_hour||0,time_to_minute:e.time_to_minute||0,time_download_ratio:e.time_download_ratio||0,time_upload_ratio:e.time_upload_ratio||0,nas_id:e.nas_id||null,pool_name:e.pool_name||"",address_list_in:e.address_list_in||"",address_list_out:e.address_list_out||"",queue_type:e.queue_type||"simple",is_active:!0},d=await m.create(l);if(null==(t=null==(s=d.data)?void 0:s.data)?void 0:t.id)try{const a=(await c.listServiceCDNs(e.id)).data.data||[];a.length>0&&await c.updateServiceCDNs(d.data.data.id,{cdns:a.map(e=>({cdn_id:e.cdn_id,speed_limit:e.speed_limit,bypass_quota:e.bypass_quota,pcq_enabled:e.pcq_enabled||!1,pcq_limit:e.pcq_limit||50,pcq_total_limit:e.pcq_total_limit||2e3,pcq_nas_id:e.pcq_nas_id||null,pcq_target_pools:e.pcq_target_pools||"",is_active:e.is_active??!0,time_based_speed_enabled:e.time_based_speed_enabled||!1,time_from_hour:e.time_from_hour||0,time_from_minute:e.time_from_minute||0,time_to_hour:e.time_to_hour||0,time_to_minute:e.time_to_minute||0,time_speed_ratio:e.time_speed_ratio||0}))})}catch(i){}return d},onSuccess:()=>{f.success("Service duplicated successfully"),w.invalidateQueries(["services"]),te(!1),de(null)},onError:e=>{var a,s;return f.error((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)||"Failed to duplicate service")}}),re=e=>{const{name:a,value:s,type:t,checked:l}=e.target;F(e=>({...e,[a]:"checkbox"===t?l:s}))},pe=(e,a,s)=>{U(t=>t.map(t=>t.cdn_id===e?{...t,[a]:s}:t))},_e=(e,a)=>{U(s=>s.map(s=>s.cdn_id===e?{...s,...a}:s))},me=e=>{const a=null==V?void 0:V.find(a=>a.id===e);return(null==a?void 0:a.name)||"Unknown"},ce=l.useMemo(()=>[{accessorKey:"name",header:"Name",enableSorting:!0,cell:({row:e})=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.original.name}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.original.description})]})},{id:"speed",header:"Speed",enableSorting:!0,accessorFn:e=>e.download_speed||0,sortingFn:"basic",cell:({row:e})=>t.jsxs("div",{className:"text-sm",children:[t.jsxs("div",{children:["↓ ",e.original.download_speed," kb"]}),t.jsxs("div",{children:["↑ ",e.original.upload_speed," kb"]})]})},{accessorKey:"price",header:"Price",enableSorting:!0,sortingFn:"basic",cell:({row:e})=>{var a;return`$${null==(a=e.original.price)?void 0:a.toFixed(2)}`}},{accessorKey:"validity_days",header:"Validity",enableSorting:!1,cell:({row:e})=>`${e.original.validity_days} days`},{accessorKey:"quota",header:"Quota",enableSorting:!1,cell:({row:e})=>t.jsx("div",{className:"text-sm",children:e.original.daily_quota||e.original.monthly_quota?t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:["Daily: ",e.original.daily_quota?(e.original.daily_quota/1073741824).toFixed(0):"∞"," GB"]}),t.jsxs("div",{children:["Monthly: ",e.original.monthly_quota?(e.original.monthly_quota/1073741824).toFixed(0):"∞"," GB"]})]}):t.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Unlimited"})})},{accessorKey:"pool_name",header:"Pool",enableSorting:!1,cell:({row:e})=>t.jsx("span",{className:b("text-sm",e.original.pool_name?"text-gray-900":"text-gray-400"),children:e.original.pool_name||"None"})},{accessorKey:"fup",header:"FUP Tiers",enableSorting:!1,cell:({row:e})=>{const a=e.original,s=a.fup1_download_speed>0||a.fup2_download_speed>0||a.fup3_download_speed>0;return t.jsx("div",{className:"text-xs",children:s?t.jsxs(t.Fragment,{children:[a.fup1_threshold>0&&a.fup1_download_speed>0&&t.jsxs("div",{className:"text-orange-600",children:["FUP1: ",Math.round(a.fup1_threshold/1024/1024/1024),"GB → ",a.fup1_download_speed,"k/",a.fup1_upload_speed,"k"]}),a.fup2_threshold>0&&a.fup2_download_speed>0&&t.jsxs("div",{className:"text-red-600",children:["FUP2: ",Math.round(a.fup2_threshold/1024/1024/1024),"GB → ",a.fup2_download_speed,"k/",a.fup2_upload_speed,"k"]}),a.fup3_threshold>0&&a.fup3_download_speed>0&&t.jsxs("div",{className:"text-purple-600",children:["FUP3: ",Math.round(a.fup3_threshold/1024/1024/1024),"GB → ",a.fup3_download_speed,"k/",a.fup3_upload_speed,"k"]})]}):t.jsx("span",{className:"text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"None"})})}},{accessorKey:"is_active",header:"Status",enableSorting:!1,cell:({row:e})=>t.jsx("span",{className:b("badge",e.original.is_active?"badge-success":"badge-gray"),children:e.original.is_active?"Active":"Inactive"})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[q("services.edit")&&t.jsx("button",{onClick:()=>ee(e.original),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-primary-50 dark:hover:bg-primary-900/30 rounded",title:"Edit",children:t.jsx(y,{className:"w-4 h-4"})}),q("services.delete")&&t.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this service?")&&Z.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete",children:t.jsx(v,{className:"w-4 h-4"})})]})}],[Z,q]),ue=u({data:$||[],columns:ce,state:{sorting:M},onSortingChange:P,getCoreRowModel:g(),getSortedRowModel:x()});return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Services"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage internet service plans"})]}),q("services.create")&&t.jsxs("button",{onClick:()=>ee(),className:"btn-primary flex items-center gap-2 w-full sm:w-auto justify-center",children:[t.jsx(i,{className:"w-4 h-4"}),"Add Service"]})]}),t.jsx("div",{className:"card",children:t.jsx("div",{className:"table-container",children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:ue.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(e=>t.jsx("th",{children:e.column.getCanSort()?t.jsxs("button",{type:"button",onClick:e.column.getToggleSortingHandler(),className:"flex items-center gap-1 cursor-pointer select-none hover:text-primary-600 dark:hover:text-primary-400",children:[h(e.column.columnDef.header,e.getContext()),{asc:t.jsx(o,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"}),desc:t.jsx(n,{className:"w-4 h-4 text-primary-600 dark:text-primary-400"})}[e.column.getIsSorted()]??t.jsx(N,{className:"w-3.5 h-3.5 text-gray-400"})]}):h(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:z?t.jsx("tr",{children:t.jsx("td",{colSpan:ce.length,className:"text-center py-8",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===ue.getRowModel().rows.length?t.jsx("tr",{children:t.jsx("td",{colSpan:ce.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No services found"})}):ue.getRowModel().rows.map(e=>t.jsx("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>{return a=e.original,de(a),ne(a.name+" (Copy)"),void te(!0);var a},children:e.getVisibleCells().map(e=>t.jsx("td",{children:h(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),se&&le&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>te(!1)}),t.jsx("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full",children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"Duplicate Service"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Copy all settings from ",t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:le.name})]}),t.jsxs("div",{className:"mb-2 text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[t.jsxs("div",{children:["Speed: ↓",le.download_speed,"kb / ↑",le.upload_speed,"kb"]}),t.jsxs("div",{children:["Price: $",null==(j=le.price)?void 0:j.toFixed(2)," | Validity: ",le.validity_days," days"]}),le.pool_name&&t.jsxs("div",{children:["Pool: ",le.pool_name]})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),ie.trim()?oe.mutate({originalService:le,newName:ie.trim()}):f.error("Service name is required")},className:"mt-4",children:[t.jsx("label",{className:"label",children:"New Service Name"}),t.jsx("input",{type:"text",value:ie,onChange:e=>ne(e.target.value),className:"input w-full",autoFocus:!0,required:!0}),t.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[t.jsx("button",{type:"button",onClick:()=>te(!1),className:"btn-secondary",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:oe.isLoading,className:"btn-primary",children:oe.isLoading?"Duplicating...":"Duplicate"})]})]})]})})]})}),S&&t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:ae}),t.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[t.jsx("h2",{className:"text-xl font-semibold",children:C?"Edit Service":"Add Service"}),t.jsx("button",{onClick:ae,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:t.jsx(r,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=parseInt(A.download_speed)||0,s=parseInt(A.upload_speed)||0,t={...A,download_speed:a,upload_speed:s,download_speed_str:a>0?`${a}k`:"",upload_speed_str:s>0?`${s}k`:"",price:parseFloat(A.price)||0,validity_days:parseInt(A.validity_days)||30,daily_quota:A.daily_quota?1024*parseInt(A.daily_quota)*1024*1024:0,monthly_quota:A.monthly_quota?1024*parseInt(A.monthly_quota)*1024*1024:0,burst_download:parseInt(A.burst_download)||0,burst_upload:parseInt(A.burst_upload)||0,burst_threshold:parseInt(A.burst_threshold)||0,burst_time:parseInt(A.burst_time)||0,priority:parseInt(A.priority)||8,fup1_threshold:A.fup1_threshold?1024*parseInt(A.fup1_threshold)*1024*1024:0,fup1_download_speed:parseInt(A.fup1_download_speed)||0,fup1_upload_speed:parseInt(A.fup1_upload_speed)||0,fup2_threshold:A.fup2_threshold?1024*parseInt(A.fup2_threshold)*1024*1024:0,fup2_download_speed:parseInt(A.fup2_download_speed)||0,fup2_upload_speed:parseInt(A.fup2_upload_speed)||0,fup3_threshold:A.fup3_threshold?1024*parseInt(A.fup3_threshold)*1024*1024:0,fup3_download_speed:parseInt(A.fup3_download_speed)||0,fup3_upload_speed:parseInt(A.fup3_upload_speed)||0,monthly_fup1_threshold:A.monthly_fup1_threshold?1024*parseInt(A.monthly_fup1_threshold)*1024*1024:0,monthly_fup1_download_speed:parseInt(A.monthly_fup1_download_speed)||0,monthly_fup1_upload_speed:parseInt(A.monthly_fup1_upload_speed)||0,monthly_fup2_threshold:A.monthly_fup2_threshold?1024*parseInt(A.monthly_fup2_threshold)*1024*1024:0,monthly_fup2_download_speed:parseInt(A.monthly_fup2_download_speed)||0,monthly_fup2_upload_speed:parseInt(A.monthly_fup2_upload_speed)||0,monthly_fup3_threshold:A.monthly_fup3_threshold?1024*parseInt(A.monthly_fup3_threshold)*1024*1024:0,monthly_fup3_download_speed:parseInt(A.monthly_fup3_download_speed)||0,monthly_fup3_upload_speed:parseInt(A.monthly_fup3_upload_speed)||0,time_based_speed_enabled:A.time_based_speed_enabled,time_from_hour:(()=>{let e=parseInt(A.time_from_hour)||12;return"PM"===A.time_from_ampm&&12!==e&&(e+=12),"AM"===A.time_from_ampm&&12===e&&(e=0),e})(),time_from_minute:parseInt(A.time_from_minute)||0,time_to_hour:(()=>{let e=parseInt(A.time_to_hour)||12;return"PM"===A.time_to_ampm&&12!==e&&(e+=12),"AM"===A.time_to_ampm&&12===e&&(e=0),e})(),time_to_minute:parseInt(A.time_to_minute)||0,time_download_ratio:parseInt(A.time_download_ratio)||0,time_upload_ratio:parseInt(A.time_upload_ratio)||0};Y.mutate(t)},className:"p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label",children:"Service Name"}),t.jsx("input",{type:"text",name:"name",value:A.name,onChange:re,className:"input",required:!0})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label",children:"Description"}),t.jsx("textarea",{name:"description",value:A.description,onChange:re,className:"input",rows:2})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Speed Settings"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Download Speed (kb)"}),t.jsx("input",{type:"number",name:"download_speed",value:A.download_speed,onChange:re,className:"input",placeholder:"e.g., 4000 for 4Mbps",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Upload Speed (kb)"}),t.jsx("input",{type:"number",name:"upload_speed",value:A.upload_speed,onChange:re,className:"input",placeholder:"e.g., 1400 for 1.4Mbps",required:!0})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Pricing & Validity"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Price ($)"}),t.jsx("input",{type:"number",name:"price",value:A.price,onChange:re,className:"input",step:"0.01",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Validity (Days)"}),t.jsx("input",{type:"number",name:"validity_days",value:A.validity_days,onChange:re,className:"input",required:!0})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Quota Settings (0 = Unlimited)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Daily Quota (GB)"}),t.jsx("input",{type:"number",name:"daily_quota",value:A.daily_quota,onChange:re,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Monthly Quota (GB)"}),t.jsx("input",{type:"number",name:"monthly_quota",value:A.monthly_quota,onChange:re,className:"input"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Burst Settings (Mikrotik)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Download (kb)"}),t.jsx("input",{type:"number",name:"burst_download",value:A.burst_download,onChange:re,className:"input",placeholder:"e.g., 8000"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Upload (kb)"}),t.jsx("input",{type:"number",name:"burst_upload",value:A.burst_upload,onChange:re,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Threshold (%)"}),t.jsx("input",{type:"number",name:"burst_threshold",value:A.burst_threshold,onChange:re,className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Burst Time (seconds)"}),t.jsx("input",{type:"number",name:"burst_time",value:A.burst_time,onChange:re,className:"input"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"RADIUS Settings"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Select NAS/Router"}),t.jsxs("select",{value:L||"",onChange:e=>{const a=e.target.value?parseInt(e.target.value):null;T(a),F(e=>({...e,nas_id:a})),a?X(a):Q([])},className:"input",children:[t.jsx("option",{value:"",children:"-- Select NAS to fetch pools --"}),null==H?void 0:H.filter(e=>e.is_active).map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.ip_address,")"]},e.id))]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Select router to load available IP pools"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"IP Pool Name"}),R?t.jsxs("div",{className:"input flex items-center text-gray-500 dark:text-gray-400",children:[t.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading pools..."]}):G.length>0||A.pool_name?t.jsxs("select",{name:"pool_name",value:A.pool_name,onChange:re,className:"input",children:[t.jsx("option",{value:"",children:"-- Select Pool --"}),A.pool_name&&!G.find(e=>e.name===A.pool_name)&&t.jsxs("option",{value:A.pool_name,children:[A.pool_name," (current)"]},A.pool_name),G.map(e=>t.jsxs("option",{value:e.name,children:[e.name," (",e.ranges,")"]},e.name))]}):t.jsx("input",{type:"text",name:"pool_name",value:A.pool_name,onChange:re,className:"input",placeholder:L?"No pools found - enter manually":"Select NAS first or enter manually"}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:A.pool_name?t.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Selected: ",A.pool_name]}):"Pool for Framed-Pool RADIUS attribute"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Daily FUP (Resets Every Day at Midnight)"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Set up to 3 FUP tiers. When daily usage exceeds a threshold, the specified speed is applied. Speed is in Kbps (e.g., 700 = 700k)."}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-orange-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"FUP1 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup1_threshold",value:A.fup1_threshold,onChange:re,className:"input",placeholder:"e.g., 7"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup1_download_speed",value:A.fup1_download_speed,onChange:re,className:"input",placeholder:"e.g., 700"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-orange-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup1_upload_speed",value:A.fup1_upload_speed,onChange:re,className:"input",placeholder:"e.g., 700"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-red-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"FUP2 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup2_threshold",value:A.fup2_threshold,onChange:re,className:"input",placeholder:"e.g., 9"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup2_download_speed",value:A.fup2_download_speed,onChange:re,className:"input",placeholder:"e.g., 500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-red-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup2_upload_speed",value:A.fup2_upload_speed,onChange:re,className:"input",placeholder:"e.g., 500"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-purple-50 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"FUP3 Threshold (GB)"}),t.jsx("input",{type:"number",name:"fup3_threshold",value:A.fup3_threshold,onChange:re,className:"input",placeholder:"e.g., 11"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"fup3_download_speed",value:A.fup3_download_speed,onChange:re,className:"input",placeholder:"e.g., 300"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-purple-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"fup3_upload_speed",value:A.fup3_upload_speed,onChange:re,className:"input",placeholder:"e.g., 300"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h3",{className:"font-medium mb-3",children:"Monthly FUP (Resets on Subscription Renewal)"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"When monthly usage exceeds the threshold, the specified speed is applied. Resets when the user renews their subscription."}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-cyan-50 dark:bg-cyan-900/30 rounded-lg",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Threshold (GB)"}),t.jsx("input",{type:"number",name:"monthly_fup1_threshold",value:A.monthly_fup1_threshold,onChange:re,className:"input",placeholder:"e.g., 100"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Download (Kbps)"}),t.jsx("input",{type:"number",name:"monthly_fup1_download_speed",value:A.monthly_fup1_download_speed,onChange:re,className:"input",placeholder:"e.g., 500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-cyan-700",children:"Upload (Kbps)"}),t.jsx("input",{type:"number",name:"monthly_fup1_upload_speed",value:A.monthly_fup1_upload_speed,onChange:re,className:"input",placeholder:"e.g., 500"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"font-medium",children:"Free Hours — Quota Discount (Automatic)"}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",name:"time_based_speed_enabled",checked:A.time_based_speed_enabled,onChange:re,className:"toggle toggle-primary"}),t.jsx("span",{className:"text-sm font-medium "+(A.time_based_speed_enabled?"text-green-600":"text-gray-500"),children:A.time_based_speed_enabled?"Enabled":"Disabled"})]})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Give customers free quota during specified hours. Set 100% = completely free (no quota counted), 70% = 70% free (only 30% counted), 0% = no discount. Use Bandwidth Rules to boost speed separately."}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 "+(A.time_based_speed_enabled?"":"opacity-50 pointer-events-none"),children:[t.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg",children:[t.jsx("label",{className:"label text-indigo-700 mb-2",children:"From Time"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("select",{name:"time_from_hour",value:A.time_from_hour,onChange:re,className:"input w-20",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("span",{className:"font-bold",children:":"}),t.jsx("select",{name:"time_from_minute",value:A.time_from_minute,onChange:re,className:"input w-20",children:[0,15,30,45].map(e=>t.jsx("option",{value:e,children:e.toString().padStart(2,"0")},e))}),t.jsxs("select",{name:"time_from_ampm",value:A.time_from_ampm,onChange:re,className:"input w-20 font-semibold",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]}),t.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg",children:[t.jsx("label",{className:"label text-indigo-700 mb-2",children:"To Time"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("select",{name:"time_to_hour",value:A.time_to_hour,onChange:re,className:"input w-20",children:[12,1,2,3,4,5,6,7,8,9,10,11].map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("span",{className:"font-bold",children:":"}),t.jsx("select",{name:"time_to_minute",value:A.time_to_minute,onChange:re,className:"input w-20",children:[0,15,30,45].map(e=>t.jsx("option",{value:e,children:e.toString().padStart(2,"0")},e))}),t.jsxs("select",{name:"time_to_ampm",value:A.time_to_ampm,onChange:re,className:"input w-20 font-semibold",children:[t.jsx("option",{value:"AM",children:"AM"}),t.jsx("option",{value:"PM",children:"PM"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 bg-indigo-50 rounded-lg "+(A.time_based_speed_enabled?"":"opacity-50 pointer-events-none"),children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-indigo-700",children:"Quota Free % (Download)"}),t.jsx("input",{type:"number",name:"time_download_ratio",value:A.time_download_ratio,onChange:re,className:"input",placeholder:"100",min:"0",max:"100"}),t.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:"100% = fully free, 70% = 30% counted"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-indigo-700",children:"Quota Free % (Upload)"}),t.jsx("input",{type:"number",name:"time_upload_ratio",value:A.time_upload_ratio,onChange:re,className:"input",placeholder:"100",min:"0",max:"100"}),t.jsx("p",{className:"text-xs text-indigo-500 mt-1",children:"100% = fully free, 70% = 30% counted"})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("h3",{className:"font-medium mb-3 flex items-center gap-2",children:[t.jsx(p,{className:"w-5 h-5 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400"}),"CDN Configuration"]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Configure which CDNs apply to this service with custom speed limits and bypass options."}),V&&V.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs("select",{className:"input",value:"",onChange:e=>{e.target.value&&(e=>{if(D.find(a=>a.cdn_id===e))return;const a=L||A.nas_id||null,s=A.pool_name||"";U([...D,{cdn_id:e,speed_limit:0,bypass_quota:!1,pcq_enabled:!1,pcq_limit:50,pcq_total_limit:2e3,pcq_nas_id:a,pcq_target_pools:s,is_active:!0,time_based_speed_enabled:!1,time_from_hour:12,time_from_minute:0,time_from_ampm:"AM",time_to_hour:12,time_to_minute:0,time_to_ampm:"AM",time_speed_ratio:100}]),a&&J(e,a)})(parseInt(e.target.value))},children:[t.jsx("option",{value:"",children:"+ Add CDN..."}),V.filter(e=>!D.find(a=>a.cdn_id===e.id)).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})}),D.length>0?t.jsx("div",{className:"space-y-3",children:D.map(e=>{var a,s,l;return t.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(p,{className:"w-5 h-5 text-indigo-500"}),t.jsx("span",{className:"font-medium",children:me(e.cdn_id)})]}),t.jsx("button",{type:"button",onClick:()=>{return a=e.cdn_id,void U(D.filter(e=>e.cdn_id!==a));var a},className:"text-red-500 hover:text-red-700 p-1",children:t.jsx(v,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs",children:"Speed Limit (Mbps)"}),t.jsx("input",{type:"number",value:0===e.speed_limit?"":e.speed_limit,onChange:a=>pe(e.cdn_id,"speed_limit",""===a.target.value?0:parseInt(a.target.value)||0),className:"input text-sm",placeholder:"0 = unlimited",min:"0"})]}),t.jsx("div",{className:"flex items-end",children:t.jsxs("label",{className:"flex items-center gap-2 pb-2",children:[t.jsx("input",{type:"checkbox",checked:e.bypass_quota,onChange:a=>pe(e.cdn_id,"bypass_quota",a.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Bypass Quota"})]})}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:e.is_active,onChange:a=>pe(e.cdn_id,"is_active",a.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{className:"text-sm",children:"Active"})]}),t.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"Show in Live Graph"})]})]}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:e.pcq_enabled,onChange:a=>{const s=a.target.checked,t=L||A.nas_id||null;s&&t&&!e.pcq_nas_id?(_e(e.cdn_id,{pcq_enabled:!0,pcq_nas_id:t}),J(e.cdn_id,t)):pe(e.cdn_id,"pcq_enabled",s)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400"}),t.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"PCQ Mode"})]}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"(Shared queue for all subscribers)"})]}),e.pcq_enabled&&t.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded space-y-3",children:[(()=>{const a=L||A.nas_id||null,s=a?null==H?void 0:H.find(e=>e.id===a):null;return s?t.jsxs("div",{className:"text-xs text-blue-700",children:["NAS: ",t.jsxs("span",{className:"font-medium",children:[s.name," (",s.ip_address,")"]}),t.jsx("span",{className:"text-gray-400 ml-1",children:"— from RADIUS Settings"})]}):t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"Select NAS"}),t.jsxs("select",{value:e.pcq_nas_id||"",onChange:a=>{const s=a.target.value?parseInt(a.target.value):null;_e(e.cdn_id,{pcq_nas_id:s,pcq_target_pools:""}),s&&J(e.cdn_id,s)},className:"input text-sm",children:[t.jsx("option",{value:"",children:"-- Select NAS --"}),null==H?void 0:H.filter(e=>e.is_active).map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.ip_address,")"]},e.id))]})]})})(),e.pcq_nas_id&&t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"Select Pools (Target)"}),(null==(a=W[e.cdn_id])?void 0:a.loading)?t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Loading pools..."}):(null==(l=null==(s=W[e.cdn_id])?void 0:s.pools)?void 0:l.length)>0?t.jsx("div",{className:"grid grid-cols-2 gap-2 mt-1",children:W[e.cdn_id].pools.filter(e=>!A.pool_name||e.name===A.pool_name).map(a=>{const s=e.pcq_target_pools?e.pcq_target_pools.split(","):[],l=s.includes(a.ranges);return t.jsxs("label",{className:"flex items-center gap-2 p-2 bg-white rounded border cursor-pointer hover:bg-blue-50",children:[t.jsx("input",{type:"checkbox",checked:l,onChange:t=>{let l=[...s];t.target.checked?l.push(a.ranges):l=l.filter(e=>e!==a.ranges),pe(e.cdn_id,"pcq_target_pools",l.filter(e=>e).join(","))},className:"rounded border-gray-300 text-blue-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:a.name}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:a.ranges})]})]},a.name)})}):t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:t.jsx("button",{type:"button",onClick:()=>J(e.cdn_id,e.pcq_nas_id),className:"text-blue-600 hover:underline",children:"Click to fetch pools from NAS"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-blue-200",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"PCQ Limit (KiB)"}),t.jsx("input",{type:"number",value:e.pcq_limit,onChange:a=>pe(e.cdn_id,"pcq_limit",parseInt(a.target.value)||50),className:"input text-sm",min:"1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label text-xs text-blue-700",children:"PCQ Total Limit (KiB)"}),t.jsx("input",{type:"number",value:e.pcq_total_limit,onChange:a=>pe(e.cdn_id,"pcq_total_limit",parseInt(a.target.value)||2e3),className:"input text-sm",min:"1"})]})]}),e.pcq_target_pools&&t.jsxs("div",{className:"text-xs text-blue-600 bg-blue-100 p-2 rounded",children:[t.jsx("strong",{children:"Target:"})," ",e.pcq_target_pools]})]})]})]},e.cdn_id)})}):t.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"No CDNs configured. Select a CDN from the dropdown above."})]}),t.jsx("div",{className:"border-t pt-4",children:t.jsxs("label",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",name:"is_active",checked:A.is_active,onChange:re,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),t.jsx("span",{children:"Active Service"})]})}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[t.jsx("button",{type:"button",onClick:ae,className:"btn-secondary",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:Y.isLoading||C&&!B,className:"btn-primary",children:Y.isLoading?"Saving...":!B&&C?"Loading CDNs...":C?"Update":"Create"})]})]})]})]})})]})}export{w as default};
