import{b as e,u as s,d as a,j as r}from"./data-vendor-DrqtOFCb.js";import{r as t}from"./react-vendor-_qYBQpt5.js";import{u as l,F as i,t as d,e as n,b as c,a as o,H as x}from"./index-BAxY-e20.js";import{u as m,f as h,a as g}from"./table-vendor-XPl0DXXF.js";import{z as u}from"./ui-vendor-C17HITwC.js";import{F as j}from"./ArrowUpTrayIcon-LbDro8i1.js";import{F as p}from"./XCircleIcon-BUCetHXU.js";import{F as v}from"./MagnifyingGlassIcon-Bzqxa0ti.js";import"./chart-vendor-CsTzT1mg.js";function y(e){if(!e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB","TB"][s]}function f(e){if(!e)return"0s";const s=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return s>0?`${s}h ${a}m`:a>0?`${a}m ${r}s`:`${r}s`}function N(){const N=e(),{hasPermission:w}=l(),[_,b]=t.useState(""),{data:k,isLoading:M,refetch:C}=s({queryKey:["sessions"],queryFn:()=>x.list({limit:100}).then(e=>e.data.data),refetchInterval:1e4}),A=a({mutationFn:e=>x.disconnect(e),onSuccess:()=>{u.success("Session disconnected"),N.invalidateQueries(["sessions"])},onError:e=>{var s,a;return u.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to disconnect")}}),F=t.useMemo(()=>{if(!k)return[];if(!_)return k;const e=_.toLowerCase();return k.filter(s=>{var a,r,t,l,i;return(null==(a=s.username)?void 0:a.toLowerCase().includes(e))||(null==(r=s.framed_ip_address)?void 0:r.includes(e))||(null==(t=s.nas_ip_address)?void 0:t.includes(e))||(null==(l=s.calling_station_id)?void 0:l.toLowerCase().includes(e))||(null==(i=s.full_name)?void 0:i.toLowerCase().includes(e))})},[k,_]),K=t.useMemo(()=>[{accessorKey:"username",header:"Username",cell:({row:e})=>r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(i,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{className:"font-medium",children:e.original.username})]}),e.original.full_name&&r.jsx("span",{className:"text-xs text-gray-500 ml-6",children:e.original.full_name})]})},{accessorKey:"framed_ip_address",header:"IP Address",cell:({row:e})=>r.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm",children:e.original.framed_ip_address||"-"})},{accessorKey:"calling_station_id",header:"MAC Address",cell:({row:e})=>r.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm text-xs",children:e.original.calling_station_id||"-"})},{accessorKey:"nas_name",header:"NAS",cell:({row:e})=>r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{children:e.original.nas_name||e.original.nas_ip_address||"-"}),e.original.nas_name&&e.original.nas_ip_address&&r.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 dark:text-gray-400",children:e.original.nas_ip_address})]})},{accessorKey:"acct_start_time",header:"Started",cell:({row:e})=>r.jsx("div",{className:"text-sm",children:d(e.original.acct_start_time)})},{accessorKey:"session_duration",header:"Duration",cell:({row:e})=>r.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[r.jsx(n,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 dark:text-gray-400"}),f(e.original.session_duration)]})},{accessorKey:"traffic",header:"Traffic",cell:({row:e})=>r.jsxs("div",{className:"text-sm space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[r.jsx(c,{className:"w-3 h-3"}),y(e.original.acct_input_octets)]}),r.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[r.jsx(j,{className:"w-3 h-3"}),y(e.original.acct_output_octets)]})]})},{id:"actions",header:"Actions",cell:({row:e})=>w("subscribers.disconnect")?r.jsx("button",{onClick:()=>{confirm("Disconnect this session?")&&A.mutate(e.original.id)},className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Disconnect",children:r.jsx(p,{className:"w-5 h-5"})}):null}],[A,w]),S=m({data:F,columns:K,getCoreRowModel:g()}),B=(null==k?void 0:k.reduce((e,s)=>e+(s.acct_input_octets||0),0))||0,D=(null==k?void 0:k.reduce((e,s)=>e+(s.acct_output_octets||0),0))||0;return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Active Sessions"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monitor live PPPoE connections"})]}),r.jsxs("button",{onClick:()=>C(),className:"btn-secondary flex items-center gap-2 w-full sm:w-auto justify-center",children:[r.jsx(o,{className:"w-4 h-4"}),"Refresh"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:r.jsx(i,{className:"w-5 h-5 text-green-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Online Users"}),r.jsx("div",{className:"text-2xl font-bold",children:(null==k?void 0:k.length)||0})]})]})}),r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:r.jsx(c,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Download"}),r.jsx("div",{className:"text-2xl font-bold",children:y(B)})]})]})}),r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:r.jsx(j,{className:"w-5 h-5 text-purple-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Total Upload"}),r.jsx("div",{className:"text-2xl font-bold",children:y(D)})]})]})}),r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:r.jsx(n,{className:"w-5 h-5 text-yellow-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"Auto-refresh"}),r.jsx("div",{className:"text-lg font-bold",children:"Every 10s"})]})]})})]}),r.jsx("div",{className:"card p-4",children:r.jsxs("div",{className:"relative max-w-md",children:[r.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 dark:text-gray-500 dark:text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search by username, IP, MAC...",value:_,onChange:e=>b(e.target.value),className:"input pl-10"})]})}),r.jsx("div",{className:"card",children:r.jsx("div",{className:"table-container",children:r.jsxs("table",{className:"table",children:[r.jsx("thead",{children:S.getHeaderGroups().map(e=>r.jsx("tr",{children:e.headers.map(e=>r.jsx("th",{children:h(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:M?r.jsx("tr",{children:r.jsx("td",{colSpan:K.length,className:"text-center py-8",children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===S.getRowModel().rows.length?r.jsx("tr",{children:r.jsx("td",{colSpan:K.length,className:"text-center py-8 text-gray-500 dark:text-gray-400 dark:text-gray-500 dark:text-gray-400",children:"No active sessions"})}):S.getRowModel().rows.map(e=>r.jsx("tr",{className:"hover:bg-gray-50 dark:bg-gray-700",children:e.getVisibleCells().map(e=>r.jsx("td",{children:h(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})})]})}export{N as default};
