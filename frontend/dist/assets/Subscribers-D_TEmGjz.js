import{b as e,u as s,d as a,j as t}from"./data-vendor-C6mPcuPT.js";import{r,b as l,L as n}from"./react-vendor-C4Xey-hE.js";import{u as i,f as c,F as d,a as o,b as m,c as x,d as u,e as h,g as b,h as p,s as g,i as v,n as j}from"./index-DmOIf-MM.js";import{u as y,f as N,g as f,a as w}from"./table-vendor-BZVOk-Gl.js";import{c as _,z as C}from"./ui-vendor-CMKyyIMz.js";import{F as k}from"./ArrowUpTrayIcon-KwZNblaH.js";import{F as S}from"./DocumentArrowUpIcon-CR12HOyy.js";import{F}from"./MagnifyingGlassIcon-D7UyJAmN.js";import{F as A,a as M,b as E}from"./FunnelIcon-CqzGRNnT.js";import{F as P}from"./EyeIcon-CLCqJwk9.js";import{F as R}from"./PlayIcon-0-RjI_79.js";import{F as I}from"./XCircleIcon-ngg1M-ll.js";import{F as D}from"./BanknotesIcon-BC0JzAj0.js";import{F as U}from"./TrashIcon-BFZdbUYd.js";import"./chart-vendor-Be69IwoK.js";function $({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const L=r.forwardRef($);function O({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"}))}const B=r.forwardRef(O);function q({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"}))}const K=r.forwardRef(q);function Q({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const X=r.forwardRef(Q);function T({title:e,titleId:s,...a},t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},a),e?r.createElement("title",{id:s},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const V=r.forwardRef(T),H=[{value:"",label:"All Status"},{value:"online",label:"Online"},{value:"offline",label:"Offline"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"expired",label:"Expired"},{value:"expiring",label:"Expiring Soon"}],Z=e=>{const s=e.expiry_date&&new Date(e.expiry_date)<new Date;return e.expiry_date&&(new Date(e.expiry_date),new Date(Date.now()+6048e5)),0===e.status?{color:"bg-gray-500",text:"Inactive",textColor:"text-gray-600"}:2===e.status?{color:"bg-gray-500",text:"Suspended",textColor:"text-gray-600"}:s?{color:"bg-yellow-500",text:"Expired",textColor:"text-yellow-600"}:e.is_online?{color:"bg-green-500",text:"Online",textColor:"text-green-600"}:{color:"bg-red-500",text:"Offline",textColor:"text-red-600"}},z=e=>{if(!e||0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(1))+" "+["B","KB","MB","GB","TB"][s]};function W(){var $,O,q,Q,T,W,G,J,Y,ee,se,ae,te,re,le;l();const ne=e(),{hasPermission:ie}=i(),ce=r.useRef(null),[de,oe]=r.useState(1),[me,xe]=r.useState(25),[ue,he]=r.useState(""),[be,pe]=r.useState(""),[ge,ve]=r.useState(""),[je,ye]=r.useState(""),[Ne,fe]=r.useState(!1),[we,_e]=r.useState([]),[Ce,ke]=r.useState("active"),[Se,Fe]=r.useState(new Set),[Ae,Me]=r.useState({username:!0,full_name:!0,phone:!0,mac_address:!0,ip_address:!0,service:!0,status:!0,expiry_date:!0,daily_quota:!0,monthly_quota:!0,balance:!1,address:!1,region:!1}),[Ee,Pe]=r.useState(!1),[Re,Ie]=r.useState(!1),[De,Ue]=r.useState(null),[$e,Le]=r.useState(""),[Oe,Be]=r.useState(null),[qe,Ke]=r.useState(null),[Qe,Xe]=r.useState(""),[Te,Ve]=r.useState(""),[He,Ze]=r.useState({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0}),[ze,We]=r.useState(null),[Ge,Je]=r.useState(!1),[Ye,es]=r.useState(null),[ss,as]=r.useState(null),[ts,rs]=r.useState(!1),[ls,ns]=r.useState(!0),{data:is,isLoading:cs,refetch:ds}=s({queryKey:["subscribers",de,me,ue,be,ge,je,Ce],queryFn:()=>"archived"===Ce?g.listArchived({page:de,limit:me,search:ue}).then(e=>e.data):g.list({page:de,limit:me,search:ue,status:be,service_id:ge,nas_id:je}).then(e=>e.data)}),{data:os}=s({queryKey:["services-list"],queryFn:()=>v.list().then(e=>e.data.data)}),{data:ms}=s({queryKey:["nas-list"],queryFn:()=>j.list().then(e=>e.data.data)}),xs=r.useMemo(()=>((null==is?void 0:is.data)||[]).filter(e=>Se.has(e.id)),[null==is?void 0:is.data,Se]),us=Se.size,hs=()=>{Fe(new Set)},bs=a({mutationFn:e=>g.renew(e),onSuccess:()=>{C.success("Subscriber renewed successfully"),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to renew")}}),ps=a({mutationFn:e=>g.disconnect(e),onSuccess:()=>{C.success("Subscriber disconnected"),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to disconnect")}}),gs=a({mutationFn:e=>g.resetFup(e),onSuccess:()=>{C.success("FUP quota reset successfully"),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to reset FUP")}}),vs=a({mutationFn:({id:e,mac_address:s,reason:a})=>g.resetMac(e,{mac_address:s,reason:a}),onSuccess:()=>{C.success("MAC address reset successfully"),Ke(null),Xe(""),Ve(""),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to reset MAC")}}),js=a({mutationFn:({id:e,new_username:s,reason:a})=>g.rename(e,{new_username:s,reason:a}),onSuccess:()=>{C.success("Username changed successfully"),Ke(null),Xe(""),Ve(""),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to rename")}}),ys=a({mutationFn:({id:e,days:s,reason:a})=>g.addDays(e,{days:s,reason:a}),onSuccess:()=>{C.success("Days added successfully"),Ke(null),Xe(""),Ve(""),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to add days")}}),Ns=a({mutationFn:({id:e,service_id:s,extend_expiry:a,reset_fup:t,charge_price:r,prorate_price:l,reason:n})=>g.changeService(e,{service_id:s,extend_expiry:a,reset_fup:t,charge_price:r,prorate_price:l,reason:n}),onSuccess:e=>{var s;const a=null==(s=e.data)?void 0:s.data;let t="Service changed successfully";(null==a?void 0:a.charge_amount)&&(t+=`. Charged: $${a.charge_amount.toFixed(2)}`),C.success(t),Ke(null),Xe(""),Ve(""),We(null),Ze({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0}),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to change service")}}),fs=async e=>{var s,a,t,r;if(e&&e.is_online){rs(!0);try{const t=await g.getTorch(e.id,2);(null==(s=t.data)?void 0:s.success)?as(t.data.data):(C.error((null==(a=t.data)?void 0:a.message)||"Failed to get torch data"),as(null))}catch(l){C.error((null==(r=null==(t=l.response)?void 0:t.data)?void 0:r.message)||"Failed to get torch data"),as(null)}finally{rs(!1)}}};r.useEffect(()=>{let e;return Ye&&ls&&!ts&&(e=setInterval(()=>{fs(Ye)},2e3)),()=>{e&&clearInterval(e)}},[Ye,ls,ts]);const ws=a({mutationFn:e=>g.activate(e),onSuccess:()=>{C.success("Subscriber activated"),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to activate")}}),_s=a({mutationFn:e=>g.deactivate(e),onSuccess:()=>{C.success("Subscriber deactivated"),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to deactivate")}}),Cs=a({mutationFn:({id:e,amount:s,reason:a})=>g.refill(e,{amount:s,reason:a}),onSuccess:()=>{C.success("Account refilled successfully"),Ke(null),Xe(""),Ve(""),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to refill")}}),ks=a({mutationFn:e=>g.ping(e),onSuccess:e=>{const s=e.data.data;C.success(`Ping result: ${s.output}`)},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to ping")}}),Ss=a({mutationFn:e=>g.delete(e),onSuccess:()=>{C.success("Subscriber deleted"),hs(),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}}),Fs=a({mutationFn:({file:e,serviceId:s})=>{const a=new FormData;return a.append("file",e),a.append("service_id",s),g.bulkImport(a)},onSuccess:e=>{Be(e.data.data),C.success(e.data.message),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to import")}}),As=a({mutationFn:({ids:e,action:s})=>g.bulkAction({ids:e,action:s}),onSuccess:e=>{C.success(e.data.message),hs(),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to perform action")}});a({mutationFn:e=>g.restore(e),onSuccess:()=>{C.success("Subscriber restored"),hs(),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to restore")}}),a({mutationFn:e=>g.permanentDelete(e),onSuccess:()=>{C.success("Subscriber permanently deleted"),hs(),ne.invalidateQueries(["subscribers"])},onError:e=>{var s,a;return C.error((null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.message)||"Failed to delete")}});const Ms=e=>{var s;const a=Array.from(Se);if(0!==a.length)if(a.length>1)As.mutate({ids:a,action:e});else{const t=a[0],r=xs[0];switch(e){case"renew":bs.mutate(t);break;case"disconnect":ps.mutate(t);break;case"reset_fup":gs.mutate(t);break;case"enable":ws.mutate(t);break;case"disable":_s.mutate(t);break;case"ping":ks.mutate(t);break;case"delete":confirm("Are you sure you want to delete this subscriber?")&&Ss.mutate(t);break;case"reset_mac":Ke({type:"resetMac",subscriber:r}),Xe((null==r?void 0:r.mac_address)||"");break;case"add_days":Ke({type:"addDays",subscriber:r});break;case"change_service":Ke({type:"changeService",subscriber:r}),Xe((null==(s=null==r?void 0:r.service_id)?void 0:s.toString())||"");break;case"rename":Ke({type:"rename",subscriber:r});break;case"refill":Ke({type:"refill",subscriber:r})}}},Es=e=>{const s=Array.from(Se);0!==s.length&&("delete"!==e||confirm(`Delete ${s.length} subscriber(s)?`))&&As.mutate({ids:s,action:e})},Ps=r.useMemo(()=>[{id:"status_indicator",header:"",cell:({row:e})=>{const s=Z(e.original);return t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("span",{className:_("w-3 h-3 rounded-full",s.color,e.original.is_online&&"animate-pulse")})})},size:30},...Ae.username?[{accessorKey:"username",header:"Username",cell:({row:e})=>t.jsx("div",{children:t.jsxs("span",{className:"inline-flex items-center gap-1",children:[t.jsx(n,{to:`/subscribers/${e.original.id}`,className:"font-semibold text-primary-600 hover:text-primary-800 hover:underline",onClick:e=>e.stopPropagation(),children:e.original.username}),e.original.is_online&&t.jsx("button",{onClick:s=>{s.stopPropagation(),es(e.original),as(null),fs(e.original)},className:"text-green-500 hover:text-green-700",title:"Live Traffic (Torch)",children:t.jsx(d,{className:"w-4 h-4"})}),e.original.fup_level>0&&t.jsxs("span",{className:"inline-block px-1.5 py-0.5 text-[10px] font-bold text-white rounded whitespace-nowrap "+(1===e.original.fup_level?"bg-yellow-500":2===e.original.fup_level?"bg-orange-500":"bg-red-600"),children:["FUP",e.original.fup_level]})]})})}]:[],...Ae.full_name?[{accessorKey:"full_name",header:"Fullname"}]:[],...Ae.phone?[{accessorKey:"phone",header:"Phone"}]:[],...Ae.mac_address?[{accessorKey:"mac_address",header:"MAC",cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"font-mono text-xs",children:e.original.mac_address||"N/A"}),e.original.mac_address&&t.jsx("button",{onClick:s=>{s.stopPropagation(),Ke({type:"resetMac",subscriber:e.original}),Xe(e.original.mac_address)},className:"text-gray-400 hover:text-primary-600",title:"Reset MAC",children:t.jsx(o,{className:"w-3.5 h-3.5"})})]})}]:[],...Ae.ip_address?[{accessorKey:"ip_address",header:"IP",cell:({row:e})=>t.jsx("span",{className:_("font-mono text-xs",e.original.is_online?"text-green-600 font-medium":"text-gray-500"),children:e.original.ip_address||e.original.static_ip||"N/A"})}]:[],...Ae.service?[{accessorKey:"service.name",header:"Service",cell:({row:e})=>{var s,a;const r=e.original.daily_quota_used||0,l=(null==(s=e.original.service)?void 0:s.daily_quota)||0,n=(null==(a=e.original.service)?void 0:a.name)||"-";if(0===l)return t.jsx("div",{className:"text-center font-medium",children:n});const i=Math.min(100,r/l*100),c=z(r);return t.jsxs("div",{className:"min-w-[120px]",children:[t.jsx("div",{className:"text-center font-medium text-sm",children:n}),t.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-4 mt-1 relative border border-gray-300",children:[t.jsx("div",{className:"h-full rounded-full transition-all "+(i>=100?"bg-red-500":i>=50?"bg-yellow-500":"bg-teal-500"),style:{width:`${Math.min(100,i)}%`}}),t.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800",children:c})]})]})}}]:[],...Ae.status?[{accessorKey:"status",header:"Status",cell:({row:e})=>{const s=Z(e.original);return t.jsx("span",{className:_("text-xs font-medium",s.textColor),children:s.text})}}]:[],...Ae.expiry_date?[{accessorKey:"expiry_date",header:"Expiry",cell:({row:e})=>{if(!e.original.expiry_date)return"-";const s=new Date(e.original.expiry_date),a=s<new Date,r=Math.ceil((s-new Date)/864e5);return t.jsxs("div",{children:[t.jsx("div",{className:_(a?"text-red-600":"text-gray-900","text-sm"),children:c(e.original.expiry_date)}),t.jsx("div",{className:_("text-xs",a?"text-red-500":"text-gray-500"),children:a?`${Math.abs(r)}d ago`:`${r}d left`})]})}}]:[],...Ae.monthly_quota?[{id:"monthly_quota",header:"Monthly",cell:({row:e})=>{var s;const a=e.original.monthly_quota_used||0,r=(null==(s=e.original.service)?void 0:s.monthly_quota)||0;if(0===r)return t.jsx("span",{className:"text-gray-400 text-xs",children:"Unlimited"});const l=Math.min(100,a/r*100),n=z(a);return t.jsx("div",{className:"min-w-[80px]",children:t.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-3 relative border border-gray-300",children:[t.jsx("div",{className:"h-full rounded-full "+(l>=100?"bg-red-500":l>=50?"bg-yellow-500":"bg-teal-500"),style:{width:`${Math.min(100,l)}%`}}),t.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-medium",children:n})]})})}}]:[],...Ae.balance?[{accessorKey:"credit_balance",header:"Balance",cell:({row:e})=>t.jsxs("span",{className:"font-medium",children:["$",(e.original.credit_balance||0).toFixed(2)]})}]:[],...Ae.address?[{accessorKey:"address",header:"Address"}]:[],...Ae.region?[{accessorKey:"region",header:"Region"}]:[],..."archived"===Ce?[{accessorKey:"deleted_at",header:"Deleted At",cell:({row:e})=>c(e.original.deleted_at)}]:[]],[Ce,Ae]),Rs=y({data:(null==is?void 0:is.data)||[],columns:Ps,state:{sorting:we},onSortingChange:_e,getCoreRowModel:w(),getSortedRowModel:f(),manualPagination:!0,pageCount:Math.ceil(((null==($=null==is?void 0:is.meta)?void 0:$.total)||0)/me)}),Is=Math.ceil(((null==(O=null==is?void 0:is.meta)?void 0:O.total)||0)/me),Ds=(null==is?void 0:is.stats)||{},Us=((null==is?void 0:is.data)||[]).length>0&&Se.size===((null==is?void 0:is.data)||[]).length;return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Subscribers"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>{const e=(null==is?void 0:is.data)||[];if(0===e.length)return void C.error("No data to export");const s=[["Username","Full Name","Phone","Email","Service","MAC Address","IP Address","Status","Expiry Date"],...e.map(e=>{var s;return[e.username,e.full_name,e.phone,e.email,null==(s=e.service)?void 0:s.name,e.mac_address,e.ip_address||e.static_ip,e.status,e.expiry_date?c(e.expiry_date):""]})].map(e=>e.map(e=>`"${e||""}"`).join(",")).join("\n"),a=new Blob([s],{type:"text/csv"}),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`subscribers_${(new Date).toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(t),C.success("Exported to CSV")},className:"btn btn-secondary btn-sm flex items-center gap-1",children:[t.jsx(m,{className:"w-3.5 h-3.5"}),"Export"]}),ie("subscribers.create")&&t.jsxs("button",{onClick:()=>Ie(!0),className:"btn btn-secondary btn-sm flex items-center gap-1",children:[t.jsx(k,{className:"w-3.5 h-3.5"}),"Import CSV"]}),ie("subscribers.create")&&t.jsxs(n,{to:"/subscribers/import",className:"btn btn-secondary btn-sm flex items-center gap-1",children:[t.jsx(S,{className:"w-3.5 h-3.5"}),"Import Excel"]}),t.jsx("button",{onClick:()=>ds(),className:"btn btn-secondary btn-sm flex items-center gap-1",children:t.jsx(o,{className:"w-3.5 h-3.5"})}),ie("subscribers.create")&&t.jsxs(n,{to:"/subscribers/new",className:"btn btn-primary btn-sm flex items-center gap-1",children:[t.jsx(x,{className:"w-3.5 h-3.5"}),"Add"]})]})]}),t.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 bg-white rounded-lg border text-sm",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),t.jsx("span",{className:"font-semibold text-green-600",children:Ds.online||0}),t.jsx("span",{className:"text-gray-500",children:"Online"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),t.jsx("span",{className:"font-semibold text-red-600",children:Ds.offline||0}),t.jsx("span",{className:"text-gray-500",children:"Offline"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),t.jsx("span",{className:"font-semibold text-blue-600",children:Ds.active||0}),t.jsx("span",{className:"text-gray-500",children:"Active"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),t.jsx("span",{className:"font-semibold text-gray-600",children:Ds.inactive||0}),t.jsx("span",{className:"text-gray-500",children:"Inactive"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),t.jsx("span",{className:"font-semibold text-yellow-600",children:Ds.expired||0}),t.jsx("span",{className:"text-gray-500",children:"Expired"})]}),t.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[t.jsx("span",{className:"font-semibold text-gray-700",children:(null==(q=null==is?void 0:is.meta)?void 0:q.total)||0}),t.jsx("span",{className:"text-gray-500",children:"Total"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex rounded-lg border bg-gray-100 p-0.5",children:[t.jsx("button",{onClick:()=>{ke("active"),oe(1),hs()},className:_("px-3 py-1 text-sm font-medium rounded-md transition-colors","active"===Ce?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Active"}),t.jsxs("button",{onClick:()=>{ke("archived"),oe(1),hs()},className:_("px-3 py-1 text-sm font-medium rounded-md transition-colors flex items-center gap-1","archived"===Ce?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[t.jsx(L,{className:"w-3.5 h-3.5"}),"Archived"]})]}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(F,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search username, name, phone, MAC, IP...",value:ue,onChange:e=>{he(e.target.value),oe(1)},className:"input input-sm pl-8 w-full"})]}),"active"===Ce&&t.jsxs(t.Fragment,{children:[t.jsx("select",{value:be,onChange:e=>{pe(e.target.value),oe(1)},className:"input input-sm w-32",children:H.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsxs("button",{onClick:()=>fe(!Ne),className:_("btn btn-secondary btn-sm flex items-center gap-1",Ne&&"bg-primary-50 text-primary-600"),children:[t.jsx(A,{className:"w-3.5 h-3.5"}),"Filters"]}),t.jsxs("button",{onClick:()=>Pe(!Ee),className:_("btn btn-secondary btn-sm flex items-center gap-1",Ee&&"bg-primary-50 text-primary-600"),children:[t.jsx(P,{className:"w-3.5 h-3.5"}),"Columns"]})]})]}),(Ne||Ee)&&t.jsxs("div",{className:"card p-3",children:[Ee&&t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:"Visible Columns"}),t.jsx("div",{className:"flex flex-wrap gap-1.5",children:Object.entries(Ae).map(([e,s])=>t.jsxs("label",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-100 rounded cursor-pointer hover:bg-gray-200 text-xs",children:[t.jsx("input",{type:"checkbox",checked:s,onChange:s=>Me({...Ae,[e]:s.target.checked}),className:"rounded border-gray-300 w-3 h-3"}),t.jsx("span",{className:"capitalize",children:e.replace("_"," ")})]},e))})]}),Ne&&"active"===Ce&&t.jsx("div",{className:Ee?"mt-3 pt-3 border-t":"",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500",children:"Service"}),t.jsxs("select",{value:ge,onChange:e=>{ve(e.target.value),oe(1)},className:"input input-sm w-40",children:[t.jsx("option",{value:"",children:"All Services"}),null==os?void 0:os.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500",children:"NAS"}),t.jsxs("select",{value:je,onChange:e=>{ye(e.target.value),oe(1)},className:"input input-sm w-40",children:[t.jsx("option",{value:"",children:"All NAS"}),null==ms?void 0:ms.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-500",children:"Per Page"}),t.jsxs("select",{value:me,onChange:e=>{xe(parseInt(e.target.value)),oe(1)},className:"input input-sm w-20",children:[t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"25",children:"25"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]})]}),t.jsx("button",{onClick:()=>{he(""),pe(""),ve(""),ye(""),oe(1)},className:"btn btn-secondary btn-sm mt-4",children:"Clear"})]})})]}),t.jsx("div",{className:"card p-2",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[t.jsxs("button",{onClick:()=>{const e=(null==is?void 0:is.data)||[];Se.size===e.length?Fe(new Set):Fe(new Set(e.map(e=>e.id)))},className:_("btn btn-sm flex items-center gap-1",Us?"btn-primary":"btn-secondary"),children:[t.jsx(V,{className:"w-4 h-4"}),Us?"Deselect All":"Select All"]}),t.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),ie("subscribers.renew")&&t.jsxs("button",{onClick:()=>Es("renew"),disabled:0===us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(u,{className:"w-4 h-4"}),"Renew"]}),ie("subscribers.reset_fup")&&t.jsxs("button",{onClick:()=>Es("reset_fup"),disabled:0===us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(o,{className:"w-4 h-4"}),"Reset FUP"]}),ie("subscribers.inactivate")&&t.jsxs("button",{onClick:()=>Es("enable"),disabled:0===us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(R,{className:"w-4 h-4"}),"Activate"]}),ie("subscribers.inactivate")&&t.jsxs("button",{onClick:()=>Es("disable"),disabled:0===us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(X,{className:"w-4 h-4"}),"Deactivate"]}),ie("subscribers.disconnect")&&t.jsxs("button",{onClick:()=>Es("disconnect"),disabled:0===us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(I,{className:"w-4 h-4"}),"Disconnect"]}),t.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),ie("subscribers.rename")&&t.jsxs("button",{onClick:()=>Ms("rename"),disabled:1!==us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(K,{className:"w-4 h-4"}),"Rename"]}),ie("subscribers.add_days")&&t.jsxs("button",{onClick:()=>Ms("add_days"),disabled:1!==us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(h,{className:"w-4 h-4"}),"Add Days"]}),ie("subscribers.change_service")&&t.jsxs("button",{onClick:()=>Ms("change_service"),disabled:1!==us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(B,{className:"w-4 h-4"}),"Change Service"]}),ie("subscribers.refill_quota")&&t.jsxs("button",{onClick:()=>Ms("refill"),disabled:1!==us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(D,{className:"w-4 h-4"}),"Refill"]}),ie("subscribers.ping")&&t.jsxs("button",{onClick:()=>Ms("ping"),disabled:1!==us,className:"btn btn-secondary btn-sm flex items-center gap-1 disabled:opacity-40",children:[t.jsx(b,{className:"w-4 h-4"}),"Ping"]}),t.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),ie("subscribers.delete")&&t.jsxs("button",{onClick:()=>Es("delete"),disabled:0===us,className:"btn btn-sm flex items-center gap-1 bg-red-50 text-red-600 hover:bg-red-100 border-red-200 disabled:opacity-40",children:[t.jsx(U,{className:"w-4 h-4"}),"Delete"]}),us>0&&t.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm",children:[t.jsxs("span",{className:"font-semibold text-primary-600",children:[us," selected"]}),t.jsx("button",{onClick:hs,className:"text-gray-500 hover:text-gray-700",children:t.jsx(p,{className:"w-4 h-4"})})]})]})}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"table table-compact",children:[t.jsx("thead",{children:Rs.getHeaderGroups().map(e=>t.jsx("tr",{children:e.headers.map(e=>t.jsx("th",{onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,className:_(e.column.getCanSort()&&"cursor-pointer select-none","text-center"),children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[N(e.column.columnDef.header,e.getContext()),"asc"===e.column.getIsSorted()&&" ▲","desc"===e.column.getIsSorted()&&" ▼"]})},e.id))},e.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:cs?t.jsx("tr",{children:t.jsx("td",{colSpan:Ps.length,className:"text-center py-8",children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})})})}):0===Rs.getRowModel().rows.length?t.jsx("tr",{children:t.jsx("td",{colSpan:Ps.length,className:"text-center py-8 text-gray-500",children:"archived"===Ce?"No archived subscribers":"No subscribers found"})}):Rs.getRowModel().rows.map(e=>{const s=Se.has(e.original.id);return t.jsx("tr",{className:_("cursor-pointer transition-colors",s?"bg-red-50 border-b-2 border-red-400 text-red-700":"hover:bg-gray-50"),onClick:()=>{return s=e.original.id,void Fe(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},children:e.getVisibleCells().map(e=>t.jsx("td",{className:"text-center",children:N(e.column.columnDef.cell,e.getContext())},e.id))},e.id)})})]})}),t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-t text-xs",children:[t.jsxs("span",{className:"text-gray-500",children:[(de-1)*me+1,"-",Math.min(de*me,(null==(Q=null==is?void 0:is.meta)?void 0:Q.total)||0)," of ",(null==(T=null==is?void 0:is.meta)?void 0:T.total)||0]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>oe(e=>Math.max(1,e-1)),disabled:1===de,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50",children:t.jsx(M,{className:"w-4 h-4"})}),t.jsxs("span",{className:"px-2 text-gray-600",children:[de,"/",Is||1]}),t.jsx("button",{onClick:()=>oe(e=>Math.min(Is,e+1)),disabled:de>=Is,className:"p-1 rounded hover:bg-gray-100 disabled:opacity-50",children:t.jsx(E,{className:"w-4 h-4"})})]})]})]}),"resetMac"===(null==qe?void 0:qe.type)&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Reset MAC Address"}),t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["User: ",t.jsx("strong",{children:qe.subscriber.username})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Current MAC: ",t.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:qe.subscriber.mac_address||"None"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"New MAC Address (leave empty to clear)"}),t.jsx("input",{type:"text",value:Qe,onChange:e=>Xe(e.target.value),className:"input font-mono",placeholder:"XX:XX:XX:XX:XX:XX"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Reason"}),t.jsxs("select",{value:Te,onChange:e=>Ve(e.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Select reason..."}),t.jsx("option",{value:"device_change",children:"User switched device"}),t.jsx("option",{value:"account_sharing",children:"Prevent account sharing"}),t.jsx("option",{value:"network_card_change",children:"Network card changed"}),t.jsx("option",{value:"sync_from_radius",children:"Sync from RADIUS"}),t.jsx("option",{value:"security",children:"Security issue"}),t.jsx("option",{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:()=>vs.mutate({id:qe.subscriber.id,mac_address:Qe||null,reason:Te}),disabled:vs.isPending,className:"btn btn-primary",children:vs.isPending?"Resetting...":"Reset MAC"})]})]})}),"rename"===(null==qe?void 0:qe.type)&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Rename Username"}),t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsx("div",{children:t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Current Username: ",t.jsx("strong",{children:qe.subscriber.username})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"New Username *"}),t.jsx("input",{type:"text",value:Qe,onChange:e=>Xe(e.target.value),className:"input",placeholder:"Enter new username"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Reason"}),t.jsx("input",{type:"text",value:Te,onChange:e=>Ve(e.target.value),className:"input",placeholder:"Enter reason for change"})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:()=>js.mutate({id:qe.subscriber.id,new_username:Qe,reason:Te}),disabled:!Qe||js.isPending,className:"btn btn-primary",children:js.isPending?"Renaming...":"Rename"})]})]})}),"addDays"===(null==qe?void 0:qe.type)&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Add/Subtract Days"}),t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["User: ",t.jsx("strong",{children:qe.subscriber.username})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Current Expiry: ",t.jsx("strong",{children:qe.subscriber.expiry_date?c(qe.subscriber.expiry_date):"N/A"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Days *"}),t.jsx("input",{type:"number",value:Qe,onChange:e=>Xe(e.target.value),className:"input",placeholder:"Enter days (negative to subtract)"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use negative number to subtract days"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Reason"}),t.jsxs("select",{value:Te,onChange:e=>Ve(e.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Select reason..."}),t.jsx("option",{value:"compensation",children:"Compensation"}),t.jsx("option",{value:"overdue_fix",children:"Overdue fix"}),t.jsx("option",{value:"promotion",children:"Promotion"}),t.jsx("option",{value:"manual_adjustment",children:"Manual adjustment"}),t.jsx("option",{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:()=>ys.mutate({id:qe.subscriber.id,days:parseInt(Qe),reason:Te}),disabled:!Qe||ys.isPending,className:"btn btn-primary",children:ys.isPending?"Updating...":"Apply"})]})]})}),"changeService"===(null==qe?void 0:qe.type)&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal max-w-lg",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Change Service"}),t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve(""),We(null),Ze({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0})},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["User: ",t.jsx("strong",{children:qe.subscriber.username})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Current Service: ",t.jsx("strong",{children:(null==(W=qe.subscriber.service)?void 0:W.name)||"N/A"})," - $",(null==(J=null==(G=qe.subscriber.service)?void 0:G.price)?void 0:J.toFixed(2))||"0.00"]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Expiry: ",t.jsx("strong",{children:qe.subscriber.expiry_date?new Date(qe.subscriber.expiry_date).toLocaleDateString():"N/A"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"New Service *"}),t.jsxs("select",{value:Qe,onChange:e=>{Xe(e.target.value),e.target.value?(async(e,s)=>{var a;if(e&&s){Je(!0);try{const t=await g.calculateChangeServicePrice(e,s);We(null==(a=t.data)?void 0:a.data)}catch(t){We(null)}finally{Je(!1)}}else We(null)})(qe.subscriber.id,e.target.value):We(null)},className:"input",children:[t.jsx("option",{value:"",children:"Select Service"}),null==os?void 0:os.map(e=>{var s;return t.jsxs("option",{value:e.id,children:[e.name," - $",null==(s=e.price)?void 0:s.toFixed(2)]},e.id)})]})]}),Ge&&t.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-600",children:"Calculating price..."}),ze&&!Ge&&t.jsxs("div",{className:"p-3 rounded-lg text-sm "+(ze.is_upgrade?"bg-blue-50 border border-blue-200":ze.is_downgrade?"bg-yellow-50 border border-yellow-200":"bg-gray-50"),children:[t.jsx("div",{className:"font-semibold mb-2",children:ze.is_upgrade?"⬆️ Upgrade":ze.is_downgrade?"⬇️ Downgrade":"↔️ Same Price"}),t.jsxs("div",{className:"space-y-1 text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Remaining days:"}),t.jsxs("span",{className:"font-medium",children:[ze.remaining_days," days"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Old day price:"}),t.jsxs("span",{children:["$",null==(Y=ze.old_day_price)?void 0:Y.toFixed(2),"/day"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"New day price:"}),t.jsxs("span",{children:["$",null==(ee=ze.new_day_price)?void 0:ee.toFixed(2),"/day"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Credit from old service:"}),t.jsxs("span",{className:"text-green-600",children:["-$",null==(se=ze.old_credit)?void 0:se.toFixed(2)]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Cost for new service:"}),t.jsxs("span",{className:"text-red-600",children:["+$",null==(ae=ze.new_cost)?void 0:ae.toFixed(2)]})]}),ze.change_fee>0&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Change fee:"}),t.jsxs("span",{children:["+$",null==(te=ze.change_fee)?void 0:te.toFixed(2)]})]}),t.jsxs("div",{className:"border-t pt-1 mt-1 flex justify-between font-semibold",children:[t.jsxs("span",{children:["Total to ",ze.total_charge>=0?"charge":"refund",":"]}),t.jsxs("span",{className:ze.total_charge>=0?"text-red-600":"text-green-600",children:["$",null==(re=Math.abs(ze.total_charge))?void 0:re.toFixed(2)]})]})]}),ze.is_downgrade&&!ze.downgrade_allowed&&t.jsx("div",{className:"mt-2 text-red-600 font-medium",children:"⚠️ Downgrade is not allowed by system settings"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:He.extend_expiry,onChange:e=>Ze({...He,extend_expiry:e.target.checked}),className:"rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"Extend Expiry"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:He.reset_fup,onChange:e=>Ze({...He,reset_fup:e.target.checked}),className:"rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"Reset FUP Quota"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:He.prorate_price,onChange:e=>Ze({...He,prorate_price:e.target.checked,charge_price:!1}),className:"rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"Prorate Price (recommended)"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:He.charge_price,onChange:e=>Ze({...He,charge_price:e.target.checked,prorate_price:!1}),className:"rounded border-gray-300"}),t.jsx("span",{className:"text-sm",children:"Charge Full Price"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Reason"}),t.jsx("input",{type:"text",value:Te,onChange:e=>Ve(e.target.value),className:"input",placeholder:"Enter reason for change"})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve(""),We(null),Ze({extend_expiry:!1,reset_fup:!1,charge_price:!1,prorate_price:!0})},className:"btn btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:()=>Ns.mutate({id:qe.subscriber.id,service_id:parseInt(Qe),...He,reason:Te}),disabled:!Qe||Ns.isPending||(null==ze?void 0:ze.is_downgrade)&&!(null==ze?void 0:ze.downgrade_allowed),className:"btn btn-primary",children:Ns.isPending?"Changing...":"Change Service"})]})]})}),"refill"===(null==qe?void 0:qe.type)&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Refill Account"}),t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsx("div",{children:t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["User: ",t.jsx("strong",{children:qe.subscriber.username})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Amount *"}),t.jsx("input",{type:"number",step:"0.01",min:"0",value:Qe,onChange:e=>Xe(e.target.value),className:"input",placeholder:"Enter amount"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Reason"}),t.jsxs("select",{value:Te,onChange:e=>Ve(e.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Select reason..."}),t.jsx("option",{value:"prepaid_card",children:"Prepaid Card"}),t.jsx("option",{value:"cash_payment",children:"Cash Payment"}),t.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),t.jsx("option",{value:"credit",children:"Credit"}),t.jsx("option",{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ke(null),Xe(""),Ve("")},className:"btn btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:()=>Cs.mutate({id:qe.subscriber.id,amount:parseFloat(Qe),reason:Te}),disabled:!Qe||parseFloat(Qe)<=0||Cs.isPending,className:"btn btn-primary",children:Cs.isPending?"Refilling...":"Refill"})]})]})}),Re&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal modal-lg",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"Bulk Import Subscribers"}),t.jsx("button",{onClick:()=>{Ie(!1),Ue(null),Be(null)},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"CSV File"}),t.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer hover:border-primary-400",onClick:()=>{var e;return null==(e=ce.current)?void 0:e.click()},children:[t.jsx(S,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-gray-600",children:De?De.name:"Click to select CSV file"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Columns: username, password, full_name, email, phone, address"})]}),t.jsx("input",{ref:ce,type:"file",accept:".csv",onChange:e=>{var s;return Ue((null==(s=e.target.files)?void 0:s[0])||null)},className:"hidden"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label",children:"Service Plan *"}),t.jsxs("select",{value:$e,onChange:e=>Le(e.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Select Service"}),null==os?void 0:os.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),Oe&&t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto",children:[t.jsx("h4",{className:"font-medium mb-2",children:"Import Results"}),t.jsxs("p",{className:"text-sm text-green-600",children:["Created: ",Oe.created]}),t.jsxs("p",{className:"text-sm text-red-600",children:["Failed: ",Oe.failed]}),null==(le=Oe.results)?void 0:le.filter(e=>!e.success).slice(0,10).map((e,s)=>t.jsxs("p",{className:"text-xs text-red-500",children:["Row ",e.row,": ",e.message]},s))]})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{onClick:()=>{Ie(!1),Ue(null),Be(null)},className:"btn btn-secondary",children:"Close"}),t.jsxs("button",{onClick:()=>{De&&$e?Fs.mutate({file:De,serviceId:$e}):C.error("Please select a file and service")},disabled:!De||!$e||Fs.isPending,className:"btn btn-primary flex items-center gap-2",children:[Fs.isPending?t.jsx(o,{className:"w-4 h-4 animate-spin"}):t.jsx(k,{className:"w-4 h-4"}),"Import"]})]})]})}),Ye&&t.jsx("div",{className:"modal-overlay",children:t.jsxs("div",{className:"modal-content max-w-2xl",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[t.jsx(d,{className:"w-5 h-5 text-green-500"}),"Live Traffic - ",Ye.username]}),t.jsx("button",{onClick:()=>{es(null),as(null),ns(!1)},className:"btn btn-ghost btn-sm",children:t.jsx(p,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"modal-body",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-500",children:["IP: ",t.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:Ye.ip_address||"N/A"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[ls&&t.jsxs("div",{className:"flex items-center gap-1.5 text-green-600",children:[t.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"})]}),t.jsx("span",{className:"text-xs font-medium",children:"LIVE"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:ls,onChange:e=>ns(e.target.checked),className:"rounded"}),"Auto-refresh"]}),t.jsxs("button",{onClick:()=>fs(Ye),disabled:ts,className:"btn btn-sm btn-secondary flex items-center gap-1",children:[t.jsx(o,{className:_("w-4 h-4",ts&&"animate-spin")}),"Refresh"]})]})]}),ts&&!ss&&t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),t.jsx("span",{className:"ml-3 text-gray-500",children:"Capturing traffic..."})]}),ss&&t.jsxs("div",{children:[t.jsxs("div",{className:"bg-gray-900 text-white rounded-t-lg p-3 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"text-gray-400",children:"Interface:"}),t.jsx("span",{className:"font-mono text-green-400",children:ss.interface})]}),t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Download:"}),t.jsxs("span",{className:"ml-2 text-green-400 font-bold",children:[(8*(ss.total_tx||0)/1e6).toFixed(1)," Mbps"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Upload:"}),t.jsxs("span",{className:"ml-2 text-blue-400 font-bold",children:[(8*(ss.total_rx||0)/1e6).toFixed(1)," Mbps"]})]})]})]}),ss.entries&&ss.entries.length>0?t.jsxs("div",{className:"border border-gray-300 rounded-b-lg overflow-hidden",children:[t.jsx("div",{className:"max-h-80 overflow-y-auto",children:t.jsxs("table",{className:"w-full text-xs font-mono",children:[t.jsx("thead",{className:"bg-gray-100 sticky top-0",children:t.jsxs("tr",{className:"text-gray-600",children:[t.jsx("th",{className:"px-2 py-1.5 text-left border-r",children:"Proto"}),t.jsx("th",{className:"px-2 py-1.5 text-left border-r",children:"Src. Address"}),t.jsx("th",{className:"px-2 py-1.5 text-left border-r",children:"Dst. Address"}),t.jsx("th",{className:"px-2 py-1.5 text-right border-r",children:"Download"}),t.jsx("th",{className:"px-2 py-1.5 text-right border-r",children:"Upload"}),t.jsx("th",{className:"px-2 py-1.5 text-right border-r",children:"DL Pkt"}),t.jsx("th",{className:"px-2 py-1.5 text-right",children:"UL Pkt"})]})}),t.jsx("tbody",{className:"bg-white",children:ss.entries.slice(0,100).map((e,s)=>t.jsxs("tr",{className:_("border-t border-gray-100 hover:bg-blue-50",e.tx_rate>1e6&&"bg-green-50",e.tx_rate>5e6&&"bg-yellow-50"),children:[t.jsx("td",{className:"px-2 py-1 border-r",children:t.jsxs("span",{className:_("uppercase","tcp"===e.protocol&&"text-blue-600","udp"===e.protocol&&"text-purple-600","icmp"===e.protocol&&"text-orange-600"),children:[e.proto_num||""," ",e.protocol||"-"]})}),t.jsxs("td",{className:"px-2 py-1 border-r text-gray-700",children:[e.src_address,e.src_port>0&&`:${e.src_port}`]}),t.jsxs("td",{className:"px-2 py-1 border-r text-gray-700",children:[e.dst_address,e.dst_port>0&&`:${e.dst_port}`]}),t.jsx("td",{className:"px-2 py-1 border-r text-right text-green-700 font-medium",children:e.tx_rate>1e6?`${(8*e.tx_rate/1e6).toFixed(1)} Mbps`:e.tx_rate>1e3?`${(8*e.tx_rate/1e3).toFixed(1)} kbps`:`${(8*e.tx_rate).toFixed(0)} bps`}),t.jsx("td",{className:"px-2 py-1 border-r text-right text-blue-700 font-medium",children:e.rx_rate>1e6?`${(8*e.rx_rate/1e6).toFixed(1)} Mbps`:e.rx_rate>1e3?`${(8*e.rx_rate/1e3).toFixed(1)} kbps`:`${(8*e.rx_rate).toFixed(0)} bps`}),t.jsx("td",{className:"px-2 py-1 border-r text-right text-gray-500",children:e.tx_packets||0}),t.jsx("td",{className:"px-2 py-1 text-right text-gray-500",children:e.rx_packets||0})]},s))})]})}),t.jsxs("div",{className:"bg-gray-100 px-3 py-1.5 text-xs text-gray-500 border-t flex justify-between",children:[t.jsxs("span",{children:[ss.entries.length," flows"]}),t.jsxs("span",{children:["Duration: ",ss.duration]})]})]}):t.jsx("div",{className:"border border-gray-300 rounded-b-lg p-8 text-center text-gray-500 bg-gray-50",children:"No active traffic flows detected"})]}),!ts&&!ss&&t.jsx("div",{className:"text-center py-8 text-gray-500",children:"Click Refresh to capture traffic data"})]}),t.jsx("div",{className:"modal-footer",children:t.jsx("button",{onClick:()=>{es(null),as(null),ns(!1)},className:"btn btn-secondary",children:"Close"})})]})})]})}export{W as default};
